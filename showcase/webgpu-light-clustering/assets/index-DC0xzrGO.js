(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var stats_min$1={exports:{}},stats_min=stats_min$1.exports,hasRequiredStats_min;function requireStats_min(){return hasRequiredStats_min||(hasRequiredStats_min=1,(function(t,e){(function(n,r){t.exports=r()})(stats_min,function(){var n=function(){function r(G){return c.appendChild(G.dom),G}function s(G){for(var P=0;P<c.children.length;P++)c.children[P].style.display=P===G?"block":"none";o=G}var o=0,c=document.createElement("div");c.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",c.addEventListener("click",function(G){G.preventDefault(),s(++o%c.children.length)},!1);var d=(performance||Date).now(),p=d,T=0,S=r(new n.Panel("FPS","#0ff","#002")),R=r(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var x=r(new n.Panel("MB","#f08","#201"));return s(0),{REVISION:16,dom:c,addPanel:r,showPanel:s,begin:function(){d=(performance||Date).now()},end:function(){T++;var G=(performance||Date).now();if(R.update(G-d,200),G>p+1e3&&(S.update(1e3*T/(G-p),100),p=G,T=0,x)){var P=performance.memory;x.update(P.usedJSHeapSize/1048576,P.jsHeapSizeLimit/1048576)}return G},update:function(){d=this.end()},domElement:c,setMode:s}};return n.Panel=function(r,s,o){var c=1/0,d=0,p=Math.round,T=p(window.devicePixelRatio||1),S=80*T,R=48*T,x=3*T,G=2*T,P=3*T,U=15*T,H=74*T,X=30*T,$=document.createElement("canvas");$.width=S,$.height=R,$.style.cssText="width:80px;height:48px";var K=$.getContext("2d");return K.font="bold "+9*T+"px Helvetica,Arial,sans-serif",K.textBaseline="top",K.fillStyle=o,K.fillRect(0,0,S,R),K.fillStyle=s,K.fillText(r,x,G),K.fillRect(P,U,H,X),K.fillStyle=o,K.globalAlpha=.9,K.fillRect(P,U,H,X),{dom:$,update:function(q,te){c=Math.min(c,q),d=Math.max(d,q),K.fillStyle=o,K.globalAlpha=1,K.fillRect(0,0,S,U),K.fillStyle=s,K.fillText(p(q)+" "+r+" ("+p(c)+"-"+p(d)+")",x,G),K.drawImage($,P+T,U,H-T,X,P,U,H-T,X),K.fillRect(P+H-T,U,T,X),K.fillStyle=o,K.globalAlpha=.9,K.fillRect(P+H-T,U,T,p((1-q/te)*X))}}},n})})(stats_min$1)),stats_min$1.exports}var stats_minExports=requireStats_min();const Stats=getDefaultExportFromCjs(stats_minExports);function ___$insertStyle(t){if(!(typeof window>"u")){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}function colorToString(t,e){var n=t.__state.conversionName.toString(),r=Math.round(t.r),s=Math.round(t.g),o=Math.round(t.b),c=t.a,d=Math.round(t.h),p=t.s.toFixed(1),T=t.v.toFixed(1);if(e||n==="THREE_CHAR_HEX"||n==="SIX_CHAR_HEX"){for(var S=t.hex.toString(16);S.length<6;)S="0"+S;return"#"+S}else{if(n==="CSS_RGB")return"rgb("+r+","+s+","+o+")";if(n==="CSS_RGBA")return"rgba("+r+","+s+","+o+","+c+")";if(n==="HEX")return"0x"+t.hex.toString(16);if(n==="RGB_ARRAY")return"["+r+","+s+","+o+"]";if(n==="RGBA_ARRAY")return"["+r+","+s+","+o+","+c+"]";if(n==="RGB_OBJ")return"{r:"+r+",g:"+s+",b:"+o+"}";if(n==="RGBA_OBJ")return"{r:"+r+",g:"+s+",b:"+o+",a:"+c+"}";if(n==="HSV_OBJ")return"{h:"+d+",s:"+p+",v:"+T+"}";if(n==="HSVA_OBJ")return"{h:"+d+",s:"+p+",v:"+T+",a:"+c+"}"}return"unknown format"}var ARR_EACH=Array.prototype.forEach,ARR_SLICE=Array.prototype.slice,Common={BREAK:{},extend:function(e){return this.each(ARR_SLICE.call(arguments,1),function(n){var r=this.isObject(n)?Object.keys(n):[];r.forEach(function(s){this.isUndefined(n[s])||(e[s]=n[s])}.bind(this))},this),e},defaults:function(e){return this.each(ARR_SLICE.call(arguments,1),function(n){var r=this.isObject(n)?Object.keys(n):[];r.forEach(function(s){this.isUndefined(e[s])&&(e[s]=n[s])}.bind(this))},this),e},compose:function(){var e=ARR_SLICE.call(arguments);return function(){for(var n=ARR_SLICE.call(arguments),r=e.length-1;r>=0;r--)n=[e[r].apply(this,n)];return n[0]}},each:function(e,n,r){if(e){if(ARR_EACH&&e.forEach&&e.forEach===ARR_EACH)e.forEach(n,r);else if(e.length===e.length+0){var s=void 0,o=void 0;for(s=0,o=e.length;s<o;s++)if(s in e&&n.call(r,e[s],s)===this.BREAK)return}else for(var c in e)if(n.call(r,e[c],c)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},debounce:function(e,n,r){var s=void 0;return function(){var o=this,c=arguments;function d(){s=null,r||e.apply(o,c)}var p=r||!s;clearTimeout(s),s=setTimeout(d,n),p&&e.apply(o,c)}},toArray:function(e){return e.toArray?e.toArray():ARR_SLICE.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return e===null},isNaN:(function(t){function e(n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e})(function(t){return isNaN(t)}),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return e instanceof Function}},INTERPRETATIONS=[{litmus:Common.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var n=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return n===null?!1:{space:"HEX",hex:parseInt("0x"+n[1].toString()+n[1].toString()+n[2].toString()+n[2].toString()+n[3].toString()+n[3].toString(),0)}},write:colorToString},SIX_CHAR_HEX:{read:function(e){var n=e.match(/^#([A-F0-9]{6})$/i);return n===null?!1:{space:"HEX",hex:parseInt("0x"+n[1].toString(),0)}},write:colorToString},CSS_RGB:{read:function(e){var n=e.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return n===null?!1:{space:"RGB",r:parseFloat(n[1]),g:parseFloat(n[2]),b:parseFloat(n[3])}},write:colorToString},CSS_RGBA:{read:function(e){var n=e.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return n===null?!1:{space:"RGB",r:parseFloat(n[1]),g:parseFloat(n[2]),b:parseFloat(n[3]),a:parseFloat(n[4])}},write:colorToString}}},{litmus:Common.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:Common.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!==3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!==4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:Common.isObject,conversions:{RGBA_OBJ:{read:function(e){return Common.isNumber(e.r)&&Common.isNumber(e.g)&&Common.isNumber(e.b)&&Common.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return Common.isNumber(e.r)&&Common.isNumber(e.g)&&Common.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return Common.isNumber(e.h)&&Common.isNumber(e.s)&&Common.isNumber(e.v)&&Common.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return Common.isNumber(e.h)&&Common.isNumber(e.s)&&Common.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],result=void 0,toReturn=void 0,interpret=function(){toReturn=!1;var e=arguments.length>1?Common.toArray(arguments):arguments[0];return Common.each(INTERPRETATIONS,function(n){if(n.litmus(e))return Common.each(n.conversions,function(r,s){if(result=r.read(e),toReturn===!1&&result!==!1)return toReturn=result,result.conversionName=s,result.conversion=r,Common.BREAK}),Common.BREAK}),toReturn},tmpComponent=void 0,ColorMath={hsv_to_rgb:function(e,n,r){var s=Math.floor(e/60)%6,o=e/60-Math.floor(e/60),c=r*(1-n),d=r*(1-o*n),p=r*(1-(1-o)*n),T=[[r,p,c],[d,r,c],[c,r,p],[c,d,r],[p,c,r],[r,c,d]][s];return{r:T[0]*255,g:T[1]*255,b:T[2]*255}},rgb_to_hsv:function(e,n,r){var s=Math.min(e,n,r),o=Math.max(e,n,r),c=o-s,d=void 0,p=void 0;if(o!==0)p=c/o;else return{h:NaN,s:0,v:0};return e===o?d=(n-r)/c:n===o?d=2+(r-e)/c:d=4+(e-n)/c,d/=6,d<0&&(d+=1),{h:d*360,s:p,v:o/255}},rgb_to_hex:function(e,n,r){var s=this.hex_with_component(0,2,e);return s=this.hex_with_component(s,1,n),s=this.hex_with_component(s,0,r),s},component_from_hex:function(e,n){return e>>n*8&255},hex_with_component:function(e,n,r){return r<<(tmpComponent=n*8)|e&~(255<<tmpComponent)}},_typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=(function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}})(),get=function t(e,n,r){e===null&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,n);if(s===void 0){var o=Object.getPrototypeOf(e);return o===null?void 0:t(o,n,r)}else{if("value"in s)return s.value;var c=s.get;return c===void 0?void 0:c.call(r)}},inherits=function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t},Color=(function(){function t(){if(classCallCheck(this,t),this.__state=interpret.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return createClass(t,[{key:"toString",value:function(){return colorToString(this)}},{key:"toHexString",value:function(){return colorToString(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t})();function defineRGBComponent(t,e,n){Object.defineProperty(t,e,{get:function(){return this.__state.space==="RGB"?this.__state[e]:(Color.recalculateRGB(this,e,n),this.__state[e])},set:function(s){this.__state.space!=="RGB"&&(Color.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=s}})}function defineHSVComponent(t,e){Object.defineProperty(t,e,{get:function(){return this.__state.space==="HSV"?this.__state[e]:(Color.recalculateHSV(this),this.__state[e])},set:function(r){this.__state.space!=="HSV"&&(Color.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=r}})}Color.recalculateRGB=function(t,e,n){if(t.__state.space==="HEX")t.__state[e]=ColorMath.component_from_hex(t.__state.hex,n);else if(t.__state.space==="HSV")Common.extend(t.__state,ColorMath.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v));else throw new Error("Corrupted color state")};Color.recalculateHSV=function(t){var e=ColorMath.rgb_to_hsv(t.r,t.g,t.b);Common.extend(t.__state,{s:e.s,v:e.v}),Common.isNaN(e.h)?Common.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h};Color.COMPONENTS=["r","g","b","h","s","v","hex","a"];defineRGBComponent(Color.prototype,"r",2);defineRGBComponent(Color.prototype,"g",1);defineRGBComponent(Color.prototype,"b",0);defineHSVComponent(Color.prototype,"h");defineHSVComponent(Color.prototype,"s");defineHSVComponent(Color.prototype,"v");Object.defineProperty(Color.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty(Color.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=ColorMath.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var Controller=(function(){function t(e,n){classCallCheck(this,t),this.initialValue=e[n],this.domElement=document.createElement("div"),this.object=e,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return createClass(t,[{key:"onChange",value:function(n){return this.__onChange=n,this}},{key:"onFinishChange",value:function(n){return this.__onFinishChange=n,this}},{key:"setValue",value:function(n){return this.object[this.property]=n,this.__onChange&&this.__onChange.call(this,n),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t})(),EVENT_MAP={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},EVENT_MAP_INV={};Common.each(EVENT_MAP,function(t,e){Common.each(t,function(n){EVENT_MAP_INV[n]=e})});var CSS_VALUE_PIXELS=/(\d+(\.\d+)?)px/;function cssValueToPixels(t){if(t==="0"||Common.isUndefined(t))return 0;var e=t.match(CSS_VALUE_PIXELS);return Common.isNull(e)?0:parseFloat(e[1])}var dom={makeSelectable:function(e,n){e===void 0||e.style===void 0||(e.onselectstart=n?function(){return!1}:function(){},e.style.MozUserSelect=n?"auto":"none",e.style.KhtmlUserSelect=n?"auto":"none",e.unselectable=n?"on":"off")},makeFullscreen:function(e,n,r){var s=r,o=n;Common.isUndefined(o)&&(o=!0),Common.isUndefined(s)&&(s=!0),e.style.position="absolute",o&&(e.style.left=0,e.style.right=0),s&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,n,r,s){var o=r||{},c=EVENT_MAP_INV[n];if(!c)throw new Error("Event type "+n+" not supported.");var d=document.createEvent(c);switch(c){case"MouseEvents":{var p=o.x||o.clientX||0,T=o.y||o.clientY||0;d.initMouseEvent(n,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,p,T,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var S=d.initKeyboardEvent||d.initKeyEvent;Common.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),S(n,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break}default:{d.initEvent(n,o.bubbles||!1,o.cancelable||!0);break}}Common.defaults(d,s),e.dispatchEvent(d)},bind:function(e,n,r,s){var o=s||!1;return e.addEventListener?e.addEventListener(n,r,o):e.attachEvent&&e.attachEvent("on"+n,r),dom},unbind:function(e,n,r,s){var o=s||!1;return e.removeEventListener?e.removeEventListener(n,r,o):e.detachEvent&&e.detachEvent("on"+n,r),dom},addClass:function(e,n){if(e.className===void 0)e.className=n;else if(e.className!==n){var r=e.className.split(/ +/);r.indexOf(n)===-1&&(r.push(n),e.className=r.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return dom},removeClass:function(e,n){if(n)if(e.className===n)e.removeAttribute("class");else{var r=e.className.split(/ +/),s=r.indexOf(n);s!==-1&&(r.splice(s,1),e.className=r.join(" "))}else e.className=void 0;return dom},hasClass:function(e,n){return new RegExp("(?:^|\\s+)"+n+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var n=getComputedStyle(e);return cssValueToPixels(n["border-left-width"])+cssValueToPixels(n["border-right-width"])+cssValueToPixels(n["padding-left"])+cssValueToPixels(n["padding-right"])+cssValueToPixels(n.width)},getHeight:function(e){var n=getComputedStyle(e);return cssValueToPixels(n["border-top-width"])+cssValueToPixels(n["border-bottom-width"])+cssValueToPixels(n["padding-top"])+cssValueToPixels(n["padding-bottom"])+cssValueToPixels(n.height)},getOffset:function(e){var n=e,r={left:0,top:0};if(n.offsetParent)do r.left+=n.offsetLeft,r.top+=n.offsetTop,n=n.offsetParent;while(n);return r},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},BooleanController=(function(t){inherits(e,t);function e(n,r){classCallCheck(this,e);var s=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),o=s;s.__prev=s.getValue(),s.__checkbox=document.createElement("input"),s.__checkbox.setAttribute("type","checkbox");function c(){o.setValue(!o.__prev)}return dom.bind(s.__checkbox,"change",c,!1),s.domElement.appendChild(s.__checkbox),s.updateDisplay(),s}return createClass(e,[{key:"setValue",value:function(r){var s=get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,r);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),s}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e})(Controller),OptionController=(function(t){inherits(e,t);function e(n,r,s){classCallCheck(this,e);var o=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),c=s,d=o;if(o.__select=document.createElement("select"),Common.isArray(c)){var p={};Common.each(c,function(T){p[T]=T}),c=p}return Common.each(c,function(T,S){var R=document.createElement("option");R.innerHTML=S,R.setAttribute("value",T),d.__select.appendChild(R)}),o.updateDisplay(),dom.bind(o.__select,"change",function(){var T=this.options[this.selectedIndex].value;d.setValue(T)}),o.domElement.appendChild(o.__select),o}return createClass(e,[{key:"setValue",value:function(r){var s=get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,r);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),s}},{key:"updateDisplay",value:function(){return dom.isActive(this.__select)?this:(this.__select.value=this.getValue(),get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e})(Controller),StringController=(function(t){inherits(e,t);function e(n,r){classCallCheck(this,e);var s=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),o=s;function c(){o.setValue(o.__input.value)}function d(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),dom.bind(s.__input,"keyup",c),dom.bind(s.__input,"change",c),dom.bind(s.__input,"blur",d),dom.bind(s.__input,"keydown",function(p){p.keyCode===13&&this.blur()}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return createClass(e,[{key:"updateDisplay",value:function(){return dom.isActive(this.__input)||(this.__input.value=this.getValue()),get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e})(Controller);function numDecimals(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var NumberController=(function(t){inherits(e,t);function e(n,r,s){classCallCheck(this,e);var o=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),c=s||{};return o.__min=c.min,o.__max=c.max,o.__step=c.step,Common.isUndefined(o.__step)?o.initialValue===0?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=numDecimals(o.__impliedStep),o}return createClass(e,[{key:"setValue",value:function(r){var s=r;return this.__min!==void 0&&s<this.__min?s=this.__min:this.__max!==void 0&&s>this.__max&&(s=this.__max),this.__step!==void 0&&s%this.__step!==0&&(s=Math.round(s/this.__step)*this.__step),get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,s)}},{key:"min",value:function(r){return this.__min=r,this}},{key:"max",value:function(r){return this.__max=r,this}},{key:"step",value:function(r){return this.__step=r,this.__impliedStep=r,this.__precision=numDecimals(r),this}}]),e})(Controller);function roundToDecimal(t,e){var n=Math.pow(10,e);return Math.round(t*n)/n}var NumberControllerBox=(function(t){inherits(e,t);function e(n,r,s){classCallCheck(this,e);var o=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r,s));o.__truncationSuspended=!1;var c=o,d=void 0;function p(){var P=parseFloat(c.__input.value);Common.isNaN(P)||c.setValue(P)}function T(){c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}function S(){T()}function R(P){var U=d-P.clientY;c.setValue(c.getValue()+U*c.__impliedStep),d=P.clientY}function x(){dom.unbind(window,"mousemove",R),dom.unbind(window,"mouseup",x),T()}function G(P){dom.bind(window,"mousemove",R),dom.bind(window,"mouseup",x),d=P.clientY}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),dom.bind(o.__input,"change",p),dom.bind(o.__input,"blur",S),dom.bind(o.__input,"mousedown",G),dom.bind(o.__input,"keydown",function(P){P.keyCode===13&&(c.__truncationSuspended=!0,this.blur(),c.__truncationSuspended=!1,T())}),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return createClass(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():roundToDecimal(this.getValue(),this.__precision),get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e})(NumberController);function map(t,e,n,r,s){return r+(s-r)*((t-e)/(n-e))}var NumberControllerSlider=(function(t){inherits(e,t);function e(n,r,s,o,c){classCallCheck(this,e);var d=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r,{min:s,max:o,step:c})),p=d;d.__background=document.createElement("div"),d.__foreground=document.createElement("div"),dom.bind(d.__background,"mousedown",T),dom.bind(d.__background,"touchstart",x),dom.addClass(d.__background,"slider"),dom.addClass(d.__foreground,"slider-fg");function T(U){document.activeElement.blur(),dom.bind(window,"mousemove",S),dom.bind(window,"mouseup",R),S(U)}function S(U){U.preventDefault();var H=p.__background.getBoundingClientRect();return p.setValue(map(U.clientX,H.left,H.right,p.__min,p.__max)),!1}function R(){dom.unbind(window,"mousemove",S),dom.unbind(window,"mouseup",R),p.__onFinishChange&&p.__onFinishChange.call(p,p.getValue())}function x(U){U.touches.length===1&&(dom.bind(window,"touchmove",G),dom.bind(window,"touchend",P),G(U))}function G(U){var H=U.touches[0].clientX,X=p.__background.getBoundingClientRect();p.setValue(map(H,X.left,X.right,p.__min,p.__max))}function P(){dom.unbind(window,"touchmove",G),dom.unbind(window,"touchend",P),p.__onFinishChange&&p.__onFinishChange.call(p,p.getValue())}return d.updateDisplay(),d.__background.appendChild(d.__foreground),d.domElement.appendChild(d.__background),d}return createClass(e,[{key:"updateDisplay",value:function(){var r=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=r*100+"%",get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e})(NumberController),FunctionController=(function(t){inherits(e,t);function e(n,r,s){classCallCheck(this,e);var o=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),c=o;return o.__button=document.createElement("div"),o.__button.innerHTML=s===void 0?"Fire":s,dom.bind(o.__button,"click",function(d){return d.preventDefault(),c.fire(),!1}),dom.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return createClass(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e})(Controller),ColorController=(function(t){inherits(e,t);function e(n,r){classCallCheck(this,e);var s=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r));s.__color=new Color(s.getValue()),s.__temp=new Color(0);var o=s;s.domElement=document.createElement("div"),dom.makeSelectable(s.domElement,!1),s.__selector=document.createElement("div"),s.__selector.className="selector",s.__saturation_field=document.createElement("div"),s.__saturation_field.className="saturation-field",s.__field_knob=document.createElement("div"),s.__field_knob.className="field-knob",s.__field_knob_border="2px solid ",s.__hue_knob=document.createElement("div"),s.__hue_knob.className="hue-knob",s.__hue_field=document.createElement("div"),s.__hue_field.className="hue-field",s.__input=document.createElement("input"),s.__input.type="text",s.__input_textShadow="0 1px 1px ",dom.bind(s.__input,"keydown",function(U){U.keyCode===13&&R.call(this)}),dom.bind(s.__input,"blur",R),dom.bind(s.__selector,"mousedown",function(){dom.addClass(this,"drag").bind(window,"mouseup",function(){dom.removeClass(o.__selector,"drag")})}),dom.bind(s.__selector,"touchstart",function(){dom.addClass(this,"drag").bind(window,"touchend",function(){dom.removeClass(o.__selector,"drag")})});var c=document.createElement("div");Common.extend(s.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),Common.extend(s.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:s.__field_knob_border+(s.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),Common.extend(s.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),Common.extend(s.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),Common.extend(c.style,{width:"100%",height:"100%",background:"none"}),linearGradient(c,"top","rgba(0,0,0,0)","#000"),Common.extend(s.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),hueGradient(s.__hue_field),Common.extend(s.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:s.__input_textShadow+"rgba(0,0,0,0.7)"}),dom.bind(s.__saturation_field,"mousedown",d),dom.bind(s.__saturation_field,"touchstart",d),dom.bind(s.__field_knob,"mousedown",d),dom.bind(s.__field_knob,"touchstart",d),dom.bind(s.__hue_field,"mousedown",p),dom.bind(s.__hue_field,"touchstart",p);function d(U){G(U),dom.bind(window,"mousemove",G),dom.bind(window,"touchmove",G),dom.bind(window,"mouseup",T),dom.bind(window,"touchend",T)}function p(U){P(U),dom.bind(window,"mousemove",P),dom.bind(window,"touchmove",P),dom.bind(window,"mouseup",S),dom.bind(window,"touchend",S)}function T(){dom.unbind(window,"mousemove",G),dom.unbind(window,"touchmove",G),dom.unbind(window,"mouseup",T),dom.unbind(window,"touchend",T),x()}function S(){dom.unbind(window,"mousemove",P),dom.unbind(window,"touchmove",P),dom.unbind(window,"mouseup",S),dom.unbind(window,"touchend",S),x()}function R(){var U=interpret(this.value);U!==!1?(o.__color.__state=U,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function x(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}s.__saturation_field.appendChild(c),s.__selector.appendChild(s.__field_knob),s.__selector.appendChild(s.__saturation_field),s.__selector.appendChild(s.__hue_field),s.__hue_field.appendChild(s.__hue_knob),s.domElement.appendChild(s.__input),s.domElement.appendChild(s.__selector),s.updateDisplay();function G(U){U.type.indexOf("touch")===-1&&U.preventDefault();var H=o.__saturation_field.getBoundingClientRect(),X=U.touches&&U.touches[0]||U,$=X.clientX,K=X.clientY,q=($-H.left)/(H.right-H.left),te=1-(K-H.top)/(H.bottom-H.top);return te>1?te=1:te<0&&(te=0),q>1?q=1:q<0&&(q=0),o.__color.v=te,o.__color.s=q,o.setValue(o.__color.toOriginal()),!1}function P(U){U.type.indexOf("touch")===-1&&U.preventDefault();var H=o.__hue_field.getBoundingClientRect(),X=U.touches&&U.touches[0]||U,$=X.clientY,K=1-($-H.top)/(H.bottom-H.top);return K>1?K=1:K<0&&(K=0),o.__color.h=K*360,o.setValue(o.__color.toOriginal()),!1}return s}return createClass(e,[{key:"updateDisplay",value:function(){var r=interpret(this.getValue());if(r!==!1){var s=!1;Common.each(Color.COMPONENTS,function(d){if(!Common.isUndefined(r[d])&&!Common.isUndefined(this.__color.__state[d])&&r[d]!==this.__color.__state[d])return s=!0,{}},this),s&&Common.extend(this.__color.__state,r)}Common.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var o=this.__color.v<.5||this.__color.s>.5?255:0,c=255-o;Common.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+o+","+o+","+o+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,linearGradient(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),Common.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+o+","+o+","+o+")",textShadow:this.__input_textShadow+"rgba("+c+","+c+","+c+",.7)"})}}]),e})(Controller),vendors=["-moz-","-o-","-webkit-","-ms-",""];function linearGradient(t,e,n,r){t.style.background="",Common.each(vendors,function(s){t.style.cssText+="background: "+s+"linear-gradient("+e+", "+n+" 0%, "+r+" 100%); "})}function hueGradient(t){t.style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var css={load:function(e,n){var r=n||document,s=r.createElement("link");s.type="text/css",s.rel="stylesheet",s.href=e,r.getElementsByTagName("head")[0].appendChild(s)},inject:function(e,n){var r=n||document,s=document.createElement("style");s.type="text/css",s.innerHTML=e;var o=r.getElementsByTagName("head")[0];try{o.appendChild(s)}catch{}}},saveDialogContents=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,ControllerFactory=function(e,n){var r=e[n];return Common.isArray(arguments[2])||Common.isObject(arguments[2])?new OptionController(e,n,arguments[2]):Common.isNumber(r)?Common.isNumber(arguments[2])&&Common.isNumber(arguments[3])?Common.isNumber(arguments[4])?new NumberControllerSlider(e,n,arguments[2],arguments[3],arguments[4]):new NumberControllerSlider(e,n,arguments[2],arguments[3]):Common.isNumber(arguments[4])?new NumberControllerBox(e,n,{min:arguments[2],max:arguments[3],step:arguments[4]}):new NumberControllerBox(e,n,{min:arguments[2],max:arguments[3]}):Common.isString(r)?new StringController(e,n):Common.isFunction(r)?new FunctionController(e,n,""):Common.isBoolean(r)?new BooleanController(e,n):null};function requestAnimationFrame$1(t){setTimeout(t,1e3/60)}var requestAnimationFrame$1$1=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||requestAnimationFrame$1,CenteredDiv=(function(){function t(){classCallCheck(this,t),this.backgroundElement=document.createElement("div"),Common.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),dom.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),Common.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;dom.bind(this.backgroundElement,"click",function(){e.hide()})}return createClass(t,[{key:"show",value:function(){var n=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),Common.defer(function(){n.backgroundElement.style.opacity=1,n.domElement.style.opacity=1,n.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var n=this,r=function s(){n.domElement.style.display="none",n.backgroundElement.style.display="none",dom.unbind(n.domElement,"webkitTransitionEnd",s),dom.unbind(n.domElement,"transitionend",s),dom.unbind(n.domElement,"oTransitionEnd",s)};dom.bind(this.domElement,"webkitTransitionEnd",r),dom.bind(this.domElement,"transitionend",r),dom.bind(this.domElement,"oTransitionEnd",r),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-dom.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-dom.getHeight(this.domElement)/2+"px"}}]),t})(),styleSheet=___$insertStyle(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);css.inject(styleSheet);var CSS_NAMESPACE="dg",HIDE_KEY_CODE=72,CLOSE_BUTTON_HEIGHT=20,DEFAULT_DEFAULT_PRESET_NAME="Default",SUPPORTS_LOCAL_STORAGE=(function(){try{return!!window.localStorage}catch{return!1}})(),SAVE_DIALOGUE=void 0,autoPlaceVirgin=!0,autoPlaceContainer=void 0,hide=!1,hideableGuis=[],GUI=function t(e){var n=this,r=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),dom.addClass(this.domElement,CSS_NAMESPACE),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=Common.defaults(r,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),r=Common.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),Common.isUndefined(r.load)?r.load={preset:DEFAULT_DEFAULT_PRESET_NAME}:r.preset&&(r.load.preset=r.preset),Common.isUndefined(r.parent)&&r.hideable&&hideableGuis.push(this),r.resizable=Common.isUndefined(r.parent)&&r.resizable,r.autoPlace&&Common.isUndefined(r.scrollable)&&(r.scrollable=!0);var s=SUPPORTS_LOCAL_STORAGE&&localStorage.getItem(getLocalStorageHash(this,"isLocal"))==="true",o=void 0,c=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(x){n.parent?n.getRoot().preset=x:r.load.preset=x,setPresetSelectIndex(this),n.revert()}},width:{get:function(){return r.width},set:function(x){r.width=x,setWidth(n,x)}},name:{get:function(){return r.name},set:function(x){r.name=x,c&&(c.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(x){r.closed=x,r.closed?dom.addClass(n.__ul,t.CLASS_CLOSED):dom.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=x?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return s},set:function(x){SUPPORTS_LOCAL_STORAGE&&(s=x,x?dom.bind(window,"unload",o):dom.unbind(window,"unload",o),localStorage.setItem(getLocalStorageHash(n,"isLocal"),x))}}}),Common.isUndefined(r.parent)){if(this.closed=r.closed||!1,dom.addClass(this.domElement,t.CLASS_MAIN),dom.makeSelectable(this.domElement,!1),SUPPORTS_LOCAL_STORAGE&&s){n.useLocalStorage=!0;var d=localStorage.getItem(getLocalStorageHash(this,"gui"));d&&(r.load=JSON.parse(d))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,dom.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),r.closeOnTop?(dom.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(dom.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),dom.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{r.closed===void 0&&(r.closed=!0);var p=document.createTextNode(r.name);dom.addClass(p,"controller-name"),c=addRow(n,p);var T=function(x){return x.preventDefault(),n.closed=!n.closed,!1};dom.addClass(this.__ul,t.CLASS_CLOSED),dom.addClass(c,"title"),dom.bind(c,"click",T),r.closed||(this.closed=!1)}r.autoPlace&&(Common.isUndefined(r.parent)&&(autoPlaceVirgin&&(autoPlaceContainer=document.createElement("div"),dom.addClass(autoPlaceContainer,CSS_NAMESPACE),dom.addClass(autoPlaceContainer,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(autoPlaceContainer),autoPlaceVirgin=!1),autoPlaceContainer.appendChild(this.domElement),dom.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||setWidth(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},dom.bind(window,"resize",this.__resizeHandler),dom.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),dom.bind(this.__ul,"transitionend",this.__resizeHandler),dom.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&addResizeHandle(this),o=function(){SUPPORTS_LOCAL_STORAGE&&localStorage.getItem(getLocalStorageHash(n,"isLocal"))==="true"&&localStorage.setItem(getLocalStorageHash(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=o;function S(){var R=n.getRoot();R.width+=1,Common.defer(function(){R.width-=1})}r.parent||S()};GUI.toggleHide=function(){hide=!hide,Common.each(hideableGuis,function(t){t.domElement.style.display=hide?"none":""})};GUI.CLASS_AUTO_PLACE="a";GUI.CLASS_AUTO_PLACE_CONTAINER="ac";GUI.CLASS_MAIN="main";GUI.CLASS_CONTROLLER_ROW="cr";GUI.CLASS_TOO_TALL="taller-than-window";GUI.CLASS_CLOSED="closed";GUI.CLASS_CLOSE_BUTTON="close-button";GUI.CLASS_CLOSE_TOP="close-top";GUI.CLASS_CLOSE_BOTTOM="close-bottom";GUI.CLASS_DRAG="drag";GUI.DEFAULT_WIDTH=245;GUI.TEXT_CLOSED="Close Controls";GUI.TEXT_OPEN="Open Controls";GUI._keydownHandler=function(t){document.activeElement.type!=="text"&&(t.which===HIDE_KEY_CODE||t.keyCode===HIDE_KEY_CODE)&&GUI.toggleHide()};dom.bind(window,"keydown",GUI._keydownHandler,!1);Common.extend(GUI.prototype,{add:function(e,n){return _add(this,e,n,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,n){return _add(this,e,n,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var n=this;Common.defer(function(){n.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&autoPlaceContainer.removeChild(this.domElement);var e=this;Common.each(this.__folders,function(n){e.removeFolder(n)}),dom.unbind(window,"keydown",GUI._keydownHandler,!1),removeListeners(this)},addFolder:function(e){if(this.__folders[e]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+e+'"');var n={name:e,parent:this};n.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(n.closed=this.load.folders[e].closed,n.load=this.load.folders[e]);var r=new GUI(n);this.__folders[e]=r;var s=addRow(this,r.domElement);return dom.addClass(s,"folder"),r},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],removeListeners(e);var n=this;Common.each(e.__folders,function(r){e.removeFolder(r)}),Common.defer(function(){n.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var n=dom.getOffset(e.__ul).top,r=0;Common.each(e.__ul.childNodes,function(s){e.autoPlace&&s===e.__save_row||(r+=dom.getHeight(s))}),window.innerHeight-n-CLOSE_BUTTON_HEIGHT<r?(dom.addClass(e.domElement,GUI.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-n-CLOSE_BUTTON_HEIGHT+"px"):(dom.removeClass(e.domElement,GUI.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&Common.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:Common.debounce(function(){this.onResize()},50),remember:function(){if(Common.isUndefined(SAVE_DIALOGUE)&&(SAVE_DIALOGUE=new CenteredDiv,SAVE_DIALOGUE.domElement.innerHTML=saveDialogContents),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;Common.each(Array.prototype.slice.call(arguments),function(n){e.__rememberedObjects.length===0&&addSaveMenu(e),e.__rememberedObjects.indexOf(n)===-1&&e.__rememberedObjects.push(n)}),this.autoPlace&&setWidth(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=getCurrentPreset(this)),e.folders={},Common.each(this.__folders,function(n,r){e.folders[r]=n.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=getCurrentPreset(this),markPresetModified(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[DEFAULT_DEFAULT_PRESET_NAME]=getCurrentPreset(this,!0)),this.load.remembered[e]=getCurrentPreset(this),this.preset=e,addPresetOption(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){Common.each(this.__controllers,function(n){this.getRoot().load.remembered?recallSavedValue(e||this.getRoot(),n):n.setValue(n.initialValue),n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())},this),Common.each(this.__folders,function(n){n.revert(n)}),e||markPresetModified(this.getRoot(),!1)},listen:function(e){var n=this.__listening.length===0;this.__listening.push(e),n&&updateDisplays(this.__listening)},updateDisplay:function(){Common.each(this.__controllers,function(e){e.updateDisplay()}),Common.each(this.__folders,function(e){e.updateDisplay()})}});function addRow(t,e,n){var r=document.createElement("li");return e&&r.appendChild(e),n?t.__ul.insertBefore(r,n):t.__ul.appendChild(r),t.onResize(),r}function removeListeners(t){dom.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&dom.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function markPresetModified(t,e){var n=t.__preset_select[t.__preset_select.selectedIndex];e?n.innerHTML=n.value+"*":n.innerHTML=n.value}function augmentController(t,e,n){if(n.__li=e,n.__gui=t,Common.extend(n,{options:function(c){if(arguments.length>1){var d=n.__li.nextElementSibling;return n.remove(),_add(t,n.object,n.property,{before:d,factoryArgs:[Common.toArray(arguments)]})}if(Common.isArray(c)||Common.isObject(c)){var p=n.__li.nextElementSibling;return n.remove(),_add(t,n.object,n.property,{before:p,factoryArgs:[c]})}},name:function(c){return n.__li.firstElementChild.firstElementChild.innerHTML=c,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof NumberControllerSlider){var r=new NumberControllerBox(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});Common.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(o){var c=n[o],d=r[o];n[o]=r[o]=function(){var p=Array.prototype.slice.call(arguments);return d.apply(r,p),c.apply(n,p)}}),dom.addClass(e,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof NumberControllerBox){var s=function(c){if(Common.isNumber(n.__min)&&Common.isNumber(n.__max)){var d=n.__li.firstElementChild.firstElementChild.innerHTML,p=n.__gui.__listening.indexOf(n)>-1;n.remove();var T=_add(t,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return T.name(d),p&&T.listen(),T}return c};n.min=Common.compose(s,n.min),n.max=Common.compose(s,n.max)}else n instanceof BooleanController?(dom.bind(e,"click",function(){dom.fakeEvent(n.__checkbox,"click")}),dom.bind(n.__checkbox,"click",function(o){o.stopPropagation()})):n instanceof FunctionController?(dom.bind(e,"click",function(){dom.fakeEvent(n.__button,"click")}),dom.bind(e,"mouseover",function(){dom.addClass(n.__button,"hover")}),dom.bind(e,"mouseout",function(){dom.removeClass(n.__button,"hover")})):n instanceof ColorController&&(dom.addClass(e,"color"),n.updateDisplay=Common.compose(function(o){return e.style.borderLeftColor=n.__color.toString(),o},n.updateDisplay),n.updateDisplay());n.setValue=Common.compose(function(o){return t.getRoot().__preset_select&&n.isModified()&&markPresetModified(t.getRoot(),!0),o},n.setValue)}function recallSavedValue(t,e){var n=t.getRoot(),r=n.__rememberedObjects.indexOf(e.object);if(r!==-1){var s=n.__rememberedObjectIndecesToControllers[r];if(s===void 0&&(s={},n.__rememberedObjectIndecesToControllers[r]=s),s[e.property]=e,n.load&&n.load.remembered){var o=n.load.remembered,c=void 0;if(o[t.preset])c=o[t.preset];else if(o[DEFAULT_DEFAULT_PRESET_NAME])c=o[DEFAULT_DEFAULT_PRESET_NAME];else return;if(c[r]&&c[r][e.property]!==void 0){var d=c[r][e.property];e.initialValue=d,e.setValue(d)}}}}function _add(t,e,n,r){if(e[n]===void 0)throw new Error('Object "'+e+'" has no property "'+n+'"');var s=void 0;if(r.color)s=new ColorController(e,n);else{var o=[e,n].concat(r.factoryArgs);s=ControllerFactory.apply(t,o)}r.before instanceof Controller&&(r.before=r.before.__li),recallSavedValue(t,s),dom.addClass(s.domElement,"c");var c=document.createElement("span");dom.addClass(c,"property-name"),c.innerHTML=s.property;var d=document.createElement("div");d.appendChild(c),d.appendChild(s.domElement);var p=addRow(t,d,r.before);return dom.addClass(p,GUI.CLASS_CONTROLLER_ROW),s instanceof ColorController?dom.addClass(p,"color"):dom.addClass(p,_typeof(s.getValue())),augmentController(t,p,s),t.__controllers.push(s),s}function getLocalStorageHash(t,e){return document.location.href+"."+e}function addPresetOption(t,e,n){var r=document.createElement("option");r.innerHTML=e,r.value=e,t.__preset_select.appendChild(r),n&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function showHideExplain(t,e){e.style.display=t.useLocalStorage?"block":"none"}function addSaveMenu(t){var e=t.__save_row=document.createElement("li");dom.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),dom.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",dom.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",dom.addClass(r,"button"),dom.addClass(r,"save");var s=document.createElement("span");s.innerHTML="New",dom.addClass(s,"button"),dom.addClass(s,"save-as");var o=document.createElement("span");o.innerHTML="Revert",dom.addClass(o,"button"),dom.addClass(o,"revert");var c=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?Common.each(t.load.remembered,function(R,x){addPresetOption(t,x,x===t.preset)}):addPresetOption(t,DEFAULT_DEFAULT_PRESET_NAME,!1),dom.bind(c,"change",function(){for(var R=0;R<t.__preset_select.length;R++)t.__preset_select[R].innerHTML=t.__preset_select[R].value;t.preset=this.value}),e.appendChild(c),e.appendChild(n),e.appendChild(r),e.appendChild(s),e.appendChild(o),SUPPORTS_LOCAL_STORAGE){var d=document.getElementById("dg-local-explain"),p=document.getElementById("dg-local-storage"),T=document.getElementById("dg-save-locally");T.style.display="block",localStorage.getItem(getLocalStorageHash(t,"isLocal"))==="true"&&p.setAttribute("checked","checked"),showHideExplain(t,d),dom.bind(p,"change",function(){t.useLocalStorage=!t.useLocalStorage,showHideExplain(t,d)})}var S=document.getElementById("dg-new-constructor");dom.bind(S,"keydown",function(R){R.metaKey&&(R.which===67||R.keyCode===67)&&SAVE_DIALOGUE.hide()}),dom.bind(n,"click",function(){S.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),SAVE_DIALOGUE.show(),S.focus(),S.select()}),dom.bind(r,"click",function(){t.save()}),dom.bind(s,"click",function(){var R=prompt("Enter a new preset name.");R&&t.saveAs(R)}),dom.bind(o,"click",function(){t.revert()})}function addResizeHandle(t){var e=void 0;t.__resize_handle=document.createElement("div"),Common.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function n(o){return o.preventDefault(),t.width+=e-o.clientX,t.onResize(),e=o.clientX,!1}function r(){dom.removeClass(t.__closeButton,GUI.CLASS_DRAG),dom.unbind(window,"mousemove",n),dom.unbind(window,"mouseup",r)}function s(o){return o.preventDefault(),e=o.clientX,dom.addClass(t.__closeButton,GUI.CLASS_DRAG),dom.bind(window,"mousemove",n),dom.bind(window,"mouseup",r),!1}dom.bind(t.__resize_handle,"mousedown",s),dom.bind(t.__closeButton,"mousedown",s),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function setWidth(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function getCurrentPreset(t,e){var n={};return Common.each(t.__rememberedObjects,function(r,s){var o={},c=t.__rememberedObjectIndecesToControllers[s];Common.each(c,function(d,p){o[p]=e?d.initialValue:d.getValue()}),n[s]=o}),n}function setPresetSelectIndex(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}function updateDisplays(t){t.length!==0&&requestAnimationFrame$1$1.call(window,function(){updateDisplays(t)}),Common.each(t,function(e){e.updateDisplay()})}var GUI$1=GUI,canvas,canvasFormat,context,device,aspectRatio;const fovYDegrees=45;var modelBindGroupLayout,materialBindGroupLayout;async function initWebGPU(){canvas=document.getElementById("mainCanvas");const t=window.devicePixelRatio;if(canvas.width=canvas.clientWidth*t,canvas.height=canvas.clientHeight*t,aspectRatio=canvas.width/canvas.height,!navigator.gpu){let n=document.createElement("h1");throw n.textContent="This browser doesn't support WebGPU! Try using Google Chrome.",n.style.paddingLeft="0.4em",document.body.innerHTML="",document.body.appendChild(n),new Error("WebGPU not supported on this browser")}const e=await navigator.gpu.requestAdapter();if(!e)throw new Error("no appropriate GPUAdapter found");device=await e.requestDevice(),context=canvas.getContext("webgpu"),canvasFormat=navigator.gpu.getPreferredCanvasFormat(),context.configure({device,format:canvasFormat}),console.log("WebGPU init successsful"),modelBindGroupLayout=device.createBindGroupLayout({label:"model bind group layout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),materialBindGroupLayout=device.createBindGroupLayout({label:"material bind group layout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]})}const vertexBufferLayout={arrayStride:32,attributes:[{format:"float32x3",offset:0,shaderLocation:0},{format:"float32x3",offset:12,shaderLocation:1},{format:"float32x2",offset:24,shaderLocation:2}]};class Renderer{scene;lights;camera;stats;prevTime=0;deltaTimeSum=0;deltaTimeCount=0;frameRequestId;constructor(e){this.scene=e.scene,this.lights=e.lights,this.camera=e.camera,this.stats=e.stats,this.frameRequestId=requestAnimationFrame(n=>this.onFrame(n))}stop(){cancelAnimationFrame(this.frameRequestId)}onFrame(e){this.prevTime==0&&(this.prevTime=e);let n=e-this.prevTime;if(this.camera.onFrame(n),this.lights.onFrame(e),this.stats.begin(),this.draw(),this.stats.end(),this.prevTime=e,this.frameRequestId=requestAnimationFrame(r=>this.onFrame(r)),this.deltaTimeSum+=n,this.deltaTimeCount++,this.deltaTimeCount%100===0){const r=this.deltaTimeSum/this.deltaTimeCount;console.log(`Average frame time over last ${this.deltaTimeCount} frames: ${r.toFixed(2)} ms (${(1e3/r).toFixed(2)} FPS)`)}}}const commonRaw=`// CHECKITOUT: code that you add here will be prepended to all shaders

struct Light {
    pos: vec3f,
    color: vec3f
}

struct LightSet {
    numLights: u32,
    lights: array<Light>
}

// TODO-2: you may want to create a ClusterSet struct similar to LightSet
struct Cluster {
    numLights: u32,
    lightIndices: array<u32, \${maxLightsPerCluster}>
}

struct ClusterSet {
    numClustersX: u32,
    numClustersY: u32,
    clusters: array<Cluster>
}

struct CameraUniforms {
    // TODO-1.3: add an entry for the view proj mat (of type mat4x4f)
    viewProjMat: mat4x4<f32>,
    invProjMat: mat4x4f,
    viewMat: mat4x4<f32>,
}

// CHECKITOUT: this special attenuation function ensures lights don't affect geometry outside the maximum light radius
fn rangeAttenuation(distance: f32) -> f32 {
    return clamp(1.f - pow(distance / \${lightRadius}, 4.f), 0.f, 1.f) / (distance * distance);
}

fn calculateLightContrib(light: Light, posWorld: vec3f, nor: vec3f) -> vec3f {
    let vecToLight = light.pos - posWorld;
    let distToLight = length(vecToLight);

    let lambert = max(dot(nor, normalize(vecToLight)), 0.f);
    return light.color * lambert * rangeAttenuation(distToLight);
}

fn computeIndexZ(viewZ: f32) -> u32 {
    let z = -viewZ; // positive
    let index = (z - \${clusterNear}) / (\${clusterFar} - \${clusterNear}) * f32(\${numClustersZ});
    return u32(clamp(index, 0.f, f32(\${numClustersZ} - 0.5f)));
}

fn computeClusterIndex(fragPosition: vec4f, viewPosition: vec3f, numClustersX: u32, numClustersY: u32) -> u32 {
    let indexX = u32(fragPosition.x / f32(\${clusterPixelSize}));
    let indexY = u32(fragPosition.y / f32(\${clusterPixelSize}));
    let indexZ = computeIndexZ(viewPosition.z);
    return (indexX * numClustersY + indexY) * \${numClustersZ} + indexZ;
}
`,naiveVertRaw=`// CHECKITOUT: you can use this vertex shader for all of the renderers

// TODO-1.3: add a uniform variable here for camera uniforms (of type CameraUniforms)
// make sure to use \${bindGroup_scene} for the group
@group(\${bindGroup_scene}) @binding(0) var<uniform> cameraUniforms: CameraUniforms;

@group(\${bindGroup_model}) @binding(0) var<uniform> modelMat: mat4x4f;

struct VertexInput
{
    @location(0) pos: vec3f,
    @location(1) nor: vec3f,
    @location(2) uv: vec2f
}

struct VertexOutput
{
    @builtin(position) fragPos: vec4f,
    @location(0) pos: vec3f,
    @location(1) nor: vec3f,
    @location(2) uv: vec2f,
    @location(3) viewPos: vec3f
}

@vertex
fn main(in: VertexInput) -> VertexOutput
{
    let modelPos = modelMat * vec4(in.pos, 1);
    let viewPos = cameraUniforms.viewMat * modelPos;

    var out: VertexOutput;
    out.fragPos = cameraUniforms.viewProjMat * modelPos; // TODO-1.3: replace ??? with the view proj mat from your CameraUniforms uniform variable
    out.pos = modelPos.xyz / modelPos.w;
    out.nor = in.nor;
    out.uv = in.uv;
    out.viewPos = viewPos.xyz / viewPos.w;
    return out;
}
`,naiveFragRaw=`@group(\${bindGroup_scene}) @binding(1) var<storage, read> lightSet: LightSet;

@group(\${bindGroup_material}) @binding(0) var diffuseTex: texture_2d<f32>;
@group(\${bindGroup_material}) @binding(1) var diffuseTexSampler: sampler;

struct FragmentInput
{
    @location(0) pos: vec3f,
    @location(1) nor: vec3f,
    @location(2) uv: vec2f
}

@fragment
fn main(in: FragmentInput) -> @location(0) vec4f
{
    let diffuseColor = textureSample(diffuseTex, diffuseTexSampler, in.uv);
    if (diffuseColor.a < 0.5f) {
        discard;
    }

    var totalLightContrib = vec3f(0, 0, 0);
    for (var lightIdx = 0u; lightIdx < lightSet.numLights; lightIdx++) {
        let light = lightSet.lights[lightIdx];
        totalLightContrib += calculateLightContrib(light, in.pos, normalize(in.nor));
    }

    var finalColor = diffuseColor.rgb * totalLightContrib;
    return vec4(finalColor, 1);
}
`,forwardPlusFragRaw=`// TODO-2: implement the Forward+ fragment shader

// See naive.fs.wgsl for basic fragment shader setup; this shader should use light clusters instead of looping over all lights

// ------------------------------------
// Shading process:
// ------------------------------------
// Determine which cluster contains the current fragment.
// Retrieve the number of lights that affect the current fragment from the cluster’s data.
// Initialize a variable to accumulate the total light contribution for the fragment.
// For each light in the cluster:
//     Access the light's properties using its index.
//     Calculate the contribution of the light based on its position, the fragment’s position, and the surface normal.
//     Add the calculated contribution to the total light accumulation.
// Multiply the fragment’s diffuse color by the accumulated light contribution.
// Return the final color, ensuring that the alpha component is set appropriately (typically to 1).

@group(\${bindGroup_scene}) @binding(1) var<storage, read> lightSet: LightSet;

@group(\${bindGroup_clusterSet}) @binding(0) var<storage, read> clusterSet: ClusterSet;

@group(\${bindGroup_material}) @binding(0) var diffuseTex: texture_2d<f32>;
@group(\${bindGroup_material}) @binding(1) var diffuseTexSampler: sampler;

struct FragmentInput
{
    @builtin(position) fragPos: vec4f,
    @location(0) pos: vec3f,
    @location(1) nor: vec3f,
    @location(2) uv: vec2f,
    @location(3) viewPos: vec3f,
}

@fragment
fn main(in: FragmentInput) -> @location(0) vec4f
{
    let diffuseColor = textureSample(diffuseTex, diffuseTexSampler, in.uv);
    if (diffuseColor.a < 0.5f) {
        discard;
    }

    var clusterIndex = computeClusterIndex(in.fragPos, in.viewPos, clusterSet.numClustersX, clusterSet.numClustersY);
    let numLights = clusterSet.clusters[clusterIndex].numLights;

    var totalLightContrib = vec3f(0.0f, 0.0f, 0.0f);
    for (var lightIdx = 0u; lightIdx < numLights; lightIdx++) {
        let light = lightSet.lights[clusterSet.clusters[clusterIndex].lightIndices[lightIdx]];
        totalLightContrib += calculateLightContrib(light, in.pos, normalize(in.nor));
    }

    let finalColor = diffuseColor.rgb * totalLightContrib;
    return vec4(finalColor, 1.0f);
}
`,clusteredDeferredFragRaw=`// TODO-3: implement the Clustered Deferred G-buffer fragment shader

// This shader should only store G-buffer information and should not do any shading.

@group(\${bindGroup_material}) @binding(0) var diffuseTex: texture_2d<f32>;
@group(\${bindGroup_material}) @binding(1) var diffuseTexSampler: sampler;

struct FragmentInput
{
    @location(0) pos: vec3f,
    @location(1) nor: vec3f,
    @location(2) uv: vec2f
}

struct FragmentOutput {
    @location(0) albedo : vec4f,
    @location(1) normal : vec4f
};

@fragment
fn main(in: FragmentInput) -> FragmentOutput
{
    let diffuseColor = textureSample(diffuseTex, diffuseTexSampler, in.uv);
    if (diffuseColor.a < 0.5f) {
        discard;
    }

    var out: FragmentOutput;
    out.albedo = vec4(diffuseColor.rgb, 1.0);
    out.normal = vec4(normalize(in.nor), 1.0);

    return out;
}
`,clusteredDeferredFullscreenVertRaw=`// TODO-3: implement the Clustered Deferred fullscreen vertex shader

// This shader should be very simple as it does not need all of the information passed by the the naive vertex shader.

struct VertexOutput
{
    @builtin(position) fragPos: vec4f,
    @location(0) uv: vec2f
}

@vertex
fn main(@builtin(vertex_index) index: u32) -> VertexOutput {
    // Use an oversized triangle to cover the screen.
    let positions = array<vec2f, 3>(
        vec2f(-1.0, -1.0),
        vec2f( 3.0, -1.0),
        vec2f(-1.0,  3.0)
    );
    let texCoords = array<vec2f, 3>(
        vec2f(0.0, 0.0),
        vec2f(2.0, 0.0),
        vec2f(0.0, 2.0)
    );

    var out: VertexOutput;
    out.fragPos = vec4f(positions[index], 0.0, 1.0);
    out.uv = texCoords[index];
    return out;
};
`,clusteredDeferredFullscreenFragRaw=`// TODO-3: implement the Clustered Deferred fullscreen fragment shader

// Similar to the Forward+ fragment shader, but with vertex information coming from the G-buffer instead.

@group(\${bindGroup_scene}) @binding(0) var<uniform> cameraUniforms: CameraUniforms;
@group(\${bindGroup_scene}) @binding(1) var<storage, read> lightSet: LightSet;

@group(\${bindGroup_gBuffer}) @binding(0) var albedoTex: texture_2d<f32>;
@group(\${bindGroup_gBuffer}) @binding(1) var normalTex: texture_2d<f32>;
@group(\${bindGroup_gBuffer}) @binding(2) var depthTex: texture_depth_2d;
@group(\${bindGroup_gBuffer}) @binding(3) var texSampler: sampler;

@group(\${bindGroup_clusterSet}) @binding(0) var<storage, read> clusterSet: ClusterSet;

struct FragmentInput
{
    @builtin(position) fragPos: vec4f,
    @location(0) uv: vec2f,
}

@fragment
fn main(in: FragmentInput) -> @location(0) vec4f
{
    // NDC: +y is up; texture: +y is down.
    let uv = vec2f(in.uv.x, 1.0 - in.uv.y);

    let albedo = textureSample(albedoTex, texSampler, uv).xyz;
    let normal = textureSample(normalTex, texSampler, uv).xyz;
    let depth = textureLoad(depthTex, vec2<i32>(in.fragPos.xy), 0);

    let ndcPosition = vec4f(in.uv * 2.0f - 1.0f, depth, 1.0f);
    let viewPositionH = cameraUniforms.invProjMat * ndcPosition;
    let viewPosition = viewPositionH.xyz / viewPositionH.w;

    let viewNormal = normalize((cameraUniforms.viewMat * vec4f(normal, 0.0f)).xyz);

    let clusterIndex = computeClusterIndex(in.fragPos, viewPosition, clusterSet.numClustersX, clusterSet.numClustersY);
    let numLights = clusterSet.clusters[clusterIndex].numLights;

    var totalLightContrib = vec3f(0.0f, 0.0f, 0.0f);
    for (var lightIdx = 0u; lightIdx < numLights; lightIdx++) {
        let light = lightSet.lights[clusterSet.clusters[clusterIndex].lightIndices[lightIdx]];
        let lightViewPosition = (cameraUniforms.viewMat * vec4f(light.pos, 1.0)).xyz;

        let vectorToLight = lightViewPosition - viewPosition;
        let distanceToLight = length(vectorToLight);

        let lambert = max(dot(viewNormal, normalize(vectorToLight)), 0.0f);
        totalLightContrib += light.color * lambert * rangeAttenuation(distanceToLight);
    }

    let finalColor = albedo * totalLightContrib;
    return vec4f(albedo * totalLightContrib, 1.0f);
}
`,moveLightsComputeRaw=`@group(\${bindGroup_scene}) @binding(0) var<storage, read_write> lightSet: LightSet;
@group(\${bindGroup_scene}) @binding(1) var<uniform> time: f32;

// https://gist.github.com/munrocket/236ed5ba7e409b8bdf1ff6eca5dcdc39
// MIT License. © Stefan Gustavson, Munrocket
fn permute4(x: vec4f) -> vec4f { return ((x * 34. + 1.) * x) % vec4f(289.); }
fn fade2(t: vec2f) -> vec2f { return t * t * t * (t * (t * 6. - 15.) + 10.); }

fn perlin(P: vec2f) -> f32 {
    var Pi: vec4f = floor(P.xyxy) + vec4f(0., 0., 1., 1.);
    let Pf = fract(P.xyxy) - vec4f(0., 0., 1., 1.);
    Pi = Pi % vec4f(289.); // To avoid truncation effects in permutation
    let ix = Pi.xzxz;
    let iy = Pi.yyww;
    let fx = Pf.xzxz;
    let fy = Pf.yyww;
    let i = permute4(permute4(ix) + iy);
    var gx: vec4f = 2. * fract(i * 0.0243902439) - 1.; // 1/41 = 0.024...
    let gy = abs(gx) - 0.5;
    let tx = floor(gx + 0.5);
    gx = gx - tx;
    var g00: vec2f = vec2f(gx.x, gy.x);
    var g10: vec2f = vec2f(gx.y, gy.y);
    var g01: vec2f = vec2f(gx.z, gy.z);
    var g11: vec2f = vec2f(gx.w, gy.w);
    let norm = 1.79284291400159 - 0.85373472095314 *
        vec4f(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11));
    g00 = g00 * norm.x;
    g01 = g01 * norm.y;
    g10 = g10 * norm.z;
    g11 = g11 * norm.w;
    let n00 = dot(g00, vec2f(fx.x, fy.x));
    let n10 = dot(g10, vec2f(fx.y, fy.y));
    let n01 = dot(g01, vec2f(fx.z, fy.z));
    let n11 = dot(g11, vec2f(fx.w, fy.w));
    let fade_xy = fade2(Pf.xy);
    let n_x = mix(vec2f(n00, n01), vec2f(n10, n11), vec2f(fade_xy.x));
    let n_xy = mix(n_x.x, n_x.y, fade_xy.y);
    return 2.3 * n_xy;
}

fn perlin3(lightIdx: u32, scaledTime: f32) -> vec3f {
    let seedPos = vec2f(f32(lightIdx) * 163.81f, scaledTime);
    return vec3f(perlin(seedPos), perlin(seedPos + 110.93), perlin(seedPos + 350.51));
}

const bboxMin = vec3f(-10, 0, -5);
const bboxMax = vec3f(10, 8, 5);

// CHECKITOUT: this is an example of a compute shader entry point function
@compute
@workgroup_size(\${moveLightsWorkgroupSize})
fn main(@builtin(global_invocation_id) globalIdx: vec3u) {
    let lightIdx = globalIdx.x;
    if (lightIdx >= lightSet.numLights) {
        return;
    }

    let scaledTime = time / 5000.f;

    let noise = perlin3(lightIdx, scaledTime);
    // perlin noise rarely reaches the extremes (-1 and 1), so scale accordingly here to ensure lights reach
    // the bounding box's sides
    let scaledNoise = (noise + 0.5) * 0.8;
    lightSet.lights[lightIdx].pos = mix(bboxMin, bboxMax, scaledNoise);
}
`,clusteringComputeRaw=`// TODO-2: implement the light clustering compute shader

// ------------------------------------
// Calculating cluster bounds:
// ------------------------------------
// For each cluster (X, Y, Z):
//     - Calculate the screen-space bounds for this cluster in 2D (XY).
//     - Calculate the depth bounds for this cluster in Z (near and far planes).
//     - Convert these screen and depth bounds into view-space coordinates.
//     - Store the computed bounding box (AABB) for the cluster.

// ------------------------------------
// Assigning lights to clusters:
// ------------------------------------
// For each cluster:
//     - Initialize a counter for the number of lights in this cluster.

//     For each light:
//         - Check if the light intersects with the cluster’s bounding box (AABB).
//         - If it does, add the light to the cluster's light list.
//         - Stop adding lights if the maximum number of lights is reached.

//     - Store the number of lights assigned to this cluster.

@group(0) @binding(0) var<uniform> cameraUniforms: CameraUniforms;

@group(1) @binding(0) var<storage, read> lightSet: LightSet;
@group(1) @binding(1) var<storage, read_write> clusterSet: ClusterSet;

fn computeRayDirection(ndcX: f32, ndcY: f32) -> vec3f {
    let position = cameraUniforms.invProjMat * vec4f(ndcX, ndcY, 1.0f, 1.0f);
    return normalize(position.xyz / position.w); 
}

fn isSphereIntersectingFrustum(normals: array<vec3f, 6>, offsets: array<f32, 6>, center: vec3f, radius: f32) -> bool {
    for (var i: u32 = 0u; i < 6u; i += 1u) {
        let distance = dot(normals[i], center) - offsets[i];
        if (distance > radius) {
            return false;
        }
    }
    return true;
}

@compute @workgroup_size(\${clusteringWorkGroupSize})
fn main(@builtin(global_invocation_id) globalID: vec3u) {
    let sizeYZ = clusterSet.numClustersY * \${numClustersZ};
    let sizeXYZ = clusterSet.numClustersX * sizeYZ;
    let indexXYZ = globalID.x;
    if (indexXYZ >= sizeXYZ) {
        return;
    }
    let indexX = indexXYZ / sizeYZ;
    let indexYZ = indexXYZ - indexX * sizeYZ;
    let indexY = indexYZ / \${numClustersZ};
    let indexZ = indexYZ - indexY * \${numClustersZ};

    // [-1, 1] NDC coordinates
    let xMin = f32(indexX) / f32(clusterSet.numClustersX) * 2.0f - 1.0f;
    let xMax = f32(indexX + 1u) / f32(clusterSet.numClustersX) * 2.0f - 1.0f;
    let yMin = f32(indexY) / f32(clusterSet.numClustersY) * 2.0f - 1.0f;
    let yMax = f32(indexY + 1u) / f32(clusterSet.numClustersY) * 2.0f - 1.0f;

    // Linear depth values (positive)
    let zNear = mix(\${clusterNear}, \${clusterFar}, f32(indexZ) / f32(\${numClustersZ}));
    let zFar = mix(\${clusterNear}, \${clusterFar}, f32(indexZ + 1u) / f32(\${numClustersZ}));

    // Ray directions for the four corners of the frustum (view space)
    let rayBL = computeRayDirection(xMin, yMin); // bottom-left
    let rayBR = computeRayDirection(xMax, yMin); // bottom-right
    let rayTL = computeRayDirection(xMin, yMax); // top-left
    let rayTR = computeRayDirection(xMax, yMax); // top-right

    // Plane normals (view space)
    let planeNormals = array<vec3f, 6>(
        vec3f(0.0f, 0.0f, 1.0f), // near
        vec3f(0.0f, 0.0f, -1.0f), // far
        normalize(cross(rayTL, rayBL)), // left
        normalize(cross(rayBR, rayTR)), // right
        normalize(cross(rayBL, rayBR)), // bottom
        normalize(cross(rayTR, rayTL))  // top
    );
    // dot(normal, point) - offset > 0 => outside plane
    let planeOffsets = array<f32, 6>(
        -zNear,  // near
        zFar,   // far
        0.0f,     // left
        0.0f,     // right
        0.0f,     // bottom
        0.0f      // top
    );

    var numLights: u32 = 0u;
    for (var i: u32 = 0u; i < lightSet.numLights && numLights < \${maxLightsPerCluster}; i += 1u) {
        let light = lightSet.lights[i];
        // View space position of the light
        let position = (cameraUniforms.viewMat * vec4f(light.pos, 1.0f)).xyz;
        if (isSphereIntersectingFrustum(planeNormals, planeOffsets, position, \${lightRadius})) {
            clusterSet.clusters[indexXYZ].lightIndices[numLights] = i;
            numLights += 1u;
        }
    }
    clusterSet.clusters[indexXYZ].numLights = numLights;
}
`,constants={bindGroup_scene:0,bindGroup_model:1,bindGroup_gBuffer:1,bindGroup_material:2,bindGroup_clusterSet:3,moveLightsWorkgroupSize:128,clusterPixelSize:64,numClustersZ:16,maxLightsPerCluster:511,clusteringWorkGroupSize:128};function evalShaderRaw(raw){return eval("`"+raw.replaceAll("${","${constants.")+"`")}const commonSrc=evalShaderRaw(commonRaw);function processShaderRaw(t){return commonSrc+evalShaderRaw(t)}const naiveVertSrc=processShaderRaw(naiveVertRaw),naiveFragSrc=processShaderRaw(naiveFragRaw),forwardPlusFragSrc=processShaderRaw(forwardPlusFragRaw),clusteredDeferredFragSrc=processShaderRaw(clusteredDeferredFragRaw),clusteredDeferredFullscreenVertSrc=processShaderRaw(clusteredDeferredFullscreenVertRaw),clusteredDeferredFullscreenFragSrc=processShaderRaw(clusteredDeferredFullscreenFragRaw),moveLightsComputeSrc=processShaderRaw(moveLightsComputeRaw),clusteringComputeSrc=processShaderRaw(clusteringComputeRaw);class NaiveRenderer extends Renderer{sceneUniformsBindGroupLayout;sceneUniformsBindGroup;depthTexture;depthTextureView;pipeline;constructor(e){super(e),this.sceneUniformsBindGroupLayout=device.createBindGroupLayout({label:"scene uniforms bind group layout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),this.sceneUniformsBindGroup=device.createBindGroup({label:"scene uniforms bind group",layout:this.sceneUniformsBindGroupLayout,entries:[{binding:0,resource:{buffer:this.camera.uniformsBuffer}},{binding:1,resource:{buffer:this.lights.lightSetStorageBuffer}}]}),this.depthTexture=device.createTexture({size:[canvas.width,canvas.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.depthTextureView=this.depthTexture.createView(),this.pipeline=device.createRenderPipeline({layout:device.createPipelineLayout({label:"naive pipeline layout",bindGroupLayouts:[this.sceneUniformsBindGroupLayout,modelBindGroupLayout,materialBindGroupLayout]}),depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"},vertex:{module:device.createShaderModule({label:"naive vert shader",code:naiveVertSrc}),buffers:[vertexBufferLayout]},fragment:{module:device.createShaderModule({label:"naive frag shader",code:naiveFragSrc}),targets:[{format:canvasFormat}]}})}draw(){const e=device.createCommandEncoder(),n=context.getCurrentTexture().createView(),r=e.beginRenderPass({label:"naive render pass",colorAttachments:[{view:n,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthTextureView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});r.setPipeline(this.pipeline),r.setBindGroup(constants.bindGroup_scene,this.sceneUniformsBindGroup),this.scene.iterate(s=>{r.setBindGroup(constants.bindGroup_model,s.modelBindGroup)},s=>{r.setBindGroup(constants.bindGroup_material,s.materialBindGroup)},s=>{r.setVertexBuffer(0,s.vertexBuffer),r.setIndexBuffer(s.indexBuffer,"uint32"),r.drawIndexed(s.numIndices)}),r.end(),device.queue.submit([e.finish()])}}class ForwardPlusRenderer extends Renderer{sceneUniformsBindGroupLayout;sceneUniformsBindGroup;clusterSetBindGroupLayout;clusterSetBindGroup;depthTexture;depthTextureView;pipeline;constructor(e){super(e),this.sceneUniformsBindGroupLayout=device.createBindGroupLayout({label:"scene uniforms bind group layout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),this.sceneUniformsBindGroup=device.createBindGroup({label:"scene uniforms bind group",layout:this.sceneUniformsBindGroupLayout,entries:[{binding:0,resource:{buffer:this.camera.uniformsBuffer}},{binding:1,resource:{buffer:this.lights.lightSetStorageBuffer}}]}),this.clusterSetBindGroupLayout=device.createBindGroupLayout({label:"cluster set bind group layout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),this.clusterSetBindGroup=device.createBindGroup({label:"cluster set bind group",layout:this.clusterSetBindGroupLayout,entries:[{binding:0,resource:{buffer:this.lights.clusterSetStorageBuffer}}]}),this.depthTexture=device.createTexture({size:[canvas.width,canvas.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.depthTextureView=this.depthTexture.createView(),this.pipeline=device.createRenderPipeline({layout:device.createPipelineLayout({label:"forward plus pipeline layout",bindGroupLayouts:[this.sceneUniformsBindGroupLayout,modelBindGroupLayout,materialBindGroupLayout,this.clusterSetBindGroupLayout]}),depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"},vertex:{module:device.createShaderModule({label:"forward plus vert shader",code:naiveVertSrc}),buffers:[vertexBufferLayout]},fragment:{module:device.createShaderModule({label:"forward plus frag shader",code:forwardPlusFragSrc}),targets:[{format:canvasFormat}]}})}draw(){const e=device.createCommandEncoder(),n=context.getCurrentTexture().createView();this.lights.doLightClustering(e);const r=e.beginRenderPass({label:"forward plus render pass",colorAttachments:[{view:n,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthTextureView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});r.setPipeline(this.pipeline),r.setBindGroup(constants.bindGroup_scene,this.sceneUniformsBindGroup),r.setBindGroup(constants.bindGroup_clusterSet,this.clusterSetBindGroup),this.scene.iterate(s=>{r.setBindGroup(constants.bindGroup_model,s.modelBindGroup)},s=>{r.setBindGroup(constants.bindGroup_material,s.materialBindGroup)},s=>{r.setVertexBuffer(0,s.vertexBuffer),r.setIndexBuffer(s.indexBuffer,"uint32"),r.drawIndexed(s.numIndices)}),r.end(),device.queue.submit([e.finish()])}}class ClusteredDeferredRenderer extends Renderer{sceneUniformsBindGroupLayout;sceneUniformsBindGroup;clusterSetBindGroupLayout;clusterSetBindGroup;gBufferBindGroupLayout;gBufferBindGroup;depthTexture;depthTextureView;albedoTexture;albedoTextureView;normalTexture;normalTextureView;texSampler;geometryPipeline;lightingPipeline;constructor(e){super(e),this.sceneUniformsBindGroupLayout=device.createBindGroupLayout({label:"scene uniforms bind group layout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),this.sceneUniformsBindGroup=device.createBindGroup({label:"scene uniforms bind group",layout:this.sceneUniformsBindGroupLayout,entries:[{binding:0,resource:{buffer:this.camera.uniformsBuffer}},{binding:1,resource:{buffer:this.lights.lightSetStorageBuffer}}]}),this.clusterSetBindGroupLayout=device.createBindGroupLayout({label:"cluster set bind group layout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),this.clusterSetBindGroup=device.createBindGroup({label:"cluster set bind group",layout:this.clusterSetBindGroupLayout,entries:[{binding:0,resource:{buffer:this.lights.clusterSetStorageBuffer}}]}),this.depthTexture=device.createTexture({size:[canvas.width,canvas.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),this.depthTextureView=this.depthTexture.createView(),this.albedoTexture=device.createTexture({size:[canvas.width,canvas.height],format:"rgba8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),this.albedoTextureView=this.albedoTexture.createView(),this.normalTexture=device.createTexture({size:[canvas.width,canvas.height],format:"rgba16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),this.normalTextureView=this.normalTexture.createView(),this.texSampler=device.createSampler({magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge"}),this.gBufferBindGroupLayout=device.createBindGroupLayout({label:"G-buffer bind group layout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"depth"}},{binding:3,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]}),this.gBufferBindGroup=device.createBindGroup({label:"G-buffer bind group",layout:this.gBufferBindGroupLayout,entries:[{binding:0,resource:this.albedoTextureView},{binding:1,resource:this.normalTextureView},{binding:2,resource:this.depthTextureView},{binding:3,resource:this.texSampler}]}),this.geometryPipeline=device.createRenderPipeline({layout:device.createPipelineLayout({label:"geometry pipeline layout",bindGroupLayouts:[this.sceneUniformsBindGroupLayout,modelBindGroupLayout,materialBindGroupLayout]}),depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"},vertex:{module:device.createShaderModule({label:"clustered deferred geometry vert shader",code:naiveVertSrc}),buffers:[vertexBufferLayout]},fragment:{module:device.createShaderModule({label:"clustered deferred geometry frag shader",code:clusteredDeferredFragSrc}),targets:[{format:"rgba8unorm"},{format:"rgba16float"}]}}),this.lightingPipeline=device.createRenderPipeline({layout:device.createPipelineLayout({label:"lighting pipeline layout",bindGroupLayouts:[this.sceneUniformsBindGroupLayout,this.gBufferBindGroupLayout,null,this.clusterSetBindGroupLayout]}),vertex:{module:device.createShaderModule({label:"clustered deferred lighting vert shader",code:clusteredDeferredFullscreenVertSrc}),buffers:[]},fragment:{module:device.createShaderModule({label:"clustered deferred lighting frag shader",code:clusteredDeferredFullscreenFragSrc}),targets:[{format:canvasFormat}]}})}draw(){const e=device.createCommandEncoder(),n=context.getCurrentTexture().createView();this.lights.doLightClustering(e);const r=e.beginRenderPass({label:"clustered deferred geometry pass",colorAttachments:[{view:this.albedoTextureView,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"},{view:this.normalTextureView,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthTextureView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});r.setPipeline(this.geometryPipeline),r.setBindGroup(constants.bindGroup_scene,this.sceneUniformsBindGroup),this.scene.iterate(o=>{r.setBindGroup(constants.bindGroup_model,o.modelBindGroup)},o=>{r.setBindGroup(constants.bindGroup_material,o.materialBindGroup)},o=>{r.setVertexBuffer(0,o.vertexBuffer),r.setIndexBuffer(o.indexBuffer,"uint32"),r.drawIndexed(o.numIndices)}),r.end();const s=e.beginRenderPass({label:"clustered deferred lighting pass",colorAttachments:[{view:n,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}]});s.setPipeline(this.lightingPipeline),s.setBindGroup(constants.bindGroup_scene,this.sceneUniformsBindGroup),s.setBindGroup(constants.bindGroup_gBuffer,this.gBufferBindGroup),s.setBindGroup(constants.bindGroup_clusterSet,this.clusterSetBindGroup),s.draw(3),s.end(),device.queue.submit([e.finish()])}}async function parseFromContext(t,e,n,r){return r._parse(t,e,n,r)}function assert$4(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const isBrowser$2=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),matches$1=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);matches$1&&parseFloat(matches$1[1]);const window_=globalThis,process_=globalThis.process||{};function isElectron(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const n=typeof navigator<"u"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function isBrowser$1(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||isElectron()}const VERSION$6="4.1.0";function getStorage(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class LocalStorage{constructor(e,n,r="sessionStorage"){this.storage=getStorage(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function formatTime(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function leftPad(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var COLOR;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(COLOR||(COLOR={}));const BACKGROUND_INCREMENT=10;function getColor(t){return typeof t!="string"?t:(t=t.toUpperCase(),COLOR[t]||COLOR.WHITE)}function addColor(t,e,n){return!isBrowser$1&&typeof t=="string"&&(e&&(t=`\x1B[${getColor(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${getColor(n)+BACKGROUND_INCREMENT}m${t}\x1B[49m`)),t}function autobind(t,e=["constructor"]){const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),s=t;for(const o of r){const c=s[o];typeof c=="function"&&(e.find(d=>o===d)||(s[o]=c.bind(t)))}}function assert$3(t,e){if(!t)throw new Error("Assertion failed")}function getHiResTimestamp(){let t;if(isBrowser$1()&&window_.performance)t=window_?.performance?.now?.();else if("hrtime"in process_){const e=process_?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}const originalConsole={debug:isBrowser$1()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},DEFAULT_LOG_CONFIGURATION={enabled:!0,level:0};function noop(){}const cache$6={},ONCE={once:!0};class Log{constructor({id:e}={id:""}){this.VERSION=VERSION$6,this._startTs=getHiResTimestamp(),this._deltaTs=getHiResTimestamp(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new LocalStorage(`__probe-${this.id}__`,DEFAULT_LOG_CONFIGURATION),this.timeStamp(`${this.id} started`),autobind(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((getHiResTimestamp()-this._startTs).toPrecision(10))}getDelta(){return Number((getHiResTimestamp()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,originalConsole.warn,arguments,ONCE)}error(e){return this._getLogFunction(0,e,originalConsole.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,originalConsole.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,originalConsole.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,originalConsole.debug||originalConsole.info,arguments,ONCE)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||noop,r&&[r],{tag:getTableHeader(n)}):noop}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||noop)}group(e,n,r={collapsed:!1}){const s=normalizeArguments({logLevel:e,message:n,opts:r}),{collapsed:o}=r;return s.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,n,r={}){return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||noop)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=normalizeLogLevel(e)}_getLogFunction(e,n,r,s,o){if(this._shouldLog(e)){o=normalizeArguments({logLevel:e,message:n,args:s,opts:o}),r=r||o.method,assert$3(r),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=getHiResTimestamp();const c=o.tag||o.message;if(o.once&&c)if(!cache$6[c])cache$6[c]=getHiResTimestamp();else return noop;return n=decorateMessage(this.id,o.message,o),r.bind(console,n,...o.args)}return noop}}Log.VERSION=VERSION$6;function normalizeLogLevel(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return assert$3(Number.isFinite(e)&&e>=0),e}function normalizeArguments(t){const{logLevel:e,message:n}=t;t.logLevel=normalizeLogLevel(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const s=typeof t.message;return assert$3(s==="string"||s==="object"),Object.assign(t,{args:r},t.opts)}function decorateMessage(t,e,n){if(typeof e=="string"){const r=n.time?leftPad(formatTime(n.total)):"";e=n.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=addColor(e,n.color,n.background)}return e}function getTableHeader(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const VERSION$5="4.3.3",version=VERSION$5[0]>="0"&&VERSION$5[0]<="9"?`v${VERSION$5}`:"";function createLog(){const t=new Log({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=version,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const log=createLog();function mergeLoaderOptions(t,e){return mergeOptionsRecursively(t||{},e)}function mergeOptionsRecursively(t,e,n=0){if(n>3)return e;const r={...t};for(const[s,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?r[s]=mergeOptionsRecursively(r[s]||{},e[s],n+1):r[s]=e[s];return r}function registerJSModules(t){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,t)}function getJSModuleOrNull(t){return globalThis.loaders?.modules?.[t]||null}const NPM_TAG="latest";function getVersion(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const VERSION$4=getVersion();function assert$2(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const isBrowser=typeof process!="object"||String(process)!=="[object process]"||process.browser,isWorker=typeof importScripts=="function",isMobile=typeof window<"u"&&typeof window.orientation<"u",matches=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);matches&&parseFloat(matches[1]);class WorkerJob{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,n){this.name=e,this.workerThread=n,this.result=new Promise((r,s)=>{this._resolve=r,this._reject=s})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){assert$2(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){assert$2(this.isRunning),this.isRunning=!1,this._reject(e)}}class NodeWorker{terminate(){}}const workerURLCache=new Map;function getLoadableWorkerURL(t){assert$2(t.source&&!t.url||!t.source&&t.url);let e=workerURLCache.get(t.source||t.url);return e||(t.url&&(e=getLoadableWorkerURLFromURL(t.url),workerURLCache.set(t.url,e)),t.source&&(e=getLoadableWorkerURLFromSource(t.source),workerURLCache.set(t.source,e))),assert$2(e),e}function getLoadableWorkerURLFromURL(t){if(!t.startsWith("http"))return t;const e=buildScriptSource(t);return getLoadableWorkerURLFromSource(e)}function getLoadableWorkerURLFromSource(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function buildScriptSource(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function getTransferList(t,e=!0,n){const r=n||new Set;if(t){if(isTransferable(t))r.add(t);else if(isTransferable(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const s in t)getTransferList(t[s],e,r)}}return n===void 0?Array.from(r):[]}function isTransferable(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const NOOP=()=>{};class WorkerThread{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&isBrowser||typeof NodeWorker<"u"&&!isBrowser}constructor(e){const{name:n,source:r,url:s}=e;assert$2(r||s),this.name=n,this.source=r,this.url=s,this.onMessage=NOOP,this.onError=o=>console.log(o),this.worker=isBrowser?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=NOOP,this.onError=NOOP,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||getTransferList(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=getLoadableWorkerURL({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new NodeWorker(r,{eval:!1})}else if(this.source)e=new NodeWorker(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class WorkerPool{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return WorkerThread.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(s,o,c)=>s.done(c),r=(s,o)=>s.error(o)){const s=new Promise(o=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:o}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new WorkerJob(n.name,e);e.onMessage=s=>n.onMessage(r,s.type,s.payload),e.onError=s=>n.onError(r,s),n.onStart(r);try{await r.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!isBrowser||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new WorkerThread({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return isMobile?this.maxMobileConcurrency:this.maxConcurrency}}const DEFAULT_PROPS={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class WorkerFarm{props;workerPools=new Map;static _workerFarm;static isSupported(){return WorkerThread.isSupported()}static getWorkerFarm(e={}){return WorkerFarm._workerFarm=WorkerFarm._workerFarm||new WorkerFarm({}),WorkerFarm._workerFarm.setProps(e),WorkerFarm._workerFarm}constructor(e){this.props={...DEFAULT_PROPS},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:s}=e;let o=this.workerPools.get(n);return o||(o=new WorkerPool({name:n,source:r,url:s}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function getWorkerURL(t,e={}){const n=e[t.id]||{},r=isBrowser?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let s=n.workerUrl;if(!s&&t.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(isBrowser?s=`modules/${t.module}/dist/${r}`:s=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!s){let o=t.version;o==="latest"&&(o=NPM_TAG);const c=o?`@${o}`:"";s=`https://unpkg.com/@loaders.gl/${t.module}${c}/dist/${r}`}return assert$2(s),s}function validateWorkerVersion(t,e=VERSION$4){assert$2(t,"no worker provided");const n=t.version;return!(!e||!n)}const loadLibraryPromises={};async function loadLibrary(t,e=null,n={},r=null){return e&&(t=getLibraryUrl(t,e,n,r)),loadLibraryPromises[t]=loadLibraryPromises[t]||loadLibraryFromFile(t),await loadLibraryPromises[t]}function getLibraryUrl(t,e,n={},r=null){if(!n.useLocalLibraries&&t.startsWith("http"))return t;r=r||t;const s=n.modules||{};return s[r]?s[r]:isBrowser?n.CDN?(assert$2(n.CDN.startsWith("http")),`${n.CDN}/${e}@${VERSION$4}/dist/libs/${r}`):isWorker?`../src/libs/${r}`:`modules/${e}/src/libs/${r}`:`modules/${e}/dist/libs/${r}`}async function loadLibraryFromFile(t){if(t.endsWith("wasm"))return await loadAsArrayBuffer(t);if(!isBrowser)try{const{requireFromFile:n}=globalThis.loaders||{};return await n?.(t)}catch(n){return console.error(n),null}if(isWorker)return importScripts(t);const e=await loadAsText(t);return loadLibraryFromString(e,t)}function loadLibraryFromString(t,e){if(!isBrowser){const{requireFromString:r}=globalThis.loaders||{};return r?.(t,e)}if(isWorker)return eval.call(globalThis,t),null;const n=document.createElement("script");n.id=e;try{n.appendChild(document.createTextNode(t))}catch{n.text=t}return document.body.appendChild(n),null}async function loadAsArrayBuffer(t){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return isBrowser||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function loadAsText(t){const{readFileAsText:e}=globalThis.loaders||{};return isBrowser||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}function canParseWithWorker(t,e){return!WorkerFarm.isSupported()||!isBrowser&&!e?._nodeWorkers?!1:t.worker&&e?.worker}async function parseWithWorker(t,e,n,r,s){const o=t.id,c=getWorkerURL(t,n),p=WorkerFarm.getWorkerFarm(n).getWorkerPool({name:o,url:c});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const T=await p.startJob("process-on-worker",onMessage.bind(null,s));return T.postMessage("process",{input:e,options:n,context:r}),await(await T.result).result}async function onMessage(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:s,input:o,options:c}=r;try{const d=await t(o,c);e.postMessage("done",{id:s,result:d})}catch(d){const p=d instanceof Error?d.message:"unknown error";e.postMessage("error",{id:s,error:p})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function getFirstCharacters$1(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?getMagicString$2(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?getMagicString$2(t,0,e):""}function getMagicString$2(t,e,n){if(t.byteLength<=e+n)return"";const r=new DataView(t);let s="";for(let o=0;o<n;o++)s+=String.fromCharCode(r.getUint8(e+o));return s}function parseJSON(t){try{return JSON.parse(t)}catch{throw new Error(`Failed to parse JSON from data starting with "${getFirstCharacters$1(t)}"`)}}function compareArrayBuffers(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),s=new Uint8Array(e);for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0}function concatenateArrayBuffers(...t){return concatenateArrayBuffersFromArray(t)}function concatenateArrayBuffersFromArray(t){const e=t.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),n=e.reduce((o,c)=>o+c.byteLength,0),r=new Uint8Array(n);let s=0;for(const o of e)r.set(o,s),s+=o.byteLength;return r.buffer}function sliceArrayBuffer(t,e,n){const r=n!==void 0?new Uint8Array(t).subarray(e,e+n):new Uint8Array(t).subarray(e);return new Uint8Array(r).buffer}function padToNBytes(t,e){return assert$4(t>=0),assert$4(e>0),t+(e-1)&-4}function copyToArray(t,e,n){let r;if(t instanceof ArrayBuffer)r=new Uint8Array(t);else{const s=t.byteOffset,o=t.byteLength;r=new Uint8Array(t.buffer||t.arrayBuffer,s,o)}return e.set(r,n),n+padToNBytes(r.byteLength,4)}async function concatenateArrayBuffersAsync(t){const e=[];for await(const n of t)e.push(n);return concatenateArrayBuffers(...e)}let pathPrefix="";const fileAliases={};function resolvePath(t){for(const e in fileAliases)if(t.startsWith(e)){const n=fileAliases[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${pathPrefix}${t}`),t}function toArrayBuffer$1(t){return t}function isBuffer$1(t){return t&&typeof t=="object"&&t.isBuffer}function toArrayBuffer(t){if(isBuffer$1(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function filename(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function dirname(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const isBoolean=t=>typeof t=="boolean",isFunction=t=>typeof t=="function",isObject=t=>t!==null&&typeof t=="object",isPureObject=t=>isObject(t)&&t.constructor==={}.constructor,isIterable=t=>!!t&&typeof t[Symbol.iterator]=="function",isAsyncIterable=t=>t&&typeof t[Symbol.asyncIterator]=="function",isResponse=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,isBlob=t=>typeof Blob<"u"&&t instanceof Blob,isBuffer=t=>t&&typeof t=="object"&&t.isBuffer,isReadableDOMStream=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||isObject(t)&&isFunction(t.tee)&&isFunction(t.cancel)&&isFunction(t.getReader),isReadableNodeStream=t=>isObject(t)&&isFunction(t.read)&&isFunction(t.pipe)&&isBoolean(t.readable),isReadableStream=t=>isReadableDOMStream(t)||isReadableNodeStream(t);class FetchError extends Error{constructor(e,n){super(e),this.reason=n.reason,this.url=n.url,this.response=n.response}reason;url;response}const DATA_URL_PATTERN=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,MIME_TYPE_PATTERN=/^([-\w.]+\/[-\w.+]+)/;function compareMIMETypes(t,e){return t.toLowerCase()===e.toLowerCase()}function parseMIMEType(t){const e=MIME_TYPE_PATTERN.exec(t);return e?e[1]:t}function parseMIMETypeFromURL(t){const e=DATA_URL_PATTERN.exec(t);return e?e[1]:""}const QUERY_STRING_PATTERN=/\?.*/;function extractQueryString(t){const e=t.match(QUERY_STRING_PATTERN);return e&&e[0]}function stripQueryString(t){return t.replace(QUERY_STRING_PATTERN,"")}function shortenUrlForDisplay(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function getResourceUrl(t){return isResponse(t)?t.url:isBlob(t)?t.name||"":typeof t=="string"?t:""}function getResourceMIMEType(t){if(isResponse(t)){const e=t,n=e.headers.get("content-type")||"",r=stripQueryString(e.url);return parseMIMEType(n)||parseMIMETypeFromURL(r)}return isBlob(t)?t.type||"":typeof t=="string"?parseMIMETypeFromURL(t):""}function getResourceContentLength(t){return isResponse(t)?t.headers["content-length"]||-1:isBlob(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function makeResponse(t){if(isResponse(t))return t;const e={},n=getResourceContentLength(t);n>=0&&(e["content-length"]=String(n));const r=getResourceUrl(t),s=getResourceMIMEType(t);s&&(e["content-type"]=s);const o=await getInitialDataUrl(t);o&&(e["x-first-bytes"]=o),typeof t=="string"&&(t=new TextEncoder().encode(t));const c=new Response(t,{headers:e});return Object.defineProperty(c,"url",{value:r}),c}async function checkResponse(t){if(!t.ok)throw await getResponseError(t)}async function getResponseError(t){const e=shortenUrlForDisplay(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const r={reason:t.statusText,url:t.url,response:t};try{const s=t.headers.get("Content-Type");r.reason=!t.bodyUsed&&s?.includes("application/json")?await t.json():await t.text()}catch{}return new FetchError(n,r)}async function getInitialDataUrl(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const s=new FileReader;s.onload=o=>r(o?.target?.result),s.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${arrayBufferToBase64(n)}`}return null}function arrayBufferToBase64(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function isNodePath(t){return!isRequestURL(t)&&!isDataURL(t)}function isRequestURL(t){return t.startsWith("http:")||t.startsWith("https:")}function isDataURL(t){return t.startsWith("data:")}async function fetchFile(t,e){if(typeof t=="string"){const n=resolvePath(t);return isNodePath(n)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(n,e):await fetch(n,e)}return await makeResponse(t)}const probeLog=new Log({id:"loaders.gl"});class NullLog{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class ConsoleLog{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const DEFAULT_LOADER_OPTIONS={fetch:null,mimeType:void 0,nothrow:!1,log:new ConsoleLog,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:isBrowser$2,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},REMOVED_LOADER_OPTIONS={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function getGlobalLoaderState(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function getGlobalLoaderOptions(){const t=getGlobalLoaderState();return t.globalOptions=t.globalOptions||{...DEFAULT_LOADER_OPTIONS},t.globalOptions}function normalizeOptions(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],validateOptions(t,n),normalizeOptionsInternal(e,t,r)}function validateOptions(t,e){validateOptionsObject(t,null,DEFAULT_LOADER_OPTIONS,REMOVED_LOADER_OPTIONS,e);for(const n of e){const r=t&&t[n.id]||{},s=n.options&&n.options[n.id]||{},o=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};validateOptionsObject(r,n.id,s,o,e)}}function validateOptionsObject(t,e,n,r,s){const o=e||"Top level",c=e?`${e}.`:"";for(const d in t){const p=!e&&isObject(t[d]),T=d==="baseUri"&&!e,S=d==="workerUrl"&&e;if(!(d in n)&&!T&&!S){if(d in r)probeLog.warn(`${o} loader option '${c}${d}' no longer supported, use '${r[d]}'`)();else if(!p){const R=findSimilarOption(d,s);probeLog.warn(`${o} loader option '${c}${d}' not recognized. ${R}`)()}}}}function findSimilarOption(t,e){const n=t.toLowerCase();let r="";for(const s of e)for(const o in s.options){if(t===o)return`Did you mean '${s.id}.${o}'?`;const c=o.toLowerCase();(n.startsWith(c)||c.startsWith(n))&&(r=r||`Did you mean '${s.id}.${o}'?`)}return r}function normalizeOptionsInternal(t,e,n){const s={...t.options||{}};return addUrlOptions(s,n),s.log===null&&(s.log=new NullLog),mergeNestedFields(s,getGlobalLoaderOptions()),mergeNestedFields(s,e),s}function mergeNestedFields(t,e){for(const n in e)if(n in e){const r=e[n];isPureObject(r)&&isPureObject(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function addUrlOptions(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function isLoaderObject(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t?.extensions)):!1}function normalizeLoader(t){assert$4(t,"null loader"),assert$4(isLoaderObject(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t?.parseTextSync||t?.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const getGlobalLoaderRegistry=()=>{const t=getGlobalLoaderState();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function registerLoaders(t){const e=getGlobalLoaderRegistry();t=Array.isArray(t)?t:[t];for(const n of t){const r=normalizeLoader(n);e.find(s=>r===s)||e.unshift(r)}}function getRegisteredLoaders(){return getGlobalLoaderRegistry()}const EXT_PATTERN=/\.([^.]+)$/;async function selectLoader(t,e=[],n,r){if(!validHTTPResponse(t))return null;let s=selectLoaderSync(t,e,{...n,nothrow:!0},r);if(s)return s;if(isBlob(t)&&(t=await t.slice(0,10).arrayBuffer(),s=selectLoaderSync(t,e,n,r)),!s&&!n?.nothrow)throw new Error(getNoValidLoaderMessage(t));return s}function selectLoaderSync(t,e=[],n,r){if(!validHTTPResponse(t))return null;if(e&&!Array.isArray(e))return normalizeLoader(e);let s=[];e&&(s=s.concat(e)),n?.ignoreRegisteredLoaders||s.push(...getRegisteredLoaders()),normalizeLoaders(s);const o=selectLoaderInternal(t,s,n,r);if(!o&&!n?.nothrow)throw new Error(getNoValidLoaderMessage(t));return o}function selectLoaderInternal(t,e,n,r){const s=getResourceUrl(t),o=getResourceMIMEType(t),c=stripQueryString(s)||r?.url;let d=null,p="";return n?.mimeType&&(d=findLoaderByMIMEType(e,n?.mimeType),p=`match forced by supplied MIME type ${n?.mimeType}`),d=d||findLoaderByUrl(e,c),p=p||(d?`matched url ${c}`:""),d=d||findLoaderByMIMEType(e,o),p=p||(d?`matched MIME type ${o}`:""),d=d||findLoaderByInitialBytes(e,t),p=p||(d?`matched initial data ${getFirstCharacters(t)}`:""),n?.fallbackMimeType&&(d=d||findLoaderByMIMEType(e,n?.fallbackMimeType),p=p||(d?`matched fallback MIME type ${o}`:"")),p&&log.log(1,`selectLoader selected ${d?.name}: ${p}.`),d}function validHTTPResponse(t){return!(t instanceof Response&&t.status===204)}function getNoValidLoaderMessage(t){const e=getResourceUrl(t),n=getResourceMIMEType(t);let r="No valid loader found (";r+=e?`${filename(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const s=t?getFirstCharacters(t):"";return r+=s?` first bytes: "${s}"`:"first bytes: not available",r+=")",r}function normalizeLoaders(t){for(const e of t)normalizeLoader(e)}function findLoaderByUrl(t,e){const n=e&&EXT_PATTERN.exec(e),r=n&&n[1];return r?findLoaderByExtension(t,r):null}function findLoaderByExtension(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function findLoaderByMIMEType(t,e){for(const n of t)if(n.mimeTypes?.some(r=>compareMIMETypes(e,r))||compareMIMETypes(e,`application/x.${n.id}`))return n;return null}function findLoaderByInitialBytes(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(testDataAgainstText(e,n))return n}else if(ArrayBuffer.isView(e)){if(testDataAgainstBinary(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&testDataAgainstBinary(e,0,n))return n;return null}function testDataAgainstText(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function testDataAgainstBinary(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(s=>testBinary(t,e,n,s))}function testBinary(t,e,n,r){if(r instanceof ArrayBuffer)return compareArrayBuffers(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const s=getMagicString$1(t,e,r.length);return r===s;default:return!1}}function getFirstCharacters(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?getMagicString$1(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?getMagicString$1(t,0,e):""}function getMagicString$1(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let s="";for(let o=0;o<n;o++)s+=String.fromCharCode(r.getUint8(e+o));return s}const DEFAULT_CHUNK_SIZE$2=256*1024;function*makeStringIterator(t,e){const n=e?.chunkSize||DEFAULT_CHUNK_SIZE$2;let r=0;const s=new TextEncoder;for(;r<t.length;){const o=Math.min(t.length-r,n),c=t.slice(r,r+o);r+=o,yield s.encode(c)}}const DEFAULT_CHUNK_SIZE$1=256*1024;function*makeArrayBufferIterator(t,e={}){const{chunkSize:n=DEFAULT_CHUNK_SIZE$1}=e;let r=0;for(;r<t.byteLength;){const s=Math.min(t.byteLength-r,n),o=new ArrayBuffer(s),c=new Uint8Array(t,r,s);new Uint8Array(o).set(c),r+=s,yield o}}const DEFAULT_CHUNK_SIZE=1024*1024;async function*makeBlobIterator(t,e){const n=e?.chunkSize||DEFAULT_CHUNK_SIZE;let r=0;for(;r<t.size;){const s=r+n,o=await t.slice(r,s).arrayBuffer();r=s,yield o}}function makeStreamIterator(t,e){return isBrowser$2?makeBrowserStreamIterator(t,e):makeNodeStreamIterator(t)}async function*makeBrowserStreamIterator(t,e){const n=t.getReader();let r;try{for(;;){const s=r||n.read();e?._streamReadAhead&&(r=n.read());const{done:o,value:c}=await s;if(o)return;yield toArrayBuffer(c)}}catch{n.releaseLock()}}async function*makeNodeStreamIterator(t,e){for await(const n of t)yield toArrayBuffer(n)}function makeIterator(t,e){if(typeof t=="string")return makeStringIterator(t,e);if(t instanceof ArrayBuffer)return makeArrayBufferIterator(t,e);if(isBlob(t))return makeBlobIterator(t,e);if(isReadableStream(t))return makeStreamIterator(t,e);if(isResponse(t))return makeStreamIterator(t.body,e);throw new Error("makeIterator")}const ERR_DATA="Cannot convert supplied data type";function getArrayBufferOrStringFromDataSync(t,e,n){if(e.text&&typeof t=="string")return t;if(isBuffer(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const s=t.byteLength||t.length;return(t.byteOffset!==0||s!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+s)),r}throw new Error(ERR_DATA)}async function getArrayBufferOrStringFromData(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return getArrayBufferOrStringFromDataSync(t,e);if(isBlob(t)&&(t=await makeResponse(t)),isResponse(t)){const s=t;return await checkResponse(s),e.binary?await s.arrayBuffer():await s.text()}if(isReadableStream(t)&&(t=makeIterator(t,n)),isIterable(t)||isAsyncIterable(t))return concatenateArrayBuffersAsync(t);throw new Error(ERR_DATA)}function getFetchFunction(t,e){const n=getGlobalLoaderOptions(),r=t||n;return typeof r.fetch=="function"?r.fetch:isObject(r.fetch)?s=>fetchFile(s,r.fetch):e?.fetch?e?.fetch:fetchFile}function getLoaderContext(t,e,n){if(n)return n;const r={fetch:getFetchFunction(e,t),...t};if(r.url){const s=stripQueryString(r.url);r.baseUrl=s,r.queryString=extractQueryString(r.url),r.filename=filename(s),r.baseUrl=dirname(s)}return Array.isArray(r.loaders)||(r.loaders=null),r}function getLoadersFromContext(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:void 0}async function parse$2(t,e,n,r){e&&!Array.isArray(e)&&!isLoaderObject(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const s=getResourceUrl(t),c=getLoadersFromContext(e,r),d=await selectLoader(t,c,n);return d?(n=normalizeOptions(n,d,c,s),r=getLoaderContext({url:s,_parse:parse$2,loaders:c},n,r||null),await parseWithLoader(d,t,n,r)):null}async function parseWithLoader(t,e,n,r){if(validateWorkerVersion(t),n=mergeLoaderOptions(t.options,n),isResponse(e)){const o=e,{ok:c,redirected:d,status:p,statusText:T,type:S,url:R}=o,x=Object.fromEntries(o.headers.entries());r.response={headers:x,ok:c,redirected:d,status:p,statusText:T,type:S,url:R}}e=await getArrayBufferOrStringFromData(e,t,n);const s=t;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,n,r);if(canParseWithWorker(t,n))return await parseWithWorker(t,e,n,r,parse$2);if(s.parseText&&typeof e=="string")return await s.parseText(e,n,r);if(s.parse)return await s.parse(e,n,r);throw assert$2(!s.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}function getDataTypeFromTypedArray(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function getMeshBoundingBox(t){let e=1/0,n=1/0,r=1/0,s=-1/0,o=-1/0,c=-1/0;const d=t.POSITION?t.POSITION.value:[],p=d&&d.length;for(let T=0;T<p;T+=3){const S=d[T],R=d[T+1],x=d[T+2];e=S<e?S:e,n=R<n?R:n,r=x<r?x:r,s=S>s?S:s,o=R>o?R:o,c=x>c?x:c}return[[e,n,r],[s,o,c]]}function deduceMeshField(t,e,n){const r=getDataTypeFromTypedArray(e.value),s=n||makeMeshAttributeMetadata(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:r}]},nullable:!1,metadata:s}}function makeMeshAttributeMetadata(t){const e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}async function load(t,e,n,r){let s,o;!Array.isArray(e)&&!isLoaderObject(e)?(s=[],o=e):(s=e,o=n);const c=getFetchFunction(o);let d=t;return typeof t=="string"&&(d=await c(t)),isBlob(t)&&(d=await c(t)),Array.isArray(s)?await parse$2(d,s,o):await parse$2(d,s,o)}const VERSION$3="4.3.3",parseImageNode=globalThis.loaders?.parseImageNode,IMAGE_SUPPORTED=typeof Image<"u",IMAGE_BITMAP_SUPPORTED=typeof ImageBitmap<"u",NODE_IMAGE_SUPPORTED=!!parseImageNode,DATA_SUPPORTED=isBrowser$2?!0:NODE_IMAGE_SUPPORTED;function isImageTypeSupported(t){switch(t){case"auto":return IMAGE_BITMAP_SUPPORTED||IMAGE_SUPPORTED||DATA_SUPPORTED;case"imagebitmap":return IMAGE_BITMAP_SUPPORTED;case"image":return IMAGE_SUPPORTED;case"data":return DATA_SUPPORTED;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function getDefaultImageType(){if(IMAGE_BITMAP_SUPPORTED)return"imagebitmap";if(IMAGE_SUPPORTED)return"image";if(DATA_SUPPORTED)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function getImageType(t){const e=getImageTypeOrNull(t);if(!e)throw new Error("Not an image");return e}function getImageData(t){switch(getImageType(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function getImageTypeOrNull(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const SVG_DATA_URL_PATTERN=/^data:image\/svg\+xml/,SVG_URL_PATTERN=/\.svg((\?|#).*)?$/;function isSVG(t){return t&&(SVG_DATA_URL_PATTERN.test(t)||SVG_URL_PATTERN.test(t))}function getBlobOrSVGDataUrl(t,e){if(isSVG(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return getBlob(t,e)}function getBlob(t,e){if(isSVG(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function parseToImage(t,e,n){const r=getBlobOrSVGDataUrl(t,n),s=self.URL||self.webkitURL,o=typeof r!="string"&&s.createObjectURL(r);try{return await loadToImage(o||r,e)}finally{o&&s.revokeObjectURL(o)}}async function loadToImage(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,s)=>{try{n.onload=()=>r(n),n.onerror=o=>{const c=o instanceof Error?o.message:"error";s(new Error(c))}}catch(o){s(o)}})}const EMPTY_OBJECT={};let imagebitmapOptionsSupported=!0;async function parseToImageBitmap(t,e,n){let r;isSVG(n)?r=await parseToImage(t,e,n):r=getBlob(t,n);const s=e&&e.imagebitmap;return await safeCreateImageBitmap(r,s)}async function safeCreateImageBitmap(t,e=null){if((isEmptyObject(e)||!imagebitmapOptionsSupported)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),imagebitmapOptionsSupported=!1}return await createImageBitmap(t)}function isEmptyObject(t){for(const e in t||EMPTY_OBJECT)return!1;return!0}function getISOBMFFMediaType(t){return!checkString(t,"ftyp",4)||(t[8]&96)===0?null:decodeMajorBrand(t)}function decodeMajorBrand(t){switch(getUTF8String(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function getUTF8String(t,e,n){return String.fromCharCode(...t.slice(e,n))}function stringToBytes(t){return[...t].map(e=>e.charCodeAt(0))}function checkString(t,e,n=0){const r=stringToBytes(e);for(let s=0;s<r.length;++s)if(r[s]!==t[s+n])return!1;return!0}const BIG_ENDIAN=!1,LITTLE_ENDIAN$1=!0;function getBinaryImageMetadata(t){const e=toDataView(t);return getPngMetadata(e)||getJpegMetadata(e)||getGifMetadata(e)||getBmpMetadata(e)||getISOBMFFMetadata(e)}function getISOBMFFMetadata(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=getISOBMFFMediaType(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function getPngMetadata(t){const e=toDataView(t);return e.byteLength>=24&&e.getUint32(0,BIG_ENDIAN)===2303741511?{mimeType:"image/png",width:e.getUint32(16,BIG_ENDIAN),height:e.getUint32(20,BIG_ENDIAN)}:null}function getGifMetadata(t){const e=toDataView(t);return e.byteLength>=10&&e.getUint32(0,BIG_ENDIAN)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,LITTLE_ENDIAN$1),height:e.getUint16(8,LITTLE_ENDIAN$1)}:null}function getBmpMetadata(t){const e=toDataView(t);return e.byteLength>=14&&e.getUint16(0,BIG_ENDIAN)===16973&&e.getUint32(2,LITTLE_ENDIAN$1)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,LITTLE_ENDIAN$1),height:e.getUint32(22,LITTLE_ENDIAN$1)}:null}function getJpegMetadata(t){const e=toDataView(t);if(!(e.byteLength>=3&&e.getUint16(0,BIG_ENDIAN)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:s}=getJpegMarkers();let o=2;for(;o+9<e.byteLength;){const c=e.getUint16(o,BIG_ENDIAN);if(s.has(c))return{mimeType:"image/jpeg",height:e.getUint16(o+5,BIG_ENDIAN),width:e.getUint16(o+7,BIG_ENDIAN)};if(!r.has(c))return null;o+=2,o+=e.getUint16(o,BIG_ENDIAN)}return null}function getJpegMarkers(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function toDataView(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function parseToNodeImage(t,e){const{mimeType:n}=getBinaryImageMetadata(t)||{},r=globalThis.loaders?.parseImageNode;return assert$4(r),await r(t,n)}async function parseImage(t,e,n){e=e||{};const s=(e.image||{}).type||"auto",{url:o}=n||{},c=getLoadableImageType(s);let d;switch(c){case"imagebitmap":d=await parseToImageBitmap(t,e,o);break;case"image":d=await parseToImage(t,e,o);break;case"data":d=await parseToNodeImage(t);break;default:assert$4(!1)}return s==="data"&&(d=getImageData(d)),d}function getLoadableImageType(t){switch(t){case"auto":case"data":return getDefaultImageType();default:return isImageTypeSupported(t),t}}const EXTENSIONS$1=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],MIME_TYPES=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],DEFAULT_IMAGE_LOADER_OPTIONS={image:{type:"auto",decode:!0}},ImageLoader={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:VERSION$3,mimeTypes:MIME_TYPES,extensions:EXTENSIONS$1,parse:parseImage,tests:[t=>!!getBinaryImageMetadata(new DataView(t))],options:DEFAULT_IMAGE_LOADER_OPTIONS},mimeTypeSupportedSync={};function isImageFormatSupported(t){if(mimeTypeSupportedSync[t]===void 0){const e=isBrowser$2?checkBrowserImageFormatSupport(t):checkNodeImageFormatSupport(t);mimeTypeSupportedSync[t]=e}return mimeTypeSupportedSync[t]}function checkNodeImageFormatSupport(t){const e=["image/png","image/jpeg","image/gif"],n=globalThis.loaders?.imageFormatsNode||e;return!!globalThis.loaders?.parseImageNode&&n.includes(t)}function checkBrowserImageFormatSupport(t){switch(t){case"image/avif":case"image/webp":return testBrowserImageFormatSupport(t);default:return!0}}function testBrowserImageFormatSupport(t){try{return document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)===0}catch{return!1}}function assert$1(t,e){if(!t)throw new Error(e||"assert failed: gltf")}const COMPONENTS={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},BYTES={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},TYPES=["SCALAR","VEC2","VEC3","VEC4"],ARRAY_CONSTRUCTOR_TO_WEBGL_CONSTANT=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],ARRAY_TO_COMPONENT_TYPE=new Map(ARRAY_CONSTRUCTOR_TO_WEBGL_CONSTANT),ATTRIBUTE_TYPE_TO_COMPONENTS$1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE$1={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY$1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function getAccessorTypeFromSize(t){return TYPES[t-1]||TYPES[0]}function getComponentTypeFromArray(t){const e=ARRAY_TO_COMPONENT_TYPE.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function getAccessorArrayTypeAndLength(t,e){const n=ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY$1[t.componentType],r=ATTRIBUTE_TYPE_TO_COMPONENTS$1[t.type],s=ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE$1[t.componentType],o=t.count*r,c=t.count*r*s;assert$1(c>=0&&c<=e.byteLength);const d=BYTES[t.componentType],p=COMPONENTS[t.type];return{ArrayType:n,length:o,byteLength:c,componentByteSize:d,numberOfComponentsInElement:p}}function getTypedArrayForBufferView(t,e,n){const r=t.bufferViews[n];assert$1(r);const s=r.buffer,o=e[s];assert$1(o);const c=(r.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,c,r.byteLength)}function getTypedArrayForAccessor(t,e,n){const r=typeof n=="number"?t.accessors?.[n]:n;if(!r)throw new Error(`No gltf accessor ${JSON.stringify(n)}`);const s=t.bufferViews?.[r.bufferView||0];if(!s)throw new Error(`No gltf buffer view for accessor ${s}`);const{arrayBuffer:o,byteOffset:c}=e[s.buffer],d=(c||0)+(r.byteOffset||0)+(s.byteOffset||0),{ArrayType:p,length:T,componentByteSize:S,numberOfComponentsInElement:R}=getAccessorArrayTypeAndLength(r,s),x=S*R,G=s.byteStride||x;if(typeof s.byteStride>"u"||s.byteStride===x)return new p(o,d,T);const P=new p(T);for(let U=0;U<r.count;U++){const H=new p(o,d+U*G,R);P.set(H,U*R)}return P}function makeDefaultGLTFJson(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class GLTFScenegraph{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||makeDefaultGLTFJson(),buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const n=this.getUsedExtensions().find(s=>s===e),r=this.getRequiredExtensions().find(s=>s===e);return typeof n=="string"||typeof r=="string"}getExtension(e){const n=this.getUsedExtensions().find(s=>s===e),r=this.json.extensions||{};return n?r[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(r=>r===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,n){return(e.extensions||{})[n]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,n){if(typeof n=="object")return n;const r=this.json[e]&&this.json[e][n];if(!r)throw new Error(`glTF file error: Could not find ${e}[${n}]`);return r}getTypedArrayForBufferView(e){e=this.getBufferView(e);const n=e.buffer,r=this.gltf.buffers[n];assert$1(r);const s=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,s,e.byteLength)}getTypedArrayForAccessor(e){const n=this.getAccessor(e);return getTypedArrayForAccessor(this.gltf.json,this.gltf.buffers,n)}getTypedArrayForImageData(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),s=this.getBuffer(n.buffer).data,o=n.byteOffset||0;return new Uint8Array(s,o,n.byteLength)}addApplicationData(e,n){return this.json[e]=n,this}addExtraData(e,n){return this.json.extras=this.json.extras||{},this.json.extras[e]=n,this}addObjectExtension(e,n,r){return e.extensions=e.extensions||{},e.extensions[n]=r,this.registerUsedExtension(n),this}setObjectExtension(e,n,r){const s=e.extensions||{};s[n]=r}removeObjectExtension(e,n){const r=e?.extensions||{};if(r[n]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const s=this.json.extensionsRemoved;s.includes(n)||s.push(n)}delete r[n]}addExtension(e,n={}){return assert$1(n),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=n,this.registerUsedExtension(e),n}addRequiredExtension(e,n={}){return assert$1(n),this.addExtension(e,n),this.registerRequiredExtension(e),n}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(n=>n===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(n=>n===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:n}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:n}),this.json.scenes.length-1}addNode(e){const{meshIndex:n,matrix:r}=e;this.json.nodes=this.json.nodes||[];const s={mesh:n};return r&&(s.matrix=r),this.json.nodes.push(s),this.json.nodes.length-1}addMesh(e){const{attributes:n,indices:r,material:s,mode:o=4}=e,d={primitives:[{attributes:this._addAttributes(n),mode:o}]};if(r){const p=this._addIndices(r);d.primitives[0].indices=p}return Number.isFinite(s)&&(d.primitives[0].material=s),this.json.meshes=this.json.meshes||[],this.json.meshes.push(d),this.json.meshes.length-1}addPointCloud(e){const r={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addImage(e,n){const r=getBinaryImageMetadata(e),s=n||r?.mimeType,c={bufferView:this.addBufferView(e),mimeType:s};return this.json.images=this.json.images||[],this.json.images.push(c),this.json.images.length-1}addBufferView(e,n=0,r=this.byteLength){const s=e.byteLength;assert$1(Number.isFinite(s)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const o={buffer:n,byteOffset:r,byteLength:s};return this.byteLength+=padToNBytes(s,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(o),this.json.bufferViews.length-1}addAccessor(e,n){const r={bufferView:e,type:getAccessorTypeFromSize(n.size),componentType:n.componentType,count:n.count,max:n.max,min:n.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(e,n={size:3}){const r=this.addBufferView(e);let s={min:n.min,max:n.max};(!s.min||!s.max)&&(s=this._getAccessorMinMax(e,n.size));const o={size:n.size,componentType:getComponentTypeFromArray(e),count:Math.round(e.length/n.size),min:s.min,max:s.max};return this.addAccessor(r,Object.assign(o,n))}addTexture(e){const{imageIndex:n}=e,r={source:n};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){const e=this.byteLength,n=new ArrayBuffer(e),r=new Uint8Array(n);let s=0;for(const o of this.sourceBuffers||[])s=copyToArray(o,r,s);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=n,this.sourceBuffers=[n],this.gltf.buffers=[{arrayBuffer:n,byteOffset:0,byteLength:n.byteLength}]}_removeStringFromArray(e,n){let r=!0;for(;r;){const s=e.indexOf(n);s>-1?e.splice(s,1):r=!1}}_addAttributes(e={}){const n={};for(const r in e){const s=e[r],o=this._getGltfAttributeName(r),c=this.addBinaryBuffer(s.value,s);n[o]=c}return n}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,n){const r={min:null,max:null};if(e.length<n)return r;r.min=[],r.max=[];const s=e.subarray(0,n);for(const o of s)r.min.push(o),r.max.push(o);for(let o=n;o<e.length;o+=n)for(let c=0;c<n;c++)r.min[0+c]=Math.min(r.min[0+c],e[o+c]),r.max[0+c]=Math.max(r.max[0+c],e[o+c]);return r}}function emod(t){return(t%1+1)%1}const ATTRIBUTE_TYPE_TO_COMPONENTS={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function getArrayElementByteSize(t,e){return ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE[e]*ATTRIBUTE_TYPE_TO_COMPONENTS[t]}function getOffsetsForProperty(t,e,n,r){if(n!=="UINT8"&&n!=="UINT16"&&n!=="UINT32"&&n!=="UINT64")return null;const s=t.getTypedArrayForBufferView(e),o=convertRawBufferToMetadataArray(s,"SCALAR",n,r+1);return o instanceof BigInt64Array||o instanceof BigUint64Array?null:o}function convertRawBufferToMetadataArray(t,e,n,r=1){const s=ATTRIBUTE_TYPE_TO_COMPONENTS[e],o=ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY[n],c=ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE[n],d=r*s,p=d*c;let T=t.buffer,S=t.byteOffset;return S%c!==0&&(T=new Uint8Array(T).slice(S,S+p).buffer,S=0),new o(T,S,d)}function getPrimitiveTextureData(t,e,n){const r=`TEXCOORD_${e.texCoord||0}`,s=n.attributes[r],o=t.getTypedArrayForAccessor(s),c=t.gltf.json,d=e.index,p=c.textures?.[d]?.source;if(typeof p<"u"){const T=c.images?.[p]?.mimeType,S=t.gltf.images?.[p];if(S&&typeof S.width<"u"){const R=[];for(let x=0;x<o.length;x+=2){const G=getImageValueByCoordinates(S,T,o,x,e.channels);R.push(G)}return R}}return[]}function primitivePropertyDataToAttributes(t,e,n,r,s){if(!n?.length)return;const o=[];for(const S of n){let R=r.findIndex(x=>x===S);R===-1&&(R=r.push(S)-1),o.push(R)}const c=new Uint32Array(o),d=t.gltf.buffers.push({arrayBuffer:c.buffer,byteOffset:c.byteOffset,byteLength:c.byteLength})-1,p=t.addBufferView(c,d,0),T=t.addAccessor(p,{size:1,componentType:getComponentTypeFromArray(c),count:c.length});s.attributes[e]=T}function getImageValueByCoordinates(t,e,n,r,s=[0]){const o={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},c=n[r],d=n[r+1];let p=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(p=4);const T=coordinatesToOffset(c,d,t,p);let S=0;for(const R of s){const x=typeof R=="number"?Object.values(o)[R]:o[R],G=T+x.offset,P=getImageData(t);if(P.data.length<=G)throw new Error(`${P.data.length} <= ${G}`);const U=P.data[G];S|=U<<x.shift}return S}function coordinatesToOffset(t,e,n,r=1){const s=n.width,o=emod(t)*(s-1),c=Math.round(o),d=n.height,p=emod(e)*(d-1),T=Math.round(p),S=n.components?n.components:r;return(T*s+c)*S}function parseVariableLengthArrayNumeric(t,e,n,r,s){const o=[];for(let c=0;c<e;c++){const d=n[c],p=n[c+1]-n[c];if(p+d>r)break;const T=d/s,S=p/s;o.push(t.slice(T,T+S))}return o}function parseFixedLengthArrayNumeric(t,e,n){const r=[];for(let s=0;s<e;s++){const o=s*n;r.push(t.slice(o,o+n))}return r}function getPropertyDataString(t,e,n,r){if(n)throw new Error("Not implemented - arrayOffsets for strings is specified");if(r){const s=[],o=new TextDecoder("utf8");let c=0;for(let d=0;d<t;d++){const p=r[d+1]-r[d];if(p+c<=e.length){const T=e.subarray(c,p+c),S=o.decode(T);s.push(S),c+=p}}return s}return[]}const EXT_MESH_FEATURES_NAME="EXT_mesh_features",name$a=EXT_MESH_FEATURES_NAME;async function decode$9(t,e){const n=new GLTFScenegraph(t);decodeExtMeshFeatures(n,e)}function encode$5(t,e){const n=new GLTFScenegraph(t);return encodeExtMeshFeatures(n),n.createBinaryChunk(),n.gltf}function decodeExtMeshFeatures(t,e){const n=t.gltf.json;if(n.meshes)for(const r of n.meshes)for(const s of r.primitives)processMeshPrimitiveFeatures(t,s,e)}function processMeshPrimitiveFeatures(t,e,n){if(!n?.gltf?.loadBuffers)return;const s=e.extensions?.[EXT_MESH_FEATURES_NAME]?.featureIds;if(s)for(const o of s){let c;if(typeof o.attribute<"u"){const d=`_FEATURE_ID_${o.attribute}`,p=e.attributes[d];c=t.getTypedArrayForAccessor(p)}else typeof o.texture<"u"&&n?.gltf?.loadImages?c=getPrimitiveTextureData(t,o.texture,e):c=[];o.data=c}}function encodeExtMeshFeatures(t,e){const n=t.gltf.json.meshes;if(n)for(const r of n)for(const s of r.primitives)encodeExtMeshFeaturesForPrimitive(t,s)}function createExtMeshFeatures(t,e,n,r){e.extensions||(e.extensions={});let s=e.extensions[EXT_MESH_FEATURES_NAME];s||(s={featureIds:[]},e.extensions[EXT_MESH_FEATURES_NAME]=s);const{featureIds:o}=s,c={featureCount:n.length,propertyTable:r,data:n};o.push(c),t.addObjectExtension(e,EXT_MESH_FEATURES_NAME,s)}function encodeExtMeshFeaturesForPrimitive(t,e){const n=e.extensions?.[EXT_MESH_FEATURES_NAME];if(!n)return;const r=n.featureIds;r.forEach((s,o)=>{if(s.data){const{accessorKey:c,index:d}=createAccessorKey(e.attributes),p=new Uint32Array(s.data);r[o]={featureCount:p.length,propertyTable:s.propertyTable,attribute:d},t.gltf.buffers.push({arrayBuffer:p.buffer,byteOffset:p.byteOffset,byteLength:p.byteLength});const T=t.addBufferView(p),S=t.addAccessor(T,{size:1,componentType:getComponentTypeFromArray(p),count:p.length});e.attributes[c]=S}})}function createAccessorKey(t){const e="_FEATURE_ID_",n=Object.keys(t).filter(o=>o.indexOf(e)===0);let r=-1;for(const o of n){const c=Number(o.substring(e.length));c>r&&(r=c)}return r++,{accessorKey:`${e}${r}`,index:r}}const EXT_mesh_features=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures,decode:decode$9,encode:encode$5,name:name$a},Symbol.toStringTag,{value:"Module"})),EXT_STRUCTURAL_METADATA_NAME="EXT_structural_metadata",name$9=EXT_STRUCTURAL_METADATA_NAME;async function decode$8(t,e){const n=new GLTFScenegraph(t);decodeExtStructuralMetadata(n,e)}function encode$4(t,e){const n=new GLTFScenegraph(t);return encodeExtStructuralMetadata(n),n.createBinaryChunk(),n.gltf}function decodeExtStructuralMetadata(t,e){if(!e.gltf?.loadBuffers)return;const n=t.getExtension(EXT_STRUCTURAL_METADATA_NAME);n&&(e.gltf?.loadImages&&decodePropertyTextures$1(t,n),decodePropertyTables$1(t,n))}function decodePropertyTextures$1(t,e){const n=e.propertyTextures,r=t.gltf.json;if(n&&r.meshes)for(const s of r.meshes)for(const o of s.primitives)processPrimitivePropertyTextures(t,n,o,e)}function decodePropertyTables$1(t,e){const n=e.schema;if(!n)return;const r=n.classes,s=e.propertyTables;if(r&&s)for(const o in r){const c=findPropertyTableByClass$1(s,o);c&&processPropertyTable$1(t,n,c)}}function findPropertyTableByClass$1(t,e){for(const n of t)if(n.class===e)return n;return null}function processPrimitivePropertyTextures(t,e,n,r){if(!e)return;const o=n.extensions?.[EXT_STRUCTURAL_METADATA_NAME]?.propertyTextures;if(o)for(const c of o){const d=e[c];processPrimitivePropertyTexture(t,d,n,r)}}function processPrimitivePropertyTexture(t,e,n,r){if(!e.properties)return;r.dataAttributeNames||(r.dataAttributeNames=[]);const s=e.class;for(const o in e.properties){const c=`${s}_${o}`,d=e.properties?.[o];if(!d)continue;d.data||(d.data=[]);const p=d.data,T=getPrimitiveTextureData(t,d,n);T!==null&&(primitivePropertyDataToAttributes(t,c,T,p,n),d.data=p,r.dataAttributeNames.push(c))}}function processPropertyTable$1(t,e,n){const r=e.classes?.[n.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const s=n.count;for(const o in r.properties){const c=r.properties[o],d=n.properties?.[o];if(d){const p=getPropertyDataFromBinarySource$1(t,e,c,s,d);d.data=p}}}function getPropertyDataFromBinarySource$1(t,e,n,r,s){let o=[];const c=s.values,d=t.getTypedArrayForBufferView(c),p=getArrayOffsetsForProperty$1(t,n,s,r),T=getStringOffsetsForProperty$1(t,s,r);switch(n.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{o=getPropertyDataNumeric$1(n,r,d,p);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${n.type}`);case"STRING":{o=getPropertyDataString(r,d,p,T);break}case"ENUM":{o=getPropertyDataENUM(e,n,r,d,p);break}default:throw new Error(`Unknown classProperty type ${n.type}`)}return o}function getArrayOffsetsForProperty$1(t,e,n,r){return e.array&&typeof e.count>"u"&&typeof n.arrayOffsets<"u"?getOffsetsForProperty(t,n.arrayOffsets,n.arrayOffsetType||"UINT32",r):null}function getStringOffsetsForProperty$1(t,e,n){return typeof e.stringOffsets<"u"?getOffsetsForProperty(t,e.stringOffsets,e.stringOffsetType||"UINT32",n):null}function getPropertyDataNumeric$1(t,e,n,r){const s=t.array,o=t.count,c=getArrayElementByteSize(t.type,t.componentType),d=n.byteLength/c;let p;return t.componentType?p=convertRawBufferToMetadataArray(n,t.type,t.componentType,d):p=n,s?r?parseVariableLengthArrayNumeric(p,e,r,n.length,c):o?parseFixedLengthArrayNumeric(p,e,o):[]:p}function getPropertyDataENUM(t,e,n,r,s){const o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const c=t.enums?.[o];if(!c)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const d=c.valueType||"UINT16",p=getArrayElementByteSize(e.type,d),T=r.byteLength/p;let S=convertRawBufferToMetadataArray(r,e.type,d,T);if(S||(S=r),e.array){if(s)return parseVariableLengthArrayENUM({valuesData:S,numberOfElements:n,arrayOffsets:s,valuesDataBytesLength:r.length,elementSize:p,enumEntry:c});const R=e.count;return R?parseFixedLengthArrayENUM(S,n,R,c):[]}return getEnumsArray(S,0,n,c)}function parseVariableLengthArrayENUM(t){const{valuesData:e,numberOfElements:n,arrayOffsets:r,valuesDataBytesLength:s,elementSize:o,enumEntry:c}=t,d=[];for(let p=0;p<n;p++){const T=r[p],S=r[p+1]-r[p];if(S+T>s)break;const R=T/o,x=S/o,G=getEnumsArray(e,R,x,c);d.push(G)}return d}function parseFixedLengthArrayENUM(t,e,n,r){const s=[];for(let o=0;o<e;o++){const c=n*o,d=getEnumsArray(t,c,n,r);s.push(d)}return s}function getEnumsArray(t,e,n,r){const s=[];for(let o=0;o<n;o++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)s.push("");else{const c=t[e+o],d=getEnumByValue(r,c);d?s.push(d.name):s.push("")}return s}function getEnumByValue(t,e){for(const n of t.values)if(n.value===e)return n;return null}const SCHEMA_CLASS_ID_DEFAULT="schemaClassId";function encodeExtStructuralMetadata(t,e){const n=t.getExtension(EXT_STRUCTURAL_METADATA_NAME);if(n&&n.propertyTables)for(const r of n.propertyTables){const s=r.class,o=n.schema?.classes?.[s];r.properties&&o&&encodeProperties(r,o,t)}}function encodeProperties(t,e,n){for(const r in t.properties){const s=t.properties[r].data;if(s){const o=e.properties[r];if(o){const c=createPropertyTableProperty(s,o,n);t.properties[r]=c}}}}function createExtStructuralMetadata(t,e,n=SCHEMA_CLASS_ID_DEFAULT){let r=t.getExtension(EXT_STRUCTURAL_METADATA_NAME);r||(r=t.addExtension(EXT_STRUCTURAL_METADATA_NAME)),r.schema=createSchema(e,n,r.schema);const s=createPropertyTable(e,n,r.schema);return r.propertyTables||(r.propertyTables=[]),r.propertyTables.push(s)-1}function createSchema(t,e,n){const r=n??{id:"schema_id"},s={properties:{}};for(const o of t){const c={type:o.elementType,componentType:o.componentType};s.properties[o.name]=c}return r.classes={},r.classes[e]=s,r}function createPropertyTable(t,e,n){const r={class:e,count:0};let s=0;const o=n.classes?.[e];for(const c of t){if(s===0&&(s=c.values.length),s!==c.values.length&&c.values.length)throw new Error("Illegal values in attributes");o?.properties[c.name]&&(r.properties||(r.properties={}),r.properties[c.name]={values:0,data:c.values})}return r.count=s,r}function createPropertyTableProperty(t,e,n){const r={values:0};if(e.type==="STRING"){const{stringData:s,stringOffsets:o}=createPropertyDataString(t);r.stringOffsets=createBufferView(o,n),r.values=createBufferView(s,n)}else if(e.type==="SCALAR"&&e.componentType){const s=createPropertyDataScalar(t,e.componentType);r.values=createBufferView(s,n)}return r}const COMPONENT_TYPE_TO_ARRAY_CONSTRUCTOR={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function createPropertyDataScalar(t,e){const n=[];for(const s of t)n.push(Number(s));const r=COMPONENT_TYPE_TO_ARRAY_CONSTRUCTOR[e];if(!r)throw new Error("Illegal component type");return new r(n)}function createPropertyDataString(t){const e=new TextEncoder,n=[];let r=0;for(const p of t){const T=e.encode(p);r+=T.length,n.push(T)}const s=new Uint8Array(r),o=[];let c=0;for(const p of n)s.set(p,c),o.push(c),c+=p.length;o.push(c);const d=new Uint32Array(o);return{stringData:s,stringOffsets:d}}function createBufferView(t,e){return e.gltf.buffers.push({arrayBuffer:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength}),e.addBufferView(t)}const EXT_structural_metadata=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata,decode:decode$8,encode:encode$4,name:name$9},Symbol.toStringTag,{value:"Module"})),EXT_FEATURE_METADATA_NAME="EXT_feature_metadata",name$8=EXT_FEATURE_METADATA_NAME;async function decode$7(t,e){const n=new GLTFScenegraph(t);decodeExtFeatureMetadata(n,e)}function decodeExtFeatureMetadata(t,e){if(!e.gltf?.loadBuffers)return;const n=t.getExtension(EXT_FEATURE_METADATA_NAME);n&&(e.gltf?.loadImages&&decodePropertyTextures(t,n),decodePropertyTables(t,n))}function decodePropertyTextures(t,e){const n=e.schema;if(!n)return;const r=n.classes,{featureTextures:s}=e;if(r&&s)for(const o in r){const c=r[o],d=findFeatureTextureByClass(s,o);d&&handleFeatureTextureProperties(t,d,c)}}function decodePropertyTables(t,e){const n=e.schema;if(!n)return;const r=n.classes,s=e.featureTables;if(r&&s)for(const o in r){const c=findPropertyTableByClass(s,o);c&&processPropertyTable(t,n,c)}}function findPropertyTableByClass(t,e){for(const n in t){const r=t[n];if(r.class===e)return r}return null}function findFeatureTextureByClass(t,e){for(const n in t){const r=t[n];if(r.class===e)return r}return null}function processPropertyTable(t,e,n){if(!n.class)return;const r=e.classes?.[n.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const s=n.count;for(const o in r.properties){const c=r.properties[o],d=n.properties?.[o];if(d){const p=getPropertyDataFromBinarySource(t,e,c,s,d);d.data=p}}}function handleFeatureTextureProperties(t,e,n){const r=e.class;for(const s in n.properties){const o=e?.properties?.[s];if(o){const c=getPropertyDataFromTexture(t,o,r);o.data=c}}}function getPropertyDataFromBinarySource(t,e,n,r,s){let o=[];const c=s.bufferView,d=t.getTypedArrayForBufferView(c),p=getArrayOffsetsForProperty(t,n,s,r),T=getStringOffsetsForProperty(t,n,s,r);return n.type==="STRING"||n.componentType==="STRING"?o=getPropertyDataString(r,d,p,T):isNumericProperty(n)&&(o=getPropertyDataNumeric(n,r,d,p)),o}function getArrayOffsetsForProperty(t,e,n,r){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof n.arrayOffsetBufferView<"u"?getOffsetsForProperty(t,n.arrayOffsetBufferView,n.offsetType||"UINT32",r):null}function getStringOffsetsForProperty(t,e,n,r){return typeof n.stringOffsetBufferView<"u"?getOffsetsForProperty(t,n.stringOffsetBufferView,n.offsetType||"UINT32",r):null}function isNumericProperty(t){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function getPropertyDataNumeric(t,e,n,r){const s=t.type==="ARRAY",o=t.componentCount,c="SCALAR",d=t.componentType||t.type,p=getArrayElementByteSize(c,d),T=n.byteLength/p,S=convertRawBufferToMetadataArray(n,c,d,T);return s?r?parseVariableLengthArrayNumeric(S,e,r,n.length,p):o?parseFixedLengthArrayNumeric(S,e,o):[]:S}function getPropertyDataFromTexture(t,e,n){const r=t.gltf.json;if(!r.meshes)return[];const s=[];for(const o of r.meshes)for(const c of o.primitives)processPrimitiveTextures(t,n,e,s,c);return s}function processPrimitiveTextures(t,e,n,r,s){const o={channels:n.channels,...n.texture},c=getPrimitiveTextureData(t,o,s);c&&primitivePropertyDataToAttributes(t,e,c,r,s)}const EXT_feature_metadata=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$7,name:name$8},Symbol.toStringTag,{value:"Module"})),VERSION$2="4.3.3",VERSION$1="4.3.3",BASIS_EXTERNAL_LIBRARIES={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let loadBasisTranscoderPromise;async function loadBasisTranscoderModule(t){registerJSModules(t.modules);const e=getJSModuleOrNull("basis");return e||(loadBasisTranscoderPromise||=loadBasisTranscoder(t),await loadBasisTranscoderPromise)}async function loadBasisTranscoder(t){let e=null,n=null;return[e,n]=await Promise.all([await loadLibrary(BASIS_EXTERNAL_LIBRARIES.TRANSCODER,"textures",t),await loadLibrary(BASIS_EXTERNAL_LIBRARIES.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await initializeBasisTranscoderModule(e,n)}function initializeBasisTranscoderModule(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t(n).then(s=>{const{BasisFile:o,initializeBasis:c}=s;c(),r({BasisFile:o})})})}let loadBasisEncoderPromise;async function loadBasisEncoderModule(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(loadBasisEncoderPromise=loadBasisEncoderPromise||loadBasisEncoder(t),await loadBasisEncoderPromise)}async function loadBasisEncoder(t){let e=null,n=null;return[e,n]=await Promise.all([await loadLibrary(BASIS_EXTERNAL_LIBRARIES.ENCODER,"textures",t),await loadLibrary(BASIS_EXTERNAL_LIBRARIES.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await initializeBasisEncoderModule(e,n)}function initializeBasisEncoderModule(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t(n).then(s=>{const{BasisFile:o,KTX2File:c,initializeBasis:d,BasisEncoder:p}=s;d(),r({BasisFile:o,KTX2File:c,BasisEncoder:p})})})}const GL_EXTENSIONS_CONSTANTS={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},BROWSER_PREFIXES=["","WEBKIT_","MOZ_"],WEBGL_EXTENSIONS={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let formats=null;function getSupportedGPUTextureFormats(t){if(!formats){t=t||getWebGLContext()||void 0,formats=new Set;for(const e of BROWSER_PREFIXES)for(const n in WEBGL_EXTENSIONS)if(t&&t.getExtension(`${e}${n}`)){const r=WEBGL_EXTENSIONS[n];formats.add(r)}}return formats}function getWebGLContext(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const KTX2_ID=[171,75,84,88,32,50,48,187,13,10,26,10];function isKTX(t){const e=new Uint8Array(t);return!(e.byteLength<KTX2_ID.length||e[0]!==KTX2_ID[0]||e[1]!==KTX2_ID[1]||e[2]!==KTX2_ID[2]||e[3]!==KTX2_ID[3]||e[4]!==KTX2_ID[4]||e[5]!==KTX2_ID[5]||e[6]!==KTX2_ID[6]||e[7]!==KTX2_ID[7]||e[8]!==KTX2_ID[8]||e[9]!==KTX2_ID[9]||e[10]!==KTX2_ID[10]||e[11]!==KTX2_ID[11])}const OutputFormat={etc1:{basisFormat:0,compressed:!0,format:GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function parseBasis(t,e){if(e.basis.containerFormat==="auto"){if(isKTX(t)){const r=await loadBasisEncoderModule(e);return parseKTX2File(r.KTX2File,t,e)}const{BasisFile:n}=await loadBasisTranscoderModule(e);return parseBasisFile(n,t,e)}switch(e.basis.module){case"encoder":const n=await loadBasisEncoderModule(e);switch(e.basis.containerFormat){case"ktx2":return parseKTX2File(n.KTX2File,t,e);case"basis":default:return parseBasisFile(n.BasisFile,t,e)}case"transcoder":default:const{BasisFile:r}=await loadBasisTranscoderModule(e);return parseBasisFile(r,t,e)}}function parseBasisFile(t,e,n){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");const s=r.getNumImages(),o=[];for(let c=0;c<s;c++){const d=r.getNumLevels(c),p=[];for(let T=0;T<d;T++)p.push(transcodeImage(r,c,T,n));o.push(p)}return o}finally{r.close(),r.delete()}}function transcodeImage(t,e,n,r){const s=t.getImageWidth(e,n),o=t.getImageHeight(e,n),c=t.getHasAlpha(),{compressed:d,format:p,basisFormat:T}=getBasisOptions(r,c),S=t.getImageTranscodedSizeInBytes(e,n,T),R=new Uint8Array(S);if(!t.transcodeImage(R,e,n,T,0,0))throw new Error("failed to start Basis transcoding");return{width:s,height:o,data:R,compressed:d,format:p,hasAlpha:c}}function parseKTX2File(t,e,n){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");const s=r.getLevels(),o=[];for(let c=0;c<s;c++)o.push(transcodeKTX2Image(r,c,n));return[o]}finally{r.close(),r.delete()}}function transcodeKTX2Image(t,e,n){const{alphaFlag:r,height:s,width:o}=t.getImageLevelInfo(e,0,0),{compressed:c,format:d,basisFormat:p}=getBasisOptions(n,r),T=t.getImageTranscodedSizeInBytes(e,0,0,p),S=new Uint8Array(T);if(!t.transcodeImage(S,e,0,0,p,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:s,data:S,compressed:c,levelSize:T,hasAlpha:r,format:d}}function getBasisOptions(t,e){let n=t&&t.basis&&t.basis.format;return n==="auto"&&(n=selectSupportedBasisFormat()),typeof n=="object"&&(n=e?n.alpha:n.noAlpha),n=n.toLowerCase(),OutputFormat[n]}function selectSupportedBasisFormat(){const t=getSupportedGPUTextureFormats();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const BasisWorkerLoader={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:VERSION$1,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},BasisLoader={...BasisWorkerLoader,parse:parseBasis},LITTLE_ENDIAN=!0,MAGIC_glTF=1735152710,GLB_FILE_HEADER_SIZE=12,GLB_CHUNK_HEADER_SIZE=8,GLB_CHUNK_TYPE_JSON=1313821514,GLB_CHUNK_TYPE_BIN=5130562,GLB_V1_CONTENT_FORMAT_JSON=0,GLB_CHUNK_TYPE_JSON_XVIZ_DEPRECATED=0,GLB_CHUNK_TYPE_BIX_XVIZ_DEPRECATED=1;function getMagicString(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function isGLB(t,e=0,n={}){const r=new DataView(t),{magic:s=MAGIC_glTF}=n,o=r.getUint32(e,!1);return o===s||o===MAGIC_glTF}function parseGLBSync(t,e,n=0,r={}){const s=new DataView(e),o=getMagicString(s,n+0),c=s.getUint32(n+4,LITTLE_ENDIAN),d=s.getUint32(n+8,LITTLE_ENDIAN);switch(Object.assign(t,{header:{byteOffset:n,byteLength:d,hasBinChunk:!1},type:o,version:c,json:{},binChunks:[]}),n+=GLB_FILE_HEADER_SIZE,t.version){case 1:return parseGLBV1(t,s,n);case 2:return parseGLBV2(t,s,n,r={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function parseGLBV1(t,e,n){assert$4(t.header.byteLength>GLB_FILE_HEADER_SIZE+GLB_CHUNK_HEADER_SIZE);const r=e.getUint32(n+0,LITTLE_ENDIAN),s=e.getUint32(n+4,LITTLE_ENDIAN);return n+=GLB_CHUNK_HEADER_SIZE,assert$4(s===GLB_V1_CONTENT_FORMAT_JSON),parseJSONChunk(t,e,n,r),n+=r,n+=parseBINChunk(t,e,n,t.header.byteLength),n}function parseGLBV2(t,e,n,r){return assert$4(t.header.byteLength>GLB_FILE_HEADER_SIZE+GLB_CHUNK_HEADER_SIZE),parseGLBChunksSync(t,e,n,r),n+t.header.byteLength}function parseGLBChunksSync(t,e,n,r){for(;n+8<=t.header.byteLength;){const s=e.getUint32(n+0,LITTLE_ENDIAN),o=e.getUint32(n+4,LITTLE_ENDIAN);switch(n+=GLB_CHUNK_HEADER_SIZE,o){case GLB_CHUNK_TYPE_JSON:parseJSONChunk(t,e,n,s);break;case GLB_CHUNK_TYPE_BIN:parseBINChunk(t,e,n,s);break;case GLB_CHUNK_TYPE_JSON_XVIZ_DEPRECATED:r.strict||parseJSONChunk(t,e,n,s);break;case GLB_CHUNK_TYPE_BIX_XVIZ_DEPRECATED:r.strict||parseBINChunk(t,e,n,s);break}n+=padToNBytes(s,4)}return n}function parseJSONChunk(t,e,n,r){const s=new Uint8Array(e.buffer,n,r),c=new TextDecoder("utf8").decode(s);return t.json=JSON.parse(c),padToNBytes(r,4)}function parseBINChunk(t,e,n,r){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:n,byteLength:r,arrayBuffer:e.buffer}),padToNBytes(r,4)}function resolveUrl(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const r=e.baseUri||e.uri;if(!r)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return r.substr(0,r.lastIndexOf("/")+1)+t}const wasm_base="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",wasm_simd="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",detector=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),wasmpack=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),FILTERS={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},DECODERS={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function meshoptDecodeGltfBuffer(t,e,n,r,s,o="NONE"){const c=await loadWasmInstance();decode$6(c,c.exports[DECODERS[s]],t,e,n,r,c.exports[FILTERS[o||"NONE"]])}let wasmPromise;async function loadWasmInstance(){return wasmPromise||(wasmPromise=loadWasmModule()),wasmPromise}async function loadWasmModule(){let t=wasm_base;WebAssembly.validate(detector)&&(t=wasm_simd,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(unpack(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function unpack(t){const e=new Uint8Array(t.length);for(let r=0;r<t.length;++r){const s=t.charCodeAt(r);e[r]=s>96?s-71:s>64?s-65:s>47?s+4:s>46?63:62}let n=0;for(let r=0;r<t.length;++r)e[n++]=e[r]<60?wasmpack[e[r]]:(e[r]-60)*64+e[++r];return e.buffer.slice(0,n)}function decode$6(t,e,n,r,s,o,c){const d=t.exports.sbrk,p=r+3&-4,T=d(p*s),S=d(o.length),R=new Uint8Array(t.exports.memory.buffer);R.set(o,S);const x=e(T,r,s,S,o.length);if(x===0&&c&&c(T,p,s),n.set(R.subarray(T,T+r*s)),d(T-d(0)),x!==0)throw new Error(`Malformed buffer data: ${x}`)}const EXT_MESHOPT_COMPRESSION="EXT_meshopt_compression",name$7=EXT_MESHOPT_COMPRESSION;async function decode$5(t,e){const n=new GLTFScenegraph(t);if(!e?.gltf?.decompressMeshes||!e.gltf?.loadBuffers)return;const r=[];for(const s of t.json.bufferViews||[])r.push(decodeMeshoptBufferView(n,s));await Promise.all(r),n.removeExtension(EXT_MESHOPT_COMPRESSION)}async function decodeMeshoptBufferView(t,e){const n=t.getObjectExtension(e,EXT_MESHOPT_COMPRESSION);if(n){const{byteOffset:r=0,byteLength:s=0,byteStride:o,count:c,mode:d,filter:p="NONE",buffer:T}=n,S=t.gltf.buffers[T],R=new Uint8Array(S.arrayBuffer,S.byteOffset+r,s),x=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await meshoptDecodeGltfBuffer(x,c,o,R,d,p),t.removeObjectExtension(e,EXT_MESHOPT_COMPRESSION)}}const EXT_meshopt_compression=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$5,name:name$7},Symbol.toStringTag,{value:"Module"})),EXT_TEXTURE_WEBP="EXT_texture_webp",name$6=EXT_TEXTURE_WEBP;function preprocess$3(t,e){const n=new GLTFScenegraph(t);if(!isImageFormatSupported("image/webp")){if(n.getRequiredExtensions().includes(EXT_TEXTURE_WEBP))throw new Error(`gltf: Required extension ${EXT_TEXTURE_WEBP} not supported by browser`);return}const{json:r}=n;for(const s of r.textures||[]){const o=n.getObjectExtension(s,EXT_TEXTURE_WEBP);o&&(s.source=o.source),n.removeObjectExtension(s,EXT_TEXTURE_WEBP)}n.removeExtension(EXT_TEXTURE_WEBP)}const EXT_texture_webp=Object.freeze(Object.defineProperty({__proto__:null,name:name$6,preprocess:preprocess$3},Symbol.toStringTag,{value:"Module"})),KHR_TEXTURE_BASISU="KHR_texture_basisu",name$5=KHR_TEXTURE_BASISU;function preprocess$2(t,e){const n=new GLTFScenegraph(t),{json:r}=n;for(const s of r.textures||[]){const o=n.getObjectExtension(s,KHR_TEXTURE_BASISU);o&&(s.source=o.source,n.removeObjectExtension(s,KHR_TEXTURE_BASISU))}n.removeExtension(KHR_TEXTURE_BASISU)}const KHR_texture_basisu=Object.freeze(Object.defineProperty({__proto__:null,name:name$5,preprocess:preprocess$2},Symbol.toStringTag,{value:"Module"})),VERSION="4.3.3",DracoLoader$1={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:VERSION,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function getDracoSchema(t,e,n){const r=makeMetadata(e.metadata),s=[],o=transformAttributesLoaderData(e.attributes);for(const c in t){const d=t[c],p=getArrowFieldFromAttribute(c,d,o[c]);s.push(p)}if(n){const c=getArrowFieldFromAttribute("indices",n);s.push(c)}return{fields:s,metadata:r}}function transformAttributesLoaderData(t){const e={};for(const n in t){const r=t[n];e[r.name||"undefined"]=r}return e}function getArrowFieldFromAttribute(t,e,n){const r=n?makeMetadata(n.metadata):void 0;return deduceMeshField(t,e,r)}function makeMetadata(t){Object.entries(t);const e={};for(const n in t)e[`${n}.string`]=JSON.stringify(t[n]);return e}const DRACO_TO_GLTF_ATTRIBUTE_NAME_MAP={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},DRACO_DATA_TYPE_TO_TYPED_ARRAY_MAP={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},INDEX_ITEM_SIZE=4;class DracoParser{draco;decoder;metadataQuerier;constructor(e){this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,n={}){const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(n);const s=this.decoder.GetEncodedGeometryType(r),o=s===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let c;switch(s){case this.draco.TRIANGULAR_MESH:c=this.decoder.DecodeBufferToMesh(r,o);break;case this.draco.POINT_CLOUD:c=this.decoder.DecodeBufferToPointCloud(r,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!c.ok()||!o.ptr){const x=`DRACO decompression failed: ${c.error_msg()}`;throw new Error(x)}const d=this._getDracoLoaderData(o,s,n),p=this._getMeshData(o,d,n),T=getMeshBoundingBox(p.attributes),S=getDracoSchema(p.attributes,d,p.indices);return{loader:"draco",loaderData:d,header:{vertexCount:o.num_points(),boundingBox:T},...p,schema:S}}finally{this.draco.destroy(r),o&&this.draco.destroy(o)}}_getDracoLoaderData(e,n,r){const s=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,r);return{geometry_type:n,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:s,attributes:o}}_getDracoAttributes(e,n){const r={};for(let s=0;s<e.num_attributes();s++){const o=this.decoder.GetAttribute(e,s),c=this._getAttributeMetadata(e,s);r[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:s,metadata:c};const d=this._getQuantizationTransform(o,n);d&&(r[o.unique_id()].quantization_transform=d);const p=this._getOctahedronTransform(o,n);p&&(r[o.unique_id()].octahedron_transform=p)}return r}_getMeshData(e,n,r){const s=this._getMeshAttributes(n,e,r);if(!s.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:s,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:s,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:s}}_getMeshAttributes(e,n,r){const s={};for(const o of Object.values(e.attributes)){const c=this._deduceAttributeName(o,r);o.name=c;const d=this._getAttributeValues(n,o);if(d){const{value:p,size:T}=d;s[c]={value:p,size:T,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}}return s}_getTriangleListIndices(e){const r=e.num_faces()*3,s=r*INDEX_ITEM_SIZE,o=this.draco._malloc(s);try{return this.decoder.GetTrianglesUInt32Array(e,s,o),new Uint32Array(this.draco.HEAPF32.buffer,o,r).slice()}finally{this.draco._free(o)}}_getTriangleStripIndices(e){const n=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,n),getUint32Array(n)}finally{this.draco.destroy(n)}}_getAttributeValues(e,n){const r=DRACO_DATA_TYPE_TO_TYPED_ARRAY_MAP[n.data_type];if(!r)return console.warn(`DRACO: Unsupported attribute type ${n.data_type}`),null;const s=n.num_components,c=e.num_points()*s,d=c*r.BYTES_PER_ELEMENT,p=getDracoDataType(this.draco,r);let T;const S=this.draco._malloc(d);try{const R=this.decoder.GetAttribute(e,n.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,R,p,d,S),T=new r(this.draco.HEAPF32.buffer,S,c).slice()}finally{this.draco._free(S)}return{value:T,size:s}}_deduceAttributeName(e,n){const r=e.unique_id;for(const[c,d]of Object.entries(n.extraAttributes||{}))if(d===r)return c;const s=e.attribute_type;for(const c in DRACO_TO_GLTF_ATTRIBUTE_NAME_MAP)if(this.draco[c]===s)return DRACO_TO_GLTF_ATTRIBUTE_NAME_MAP[c];const o=n.attributeNameEntry||"name";return e.metadata[o]?e.metadata[o].string:`CUSTOM_ATTRIBUTE_${r}`}_getTopLevelMetadata(e){const n=this.decoder.GetMetadata(e);return this._getDracoMetadata(n)}_getAttributeMetadata(e,n){const r=this.decoder.GetAttributeMetadata(e,n);return this._getDracoMetadata(r)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const n={},r=this.metadataQuerier.NumEntries(e);for(let s=0;s<r;s++){const o=this.metadataQuerier.GetEntryName(e,s);n[o]=this._getDracoMetadataField(e,o)}return n}_getDracoMetadataField(e,n){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,n,r);const s=getInt32Array(r);return{int:this.metadataQuerier.GetIntEntry(e,n),string:this.metadataQuerier.GetStringEntry(e,n),double:this.metadataQuerier.GetDoubleEntry(e,n),intArray:s}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(e){const{quantizedAttributes:n=[],octahedronAttributes:r=[]}=e,s=[...n,...r];for(const o of s)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(e,n){const{quantizedAttributes:r=[]}=n,s=e.attribute_type();if(r.map(c=>this.decoder[c]).includes(s)){const c=new this.draco.AttributeQuantizationTransform;try{if(c.InitFromAttribute(e))return{quantization_bits:c.quantization_bits(),range:c.range(),min_values:new Float32Array([1,2,3]).map(d=>c.min_value(d))}}finally{this.draco.destroy(c)}}return null}_getOctahedronTransform(e,n){const{octahedronAttributes:r=[]}=n,s=e.attribute_type();if(r.map(c=>this.decoder[c]).includes(s)){const c=new this.draco.AttributeQuantizationTransform;try{if(c.InitFromAttribute(e))return{quantization_bits:c.quantization_bits()}}finally{this.draco.destroy(c)}}return null}}function getDracoDataType(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function getInt32Array(t){const e=t.size(),n=new Int32Array(e);for(let r=0;r<e;r++)n[r]=t.GetValue(r);return n}function getUint32Array(t){const e=t.size(),n=new Int32Array(e);for(let r=0;r<e;r++)n[r]=t.GetValue(r);return n}const DRACO_DECODER_VERSION="1.5.6",DRACO_ENCODER_VERSION="1.4.1",STATIC_DECODER_URL=`https://www.gstatic.com/draco/versioned/decoders/${DRACO_DECODER_VERSION}`,DRACO_EXTERNAL_LIBRARIES={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},DRACO_EXTERNAL_LIBRARY_URLS={[DRACO_EXTERNAL_LIBRARIES.DECODER]:`${STATIC_DECODER_URL}/${DRACO_EXTERNAL_LIBRARIES.DECODER}`,[DRACO_EXTERNAL_LIBRARIES.DECODER_WASM]:`${STATIC_DECODER_URL}/${DRACO_EXTERNAL_LIBRARIES.DECODER_WASM}`,[DRACO_EXTERNAL_LIBRARIES.FALLBACK_DECODER]:`${STATIC_DECODER_URL}/${DRACO_EXTERNAL_LIBRARIES.FALLBACK_DECODER}`,[DRACO_EXTERNAL_LIBRARIES.ENCODER]:`https://raw.githubusercontent.com/google/draco/${DRACO_ENCODER_VERSION}/javascript/${DRACO_EXTERNAL_LIBRARIES.ENCODER}`};let loadDecoderPromise;async function loadDracoDecoderModule(t){const e=t.modules||{};return e.draco3d?loadDecoderPromise||=e.draco3d.createDecoderModule({}).then(n=>({draco:n})):loadDecoderPromise||=loadDracoDecoder(t),await loadDecoderPromise}async function loadDracoDecoder(t){let e,n;switch(t.draco&&t.draco.decoderType){case"js":e=await loadLibrary(DRACO_EXTERNAL_LIBRARY_URLS[DRACO_EXTERNAL_LIBRARIES.FALLBACK_DECODER],"draco",t,DRACO_EXTERNAL_LIBRARIES.FALLBACK_DECODER);break;case"wasm":default:[e,n]=await Promise.all([await loadLibrary(DRACO_EXTERNAL_LIBRARY_URLS[DRACO_EXTERNAL_LIBRARIES.DECODER],"draco",t,DRACO_EXTERNAL_LIBRARIES.DECODER),await loadLibrary(DRACO_EXTERNAL_LIBRARY_URLS[DRACO_EXTERNAL_LIBRARIES.DECODER_WASM],"draco",t,DRACO_EXTERNAL_LIBRARIES.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await initializeDracoDecoder(e,n)}function initializeDracoDecoder(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t({...n,onModuleLoaded:s=>r({draco:s})})})}const DracoLoader={...DracoLoader$1,parse:parse$1};async function parse$1(t,e){const{draco:n}=await loadDracoDecoderModule(e),r=new DracoParser(n);try{return r.parseSync(t,e?.draco)}finally{r.destroy()}}function getGLTFAccessors(t){const e={};for(const n in t){const r=t[n];if(n!=="indices"){const s=getGLTFAccessor(r);e[n]=s}}return e}function getGLTFAccessor(t){const{buffer:e,size:n,count:r}=getAccessorData(t);return{value:e,size:n,byteOffset:0,count:r,type:getAccessorTypeFromSize(n),componentType:getComponentTypeFromArray(e)}}function getAccessorData(t){let e=t,n=1,r=0;return t&&t.value&&(e=t.value,n=t.size||1),e&&(ArrayBuffer.isView(e)||(e=toTypedArray(e,Float32Array)),r=e.length/n),{buffer:e,size:n,count:r}}function toTypedArray(t,e,n=!1){return t?Array.isArray(t)?new e(t):n&&!(t instanceof e)?new e(t):t:null}const KHR_DRACO_MESH_COMPRESSION="KHR_draco_mesh_compression",name$4=KHR_DRACO_MESH_COMPRESSION;function preprocess$1(t,e,n){const r=new GLTFScenegraph(t);for(const s of makeMeshPrimitiveIterator(r))r.getObjectExtension(s,KHR_DRACO_MESH_COMPRESSION)}async function decode$4(t,e,n){if(!e?.gltf?.decompressMeshes)return;const r=new GLTFScenegraph(t),s=[];for(const o of makeMeshPrimitiveIterator(r))r.getObjectExtension(o,KHR_DRACO_MESH_COMPRESSION)&&s.push(decompressPrimitive(r,o,e,n));await Promise.all(s),r.removeExtension(KHR_DRACO_MESH_COMPRESSION)}function encode$3(t,e={}){const n=new GLTFScenegraph(t);for(const r of n.json.meshes||[])compressMesh(r),n.addRequiredExtension(KHR_DRACO_MESH_COMPRESSION)}async function decompressPrimitive(t,e,n,r){const s=t.getObjectExtension(e,KHR_DRACO_MESH_COMPRESSION);if(!s)return;const o=t.getTypedArrayForBufferView(s.bufferView),c=sliceArrayBuffer(o.buffer,o.byteOffset),d={...n};delete d["3d-tiles"];const p=await parseFromContext(c,DracoLoader,d,r),T=getGLTFAccessors(p.attributes);for(const[S,R]of Object.entries(T))if(S in e.attributes){const x=e.attributes[S],G=t.getAccessor(x);G?.min&&G?.max&&(R.min=G.min,R.max=G.max)}e.attributes=T,p.indices&&(e.indices=getGLTFAccessor(p.indices)),t.removeObjectExtension(e,KHR_DRACO_MESH_COMPRESSION),checkPrimitive(e)}function compressMesh(t,e,n=4,r,s){if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=r.DracoWriter.encodeSync({attributes:t}),c=s?.parseSync?.({attributes:t}),d=r._addFauxAttributes(c.attributes),p=r.addBufferView(o);return{primitives:[{attributes:d,mode:n,extensions:{[KHR_DRACO_MESH_COMPRESSION]:{bufferView:p,attributes:d}}}]}}function checkPrimitive(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*makeMeshPrimitiveIterator(t){for(const e of t.json.meshes||[])for(const n of e.primitives)yield n}const KHR_draco_mesh_compression=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$4,encode:encode$3,name:name$4,preprocess:preprocess$1},Symbol.toStringTag,{value:"Module"})),DEFAULT_CONFIG={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...DEFAULT_CONFIG}};const config=globalThis.mathgl.config;function formatValue(t,{precision:e=config.precision}={}){return t=round(t),`${parseFloat(t.toPrecision(e))}`}function isArray(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function equals(t,e,n){const r=config.EPSILON;try{if(t===e)return!0;if(isArray(t)&&isArray(e)){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(!equals(t[s],e[s]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=config.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{config.EPSILON=r}}function round(t){return Math.round(t/config.EPSILON)*config.EPSILON}class MathArray extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:isArray(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(config)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+formatValue(this[r],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!equals(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let s=0;s<this.ELEMENTS;++s){const o=e[s],c=typeof n=="number"?n:n[s];this[s]=o+r*(c-o)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(config.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function validateVector(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function checkNumber(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function checkVector(t,e,n=""){if(config.debug&&!validateVector(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function assert(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class Vector extends MathArray{get x(){return this[0]}set x(e){this[0]=checkNumber(e)}get y(){return this[1]}set y(e){this[1]=checkNumber(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const s=this[r]-e[r];n+=s*s}return checkNumber(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return checkNumber(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return assert(e>=0&&e<this.ELEMENTS,"index is out of range"),checkNumber(this[e])}setComponent(e,n){return assert(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}let ARRAY_TYPE=typeof Float32Array<"u"?Float32Array:Array;function create$1(){const t=new ARRAY_TYPE(2);return ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function transformMat3$1(t,e,n){const r=e[0],s=e[1];return t[0]=n[0]*r+n[3]*s+n[6],t[1]=n[1]*r+n[4]*s+n[7],t}(function(){const t=create$1();return function(e,n,r,s,o,c){let d,p;for(n||(n=2),r||(r=0),s?p=Math.min(s*n+r,e.length):p=e.length,d=r;d<p;d+=n)t[0]=e[d],t[1]=e[d+1],o(t,t,c),e[d]=t[0],e[d+1]=t[1];return e}})();function vec3_transformMat4AsVector(t,e,n){const r=e[0],s=e[1],o=e[2],c=n[3]*r+n[7]*s+n[11]*o||1;return t[0]=(n[0]*r+n[4]*s+n[8]*o)/c,t[1]=(n[1]*r+n[5]*s+n[9]*o)/c,t[2]=(n[2]*r+n[6]*s+n[10]*o)/c,t}function vec3_transformMat2(t,e,n){const r=e[0],s=e[1];return t[0]=n[0]*r+n[2]*s,t[1]=n[1]*r+n[3]*s,t[2]=e[2],t}function vec4_transformMat3(t,e,n){const r=e[0],s=e[1],o=e[2];return t[0]=n[0]*r+n[3]*s+n[6]*o,t[1]=n[1]*r+n[4]*s+n[7]*o,t[2]=n[2]*r+n[5]*s+n[8]*o,t[3]=e[3],t}function create(){const t=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function dot(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function cross(t,e,n){const r=e[0],s=e[1],o=e[2],c=n[0],d=n[1],p=n[2];return t[0]=s*p-o*d,t[1]=o*c-r*p,t[2]=r*d-s*c,t}function transformMat4(t,e,n){const r=e[0],s=e[1],o=e[2];let c=n[3]*r+n[7]*s+n[11]*o+n[15];return c=c||1,t[0]=(n[0]*r+n[4]*s+n[8]*o+n[12])/c,t[1]=(n[1]*r+n[5]*s+n[9]*o+n[13])/c,t[2]=(n[2]*r+n[6]*s+n[10]*o+n[14])/c,t}function transformMat3(t,e,n){const r=e[0],s=e[1],o=e[2];return t[0]=r*n[0]+s*n[3]+o*n[6],t[1]=r*n[1]+s*n[4]+o*n[7],t[2]=r*n[2]+s*n[5]+o*n[8],t}function transformQuat(t,e,n){const r=n[0],s=n[1],o=n[2],c=n[3],d=e[0],p=e[1],T=e[2];let S=s*T-o*p,R=o*d-r*T,x=r*p-s*d,G=s*x-o*R,P=o*S-r*x,U=r*R-s*S;const H=c*2;return S*=H,R*=H,x*=H,G*=2,P*=2,U*=2,t[0]=d+S+G,t[1]=p+R+P,t[2]=T+x+U,t}function rotateX(t,e,n,r){const s=[],o=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],o[0]=s[0],o[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),o[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function rotateY(t,e,n,r){const s=[],o=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],o[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),o[1]=s[1],o[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function rotateZ(t,e,n,r){const s=[],o=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],o[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),o[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),o[2]=s[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function angle(t,e){const n=t[0],r=t[1],s=t[2],o=e[0],c=e[1],d=e[2],p=Math.sqrt((n*n+r*r+s*s)*(o*o+c*c+d*d)),T=p&&dot(t,e)/p;return Math.acos(Math.min(Math.max(T,-1),1))}(function(){const t=create();return function(e,n,r,s,o,c){let d,p;for(n||(n=3),r||(r=0),s?p=Math.min(s*n+r,e.length):p=e.length,d=r;d<p;d+=n)t[0]=e[d],t[1]=e[d+1],t[2]=e[d+2],o(t,t,c),e[d]=t[0],e[d+1]=t[1],e[d+2]=t[2];return e}})();const ORIGIN=[0,0,0];let ZERO;class Vector3 extends Vector{static get ZERO(){return ZERO||(ZERO=new Vector3(0,0,0),Object.freeze(ZERO)),ZERO}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&isArray(e)?this.copy(e):(config.debug&&(checkNumber(e),checkNumber(n),checkNumber(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return config.debug&&(checkNumber(e.x),checkNumber(e.y),checkNumber(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=checkNumber(e)}angle(e){return angle(this,e)}cross(e){return cross(this,this,e),this.check()}rotateX({radians:e,origin:n=ORIGIN}){return rotateX(this,this,n,e),this.check()}rotateY({radians:e,origin:n=ORIGIN}){return rotateY(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=ORIGIN}){return rotateZ(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return transformMat4(this,this,e),this.check()}transformAsVector(e){return vec3_transformMat4AsVector(this,this,e),this.check()}transformByMatrix3(e){return transformMat3(this,this,e),this.check()}transformByMatrix2(e){return vec3_transformMat2(this,this,e),this.check()}transformByQuaternion(e){return transformQuat(this,this,e),this.check()}}class Matrix extends MathArray{toString(){let e="[";if(config.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=checkNumber(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)n[s]=this[r+s];return n}setColumn(e,n){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)this[r+s]=n[s];return this}}function transpose(t,e){if(t===e){const n=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function invert(t,e){const n=e[0],r=e[1],s=e[2],o=e[3],c=e[4],d=e[5],p=e[6],T=e[7],S=e[8],R=S*c-d*T,x=-S*o+d*p,G=T*o-c*p;let P=n*R+r*x+s*G;return P?(P=1/P,t[0]=R*P,t[1]=(-S*r+s*T)*P,t[2]=(d*r-s*c)*P,t[3]=x*P,t[4]=(S*n-s*p)*P,t[5]=(-d*n+s*o)*P,t[6]=G*P,t[7]=(-T*n+r*p)*P,t[8]=(c*n-r*o)*P,t):null}function determinant(t){const e=t[0],n=t[1],r=t[2],s=t[3],o=t[4],c=t[5],d=t[6],p=t[7],T=t[8];return e*(T*o-c*p)+n*(-T*s+c*d)+r*(p*s-o*d)}function multiply(t,e,n){const r=e[0],s=e[1],o=e[2],c=e[3],d=e[4],p=e[5],T=e[6],S=e[7],R=e[8],x=n[0],G=n[1],P=n[2],U=n[3],H=n[4],X=n[5],$=n[6],K=n[7],q=n[8];return t[0]=x*r+G*c+P*T,t[1]=x*s+G*d+P*S,t[2]=x*o+G*p+P*R,t[3]=U*r+H*c+X*T,t[4]=U*s+H*d+X*S,t[5]=U*o+H*p+X*R,t[6]=$*r+K*c+q*T,t[7]=$*s+K*d+q*S,t[8]=$*o+K*p+q*R,t}function translate(t,e,n){const r=e[0],s=e[1],o=e[2],c=e[3],d=e[4],p=e[5],T=e[6],S=e[7],R=e[8],x=n[0],G=n[1];return t[0]=r,t[1]=s,t[2]=o,t[3]=c,t[4]=d,t[5]=p,t[6]=x*r+G*c+T,t[7]=x*s+G*d+S,t[8]=x*o+G*p+R,t}function rotate(t,e,n){const r=e[0],s=e[1],o=e[2],c=e[3],d=e[4],p=e[5],T=e[6],S=e[7],R=e[8],x=Math.sin(n),G=Math.cos(n);return t[0]=G*r+x*c,t[1]=G*s+x*d,t[2]=G*o+x*p,t[3]=G*c-x*r,t[4]=G*d-x*s,t[5]=G*p-x*o,t[6]=T,t[7]=S,t[8]=R,t}function scale(t,e,n){const r=n[0],s=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function fromQuat(t,e){const n=e[0],r=e[1],s=e[2],o=e[3],c=n+n,d=r+r,p=s+s,T=n*c,S=r*c,R=r*d,x=s*c,G=s*d,P=s*p,U=o*c,H=o*d,X=o*p;return t[0]=1-R-P,t[3]=S-X,t[6]=x+H,t[1]=S+X,t[4]=1-T-P,t[7]=G-U,t[2]=x-H,t[5]=G+U,t[8]=1-T-R,t}var INDICES;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(INDICES||(INDICES={}));const IDENTITY_MATRIX=Object.freeze([1,0,0,0,1,0,0,0,1]);class Matrix3 extends Matrix{static get IDENTITY(){return getIdentityMatrix()}static get ZERO(){return getZeroMatrix()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return INDICES}constructor(e,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(IDENTITY_MATRIX)}fromObject(e){return this.check()}fromQuaternion(e){return fromQuat(this,e),this.check()}set(e,n,r,s,o,c,d,p,T){return this[0]=e,this[1]=n,this[2]=r,this[3]=s,this[4]=o,this[5]=c,this[6]=d,this[7]=p,this[8]=T,this.check()}setRowMajor(e,n,r,s,o,c,d,p,T){return this[0]=e,this[1]=s,this[2]=d,this[3]=n,this[4]=o,this[5]=p,this[6]=r,this[7]=c,this[8]=T,this.check()}determinant(){return determinant(this)}transpose(){return transpose(this,this),this.check()}invert(){return invert(this,this),this.check()}multiplyLeft(e){return multiply(this,e,this),this.check()}multiplyRight(e){return multiply(this,this,e),this.check()}rotate(e){return rotate(this,this,e),this.check()}scale(e){return Array.isArray(e)?scale(this,this,e):scale(this,this,[e,e]),this.check()}translate(e){return translate(this,this,e),this.check()}transform(e,n){let r;switch(e.length){case 2:r=transformMat3$1(n||[-0,-0],e,this);break;case 3:r=transformMat3(n||[-0,-0,-0],e,this);break;case 4:r=vec4_transformMat3(n||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return checkVector(r,e.length),r}transformVector(e,n){return this.transform(e,n)}transformVector2(e,n){return this.transform(e,n)}transformVector3(e,n){return this.transform(e,n)}}let ZERO_MATRIX3,IDENTITY_MATRIX3=null;function getZeroMatrix(){return ZERO_MATRIX3||(ZERO_MATRIX3=new Matrix3([0,0,0,0,0,0,0,0,0]),Object.freeze(ZERO_MATRIX3)),ZERO_MATRIX3}function getIdentityMatrix(){return IDENTITY_MATRIX3||(IDENTITY_MATRIX3=new Matrix3,Object.freeze(IDENTITY_MATRIX3)),IDENTITY_MATRIX3}const KHR_TEXTURE_TRANSFORM="KHR_texture_transform",name$3=KHR_TEXTURE_TRANSFORM,scratchVector=new Vector3,scratchRotationMatrix=new Matrix3,scratchScaleMatrix=new Matrix3;async function decode$3(t,e){if(!new GLTFScenegraph(t).hasExtension(KHR_TEXTURE_TRANSFORM)||!e.gltf?.loadBuffers)return;const s=t.json.materials||[];for(let o=0;o<s.length;o++)transformTexCoords(o,t)}function transformTexCoords(t,e){const n=e.json.materials?.[t],r=[n?.pbrMetallicRoughness?.baseColorTexture,n?.emissiveTexture,n?.normalTexture,n?.occlusionTexture,n?.pbrMetallicRoughness?.metallicRoughnessTexture],s=[];for(const o of r)o&&o?.extensions?.[KHR_TEXTURE_TRANSFORM]&&transformPrimitives(e,t,o,s)}function transformPrimitives(t,e,n,r){const s=getTransformParameters(n,r);if(!s)return;const o=t.json.meshes||[];for(const c of o)for(const d of c.primitives){const p=d.material;Number.isFinite(p)&&e===p&&transformPrimitive(t,d,s)}}function getTransformParameters(t,e){const n=t.extensions?.[KHR_TEXTURE_TRANSFORM],{texCoord:r=0}=t,{texCoord:s=r}=n;if(!(e.findIndex(([c,d])=>c===r&&d===s)!==-1)){const c=makeTransformationMatrix(n);return r!==s&&(t.texCoord=s),e.push([r,s]),{originalTexCoord:r,texCoord:s,matrix:c}}return null}function transformPrimitive(t,e,n){const{originalTexCoord:r,texCoord:s,matrix:o}=n,c=e.attributes[`TEXCOORD_${r}`];if(Number.isFinite(c)){const d=t.json.accessors?.[c];if(d&&d.bufferView){const p=t.json.bufferViews?.[d.bufferView];if(p){const{arrayBuffer:T,byteOffset:S}=t.buffers[p.buffer],R=(S||0)+(d.byteOffset||0)+(p.byteOffset||0),{ArrayType:x,length:G}=getAccessorArrayTypeAndLength(d,p),P=BYTES[d.componentType],U=COMPONENTS[d.type],H=p.byteStride||P*U,X=new Float32Array(G);for(let $=0;$<d.count;$++){const K=new x(T,R+$*H,2);scratchVector.set(K[0],K[1],1),scratchVector.transformByMatrix3(o),X.set([scratchVector[0],scratchVector[1]],$*U)}r===s?updateGltf(d,p,t.buffers,X):createAttribute(s,d,e,t,X)}}}}function updateGltf(t,e,n,r){t.componentType=5126,n.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),e.buffer=n.length-1,e.byteLength=r.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function createAttribute(t,e,n,r,s){r.buffers.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength});const o=r.json.bufferViews;if(!o)return;o.push({buffer:r.buffers.length-1,byteLength:s.buffer.byteLength,byteOffset:0});const c=r.json.accessors;c&&(c.push({bufferView:o?.length-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),n.attributes[`TEXCOORD_${t}`]=c.length-1)}function makeTransformationMatrix(t){const{offset:e=[0,0],rotation:n=0,scale:r=[1,1]}=t,s=new Matrix3().set(1,0,0,0,1,0,e[0],e[1],1),o=scratchRotationMatrix.set(Math.cos(n),Math.sin(n),0,-Math.sin(n),Math.cos(n),0,0,0,1),c=scratchScaleMatrix.set(r[0],0,0,0,r[1],0,0,0,1);return s.multiplyRight(o).multiplyRight(c)}const KHR_texture_transform=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$3,name:name$3},Symbol.toStringTag,{value:"Module"})),KHR_LIGHTS_PUNCTUAL="KHR_lights_punctual",name$2=KHR_LIGHTS_PUNCTUAL;async function decode$2(t){const e=new GLTFScenegraph(t),{json:n}=e,r=e.getExtension(KHR_LIGHTS_PUNCTUAL);r&&(e.json.lights=r.lights,e.removeExtension(KHR_LIGHTS_PUNCTUAL));for(const s of n.nodes||[]){const o=e.getObjectExtension(s,KHR_LIGHTS_PUNCTUAL);o&&(s.light=o.light),e.removeObjectExtension(s,KHR_LIGHTS_PUNCTUAL)}}async function encode$2(t){const e=new GLTFScenegraph(t),{json:n}=e;if(n.lights){const r=e.addExtension(KHR_LIGHTS_PUNCTUAL);assert$1(!r.lights),r.lights=n.lights,delete n.lights}if(e.json.lights){for(const r of e.json.lights){const s=r.node;e.addObjectExtension(s,KHR_LIGHTS_PUNCTUAL,r)}delete e.json.lights}}const KHR_lights_punctual=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$2,encode:encode$2,name:name$2},Symbol.toStringTag,{value:"Module"})),KHR_MATERIALS_UNLIT="KHR_materials_unlit",name$1=KHR_MATERIALS_UNLIT;async function decode$1(t){const e=new GLTFScenegraph(t),{json:n}=e;for(const r of n.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),e.removeObjectExtension(r,KHR_MATERIALS_UNLIT);e.removeExtension(KHR_MATERIALS_UNLIT)}function encode$1(t){const e=new GLTFScenegraph(t),{json:n}=e;if(e.materials)for(const r of n.materials||[])r.unlit&&(delete r.unlit,e.addObjectExtension(r,KHR_MATERIALS_UNLIT,{}),e.addExtension(KHR_MATERIALS_UNLIT))}const KHR_materials_unlit=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$1,encode:encode$1,name:name$1},Symbol.toStringTag,{value:"Module"})),KHR_TECHNIQUES_WEBGL="KHR_techniques_webgl",name=KHR_TECHNIQUES_WEBGL;async function decode(t){const e=new GLTFScenegraph(t),{json:n}=e,r=e.getExtension(KHR_TECHNIQUES_WEBGL);if(r){const s=resolveTechniques(r,e);for(const o of n.materials||[]){const c=e.getObjectExtension(o,KHR_TECHNIQUES_WEBGL);c&&(o.technique=Object.assign({},c,s[c.technique]),o.technique.values=resolveValues(o.technique,e)),e.removeObjectExtension(o,KHR_TECHNIQUES_WEBGL)}e.removeExtension(KHR_TECHNIQUES_WEBGL)}}async function encode(t,e){}function resolveTechniques(t,e){const{programs:n=[],shaders:r=[],techniques:s=[]}=t,o=new TextDecoder;return r.forEach(c=>{if(Number.isFinite(c.bufferView))c.code=o.decode(e.getTypedArrayForBufferView(c.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),n.forEach(c=>{c.fragmentShader=r[c.fragmentShader],c.vertexShader=r[c.vertexShader]}),s.forEach(c=>{c.program=n[c.program]}),s}function resolveValues(t,e){const n=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(r=>{t.uniforms[r].value&&!(r in n)&&(n[r]=t.uniforms[r].value)}),Object.keys(n).forEach(r=>{typeof n[r]=="object"&&n[r].index!==void 0&&(n[r].texture=e.getTexture(n[r].index))}),n}const KHR_techniques_webgl=Object.freeze(Object.defineProperty({__proto__:null,decode,encode,name},Symbol.toStringTag,{value:"Module"})),EXTENSIONS=[EXT_structural_metadata,EXT_mesh_features,EXT_meshopt_compression,EXT_texture_webp,KHR_texture_basisu,KHR_draco_mesh_compression,KHR_lights_punctual,KHR_materials_unlit,KHR_techniques_webgl,KHR_texture_transform,EXT_feature_metadata];function preprocessExtensions(t,e={},n){const r=EXTENSIONS.filter(s=>useExtension(s.name,e));for(const s of r)s.preprocess?.(t,e,n)}async function decodeExtensions(t,e={},n){const r=EXTENSIONS.filter(s=>useExtension(s.name,e));for(const s of r)await s.decode?.(t,e,n)}function useExtension(t,e){const n=e?.gltf?.excludeExtensions||{};return!(t in n&&!n[t])}const KHR_BINARY_GLTF="KHR_binary_glTF";function preprocess(t){const e=new GLTFScenegraph(t),{json:n}=e;for(const r of n.images||[]){const s=e.getObjectExtension(r,KHR_BINARY_GLTF);s&&Object.assign(r,s),e.removeObjectExtension(r,KHR_BINARY_GLTF)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,e.removeExtension(KHR_BINARY_GLTF)}const GLTF_ARRAYS={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},GLTF_KEYS={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class GLTFV1Normalizer{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,n){this.json=e.json;const r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${r.asset.version}`);return}if(!n.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),preprocess(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const n in GLTF_ARRAYS)this._convertTopLevelObjectToArray(e,n)}_convertTopLevelObjectToArray(e,n){const r=e[n];if(!(!r||Array.isArray(r))){e[n]=[];for(const s in r){const o=r[s];o.id=o.id||s;const c=e[n].length;e[n].push(o),this.idToIndexMap[n][s]=c}}}_convertObjectIdsToArrayIndices(e){for(const n in GLTF_ARRAYS)this._convertIdsToIndices(e,n);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const n of e.textures)this._convertTextureIds(n);for(const n of e.meshes)this._convertMeshIds(n);for(const n of e.nodes)this._convertNodeIds(n);for(const n of e.scenes)this._convertSceneIds(n)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const n of e.primitives){const{attributes:r,indices:s,material:o}=n;for(const c in r)r[c]=this._convertIdToIndex(r[c],"accessor");s&&(n.indices=this._convertIdToIndex(s,"accessor")),o&&(n.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(n=>this._convertIdToIndex(n,"node"))),e.meshes&&(e.meshes=e.meshes.map(n=>this._convertIdToIndex(n,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(n=>this._convertIdToIndex(n,"node")))}_convertIdsToIndices(e,n){e[n]||(console.warn(`gltf v1: json doesn't contain attribute ${n}`),e[n]=[]);for(const r of e[n])for(const s in r){const o=r[s],c=this._convertIdToIndex(o,s);r[s]=c}}_convertIdToIndex(e,n){const r=GLTF_KEYS[n];if(r in this.idToIndexMap){const s=this.idToIndexMap[r][e];if(!Number.isFinite(s))throw new Error(`gltf v1: failed to resolve ${n} with id ${e}`);return s}return e}_updateObjects(e){for(const n of this.json.buffers)delete n.type}_updateMaterial(e){for(const n of e.materials){n.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const r=n.values?.tex||n.values?.texture2d_0||n.values?.diffuseTex,s=e.textures.findIndex(o=>o.id===r);s!==-1&&(n.pbrMetallicRoughness.baseColorTexture={index:s})}}}function normalizeGLTFV1(t,e={}){return new GLTFV1Normalizer().normalize(t,e)}async function parseGLTF(t,e,n=0,r,s){return parseGLTFContainerSync(t,e,n,r),normalizeGLTFV1(t,{normalize:r?.gltf?.normalize}),preprocessExtensions(t,r,s),r?.gltf?.loadBuffers&&t.json.buffers&&await loadBuffers(t,r,s),r?.gltf?.loadImages&&await loadImages(t,r,s),await decodeExtensions(t,r,s),t}function parseGLTFContainerSync(t,e,n,r){if(r.uri&&(t.baseUri=r.uri),e instanceof ArrayBuffer&&!isGLB(e,n,r)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=parseJSON(e);else if(e instanceof ArrayBuffer){const c={};n=parseGLBSync(c,e,n,r.glb),assert$1(c.type==="glTF",`Invalid GLB magic string ${c.type}`),t._glb=c,t.json=c.json}else assert$1(!1,"GLTF: must be ArrayBuffer or string");const s=t.json.buffers||[];if(t.buffers=new Array(s.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:c}=t._glb;t.buffers[0]={arrayBuffer:c[0].arrayBuffer,byteOffset:c[0].byteOffset,byteLength:c[0].byteLength}}const o=t.json.images||[];t.images=new Array(o.length).fill({})}async function loadBuffers(t,e,n){const r=t.json.buffers||[];for(let s=0;s<r.length;++s){const o=r[s];if(o.uri){const{fetch:c}=n;assert$1(c);const d=resolveUrl(o.uri,e),T=await(await n?.fetch?.(d))?.arrayBuffer?.();t.buffers[s]={arrayBuffer:T,byteOffset:0,byteLength:T.byteLength},delete o.uri}else t.buffers[s]===null&&(t.buffers[s]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function loadImages(t,e,n){const r=getReferencesImageIndices(t),s=t.json.images||[],o=[];for(const c of r)o.push(loadImage(t,s[c],c,e,n));return await Promise.all(o)}function getReferencesImageIndices(t){const e=new Set,n=t.json.textures||[];for(const r of n)r.source!==void 0&&e.add(r.source);return Array.from(e).sort()}async function loadImage(t,e,n,r,s){let o;if(e.uri&&!e.hasOwnProperty("bufferView")){const d=resolveUrl(e.uri,r),{fetch:p}=s;o=await(await p(d)).arrayBuffer(),e.bufferView={data:o}}if(Number.isFinite(e.bufferView)){const d=getTypedArrayForBufferView(t.json,t.buffers,e.bufferView);o=sliceArrayBuffer(d.buffer,d.byteOffset,d.byteLength)}assert$1(o,"glTF image has no data");let c=await parseFromContext(o,[ImageLoader,BasisLoader],{...r,mimeType:e.mimeType,basis:r.basis||{format:selectSupportedBasisFormat()}},s);c&&c[0]&&(c={compressed:!0,mipmaps:!1,width:c[0].width,height:c[0].height,data:c[0]}),t.images=t.images||[],t.images[n]=c}const GLTFLoader={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:VERSION$2,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function parse(t,e={},n){e={...GLTFLoader.options,...e},e.gltf={...GLTFLoader.options.gltf,...e.gltf};const{byteOffset:r=0}=e;return await parseGLTF({},t,r,e,n)}function wrapConstructor(t,e){return class extends t{constructor(...n){super(...n),e(this)}}}const ZeroArray=wrapConstructor(Array,t=>t.fill(0));let EPSILON=1e-6;function getAPIImpl$5(t){function e(C=0,b=0){const w=new t(2);return C!==void 0&&(w[0]=C,b!==void 0&&(w[1]=b)),w}const n=e;function r(C,b,w){const i=w??new t(2);return i[0]=C,i[1]=b,i}function s(C,b){const w=b??new t(2);return w[0]=Math.ceil(C[0]),w[1]=Math.ceil(C[1]),w}function o(C,b){const w=b??new t(2);return w[0]=Math.floor(C[0]),w[1]=Math.floor(C[1]),w}function c(C,b){const w=b??new t(2);return w[0]=Math.round(C[0]),w[1]=Math.round(C[1]),w}function d(C,b=0,w=1,i){const g=i??new t(2);return g[0]=Math.min(w,Math.max(b,C[0])),g[1]=Math.min(w,Math.max(b,C[1])),g}function p(C,b,w){const i=w??new t(2);return i[0]=C[0]+b[0],i[1]=C[1]+b[1],i}function T(C,b,w,i){const g=i??new t(2);return g[0]=C[0]+b[0]*w,g[1]=C[1]+b[1]*w,g}function S(C,b){const w=C[0],i=C[1],g=b[0],l=b[1],h=Math.sqrt(w*w+i*i),u=Math.sqrt(g*g+l*l),m=h*u,E=m&&Te(C,b)/m;return Math.acos(E)}function R(C,b,w){const i=w??new t(2);return i[0]=C[0]-b[0],i[1]=C[1]-b[1],i}const x=R;function G(C,b){return Math.abs(C[0]-b[0])<EPSILON&&Math.abs(C[1]-b[1])<EPSILON}function P(C,b){return C[0]===b[0]&&C[1]===b[1]}function U(C,b,w,i){const g=i??new t(2);return g[0]=C[0]+w*(b[0]-C[0]),g[1]=C[1]+w*(b[1]-C[1]),g}function H(C,b,w,i){const g=i??new t(2);return g[0]=C[0]+w[0]*(b[0]-C[0]),g[1]=C[1]+w[1]*(b[1]-C[1]),g}function X(C,b,w){const i=w??new t(2);return i[0]=Math.max(C[0],b[0]),i[1]=Math.max(C[1],b[1]),i}function $(C,b,w){const i=w??new t(2);return i[0]=Math.min(C[0],b[0]),i[1]=Math.min(C[1],b[1]),i}function K(C,b,w){const i=w??new t(2);return i[0]=C[0]*b,i[1]=C[1]*b,i}const q=K;function te(C,b,w){const i=w??new t(2);return i[0]=C[0]/b,i[1]=C[1]/b,i}function Ce(C,b){const w=b??new t(2);return w[0]=1/C[0],w[1]=1/C[1],w}const Me=Ce;function be(C,b,w){const i=w??new t(3),g=C[0]*b[1]-C[1]*b[0];return i[0]=0,i[1]=0,i[2]=g,i}function Te(C,b){return C[0]*b[0]+C[1]*b[1]}function oe(C){const b=C[0],w=C[1];return Math.sqrt(b*b+w*w)}const De=oe;function me(C){const b=C[0],w=C[1];return b*b+w*w}const xe=me;function ae(C,b){const w=C[0]-b[0],i=C[1]-b[1];return Math.sqrt(w*w+i*i)}const Q=ae;function z(C,b){const w=C[0]-b[0],i=C[1]-b[1];return w*w+i*i}const Y=z;function Ae(C,b){const w=b??new t(2),i=C[0],g=C[1],l=Math.sqrt(i*i+g*g);return l>1e-5?(w[0]=i/l,w[1]=g/l):(w[0]=0,w[1]=0),w}function Fe(C,b){const w=b??new t(2);return w[0]=-C[0],w[1]=-C[1],w}function ee(C,b){const w=b??new t(2);return w[0]=C[0],w[1]=C[1],w}const Ge=ee;function ye(C,b,w){const i=w??new t(2);return i[0]=C[0]*b[0],i[1]=C[1]*b[1],i}const Le=ye;function Ee(C,b,w){const i=w??new t(2);return i[0]=C[0]/b[0],i[1]=C[1]/b[1],i}const Re=Ee;function ve(C=1,b){const w=b??new t(2),i=Math.random()*2*Math.PI;return w[0]=Math.cos(i)*C,w[1]=Math.sin(i)*C,w}function I(C){const b=C??new t(2);return b[0]=0,b[1]=0,b}function F(C,b,w){const i=w??new t(2),g=C[0],l=C[1];return i[0]=g*b[0]+l*b[4]+b[12],i[1]=g*b[1]+l*b[5]+b[13],i}function y(C,b,w){const i=w??new t(2),g=C[0],l=C[1];return i[0]=b[0]*g+b[4]*l+b[8],i[1]=b[1]*g+b[5]*l+b[9],i}function a(C,b,w,i){const g=i??new t(2),l=C[0]-b[0],h=C[1]-b[1],u=Math.sin(w),m=Math.cos(w);return g[0]=l*m-h*u+b[0],g[1]=l*u+h*m+b[1],g}function A(C,b,w){const i=w??new t(2);return Ae(C,i),K(i,b,i)}function f(C,b,w){const i=w??new t(2);return oe(C)>b?A(C,b,i):ee(C,i)}function B(C,b,w){const i=w??new t(2);return U(C,b,.5,i)}return{create:e,fromValues:n,set:r,ceil:s,floor:o,round:c,clamp:d,add:p,addScaled:T,angle:S,subtract:R,sub:x,equalsApproximately:G,equals:P,lerp:U,lerpV:H,max:X,min:$,mulScalar:K,scale:q,divScalar:te,inverse:Ce,invert:Me,cross:be,dot:Te,length:oe,len:De,lengthSq:me,lenSq:xe,distance:ae,dist:Q,distanceSq:z,distSq:Y,normalize:Ae,negate:Fe,copy:ee,clone:Ge,multiply:ye,mul:Le,divide:Ee,div:Re,random:ve,zero:I,transformMat4:F,transformMat3:y,rotate:a,setLength:A,truncate:f,midpoint:B}}const cache$5=new Map;function getAPI$5(t){let e=cache$5.get(t);return e||(e=getAPIImpl$5(t),cache$5.set(t,e)),e}function getAPIImpl$4(t){function e(u,m,E){const _=new t(3);return u!==void 0&&(_[0]=u,m!==void 0&&(_[1]=m,E!==void 0&&(_[2]=E))),_}const n=e;function r(u,m,E,_){const M=_??new t(3);return M[0]=u,M[1]=m,M[2]=E,M}function s(u,m){const E=m??new t(3);return E[0]=Math.ceil(u[0]),E[1]=Math.ceil(u[1]),E[2]=Math.ceil(u[2]),E}function o(u,m){const E=m??new t(3);return E[0]=Math.floor(u[0]),E[1]=Math.floor(u[1]),E[2]=Math.floor(u[2]),E}function c(u,m){const E=m??new t(3);return E[0]=Math.round(u[0]),E[1]=Math.round(u[1]),E[2]=Math.round(u[2]),E}function d(u,m=0,E=1,_){const M=_??new t(3);return M[0]=Math.min(E,Math.max(m,u[0])),M[1]=Math.min(E,Math.max(m,u[1])),M[2]=Math.min(E,Math.max(m,u[2])),M}function p(u,m,E){const _=E??new t(3);return _[0]=u[0]+m[0],_[1]=u[1]+m[1],_[2]=u[2]+m[2],_}function T(u,m,E,_){const M=_??new t(3);return M[0]=u[0]+m[0]*E,M[1]=u[1]+m[1]*E,M[2]=u[2]+m[2]*E,M}function S(u,m){const E=u[0],_=u[1],M=u[2],v=m[0],D=m[1],N=m[2],L=Math.sqrt(E*E+_*_+M*M),O=Math.sqrt(v*v+D*D+N*N),k=L*O,j=k&&Te(u,m)/k;return Math.acos(j)}function R(u,m,E){const _=E??new t(3);return _[0]=u[0]-m[0],_[1]=u[1]-m[1],_[2]=u[2]-m[2],_}const x=R;function G(u,m){return Math.abs(u[0]-m[0])<EPSILON&&Math.abs(u[1]-m[1])<EPSILON&&Math.abs(u[2]-m[2])<EPSILON}function P(u,m){return u[0]===m[0]&&u[1]===m[1]&&u[2]===m[2]}function U(u,m,E,_){const M=_??new t(3);return M[0]=u[0]+E*(m[0]-u[0]),M[1]=u[1]+E*(m[1]-u[1]),M[2]=u[2]+E*(m[2]-u[2]),M}function H(u,m,E,_){const M=_??new t(3);return M[0]=u[0]+E[0]*(m[0]-u[0]),M[1]=u[1]+E[1]*(m[1]-u[1]),M[2]=u[2]+E[2]*(m[2]-u[2]),M}function X(u,m,E){const _=E??new t(3);return _[0]=Math.max(u[0],m[0]),_[1]=Math.max(u[1],m[1]),_[2]=Math.max(u[2],m[2]),_}function $(u,m,E){const _=E??new t(3);return _[0]=Math.min(u[0],m[0]),_[1]=Math.min(u[1],m[1]),_[2]=Math.min(u[2],m[2]),_}function K(u,m,E){const _=E??new t(3);return _[0]=u[0]*m,_[1]=u[1]*m,_[2]=u[2]*m,_}const q=K;function te(u,m,E){const _=E??new t(3);return _[0]=u[0]/m,_[1]=u[1]/m,_[2]=u[2]/m,_}function Ce(u,m){const E=m??new t(3);return E[0]=1/u[0],E[1]=1/u[1],E[2]=1/u[2],E}const Me=Ce;function be(u,m,E){const _=E??new t(3),M=u[2]*m[0]-u[0]*m[2],v=u[0]*m[1]-u[1]*m[0];return _[0]=u[1]*m[2]-u[2]*m[1],_[1]=M,_[2]=v,_}function Te(u,m){return u[0]*m[0]+u[1]*m[1]+u[2]*m[2]}function oe(u){const m=u[0],E=u[1],_=u[2];return Math.sqrt(m*m+E*E+_*_)}const De=oe;function me(u){const m=u[0],E=u[1],_=u[2];return m*m+E*E+_*_}const xe=me;function ae(u,m){const E=u[0]-m[0],_=u[1]-m[1],M=u[2]-m[2];return Math.sqrt(E*E+_*_+M*M)}const Q=ae;function z(u,m){const E=u[0]-m[0],_=u[1]-m[1],M=u[2]-m[2];return E*E+_*_+M*M}const Y=z;function Ae(u,m){const E=m??new t(3),_=u[0],M=u[1],v=u[2],D=Math.sqrt(_*_+M*M+v*v);return D>1e-5?(E[0]=_/D,E[1]=M/D,E[2]=v/D):(E[0]=0,E[1]=0,E[2]=0),E}function Fe(u,m){const E=m??new t(3);return E[0]=-u[0],E[1]=-u[1],E[2]=-u[2],E}function ee(u,m){const E=m??new t(3);return E[0]=u[0],E[1]=u[1],E[2]=u[2],E}const Ge=ee;function ye(u,m,E){const _=E??new t(3);return _[0]=u[0]*m[0],_[1]=u[1]*m[1],_[2]=u[2]*m[2],_}const Le=ye;function Ee(u,m,E){const _=E??new t(3);return _[0]=u[0]/m[0],_[1]=u[1]/m[1],_[2]=u[2]/m[2],_}const Re=Ee;function ve(u=1,m){const E=m??new t(3),_=Math.random()*2*Math.PI,M=Math.random()*2-1,v=Math.sqrt(1-M*M)*u;return E[0]=Math.cos(_)*v,E[1]=Math.sin(_)*v,E[2]=M*u,E}function I(u){const m=u??new t(3);return m[0]=0,m[1]=0,m[2]=0,m}function F(u,m,E){const _=E??new t(3),M=u[0],v=u[1],D=u[2],N=m[3]*M+m[7]*v+m[11]*D+m[15]||1;return _[0]=(m[0]*M+m[4]*v+m[8]*D+m[12])/N,_[1]=(m[1]*M+m[5]*v+m[9]*D+m[13])/N,_[2]=(m[2]*M+m[6]*v+m[10]*D+m[14])/N,_}function y(u,m,E){const _=E??new t(3),M=u[0],v=u[1],D=u[2];return _[0]=M*m[0]+v*m[4]+D*m[8],_[1]=M*m[1]+v*m[5]+D*m[9],_[2]=M*m[2]+v*m[6]+D*m[10],_}function a(u,m,E){const _=E??new t(3),M=u[0],v=u[1],D=u[2];return _[0]=M*m[0]+v*m[4]+D*m[8],_[1]=M*m[1]+v*m[5]+D*m[9],_[2]=M*m[2]+v*m[6]+D*m[10],_}function A(u,m,E){const _=E??new t(3),M=m[0],v=m[1],D=m[2],N=m[3]*2,L=u[0],O=u[1],k=u[2],j=v*k-D*O,J=D*L-M*k,V=M*O-v*L;return _[0]=L+j*N+(v*V-D*J)*2,_[1]=O+J*N+(D*j-M*V)*2,_[2]=k+V*N+(M*J-v*j)*2,_}function f(u,m){const E=m??new t(3);return E[0]=u[12],E[1]=u[13],E[2]=u[14],E}function B(u,m,E){const _=E??new t(3),M=m*4;return _[0]=u[M+0],_[1]=u[M+1],_[2]=u[M+2],_}function C(u,m){const E=m??new t(3),_=u[0],M=u[1],v=u[2],D=u[4],N=u[5],L=u[6],O=u[8],k=u[9],j=u[10];return E[0]=Math.sqrt(_*_+M*M+v*v),E[1]=Math.sqrt(D*D+N*N+L*L),E[2]=Math.sqrt(O*O+k*k+j*j),E}function b(u,m,E,_){const M=_??new t(3),v=[],D=[];return v[0]=u[0]-m[0],v[1]=u[1]-m[1],v[2]=u[2]-m[2],D[0]=v[0],D[1]=v[1]*Math.cos(E)-v[2]*Math.sin(E),D[2]=v[1]*Math.sin(E)+v[2]*Math.cos(E),M[0]=D[0]+m[0],M[1]=D[1]+m[1],M[2]=D[2]+m[2],M}function w(u,m,E,_){const M=_??new t(3),v=[],D=[];return v[0]=u[0]-m[0],v[1]=u[1]-m[1],v[2]=u[2]-m[2],D[0]=v[2]*Math.sin(E)+v[0]*Math.cos(E),D[1]=v[1],D[2]=v[2]*Math.cos(E)-v[0]*Math.sin(E),M[0]=D[0]+m[0],M[1]=D[1]+m[1],M[2]=D[2]+m[2],M}function i(u,m,E,_){const M=_??new t(3),v=[],D=[];return v[0]=u[0]-m[0],v[1]=u[1]-m[1],v[2]=u[2]-m[2],D[0]=v[0]*Math.cos(E)-v[1]*Math.sin(E),D[1]=v[0]*Math.sin(E)+v[1]*Math.cos(E),D[2]=v[2],M[0]=D[0]+m[0],M[1]=D[1]+m[1],M[2]=D[2]+m[2],M}function g(u,m,E){const _=E??new t(3);return Ae(u,_),K(_,m,_)}function l(u,m,E){const _=E??new t(3);return oe(u)>m?g(u,m,_):ee(u,_)}function h(u,m,E){const _=E??new t(3);return U(u,m,.5,_)}return{create:e,fromValues:n,set:r,ceil:s,floor:o,round:c,clamp:d,add:p,addScaled:T,angle:S,subtract:R,sub:x,equalsApproximately:G,equals:P,lerp:U,lerpV:H,max:X,min:$,mulScalar:K,scale:q,divScalar:te,inverse:Ce,invert:Me,cross:be,dot:Te,length:oe,len:De,lengthSq:me,lenSq:xe,distance:ae,dist:Q,distanceSq:z,distSq:Y,normalize:Ae,negate:Fe,copy:ee,clone:Ge,multiply:ye,mul:Le,divide:Ee,div:Re,random:ve,zero:I,transformMat4:F,transformMat4Upper3x3:y,transformMat3:a,transformQuat:A,getTranslation:f,getAxis:B,getScaling:C,rotateX:b,rotateY:w,rotateZ:i,setLength:g,truncate:l,midpoint:h}}const cache$4=new Map;function getAPI$4(t){let e=cache$4.get(t);return e||(e=getAPIImpl$4(t),cache$4.set(t,e)),e}function getAPIImpl$3(t){const e=getAPI$5(t),n=getAPI$4(t);function r(a,A,f,B,C,b,w,i,g){const l=new t(12);return l[3]=0,l[7]=0,l[11]=0,a!==void 0&&(l[0]=a,A!==void 0&&(l[1]=A,f!==void 0&&(l[2]=f,B!==void 0&&(l[4]=B,C!==void 0&&(l[5]=C,b!==void 0&&(l[6]=b,w!==void 0&&(l[8]=w,i!==void 0&&(l[9]=i,g!==void 0&&(l[10]=g))))))))),l}function s(a,A,f,B,C,b,w,i,g,l){const h=l??new t(12);return h[0]=a,h[1]=A,h[2]=f,h[3]=0,h[4]=B,h[5]=C,h[6]=b,h[7]=0,h[8]=w,h[9]=i,h[10]=g,h[11]=0,h}function o(a,A){const f=A??new t(12);return f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=0,f[4]=a[4],f[5]=a[5],f[6]=a[6],f[7]=0,f[8]=a[8],f[9]=a[9],f[10]=a[10],f[11]=0,f}function c(a,A){const f=A??new t(12),B=a[0],C=a[1],b=a[2],w=a[3],i=B+B,g=C+C,l=b+b,h=B*i,u=C*i,m=C*g,E=b*i,_=b*g,M=b*l,v=w*i,D=w*g,N=w*l;return f[0]=1-m-M,f[1]=u+N,f[2]=E-D,f[3]=0,f[4]=u-N,f[5]=1-h-M,f[6]=_+v,f[7]=0,f[8]=E+D,f[9]=_-v,f[10]=1-h-m,f[11]=0,f}function d(a,A){const f=A??new t(12);return f[0]=-a[0],f[1]=-a[1],f[2]=-a[2],f[4]=-a[4],f[5]=-a[5],f[6]=-a[6],f[8]=-a[8],f[9]=-a[9],f[10]=-a[10],f}function p(a,A,f){const B=f??new t(12);return B[0]=a[0]*A,B[1]=a[1]*A,B[2]=a[2]*A,B[4]=a[4]*A,B[5]=a[5]*A,B[6]=a[6]*A,B[8]=a[8]*A,B[9]=a[9]*A,B[10]=a[10]*A,B}const T=p;function S(a,A,f){const B=f??new t(12);return B[0]=a[0]+A[0],B[1]=a[1]+A[1],B[2]=a[2]+A[2],B[4]=a[4]+A[4],B[5]=a[5]+A[5],B[6]=a[6]+A[6],B[8]=a[8]+A[8],B[9]=a[9]+A[9],B[10]=a[10]+A[10],B}function R(a,A){const f=A??new t(12);return f[0]=a[0],f[1]=a[1],f[2]=a[2],f[4]=a[4],f[5]=a[5],f[6]=a[6],f[8]=a[8],f[9]=a[9],f[10]=a[10],f}const x=R;function G(a,A){return Math.abs(a[0]-A[0])<EPSILON&&Math.abs(a[1]-A[1])<EPSILON&&Math.abs(a[2]-A[2])<EPSILON&&Math.abs(a[4]-A[4])<EPSILON&&Math.abs(a[5]-A[5])<EPSILON&&Math.abs(a[6]-A[6])<EPSILON&&Math.abs(a[8]-A[8])<EPSILON&&Math.abs(a[9]-A[9])<EPSILON&&Math.abs(a[10]-A[10])<EPSILON}function P(a,A){return a[0]===A[0]&&a[1]===A[1]&&a[2]===A[2]&&a[4]===A[4]&&a[5]===A[5]&&a[6]===A[6]&&a[8]===A[8]&&a[9]===A[9]&&a[10]===A[10]}function U(a){const A=a??new t(12);return A[0]=1,A[1]=0,A[2]=0,A[4]=0,A[5]=1,A[6]=0,A[8]=0,A[9]=0,A[10]=1,A}function H(a,A){const f=A??new t(12);if(f===a){let m;return m=a[1],a[1]=a[4],a[4]=m,m=a[2],a[2]=a[8],a[8]=m,m=a[6],a[6]=a[9],a[9]=m,f}const B=a[0],C=a[1],b=a[2],w=a[4],i=a[5],g=a[6],l=a[8],h=a[9],u=a[10];return f[0]=B,f[1]=w,f[2]=l,f[4]=C,f[5]=i,f[6]=h,f[8]=b,f[9]=g,f[10]=u,f}function X(a,A){const f=A??new t(12),B=a[0],C=a[1],b=a[2],w=a[4],i=a[5],g=a[6],l=a[8],h=a[9],u=a[10],m=u*i-g*h,E=-u*w+g*l,_=h*w-i*l,M=1/(B*m+C*E+b*_);return f[0]=m*M,f[1]=(-u*C+b*h)*M,f[2]=(g*C-b*i)*M,f[4]=E*M,f[5]=(u*B-b*l)*M,f[6]=(-g*B+b*w)*M,f[8]=_*M,f[9]=(-h*B+C*l)*M,f[10]=(i*B-C*w)*M,f}function $(a){const A=a[0],f=a[1],B=a[2],C=a[4],b=a[5],w=a[6],i=a[8],g=a[9],l=a[10];return A*(b*l-g*w)-C*(f*l-g*B)+i*(f*w-b*B)}const K=X;function q(a,A,f){const B=f??new t(12),C=a[0],b=a[1],w=a[2],i=a[4],g=a[5],l=a[6],h=a[8],u=a[9],m=a[10],E=A[0],_=A[1],M=A[2],v=A[4],D=A[5],N=A[6],L=A[8],O=A[9],k=A[10];return B[0]=C*E+i*_+h*M,B[1]=b*E+g*_+u*M,B[2]=w*E+l*_+m*M,B[4]=C*v+i*D+h*N,B[5]=b*v+g*D+u*N,B[6]=w*v+l*D+m*N,B[8]=C*L+i*O+h*k,B[9]=b*L+g*O+u*k,B[10]=w*L+l*O+m*k,B}const te=q;function Ce(a,A,f){const B=f??U();return a!==B&&(B[0]=a[0],B[1]=a[1],B[2]=a[2],B[4]=a[4],B[5]=a[5],B[6]=a[6]),B[8]=A[0],B[9]=A[1],B[10]=1,B}function Me(a,A){const f=A??e.create();return f[0]=a[8],f[1]=a[9],f}function be(a,A,f){const B=f??e.create(),C=A*4;return B[0]=a[C+0],B[1]=a[C+1],B}function Te(a,A,f,B){const C=B===a?a:R(a,B),b=f*4;return C[b+0]=A[0],C[b+1]=A[1],C}function oe(a,A){const f=A??e.create(),B=a[0],C=a[1],b=a[4],w=a[5];return f[0]=Math.sqrt(B*B+C*C),f[1]=Math.sqrt(b*b+w*w),f}function De(a,A){const f=A??n.create(),B=a[0],C=a[1],b=a[2],w=a[4],i=a[5],g=a[6],l=a[8],h=a[9],u=a[10];return f[0]=Math.sqrt(B*B+C*C+b*b),f[1]=Math.sqrt(w*w+i*i+g*g),f[2]=Math.sqrt(l*l+h*h+u*u),f}function me(a,A){const f=A??new t(12);return f[0]=1,f[1]=0,f[2]=0,f[4]=0,f[5]=1,f[6]=0,f[8]=a[0],f[9]=a[1],f[10]=1,f}function xe(a,A,f){const B=f??new t(12),C=A[0],b=A[1],w=a[0],i=a[1],g=a[2],l=a[4],h=a[5],u=a[6],m=a[8],E=a[9],_=a[10];return a!==B&&(B[0]=w,B[1]=i,B[2]=g,B[4]=l,B[5]=h,B[6]=u),B[8]=w*C+l*b+m,B[9]=i*C+h*b+E,B[10]=g*C+u*b+_,B}function ae(a,A){const f=A??new t(12),B=Math.cos(a),C=Math.sin(a);return f[0]=B,f[1]=C,f[2]=0,f[4]=-C,f[5]=B,f[6]=0,f[8]=0,f[9]=0,f[10]=1,f}function Q(a,A,f){const B=f??new t(12),C=a[0],b=a[1],w=a[2],i=a[4],g=a[5],l=a[6],h=Math.cos(A),u=Math.sin(A);return B[0]=h*C+u*i,B[1]=h*b+u*g,B[2]=h*w+u*l,B[4]=h*i-u*C,B[5]=h*g-u*b,B[6]=h*l-u*w,a!==B&&(B[8]=a[8],B[9]=a[9],B[10]=a[10]),B}function z(a,A){const f=A??new t(12),B=Math.cos(a),C=Math.sin(a);return f[0]=1,f[1]=0,f[2]=0,f[4]=0,f[5]=B,f[6]=C,f[8]=0,f[9]=-C,f[10]=B,f}function Y(a,A,f){const B=f??new t(12),C=a[4],b=a[5],w=a[6],i=a[8],g=a[9],l=a[10],h=Math.cos(A),u=Math.sin(A);return B[4]=h*C+u*i,B[5]=h*b+u*g,B[6]=h*w+u*l,B[8]=h*i-u*C,B[9]=h*g-u*b,B[10]=h*l-u*w,a!==B&&(B[0]=a[0],B[1]=a[1],B[2]=a[2]),B}function Ae(a,A){const f=A??new t(12),B=Math.cos(a),C=Math.sin(a);return f[0]=B,f[1]=0,f[2]=-C,f[4]=0,f[5]=1,f[6]=0,f[8]=C,f[9]=0,f[10]=B,f}function Fe(a,A,f){const B=f??new t(12),C=a[0],b=a[1],w=a[2],i=a[8],g=a[9],l=a[10],h=Math.cos(A),u=Math.sin(A);return B[0]=h*C-u*i,B[1]=h*b-u*g,B[2]=h*w-u*l,B[8]=h*i+u*C,B[9]=h*g+u*b,B[10]=h*l+u*w,a!==B&&(B[4]=a[4],B[5]=a[5],B[6]=a[6]),B}const ee=ae,Ge=Q;function ye(a,A){const f=A??new t(12);return f[0]=a[0],f[1]=0,f[2]=0,f[4]=0,f[5]=a[1],f[6]=0,f[8]=0,f[9]=0,f[10]=1,f}function Le(a,A,f){const B=f??new t(12),C=A[0],b=A[1];return B[0]=C*a[0],B[1]=C*a[1],B[2]=C*a[2],B[4]=b*a[4],B[5]=b*a[5],B[6]=b*a[6],a!==B&&(B[8]=a[8],B[9]=a[9],B[10]=a[10]),B}function Ee(a,A){const f=A??new t(12);return f[0]=a[0],f[1]=0,f[2]=0,f[4]=0,f[5]=a[1],f[6]=0,f[8]=0,f[9]=0,f[10]=a[2],f}function Re(a,A,f){const B=f??new t(12),C=A[0],b=A[1],w=A[2];return B[0]=C*a[0],B[1]=C*a[1],B[2]=C*a[2],B[4]=b*a[4],B[5]=b*a[5],B[6]=b*a[6],B[8]=w*a[8],B[9]=w*a[9],B[10]=w*a[10],B}function ve(a,A){const f=A??new t(12);return f[0]=a,f[1]=0,f[2]=0,f[4]=0,f[5]=a,f[6]=0,f[8]=0,f[9]=0,f[10]=1,f}function I(a,A,f){const B=f??new t(12);return B[0]=A*a[0],B[1]=A*a[1],B[2]=A*a[2],B[4]=A*a[4],B[5]=A*a[5],B[6]=A*a[6],a!==B&&(B[8]=a[8],B[9]=a[9],B[10]=a[10]),B}function F(a,A){const f=A??new t(12);return f[0]=a,f[1]=0,f[2]=0,f[4]=0,f[5]=a,f[6]=0,f[8]=0,f[9]=0,f[10]=a,f}function y(a,A,f){const B=f??new t(12);return B[0]=A*a[0],B[1]=A*a[1],B[2]=A*a[2],B[4]=A*a[4],B[5]=A*a[5],B[6]=A*a[6],B[8]=A*a[8],B[9]=A*a[9],B[10]=A*a[10],B}return{add:S,clone:x,copy:R,create:r,determinant:$,equals:P,equalsApproximately:G,fromMat4:o,fromQuat:c,get3DScaling:De,getAxis:be,getScaling:oe,getTranslation:Me,identity:U,inverse:X,invert:K,mul:te,mulScalar:T,multiply:q,multiplyScalar:p,negate:d,rotate:Q,rotateX:Y,rotateY:Fe,rotateZ:Ge,rotation:ae,rotationX:z,rotationY:Ae,rotationZ:ee,scale:Le,scale3D:Re,scaling:ye,scaling3D:Ee,set:s,setAxis:Te,setTranslation:Ce,translate:xe,translation:me,transpose:H,uniformScale:I,uniformScale3D:y,uniformScaling:ve,uniformScaling3D:F}}const cache$3=new Map;function getAPI$3(t){let e=cache$3.get(t);return e||(e=getAPIImpl$3(t),cache$3.set(t,e)),e}function getAPIImpl$2(t){const e=getAPI$4(t);function n(i,g,l,h,u,m,E,_,M,v,D,N,L,O,k,j){const J=new t(16);return i!==void 0&&(J[0]=i,g!==void 0&&(J[1]=g,l!==void 0&&(J[2]=l,h!==void 0&&(J[3]=h,u!==void 0&&(J[4]=u,m!==void 0&&(J[5]=m,E!==void 0&&(J[6]=E,_!==void 0&&(J[7]=_,M!==void 0&&(J[8]=M,v!==void 0&&(J[9]=v,D!==void 0&&(J[10]=D,N!==void 0&&(J[11]=N,L!==void 0&&(J[12]=L,O!==void 0&&(J[13]=O,k!==void 0&&(J[14]=k,j!==void 0&&(J[15]=j)))))))))))))))),J}function r(i,g,l,h,u,m,E,_,M,v,D,N,L,O,k,j,J){const V=J??new t(16);return V[0]=i,V[1]=g,V[2]=l,V[3]=h,V[4]=u,V[5]=m,V[6]=E,V[7]=_,V[8]=M,V[9]=v,V[10]=D,V[11]=N,V[12]=L,V[13]=O,V[14]=k,V[15]=j,V}function s(i,g){const l=g??new t(16);return l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=0,l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=0,l[8]=i[8],l[9]=i[9],l[10]=i[10],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function o(i,g){const l=g??new t(16),h=i[0],u=i[1],m=i[2],E=i[3],_=h+h,M=u+u,v=m+m,D=h*_,N=u*_,L=u*M,O=m*_,k=m*M,j=m*v,J=E*_,V=E*M,Z=E*v;return l[0]=1-L-j,l[1]=N+Z,l[2]=O-V,l[3]=0,l[4]=N-Z,l[5]=1-D-j,l[6]=k+J,l[7]=0,l[8]=O+V,l[9]=k-J,l[10]=1-D-L,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function c(i,g){const l=g??new t(16);return l[0]=-i[0],l[1]=-i[1],l[2]=-i[2],l[3]=-i[3],l[4]=-i[4],l[5]=-i[5],l[6]=-i[6],l[7]=-i[7],l[8]=-i[8],l[9]=-i[9],l[10]=-i[10],l[11]=-i[11],l[12]=-i[12],l[13]=-i[13],l[14]=-i[14],l[15]=-i[15],l}function d(i,g,l){const h=l??new t(16);return h[0]=i[0]+g[0],h[1]=i[1]+g[1],h[2]=i[2]+g[2],h[3]=i[3]+g[3],h[4]=i[4]+g[4],h[5]=i[5]+g[5],h[6]=i[6]+g[6],h[7]=i[7]+g[7],h[8]=i[8]+g[8],h[9]=i[9]+g[9],h[10]=i[10]+g[10],h[11]=i[11]+g[11],h[12]=i[12]+g[12],h[13]=i[13]+g[13],h[14]=i[14]+g[14],h[15]=i[15]+g[15],h}function p(i,g,l){const h=l??new t(16);return h[0]=i[0]*g,h[1]=i[1]*g,h[2]=i[2]*g,h[3]=i[3]*g,h[4]=i[4]*g,h[5]=i[5]*g,h[6]=i[6]*g,h[7]=i[7]*g,h[8]=i[8]*g,h[9]=i[9]*g,h[10]=i[10]*g,h[11]=i[11]*g,h[12]=i[12]*g,h[13]=i[13]*g,h[14]=i[14]*g,h[15]=i[15]*g,h}const T=p;function S(i,g){const l=g??new t(16);return l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7],l[8]=i[8],l[9]=i[9],l[10]=i[10],l[11]=i[11],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15],l}const R=S;function x(i,g){return Math.abs(i[0]-g[0])<EPSILON&&Math.abs(i[1]-g[1])<EPSILON&&Math.abs(i[2]-g[2])<EPSILON&&Math.abs(i[3]-g[3])<EPSILON&&Math.abs(i[4]-g[4])<EPSILON&&Math.abs(i[5]-g[5])<EPSILON&&Math.abs(i[6]-g[6])<EPSILON&&Math.abs(i[7]-g[7])<EPSILON&&Math.abs(i[8]-g[8])<EPSILON&&Math.abs(i[9]-g[9])<EPSILON&&Math.abs(i[10]-g[10])<EPSILON&&Math.abs(i[11]-g[11])<EPSILON&&Math.abs(i[12]-g[12])<EPSILON&&Math.abs(i[13]-g[13])<EPSILON&&Math.abs(i[14]-g[14])<EPSILON&&Math.abs(i[15]-g[15])<EPSILON}function G(i,g){return i[0]===g[0]&&i[1]===g[1]&&i[2]===g[2]&&i[3]===g[3]&&i[4]===g[4]&&i[5]===g[5]&&i[6]===g[6]&&i[7]===g[7]&&i[8]===g[8]&&i[9]===g[9]&&i[10]===g[10]&&i[11]===g[11]&&i[12]===g[12]&&i[13]===g[13]&&i[14]===g[14]&&i[15]===g[15]}function P(i){const g=i??new t(16);return g[0]=1,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=1,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=1,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g}function U(i,g){const l=g??new t(16);if(l===i){let W;return W=i[1],i[1]=i[4],i[4]=W,W=i[2],i[2]=i[8],i[8]=W,W=i[3],i[3]=i[12],i[12]=W,W=i[6],i[6]=i[9],i[9]=W,W=i[7],i[7]=i[13],i[13]=W,W=i[11],i[11]=i[14],i[14]=W,l}const h=i[0],u=i[1],m=i[2],E=i[3],_=i[4],M=i[5],v=i[6],D=i[7],N=i[8],L=i[9],O=i[10],k=i[11],j=i[12],J=i[13],V=i[14],Z=i[15];return l[0]=h,l[1]=_,l[2]=N,l[3]=j,l[4]=u,l[5]=M,l[6]=L,l[7]=J,l[8]=m,l[9]=v,l[10]=O,l[11]=V,l[12]=E,l[13]=D,l[14]=k,l[15]=Z,l}function H(i,g){const l=g??new t(16),h=i[0],u=i[1],m=i[2],E=i[3],_=i[4],M=i[5],v=i[6],D=i[7],N=i[8],L=i[9],O=i[10],k=i[11],j=i[12],J=i[13],V=i[14],Z=i[15],W=O*Z,ne=V*k,re=v*Z,se=V*D,ie=v*k,ce=O*D,ue=m*Z,le=V*E,fe=m*k,de=O*E,ge=m*D,pe=v*E,Be=N*J,_e=j*L,we=_*J,Se=j*M,Ie=_*L,Oe=N*M,Pe=h*J,Ue=j*u,Ne=h*L,He=N*u,ke=h*M,Je=_*u,Ke=W*M+se*L+ie*J-(ne*M+re*L+ce*J),Ve=ne*u+ue*L+de*J-(W*u+le*L+fe*J),Xe=re*u+le*M+ge*J-(se*u+ue*M+pe*J),je=ce*u+fe*M+pe*L-(ie*u+de*M+ge*L),he=1/(h*Ke+_*Ve+N*Xe+j*je);return l[0]=he*Ke,l[1]=he*Ve,l[2]=he*Xe,l[3]=he*je,l[4]=he*(ne*_+re*N+ce*j-(W*_+se*N+ie*j)),l[5]=he*(W*h+le*N+fe*j-(ne*h+ue*N+de*j)),l[6]=he*(se*h+ue*_+pe*j-(re*h+le*_+ge*j)),l[7]=he*(ie*h+de*_+ge*N-(ce*h+fe*_+pe*N)),l[8]=he*(Be*D+Se*k+Ie*Z-(_e*D+we*k+Oe*Z)),l[9]=he*(_e*E+Pe*k+He*Z-(Be*E+Ue*k+Ne*Z)),l[10]=he*(we*E+Ue*D+ke*Z-(Se*E+Pe*D+Je*Z)),l[11]=he*(Oe*E+Ne*D+Je*k-(Ie*E+He*D+ke*k)),l[12]=he*(we*O+Oe*V+_e*v-(Ie*V+Be*v+Se*O)),l[13]=he*(Ne*V+Be*m+Ue*O-(Pe*O+He*V+_e*m)),l[14]=he*(Pe*v+Je*V+Se*m-(ke*V+we*m+Ue*v)),l[15]=he*(ke*O+Ie*m+He*v-(Ne*v+Je*O+Oe*m)),l}function X(i){const g=i[0],l=i[1],h=i[2],u=i[3],m=i[4],E=i[5],_=i[6],M=i[7],v=i[8],D=i[9],N=i[10],L=i[11],O=i[12],k=i[13],j=i[14],J=i[15],V=N*J,Z=j*L,W=_*J,ne=j*M,re=_*L,se=N*M,ie=h*J,ce=j*u,ue=h*L,le=N*u,fe=h*M,de=_*u,ge=V*E+ne*D+re*k-(Z*E+W*D+se*k),pe=Z*l+ie*D+le*k-(V*l+ce*D+ue*k),Be=W*l+ce*E+fe*k-(ne*l+ie*E+de*k),_e=se*l+ue*E+de*D-(re*l+le*E+fe*D);return g*ge+m*pe+v*Be+O*_e}const $=H;function K(i,g,l){const h=l??new t(16),u=i[0],m=i[1],E=i[2],_=i[3],M=i[4],v=i[5],D=i[6],N=i[7],L=i[8],O=i[9],k=i[10],j=i[11],J=i[12],V=i[13],Z=i[14],W=i[15],ne=g[0],re=g[1],se=g[2],ie=g[3],ce=g[4],ue=g[5],le=g[6],fe=g[7],de=g[8],ge=g[9],pe=g[10],Be=g[11],_e=g[12],we=g[13],Se=g[14],Ie=g[15];return h[0]=u*ne+M*re+L*se+J*ie,h[1]=m*ne+v*re+O*se+V*ie,h[2]=E*ne+D*re+k*se+Z*ie,h[3]=_*ne+N*re+j*se+W*ie,h[4]=u*ce+M*ue+L*le+J*fe,h[5]=m*ce+v*ue+O*le+V*fe,h[6]=E*ce+D*ue+k*le+Z*fe,h[7]=_*ce+N*ue+j*le+W*fe,h[8]=u*de+M*ge+L*pe+J*Be,h[9]=m*de+v*ge+O*pe+V*Be,h[10]=E*de+D*ge+k*pe+Z*Be,h[11]=_*de+N*ge+j*pe+W*Be,h[12]=u*_e+M*we+L*Se+J*Ie,h[13]=m*_e+v*we+O*Se+V*Ie,h[14]=E*_e+D*we+k*Se+Z*Ie,h[15]=_*_e+N*we+j*Se+W*Ie,h}const q=K;function te(i,g,l){const h=l??P();return i!==h&&(h[0]=i[0],h[1]=i[1],h[2]=i[2],h[3]=i[3],h[4]=i[4],h[5]=i[5],h[6]=i[6],h[7]=i[7],h[8]=i[8],h[9]=i[9],h[10]=i[10],h[11]=i[11]),h[12]=g[0],h[13]=g[1],h[14]=g[2],h[15]=1,h}function Ce(i,g){const l=g??e.create();return l[0]=i[12],l[1]=i[13],l[2]=i[14],l}function Me(i,g,l){const h=l??e.create(),u=g*4;return h[0]=i[u+0],h[1]=i[u+1],h[2]=i[u+2],h}function be(i,g,l,h){const u=h===i?h:S(i,h),m=l*4;return u[m+0]=g[0],u[m+1]=g[1],u[m+2]=g[2],u}function Te(i,g){const l=g??e.create(),h=i[0],u=i[1],m=i[2],E=i[4],_=i[5],M=i[6],v=i[8],D=i[9],N=i[10];return l[0]=Math.sqrt(h*h+u*u+m*m),l[1]=Math.sqrt(E*E+_*_+M*M),l[2]=Math.sqrt(v*v+D*D+N*N),l}function oe(i,g,l,h,u){const m=u??new t(16),E=Math.tan(Math.PI*.5-.5*i);if(m[0]=E/g,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=E,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[11]=-1,m[12]=0,m[13]=0,m[15]=0,Number.isFinite(h)){const _=1/(l-h);m[10]=h*_,m[14]=h*l*_}else m[10]=-1,m[14]=-l;return m}function De(i,g,l,h=1/0,u){const m=u??new t(16),E=1/Math.tan(i*.5);if(m[0]=E/g,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=E,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[11]=-1,m[12]=0,m[13]=0,m[15]=0,h===1/0)m[10]=0,m[14]=l;else{const _=1/(h-l);m[10]=l*_,m[14]=h*l*_}return m}function me(i,g,l,h,u,m,E){const _=E??new t(16);return _[0]=2/(g-i),_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2/(h-l),_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1/(u-m),_[11]=0,_[12]=(g+i)/(i-g),_[13]=(h+l)/(l-h),_[14]=u/(u-m),_[15]=1,_}function xe(i,g,l,h,u,m,E){const _=E??new t(16),M=g-i,v=h-l,D=u-m;return _[0]=2*u/M,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*u/v,_[6]=0,_[7]=0,_[8]=(i+g)/M,_[9]=(h+l)/v,_[10]=m/D,_[11]=-1,_[12]=0,_[13]=0,_[14]=u*m/D,_[15]=0,_}function ae(i,g,l,h,u,m=1/0,E){const _=E??new t(16),M=g-i,v=h-l;if(_[0]=2*u/M,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*u/v,_[6]=0,_[7]=0,_[8]=(i+g)/M,_[9]=(h+l)/v,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,m===1/0)_[10]=0,_[14]=u;else{const D=1/(m-u);_[10]=u*D,_[14]=m*u*D}return _}const Q=e.create(),z=e.create(),Y=e.create();function Ae(i,g,l,h){const u=h??new t(16);return e.normalize(e.subtract(g,i,Y),Y),e.normalize(e.cross(l,Y,Q),Q),e.normalize(e.cross(Y,Q,z),z),u[0]=Q[0],u[1]=Q[1],u[2]=Q[2],u[3]=0,u[4]=z[0],u[5]=z[1],u[6]=z[2],u[7]=0,u[8]=Y[0],u[9]=Y[1],u[10]=Y[2],u[11]=0,u[12]=i[0],u[13]=i[1],u[14]=i[2],u[15]=1,u}function Fe(i,g,l,h){const u=h??new t(16);return e.normalize(e.subtract(i,g,Y),Y),e.normalize(e.cross(l,Y,Q),Q),e.normalize(e.cross(Y,Q,z),z),u[0]=Q[0],u[1]=Q[1],u[2]=Q[2],u[3]=0,u[4]=z[0],u[5]=z[1],u[6]=z[2],u[7]=0,u[8]=Y[0],u[9]=Y[1],u[10]=Y[2],u[11]=0,u[12]=i[0],u[13]=i[1],u[14]=i[2],u[15]=1,u}function ee(i,g,l,h){const u=h??new t(16);return e.normalize(e.subtract(i,g,Y),Y),e.normalize(e.cross(l,Y,Q),Q),e.normalize(e.cross(Y,Q,z),z),u[0]=Q[0],u[1]=z[0],u[2]=Y[0],u[3]=0,u[4]=Q[1],u[5]=z[1],u[6]=Y[1],u[7]=0,u[8]=Q[2],u[9]=z[2],u[10]=Y[2],u[11]=0,u[12]=-(Q[0]*i[0]+Q[1]*i[1]+Q[2]*i[2]),u[13]=-(z[0]*i[0]+z[1]*i[1]+z[2]*i[2]),u[14]=-(Y[0]*i[0]+Y[1]*i[1]+Y[2]*i[2]),u[15]=1,u}function Ge(i,g){const l=g??new t(16);return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=i[0],l[13]=i[1],l[14]=i[2],l[15]=1,l}function ye(i,g,l){const h=l??new t(16),u=g[0],m=g[1],E=g[2],_=i[0],M=i[1],v=i[2],D=i[3],N=i[4],L=i[5],O=i[6],k=i[7],j=i[8],J=i[9],V=i[10],Z=i[11],W=i[12],ne=i[13],re=i[14],se=i[15];return i!==h&&(h[0]=_,h[1]=M,h[2]=v,h[3]=D,h[4]=N,h[5]=L,h[6]=O,h[7]=k,h[8]=j,h[9]=J,h[10]=V,h[11]=Z),h[12]=_*u+N*m+j*E+W,h[13]=M*u+L*m+J*E+ne,h[14]=v*u+O*m+V*E+re,h[15]=D*u+k*m+Z*E+se,h}function Le(i,g){const l=g??new t(16),h=Math.cos(i),u=Math.sin(i);return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=h,l[6]=u,l[7]=0,l[8]=0,l[9]=-u,l[10]=h,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function Ee(i,g,l){const h=l??new t(16),u=i[4],m=i[5],E=i[6],_=i[7],M=i[8],v=i[9],D=i[10],N=i[11],L=Math.cos(g),O=Math.sin(g);return h[4]=L*u+O*M,h[5]=L*m+O*v,h[6]=L*E+O*D,h[7]=L*_+O*N,h[8]=L*M-O*u,h[9]=L*v-O*m,h[10]=L*D-O*E,h[11]=L*N-O*_,i!==h&&(h[0]=i[0],h[1]=i[1],h[2]=i[2],h[3]=i[3],h[12]=i[12],h[13]=i[13],h[14]=i[14],h[15]=i[15]),h}function Re(i,g){const l=g??new t(16),h=Math.cos(i),u=Math.sin(i);return l[0]=h,l[1]=0,l[2]=-u,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=u,l[9]=0,l[10]=h,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function ve(i,g,l){const h=l??new t(16),u=i[0],m=i[1],E=i[2],_=i[3],M=i[8],v=i[9],D=i[10],N=i[11],L=Math.cos(g),O=Math.sin(g);return h[0]=L*u-O*M,h[1]=L*m-O*v,h[2]=L*E-O*D,h[3]=L*_-O*N,h[8]=L*M+O*u,h[9]=L*v+O*m,h[10]=L*D+O*E,h[11]=L*N+O*_,i!==h&&(h[4]=i[4],h[5]=i[5],h[6]=i[6],h[7]=i[7],h[12]=i[12],h[13]=i[13],h[14]=i[14],h[15]=i[15]),h}function I(i,g){const l=g??new t(16),h=Math.cos(i),u=Math.sin(i);return l[0]=h,l[1]=u,l[2]=0,l[3]=0,l[4]=-u,l[5]=h,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function F(i,g,l){const h=l??new t(16),u=i[0],m=i[1],E=i[2],_=i[3],M=i[4],v=i[5],D=i[6],N=i[7],L=Math.cos(g),O=Math.sin(g);return h[0]=L*u+O*M,h[1]=L*m+O*v,h[2]=L*E+O*D,h[3]=L*_+O*N,h[4]=L*M-O*u,h[5]=L*v-O*m,h[6]=L*D-O*E,h[7]=L*N-O*_,i!==h&&(h[8]=i[8],h[9]=i[9],h[10]=i[10],h[11]=i[11],h[12]=i[12],h[13]=i[13],h[14]=i[14],h[15]=i[15]),h}function y(i,g,l){const h=l??new t(16);let u=i[0],m=i[1],E=i[2];const _=Math.sqrt(u*u+m*m+E*E);u/=_,m/=_,E/=_;const M=u*u,v=m*m,D=E*E,N=Math.cos(g),L=Math.sin(g),O=1-N;return h[0]=M+(1-M)*N,h[1]=u*m*O+E*L,h[2]=u*E*O-m*L,h[3]=0,h[4]=u*m*O-E*L,h[5]=v+(1-v)*N,h[6]=m*E*O+u*L,h[7]=0,h[8]=u*E*O+m*L,h[9]=m*E*O-u*L,h[10]=D+(1-D)*N,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}const a=y;function A(i,g,l,h){const u=h??new t(16);let m=g[0],E=g[1],_=g[2];const M=Math.sqrt(m*m+E*E+_*_);m/=M,E/=M,_/=M;const v=m*m,D=E*E,N=_*_,L=Math.cos(l),O=Math.sin(l),k=1-L,j=v+(1-v)*L,J=m*E*k+_*O,V=m*_*k-E*O,Z=m*E*k-_*O,W=D+(1-D)*L,ne=E*_*k+m*O,re=m*_*k+E*O,se=E*_*k-m*O,ie=N+(1-N)*L,ce=i[0],ue=i[1],le=i[2],fe=i[3],de=i[4],ge=i[5],pe=i[6],Be=i[7],_e=i[8],we=i[9],Se=i[10],Ie=i[11];return u[0]=j*ce+J*de+V*_e,u[1]=j*ue+J*ge+V*we,u[2]=j*le+J*pe+V*Se,u[3]=j*fe+J*Be+V*Ie,u[4]=Z*ce+W*de+ne*_e,u[5]=Z*ue+W*ge+ne*we,u[6]=Z*le+W*pe+ne*Se,u[7]=Z*fe+W*Be+ne*Ie,u[8]=re*ce+se*de+ie*_e,u[9]=re*ue+se*ge+ie*we,u[10]=re*le+se*pe+ie*Se,u[11]=re*fe+se*Be+ie*Ie,i!==u&&(u[12]=i[12],u[13]=i[13],u[14]=i[14],u[15]=i[15]),u}const f=A;function B(i,g){const l=g??new t(16);return l[0]=i[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=i[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=i[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function C(i,g,l){const h=l??new t(16),u=g[0],m=g[1],E=g[2];return h[0]=u*i[0],h[1]=u*i[1],h[2]=u*i[2],h[3]=u*i[3],h[4]=m*i[4],h[5]=m*i[5],h[6]=m*i[6],h[7]=m*i[7],h[8]=E*i[8],h[9]=E*i[9],h[10]=E*i[10],h[11]=E*i[11],i!==h&&(h[12]=i[12],h[13]=i[13],h[14]=i[14],h[15]=i[15]),h}function b(i,g){const l=g??new t(16);return l[0]=i,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=i,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=i,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function w(i,g,l){const h=l??new t(16);return h[0]=g*i[0],h[1]=g*i[1],h[2]=g*i[2],h[3]=g*i[3],h[4]=g*i[4],h[5]=g*i[5],h[6]=g*i[6],h[7]=g*i[7],h[8]=g*i[8],h[9]=g*i[9],h[10]=g*i[10],h[11]=g*i[11],i!==h&&(h[12]=i[12],h[13]=i[13],h[14]=i[14],h[15]=i[15]),h}return{add:d,aim:Ae,axisRotate:A,axisRotation:y,cameraAim:Fe,clone:R,copy:S,create:n,determinant:X,equals:G,equalsApproximately:x,fromMat3:s,fromQuat:o,frustum:xe,frustumReverseZ:ae,getAxis:Me,getScaling:Te,getTranslation:Ce,identity:P,inverse:H,invert:$,lookAt:ee,mul:q,mulScalar:T,multiply:K,multiplyScalar:p,negate:c,ortho:me,perspective:oe,perspectiveReverseZ:De,rotate:f,rotateX:Ee,rotateY:ve,rotateZ:F,rotation:a,rotationX:Le,rotationY:Re,rotationZ:I,scale:C,scaling:B,set:r,setAxis:be,setTranslation:te,translate:ye,translation:Ge,transpose:U,uniformScale:w,uniformScaling:b}}const cache$2=new Map;function getAPI$2(t){let e=cache$2.get(t);return e||(e=getAPIImpl$2(t),cache$2.set(t,e)),e}function getAPIImpl$1(t){const e=getAPI$4(t);function n(I,F,y,a){const A=new t(4);return I!==void 0&&(A[0]=I,F!==void 0&&(A[1]=F,y!==void 0&&(A[2]=y,a!==void 0&&(A[3]=a)))),A}const r=n;function s(I,F,y,a,A){const f=A??new t(4);return f[0]=I,f[1]=F,f[2]=y,f[3]=a,f}function o(I,F,y){const a=y??new t(4),A=F*.5,f=Math.sin(A);return a[0]=f*I[0],a[1]=f*I[1],a[2]=f*I[2],a[3]=Math.cos(A),a}function c(I,F){const y=F??e.create(3),a=Math.acos(I[3])*2,A=Math.sin(a*.5);return A>EPSILON?(y[0]=I[0]/A,y[1]=I[1]/A,y[2]=I[2]/A):(y[0]=1,y[1]=0,y[2]=0),{angle:a,axis:y}}function d(I,F){const y=oe(I,F);return Math.acos(2*y*y-1)}function p(I,F,y){const a=y??new t(4),A=I[0],f=I[1],B=I[2],C=I[3],b=F[0],w=F[1],i=F[2],g=F[3];return a[0]=A*g+C*b+f*i-B*w,a[1]=f*g+C*w+B*b-A*i,a[2]=B*g+C*i+A*w-f*b,a[3]=C*g-A*b-f*w-B*i,a}const T=p;function S(I,F,y){const a=y??new t(4),A=F*.5,f=I[0],B=I[1],C=I[2],b=I[3],w=Math.sin(A),i=Math.cos(A);return a[0]=f*i+b*w,a[1]=B*i+C*w,a[2]=C*i-B*w,a[3]=b*i-f*w,a}function R(I,F,y){const a=y??new t(4),A=F*.5,f=I[0],B=I[1],C=I[2],b=I[3],w=Math.sin(A),i=Math.cos(A);return a[0]=f*i-C*w,a[1]=B*i+b*w,a[2]=C*i+f*w,a[3]=b*i-B*w,a}function x(I,F,y){const a=y??new t(4),A=F*.5,f=I[0],B=I[1],C=I[2],b=I[3],w=Math.sin(A),i=Math.cos(A);return a[0]=f*i+B*w,a[1]=B*i-f*w,a[2]=C*i+b*w,a[3]=b*i-C*w,a}function G(I,F,y,a){const A=a??new t(4),f=I[0],B=I[1],C=I[2],b=I[3];let w=F[0],i=F[1],g=F[2],l=F[3],h=f*w+B*i+C*g+b*l;h<0&&(h=-h,w=-w,i=-i,g=-g,l=-l);let u,m;if(1-h>EPSILON){const E=Math.acos(h),_=Math.sin(E);u=Math.sin((1-y)*E)/_,m=Math.sin(y*E)/_}else u=1-y,m=y;return A[0]=u*f+m*w,A[1]=u*B+m*i,A[2]=u*C+m*g,A[3]=u*b+m*l,A}function P(I,F){const y=F??new t(4),a=I[0],A=I[1],f=I[2],B=I[3],C=a*a+A*A+f*f+B*B,b=C?1/C:0;return y[0]=-a*b,y[1]=-A*b,y[2]=-f*b,y[3]=B*b,y}function U(I,F){const y=F??new t(4);return y[0]=-I[0],y[1]=-I[1],y[2]=-I[2],y[3]=I[3],y}function H(I,F){const y=F??new t(4),a=I[0]+I[5]+I[10];if(a>0){const A=Math.sqrt(a+1);y[3]=.5*A;const f=.5/A;y[0]=(I[6]-I[9])*f,y[1]=(I[8]-I[2])*f,y[2]=(I[1]-I[4])*f}else{let A=0;I[5]>I[0]&&(A=1),I[10]>I[A*4+A]&&(A=2);const f=(A+1)%3,B=(A+2)%3,C=Math.sqrt(I[A*4+A]-I[f*4+f]-I[B*4+B]+1);y[A]=.5*C;const b=.5/C;y[3]=(I[f*4+B]-I[B*4+f])*b,y[f]=(I[f*4+A]+I[A*4+f])*b,y[B]=(I[B*4+A]+I[A*4+B])*b}return y}function X(I,F,y,a,A){const f=A??new t(4),B=I*.5,C=F*.5,b=y*.5,w=Math.sin(B),i=Math.cos(B),g=Math.sin(C),l=Math.cos(C),h=Math.sin(b),u=Math.cos(b);switch(a){case"xyz":f[0]=w*l*u+i*g*h,f[1]=i*g*u-w*l*h,f[2]=i*l*h+w*g*u,f[3]=i*l*u-w*g*h;break;case"xzy":f[0]=w*l*u-i*g*h,f[1]=i*g*u-w*l*h,f[2]=i*l*h+w*g*u,f[3]=i*l*u+w*g*h;break;case"yxz":f[0]=w*l*u+i*g*h,f[1]=i*g*u-w*l*h,f[2]=i*l*h-w*g*u,f[3]=i*l*u+w*g*h;break;case"yzx":f[0]=w*l*u+i*g*h,f[1]=i*g*u+w*l*h,f[2]=i*l*h-w*g*u,f[3]=i*l*u-w*g*h;break;case"zxy":f[0]=w*l*u-i*g*h,f[1]=i*g*u+w*l*h,f[2]=i*l*h+w*g*u,f[3]=i*l*u-w*g*h;break;case"zyx":f[0]=w*l*u-i*g*h,f[1]=i*g*u+w*l*h,f[2]=i*l*h-w*g*u,f[3]=i*l*u+w*g*h;break;default:throw new Error(`Unknown rotation order: ${a}`)}return f}function $(I,F){const y=F??new t(4);return y[0]=I[0],y[1]=I[1],y[2]=I[2],y[3]=I[3],y}const K=$;function q(I,F,y){const a=y??new t(4);return a[0]=I[0]+F[0],a[1]=I[1]+F[1],a[2]=I[2]+F[2],a[3]=I[3]+F[3],a}function te(I,F,y){const a=y??new t(4);return a[0]=I[0]-F[0],a[1]=I[1]-F[1],a[2]=I[2]-F[2],a[3]=I[3]-F[3],a}const Ce=te;function Me(I,F,y){const a=y??new t(4);return a[0]=I[0]*F,a[1]=I[1]*F,a[2]=I[2]*F,a[3]=I[3]*F,a}const be=Me;function Te(I,F,y){const a=y??new t(4);return a[0]=I[0]/F,a[1]=I[1]/F,a[2]=I[2]/F,a[3]=I[3]/F,a}function oe(I,F){return I[0]*F[0]+I[1]*F[1]+I[2]*F[2]+I[3]*F[3]}function De(I,F,y,a){const A=a??new t(4);return A[0]=I[0]+y*(F[0]-I[0]),A[1]=I[1]+y*(F[1]-I[1]),A[2]=I[2]+y*(F[2]-I[2]),A[3]=I[3]+y*(F[3]-I[3]),A}function me(I){const F=I[0],y=I[1],a=I[2],A=I[3];return Math.sqrt(F*F+y*y+a*a+A*A)}const xe=me;function ae(I){const F=I[0],y=I[1],a=I[2],A=I[3];return F*F+y*y+a*a+A*A}const Q=ae;function z(I,F){const y=F??new t(4),a=I[0],A=I[1],f=I[2],B=I[3],C=Math.sqrt(a*a+A*A+f*f+B*B);return C>1e-5?(y[0]=a/C,y[1]=A/C,y[2]=f/C,y[3]=B/C):(y[0]=0,y[1]=0,y[2]=0,y[3]=1),y}function Y(I,F){return Math.abs(I[0]-F[0])<EPSILON&&Math.abs(I[1]-F[1])<EPSILON&&Math.abs(I[2]-F[2])<EPSILON&&Math.abs(I[3]-F[3])<EPSILON}function Ae(I,F){return I[0]===F[0]&&I[1]===F[1]&&I[2]===F[2]&&I[3]===F[3]}function Fe(I){const F=I??new t(4);return F[0]=0,F[1]=0,F[2]=0,F[3]=1,F}const ee=e.create(),Ge=e.create(),ye=e.create();function Le(I,F,y){const a=y??new t(4),A=e.dot(I,F);return A<-.999999?(e.cross(Ge,I,ee),e.len(ee)<1e-6&&e.cross(ye,I,ee),e.normalize(ee,ee),o(ee,Math.PI,a),a):A>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(e.cross(I,F,ee),a[0]=ee[0],a[1]=ee[1],a[2]=ee[2],a[3]=1+A,z(a,a))}const Ee=new t(4),Re=new t(4);function ve(I,F,y,a,A,f){const B=f??new t(4);return G(I,a,A,Ee),G(F,y,A,Re),G(Ee,Re,2*A*(1-A),B),B}return{create:n,fromValues:r,set:s,fromAxisAngle:o,toAxisAngle:c,angle:d,multiply:p,mul:T,rotateX:S,rotateY:R,rotateZ:x,slerp:G,inverse:P,conjugate:U,fromMat:H,fromEuler:X,copy:$,clone:K,add:q,subtract:te,sub:Ce,mulScalar:Me,scale:be,divScalar:Te,dot:oe,lerp:De,length:me,len:xe,lengthSq:ae,lenSq:Q,normalize:z,equalsApproximately:Y,equals:Ae,identity:Fe,rotationTo:Le,sqlerp:ve}}const cache$1=new Map;function getAPI$1(t){let e=cache$1.get(t);return e||(e=getAPIImpl$1(t),cache$1.set(t,e)),e}function getAPIImpl(t){function e(y,a,A,f){const B=new t(4);return y!==void 0&&(B[0]=y,a!==void 0&&(B[1]=a,A!==void 0&&(B[2]=A,f!==void 0&&(B[3]=f)))),B}const n=e;function r(y,a,A,f,B){const C=B??new t(4);return C[0]=y,C[1]=a,C[2]=A,C[3]=f,C}function s(y,a){const A=a??new t(4);return A[0]=Math.ceil(y[0]),A[1]=Math.ceil(y[1]),A[2]=Math.ceil(y[2]),A[3]=Math.ceil(y[3]),A}function o(y,a){const A=a??new t(4);return A[0]=Math.floor(y[0]),A[1]=Math.floor(y[1]),A[2]=Math.floor(y[2]),A[3]=Math.floor(y[3]),A}function c(y,a){const A=a??new t(4);return A[0]=Math.round(y[0]),A[1]=Math.round(y[1]),A[2]=Math.round(y[2]),A[3]=Math.round(y[3]),A}function d(y,a=0,A=1,f){const B=f??new t(4);return B[0]=Math.min(A,Math.max(a,y[0])),B[1]=Math.min(A,Math.max(a,y[1])),B[2]=Math.min(A,Math.max(a,y[2])),B[3]=Math.min(A,Math.max(a,y[3])),B}function p(y,a,A){const f=A??new t(4);return f[0]=y[0]+a[0],f[1]=y[1]+a[1],f[2]=y[2]+a[2],f[3]=y[3]+a[3],f}function T(y,a,A,f){const B=f??new t(4);return B[0]=y[0]+a[0]*A,B[1]=y[1]+a[1]*A,B[2]=y[2]+a[2]*A,B[3]=y[3]+a[3]*A,B}function S(y,a,A){const f=A??new t(4);return f[0]=y[0]-a[0],f[1]=y[1]-a[1],f[2]=y[2]-a[2],f[3]=y[3]-a[3],f}const R=S;function x(y,a){return Math.abs(y[0]-a[0])<EPSILON&&Math.abs(y[1]-a[1])<EPSILON&&Math.abs(y[2]-a[2])<EPSILON&&Math.abs(y[3]-a[3])<EPSILON}function G(y,a){return y[0]===a[0]&&y[1]===a[1]&&y[2]===a[2]&&y[3]===a[3]}function P(y,a,A,f){const B=f??new t(4);return B[0]=y[0]+A*(a[0]-y[0]),B[1]=y[1]+A*(a[1]-y[1]),B[2]=y[2]+A*(a[2]-y[2]),B[3]=y[3]+A*(a[3]-y[3]),B}function U(y,a,A,f){const B=f??new t(4);return B[0]=y[0]+A[0]*(a[0]-y[0]),B[1]=y[1]+A[1]*(a[1]-y[1]),B[2]=y[2]+A[2]*(a[2]-y[2]),B[3]=y[3]+A[3]*(a[3]-y[3]),B}function H(y,a,A){const f=A??new t(4);return f[0]=Math.max(y[0],a[0]),f[1]=Math.max(y[1],a[1]),f[2]=Math.max(y[2],a[2]),f[3]=Math.max(y[3],a[3]),f}function X(y,a,A){const f=A??new t(4);return f[0]=Math.min(y[0],a[0]),f[1]=Math.min(y[1],a[1]),f[2]=Math.min(y[2],a[2]),f[3]=Math.min(y[3],a[3]),f}function $(y,a,A){const f=A??new t(4);return f[0]=y[0]*a,f[1]=y[1]*a,f[2]=y[2]*a,f[3]=y[3]*a,f}const K=$;function q(y,a,A){const f=A??new t(4);return f[0]=y[0]/a,f[1]=y[1]/a,f[2]=y[2]/a,f[3]=y[3]/a,f}function te(y,a){const A=a??new t(4);return A[0]=1/y[0],A[1]=1/y[1],A[2]=1/y[2],A[3]=1/y[3],A}const Ce=te;function Me(y,a){return y[0]*a[0]+y[1]*a[1]+y[2]*a[2]+y[3]*a[3]}function be(y){const a=y[0],A=y[1],f=y[2],B=y[3];return Math.sqrt(a*a+A*A+f*f+B*B)}const Te=be;function oe(y){const a=y[0],A=y[1],f=y[2],B=y[3];return a*a+A*A+f*f+B*B}const De=oe;function me(y,a){const A=y[0]-a[0],f=y[1]-a[1],B=y[2]-a[2],C=y[3]-a[3];return Math.sqrt(A*A+f*f+B*B+C*C)}const xe=me;function ae(y,a){const A=y[0]-a[0],f=y[1]-a[1],B=y[2]-a[2],C=y[3]-a[3];return A*A+f*f+B*B+C*C}const Q=ae;function z(y,a){const A=a??new t(4),f=y[0],B=y[1],C=y[2],b=y[3],w=Math.sqrt(f*f+B*B+C*C+b*b);return w>1e-5?(A[0]=f/w,A[1]=B/w,A[2]=C/w,A[3]=b/w):(A[0]=0,A[1]=0,A[2]=0,A[3]=0),A}function Y(y,a){const A=a??new t(4);return A[0]=-y[0],A[1]=-y[1],A[2]=-y[2],A[3]=-y[3],A}function Ae(y,a){const A=a??new t(4);return A[0]=y[0],A[1]=y[1],A[2]=y[2],A[3]=y[3],A}const Fe=Ae;function ee(y,a,A){const f=A??new t(4);return f[0]=y[0]*a[0],f[1]=y[1]*a[1],f[2]=y[2]*a[2],f[3]=y[3]*a[3],f}const Ge=ee;function ye(y,a,A){const f=A??new t(4);return f[0]=y[0]/a[0],f[1]=y[1]/a[1],f[2]=y[2]/a[2],f[3]=y[3]/a[3],f}const Le=ye;function Ee(y){const a=y??new t(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a}function Re(y,a,A){const f=A??new t(4),B=y[0],C=y[1],b=y[2],w=y[3];return f[0]=a[0]*B+a[4]*C+a[8]*b+a[12]*w,f[1]=a[1]*B+a[5]*C+a[9]*b+a[13]*w,f[2]=a[2]*B+a[6]*C+a[10]*b+a[14]*w,f[3]=a[3]*B+a[7]*C+a[11]*b+a[15]*w,f}function ve(y,a,A){const f=A??new t(4);return z(y,f),$(f,a,f)}function I(y,a,A){const f=A??new t(4);return be(y)>a?ve(y,a,f):Ae(y,f)}function F(y,a,A){const f=A??new t(4);return P(y,a,.5,f)}return{create:e,fromValues:n,set:r,ceil:s,floor:o,round:c,clamp:d,add:p,addScaled:T,subtract:S,sub:R,equalsApproximately:x,equals:G,lerp:P,lerpV:U,max:H,min:X,mulScalar:$,scale:K,divScalar:q,inverse:te,invert:Ce,dot:Me,length:be,len:Te,lengthSq:oe,lenSq:De,distance:me,dist:xe,distanceSq:ae,distSq:Q,normalize:z,negate:Y,copy:Ae,clone:Fe,multiply:ee,mul:Ge,divide:ye,div:Le,zero:Ee,transformMat4:Re,setLength:ve,truncate:I,midpoint:F}}const cache=new Map;function getAPI(t){let e=cache.get(t);return e||(e=getAPIImpl(t),cache.set(t,e)),e}function wgpuMatrixAPI(t,e,n,r,s,o){return{mat3:getAPI$3(t),mat4:getAPI$2(e),quat:getAPI$1(n),vec2:getAPI$5(r),vec3:getAPI$4(s),vec4:getAPI(o)}}const{mat4,vec3}=wgpuMatrixAPI(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);wgpuMatrixAPI(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);wgpuMatrixAPI(ZeroArray,Array,Array,Array,Array,Array);function setupLoaders(){registerLoaders([GLTFLoader,ImageLoader])}function getFloatArray(t,e){const n=t.json,r=n.accessors[e],s=n.bufferViews[r.bufferView],o=t.buffers[s.buffer],c=(r.byteOffset??0)+(s.byteOffset??0)+o.byteOffset;return new Float32Array(o.arrayBuffer,c,s.byteLength/4)}class Texture{image;sampler;constructor(e,n){this.image=e,this.sampler=n}}class Material{static nextId=0;id;materialBindGroup;constructor(e,n){this.id=Material.nextId++;const r=n[e.pbrMetallicRoughness.baseColorTexture.index];this.materialBindGroup=device.createBindGroup({label:"material bind group",layout:materialBindGroupLayout,entries:[{binding:0,resource:r.image.createView()},{binding:1,resource:r.sampler}]})}}class Primitive{vertexBuffer;indexBuffer;numIndices=-1;material;constructor(e,n,r){this.material=r;const s=n.json,o=s.accessors[e.indices],c=s.bufferViews[o.bufferView],d=o.componentType,p=n.buffers[c.buffer],T=(o.byteOffset??0)+(c.byteOffset??0)+p.byteOffset;let S;switch(d){case 5123:S=Uint32Array.from(new Uint16Array(p.arrayBuffer,T,o.count));break;case 5125:S=new Uint32Array(p.arrayBuffer,T,o.count);break;default:throw new Error(`unsupported index buffer element component type: 0x${d.toString(16)}`)}const R=getFloatArray(n,e.attributes.POSITION),x=getFloatArray(n,e.attributes.NORMAL),G=getFloatArray(n,e.attributes.TEXCOORD_0),P=8,U=R.length/3,H=new Float32Array(U*P);for(let X=0;X<U;++X){const $=X*P;H[$]=R[X*3],H[$+1]=R[X*3+1],H[$+2]=R[X*3+2],H[$+3]=x[X*3],H[$+4]=x[X*3+1],H[$+5]=x[X*3+2],H[$+6]=G[X*2],H[$+7]=G[X*2+1]}this.indexBuffer=device.createBuffer({label:"index buffer",size:S.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST}),device.queue.writeBuffer(this.indexBuffer,0,S),this.vertexBuffer=device.createBuffer({label:"vertex buffer",size:H.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),device.queue.writeBuffer(this.vertexBuffer,0,H),this.numIndices=S.length}}class Mesh{primitives=[];constructor(e,n,r){e.primitives.forEach(s=>{this.primitives.push(new Primitive(s,n,r[s.material]))}),this.primitives.sort((s,o)=>s.material.id-o.material.id)}}class Node{name="node";parent;children=new Set;transform=mat4.identity();modelMatUniformBuffer;modelBindGroup;mesh;setName(e){this.name=e}setParent(e){this.parent!=null&&this.parent.children.delete(this),this.parent=e,e.children.add(this)}propagateTransformations(){this.parent!=null&&(this.transform=mat4.mul(this.parent.transform,this.transform)),this.mesh!=null&&(this.modelMatUniformBuffer=device.createBuffer({label:"model mat uniform",size:64,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),device.queue.writeBuffer(this.modelMatUniformBuffer,0,this.transform),this.modelBindGroup=device.createBindGroup({label:"model bind group",layout:modelBindGroupLayout,entries:[{binding:0,resource:{buffer:this.modelMatUniformBuffer}}]}));for(let e of this.children)e.propagateTransformations()}}function createTexture(t){let e=device.createTexture({size:[t.width,t.height],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});return device.queue.copyExternalImageToTexture({source:t},{texture:e},{width:t.width,height:t.height}),e}function convertWrapModeEnum(t){switch(t){case 10497:return"repeat";case 33071:return"clamp-to-edge";case 33648:return"mirror-repeat";default:throw new Error(`unsupported wrap mode: 0x${t.toString(16)}`)}}function createSampler(t){let e={};switch(t.magFilter){case 9728:e.magFilter="nearest";break;case 9729:e.magFilter="linear";break;default:throw new Error(`unsupported magFilter: 0x${t.magFilter.toString(16)}`)}switch(t.minFilter){case 9728:e.minFilter="nearest";break;case 9729:e.minFilter="linear";break;case 9984:e.minFilter="nearest",e.mipmapFilter="nearest";break;case 9985:e.minFilter="linear",e.mipmapFilter="nearest";break;case 9986:e.minFilter="nearest",e.mipmapFilter="linear";break;case 9987:e.minFilter="linear",e.mipmapFilter="linear";break;default:throw new Error(`unsupported minFilter: 0x${t.minFilter.toString(16)}`)}return e.addressModeU=convertWrapModeEnum(t.wrapS),e.addressModeV=convertWrapModeEnum(t.wrapT),device.createSampler(e)}class Scene{root=new Node;constructor(){this.root.setName("root")}async loadGltf(e){const n=await load(e),r=n.json;let s=[];{let T=[];for(let R of n.images)T.push(createTexture(R));let S=[];for(let R of r.samplers)S.push(createSampler(R));for(let R of r.textures)s.push(new Texture(T[R.source],S[R.sampler]))}let o=[];for(let T of r.materials)o.push(new Material(T,s));let c=[];for(let T of r.meshes)c.push(new Mesh(T,n,o));let d=new Node;d.setName("scene root"),d.setParent(this.root);let p=[];for(let T of r.nodes){let S=new Node;S.setName(T.name),S.setParent(d),T.mesh!=null&&(S.mesh=c[T.mesh]),T.matrix!=null?S.transform=new Float32Array(T.matrix):(T.translation!=null&&(S.transform=mat4.mul(S.transform,mat4.translation(T.translation))),T.rotation!=null&&(S.transform=mat4.mul(S.transform,mat4.fromQuat(T.rotation))),T.scale!=null&&(S.transform=mat4.mul(S.transform,mat4.scaling(T.scale)))),p.push(S)}for(let T in r.nodes){const S=r.nodes[T];if(S.children!=null)for(let R of S.children)p[R].setParent(p[T])}d.propagateTransformations()}iterate(e,n,r){let s=[this.root],o;for(;s.length>0;){let c=s.pop();if(c.mesh!=null){e(c);for(let d of c.mesh.primitives)d.material.id!=o&&(n(d.material),o=d.material.id),r(d)}for(let d of c.children)s.push(d)}}}function hueToRgb(t){let e=(n,r=(n+t*6)%6)=>1-Math.max(Math.min(r,4-r,1),0);return vec3.lerp(vec3.create(1,1,1),vec3.create(e(5),e(3),e(1)),.8)}class Lights{camera;numLights=1e3;static maxNumLights=5e3;static numFloatsPerLight=8;static lightIntensity=.1;lightsArray=new Float32Array(Lights.maxNumLights*Lights.numFloatsPerLight);lightSetStorageBuffer;timeUniformBuffer;moveLightsComputeBindGroupLayout;moveLightsComputeBindGroup;moveLightsComputePipeline;numClusters;sceneUniformsComputeBindGroupLayout;sceneUniformsComputeBindGroup;clusterSetStorageBuffer;clusteredLightsComputeBindGroupLayout;clusterLightsComputeBindGroup;clusteringComputePipeline;constructor(e){this.camera=e,this.lightSetStorageBuffer=device.createBuffer({label:"lights",size:16+this.lightsArray.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.populateLightsBuffer(),this.updateLightSetUniformNumLights(),this.timeUniformBuffer=device.createBuffer({label:"time uniform",size:4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.moveLightsComputeBindGroupLayout=device.createBindGroupLayout({label:"move lights compute bind group layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]}),this.moveLightsComputeBindGroup=device.createBindGroup({label:"move lights compute bind group",layout:this.moveLightsComputeBindGroupLayout,entries:[{binding:0,resource:{buffer:this.lightSetStorageBuffer}},{binding:1,resource:{buffer:this.timeUniformBuffer}}]}),this.moveLightsComputePipeline=device.createComputePipeline({label:"move lights compute pipeline",layout:device.createPipelineLayout({label:"move lights compute pipeline layout",bindGroupLayouts:[this.moveLightsComputeBindGroupLayout]}),compute:{module:device.createShaderModule({label:"move lights compute shader",code:moveLightsComputeSrc}),entryPoint:"main"}}),this.sceneUniformsComputeBindGroupLayout=device.createBindGroupLayout({label:"scene uniforms compute bind group layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]}),this.sceneUniformsComputeBindGroup=device.createBindGroup({label:"scene uniforms compute bind group",layout:this.sceneUniformsComputeBindGroupLayout,entries:[{binding:0,resource:{buffer:this.camera.uniformsBuffer}}]});const n=Math.ceil(canvas.width/constants.clusterPixelSize),r=Math.ceil(canvas.height/constants.clusterPixelSize);this.numClusters=n*r*constants.numClustersZ,this.clusterSetStorageBuffer=device.createBuffer({label:"clustered lights",size:8+this.numClusters*(1+constants.maxLightsPerCluster)*4,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),device.queue.writeBuffer(this.clusterSetStorageBuffer,0,new Uint32Array([n,r])),this.clusteredLightsComputeBindGroupLayout=device.createBindGroupLayout({label:"clustered lights compute bind group layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]}),this.clusterLightsComputeBindGroup=device.createBindGroup({label:"cluster lights compute bind group",layout:this.clusteredLightsComputeBindGroupLayout,entries:[{binding:0,resource:{buffer:this.lightSetStorageBuffer}},{binding:1,resource:{buffer:this.clusterSetStorageBuffer}}]}),this.clusteringComputePipeline=device.createComputePipeline({label:"clustering compute pipeline",layout:device.createPipelineLayout({label:"clustering compute pipeline layout",bindGroupLayouts:[this.sceneUniformsComputeBindGroupLayout,this.clusteredLightsComputeBindGroupLayout]}),compute:{module:device.createShaderModule({label:"clustering compute shader",code:clusteringComputeSrc}),entryPoint:"main"}})}populateLightsBuffer(){for(let e=0;e<Lights.maxNumLights;++e){const n=vec3.scale(hueToRgb(Math.random()),Lights.lightIntensity);this.lightsArray.set(n,e*Lights.numFloatsPerLight+4)}device.queue.writeBuffer(this.lightSetStorageBuffer,16,this.lightsArray)}updateLightSetUniformNumLights(){device.queue.writeBuffer(this.lightSetStorageBuffer,0,new Uint32Array([this.numLights]))}doLightClustering(e){const n=e.beginComputePass();n.setPipeline(this.clusteringComputePipeline),n.setBindGroup(0,this.sceneUniformsComputeBindGroup),n.setBindGroup(1,this.clusterLightsComputeBindGroup);const r=Math.ceil(this.numClusters/constants.clusteringWorkGroupSize);n.dispatchWorkgroups(r),n.end()}onFrame(e){device.queue.writeBuffer(this.timeUniformBuffer,0,new Float32Array([e]));const n=device.createCommandEncoder(),r=n.beginComputePass();r.setPipeline(this.moveLightsComputePipeline),r.setBindGroup(0,this.moveLightsComputeBindGroup);const s=Math.ceil(this.numLights/constants.moveLightsWorkgroupSize);r.dispatchWorkgroups(s),r.end(),device.queue.submit([n.finish()])}}function toRadians(t){return t*Math.PI/180}class CameraUniforms{buffer=new ArrayBuffer(192);floatView=new Float32Array(this.buffer);set viewProjMat(e){this.floatView.set(e.subarray(0,16),0)}set invProjMat(e){this.floatView.set(e.subarray(0,16),16)}set viewMat(e){this.floatView.set(e.subarray(0,16),32)}}class Camera{uniforms=new CameraUniforms;uniformsBuffer;projMat=mat4.create();cameraPos=vec3.create(-7,2,0);cameraFront=vec3.create(0,0,-1);cameraUp=vec3.create(0,1,0);cameraRight=vec3.create(1,0,0);yaw=0;pitch=0;moveSpeed=.004;sensitivity=.15;static nearPlane=.1;static farPlane=1e3;keys={};constructor(){this.uniformsBuffer=device.createBuffer({size:this.uniforms.buffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.projMat=mat4.perspective(toRadians(fovYDegrees),aspectRatio,Camera.nearPlane,Camera.farPlane),this.rotateCamera(0,0),window.addEventListener("keydown",e=>this.onKeyEvent(e,!0)),window.addEventListener("keyup",e=>this.onKeyEvent(e,!1)),window.onblur=()=>this.keys={},canvas.addEventListener("mousedown",()=>canvas.requestPointerLock()),canvas.addEventListener("mouseup",()=>document.exitPointerLock()),canvas.addEventListener("mousemove",e=>this.onMouseMove(e))}onKeyEvent(e,n){this.keys[e.key.toLowerCase()]=n,this.keys.alt&&e.preventDefault()}rotateCamera(e,n){this.yaw+=e,this.pitch-=n,this.pitch>89&&(this.pitch=89),this.pitch<-89&&(this.pitch=-89);const r=mat4.create();r[0]=Math.cos(toRadians(this.yaw))*Math.cos(toRadians(this.pitch)),r[1]=Math.sin(toRadians(this.pitch)),r[2]=Math.sin(toRadians(this.yaw))*Math.cos(toRadians(this.pitch)),this.cameraFront=vec3.normalize(r),this.cameraRight=vec3.normalize(vec3.cross(this.cameraFront,[0,1,0])),this.cameraUp=vec3.normalize(vec3.cross(this.cameraRight,this.cameraFront))}onMouseMove(e){document.pointerLockElement===canvas&&this.rotateCamera(e.movementX*this.sensitivity,e.movementY*this.sensitivity)}processInput(e){let n=vec3.create(0,0,0);this.keys.w&&(n=vec3.add(n,this.cameraFront)),this.keys.s&&(n=vec3.sub(n,this.cameraFront)),this.keys.a&&(n=vec3.sub(n,this.cameraRight)),this.keys.d&&(n=vec3.add(n,this.cameraRight)),this.keys.q&&(n=vec3.sub(n,this.cameraUp)),this.keys.e&&(n=vec3.add(n,this.cameraUp));let r=this.moveSpeed*e;const s=3;if(this.keys.shift&&(r*=s),this.keys.alt&&(r/=s),vec3.length(n)>0){const o=vec3.scale(vec3.normalize(n),r);this.cameraPos=vec3.add(this.cameraPos,o)}}onFrame(e){this.processInput(e);const n=vec3.add(this.cameraPos,vec3.scale(this.cameraFront,1)),r=mat4.lookAt(this.cameraPos,n,[0,1,0]),s=mat4.mul(this.projMat,r);this.uniforms.viewProjMat=s,this.uniforms.invProjMat=mat4.inverse(this.projMat),this.uniforms.viewMat=r,device.queue.writeBuffer(this.uniformsBuffer,0,this.uniforms.buffer)}}class Stage{scene;lights;camera;stats;constructor(e,n,r,s){this.scene=e,this.lights=n,this.camera=r,this.stats=s}}await initWebGPU();setupLoaders();let scene=new Scene;await scene.loadGltf("./scenes/sponza/Sponza.gltf");const camera=new Camera,lights=new Lights(camera),stats=new Stats;stats.showPanel(0);document.body.appendChild(stats.dom);const gui=new GUI$1;gui.add(lights,"numLights").min(1).max(Lights.maxNumLights).step(1).onChange(()=>{lights.updateLightSetUniformNumLights()});const stage=new Stage(scene,lights,camera,stats);var renderer;function setRenderer(t){switch(renderer?.stop(),t){case renderModes.naive:renderer=new NaiveRenderer(stage);break;case renderModes.forwardPlus:renderer=new ForwardPlusRenderer(stage);break;case renderModes.clusteredDeferred:renderer=new ClusteredDeferredRenderer(stage);break}}const renderModes={naive:"naive",forwardPlus:"forward+",clusteredDeferred:"clustered deferred"};let renderModeController=gui.add({mode:renderModes.naive},"mode",renderModes);renderModeController.onChange(setRenderer);setRenderer(renderModeController.getValue());
