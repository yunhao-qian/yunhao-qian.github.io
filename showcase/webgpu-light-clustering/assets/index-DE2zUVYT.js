(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();function $o(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var fn={exports:{}},Wo=fn.exports,Hr;function Zo(){return Hr||(Hr=1,(function(t,e){(function(n,r){t.exports=r()})(Wo,function(){var n=function(){function r(L){return c.appendChild(L.dom),L}function s(L){for(var H=0;H<c.children.length;H++)c.children[H].style.display=H===L?"block":"none";o=L}var o=0,c=document.createElement("div");c.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",c.addEventListener("click",function(L){L.preventDefault(),s(++o%c.children.length)},!1);var d=(performance||Date).now(),m=d,E=0,M=r(new n.Panel("FPS","#0ff","#002")),D=r(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var R=r(new n.Panel("MB","#f08","#201"));return s(0),{REVISION:16,dom:c,addPanel:r,showPanel:s,begin:function(){d=(performance||Date).now()},end:function(){E++;var L=(performance||Date).now();if(D.update(L-d,200),L>m+1e3&&(M.update(1e3*E/(L-m),100),m=L,E=0,R)){var H=performance.memory;R.update(H.usedJSHeapSize/1048576,H.jsHeapSizeLimit/1048576)}return L},update:function(){d=this.end()},domElement:c,setMode:s}};return n.Panel=function(r,s,o){var c=1/0,d=0,m=Math.round,E=m(window.devicePixelRatio||1),M=80*E,D=48*E,R=3*E,L=2*E,H=3*E,J=15*E,K=74*E,z=30*E,$=document.createElement("canvas");$.width=M,$.height=D,$.style.cssText="width:80px;height:48px";var X=$.getContext("2d");return X.font="bold "+9*E+"px Helvetica,Arial,sans-serif",X.textBaseline="top",X.fillStyle=o,X.fillRect(0,0,M,D),X.fillStyle=s,X.fillText(r,R,L),X.fillRect(H,J,K,z),X.fillStyle=o,X.globalAlpha=.9,X.fillRect(H,J,K,z),{dom:$,update:function(re,ce){c=Math.min(c,re),d=Math.max(d,re),X.fillStyle=o,X.globalAlpha=1,X.fillRect(0,0,M,J),X.fillStyle=s,X.fillText(m(re)+" "+r+" ("+m(c)+"-"+m(d)+")",R,L),X.drawImage($,H+E,J,K-E,z,H,J,K-E,z),X.fillRect(H+K-E,J,E,z),X.fillStyle=o,X.globalAlpha=.9,X.fillRect(H+K-E,J,E,m((1-re/ce)*z))}}},n})})(fn)),fn.exports}var qo=Zo();const ei=$o(qo);function ti(t){if(!(typeof window>"u")){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}function xt(t,e){var n=t.__state.conversionName.toString(),r=Math.round(t.r),s=Math.round(t.g),o=Math.round(t.b),c=t.a,d=Math.round(t.h),m=t.s.toFixed(1),E=t.v.toFixed(1);if(e||n==="THREE_CHAR_HEX"||n==="SIX_CHAR_HEX"){for(var M=t.hex.toString(16);M.length<6;)M="0"+M;return"#"+M}else{if(n==="CSS_RGB")return"rgb("+r+","+s+","+o+")";if(n==="CSS_RGBA")return"rgba("+r+","+s+","+o+","+c+")";if(n==="HEX")return"0x"+t.hex.toString(16);if(n==="RGB_ARRAY")return"["+r+","+s+","+o+"]";if(n==="RGBA_ARRAY")return"["+r+","+s+","+o+","+c+"]";if(n==="RGB_OBJ")return"{r:"+r+",g:"+s+",b:"+o+"}";if(n==="RGBA_OBJ")return"{r:"+r+",g:"+s+",b:"+o+",a:"+c+"}";if(n==="HSV_OBJ")return"{h:"+d+",s:"+m+",v:"+E+"}";if(n==="HSVA_OBJ")return"{h:"+d+",s:"+m+",v:"+E+",a:"+c+"}"}return"unknown format"}var Jr=Array.prototype.forEach,Dt=Array.prototype.slice,S={BREAK:{},extend:function(e){return this.each(Dt.call(arguments,1),function(n){var r=this.isObject(n)?Object.keys(n):[];r.forEach(function(s){this.isUndefined(n[s])||(e[s]=n[s])}.bind(this))},this),e},defaults:function(e){return this.each(Dt.call(arguments,1),function(n){var r=this.isObject(n)?Object.keys(n):[];r.forEach(function(s){this.isUndefined(e[s])&&(e[s]=n[s])}.bind(this))},this),e},compose:function(){var e=Dt.call(arguments);return function(){for(var n=Dt.call(arguments),r=e.length-1;r>=0;r--)n=[e[r].apply(this,n)];return n[0]}},each:function(e,n,r){if(e){if(Jr&&e.forEach&&e.forEach===Jr)e.forEach(n,r);else if(e.length===e.length+0){var s=void 0,o=void 0;for(s=0,o=e.length;s<o;s++)if(s in e&&n.call(r,e[s],s)===this.BREAK)return}else for(var c in e)if(n.call(r,e[c],c)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},debounce:function(e,n,r){var s=void 0;return function(){var o=this,c=arguments;function d(){s=null,r||e.apply(o,c)}var m=r||!s;clearTimeout(s),s=setTimeout(d,n),m&&e.apply(o,c)}},toArray:function(e){return e.toArray?e.toArray():Dt.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return e===null},isNaN:(function(t){function e(n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e})(function(t){return isNaN(t)}),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return e instanceof Function}},ni=[{litmus:S.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var n=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return n===null?!1:{space:"HEX",hex:parseInt("0x"+n[1].toString()+n[1].toString()+n[2].toString()+n[2].toString()+n[3].toString()+n[3].toString(),0)}},write:xt},SIX_CHAR_HEX:{read:function(e){var n=e.match(/^#([A-F0-9]{6})$/i);return n===null?!1:{space:"HEX",hex:parseInt("0x"+n[1].toString(),0)}},write:xt},CSS_RGB:{read:function(e){var n=e.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return n===null?!1:{space:"RGB",r:parseFloat(n[1]),g:parseFloat(n[2]),b:parseFloat(n[3])}},write:xt},CSS_RGBA:{read:function(e){var n=e.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return n===null?!1:{space:"RGB",r:parseFloat(n[1]),g:parseFloat(n[2]),b:parseFloat(n[3]),a:parseFloat(n[4])}},write:xt}}},{litmus:S.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:S.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!==3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!==4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:S.isObject,conversions:{RGBA_OBJ:{read:function(e){return S.isNumber(e.r)&&S.isNumber(e.g)&&S.isNumber(e.b)&&S.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return S.isNumber(e.r)&&S.isNumber(e.g)&&S.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return S.isNumber(e.h)&&S.isNumber(e.s)&&S.isNumber(e.v)&&S.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return S.isNumber(e.h)&&S.isNumber(e.s)&&S.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],Ft=void 0,tn=void 0,Yn=function(){tn=!1;var e=arguments.length>1?S.toArray(arguments):arguments[0];return S.each(ni,function(n){if(n.litmus(e))return S.each(n.conversions,function(r,s){if(Ft=r.read(e),tn===!1&&Ft!==!1)return tn=Ft,Ft.conversionName=s,Ft.conversion=r,S.BREAK}),S.BREAK}),tn},Nr=void 0,dn={hsv_to_rgb:function(e,n,r){var s=Math.floor(e/60)%6,o=e/60-Math.floor(e/60),c=r*(1-n),d=r*(1-o*n),m=r*(1-(1-o)*n),E=[[r,m,c],[d,r,c],[c,r,m],[c,d,r],[m,c,r],[r,c,d]][s];return{r:E[0]*255,g:E[1]*255,b:E[2]*255}},rgb_to_hsv:function(e,n,r){var s=Math.min(e,n,r),o=Math.max(e,n,r),c=o-s,d=void 0,m=void 0;if(o!==0)m=c/o;else return{h:NaN,s:0,v:0};return e===o?d=(n-r)/c:n===o?d=2+(r-e)/c:d=4+(e-n)/c,d/=6,d<0&&(d+=1),{h:d*360,s:m,v:o/255}},rgb_to_hex:function(e,n,r){var s=this.hex_with_component(0,2,e);return s=this.hex_with_component(s,1,n),s=this.hex_with_component(s,0,r),s},component_from_hex:function(e,n){return e>>n*8&255},hex_with_component:function(e,n,r){return r<<(Nr=n*8)|e&~(255<<Nr)}},ri=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qe=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},et=(function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}})(),at=function t(e,n,r){e===null&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,n);if(s===void 0){var o=Object.getPrototypeOf(e);return o===null?void 0:t(o,n,r)}else{if("value"in s)return s.value;var c=s.get;return c===void 0?void 0:c.call(r)}},ut=function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},ft=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t},he=(function(){function t(){if(qe(this,t),this.__state=Yn.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return et(t,[{key:"toString",value:function(){return xt(this)}},{key:"toHexString",value:function(){return xt(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t})();function lr(t,e,n){Object.defineProperty(t,e,{get:function(){return this.__state.space==="RGB"?this.__state[e]:(he.recalculateRGB(this,e,n),this.__state[e])},set:function(s){this.__state.space!=="RGB"&&(he.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=s}})}function dr(t,e){Object.defineProperty(t,e,{get:function(){return this.__state.space==="HSV"?this.__state[e]:(he.recalculateHSV(this),this.__state[e])},set:function(r){this.__state.space!=="HSV"&&(he.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=r}})}he.recalculateRGB=function(t,e,n){if(t.__state.space==="HEX")t.__state[e]=dn.component_from_hex(t.__state.hex,n);else if(t.__state.space==="HSV")S.extend(t.__state,dn.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v));else throw new Error("Corrupted color state")};he.recalculateHSV=function(t){var e=dn.rgb_to_hsv(t.r,t.g,t.b);S.extend(t.__state,{s:e.s,v:e.v}),S.isNaN(e.h)?S.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h};he.COMPONENTS=["r","g","b","h","s","v","hex","a"];lr(he.prototype,"r",2);lr(he.prototype,"g",1);lr(he.prototype,"b",0);dr(he.prototype,"h");dr(he.prototype,"s");dr(he.prototype,"v");Object.defineProperty(he.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty(he.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=dn.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var At=(function(){function t(e,n){qe(this,t),this.initialValue=e[n],this.domElement=document.createElement("div"),this.object=e,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return et(t,[{key:"onChange",value:function(n){return this.__onChange=n,this}},{key:"onFinishChange",value:function(n){return this.__onFinishChange=n,this}},{key:"setValue",value:function(n){return this.object[this.property]=n,this.__onChange&&this.__onChange.call(this,n),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t})(),si={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},Js={};S.each(si,function(t,e){S.each(t,function(n){Js[n]=e})});var oi=/(\d+(\.\d+)?)px/;function tt(t){if(t==="0"||S.isUndefined(t))return 0;var e=t.match(oi);return S.isNull(e)?0:parseFloat(e[1])}var F={makeSelectable:function(e,n){e===void 0||e.style===void 0||(e.onselectstart=n?function(){return!1}:function(){},e.style.MozUserSelect=n?"auto":"none",e.style.KhtmlUserSelect=n?"auto":"none",e.unselectable=n?"on":"off")},makeFullscreen:function(e,n,r){var s=r,o=n;S.isUndefined(o)&&(o=!0),S.isUndefined(s)&&(s=!0),e.style.position="absolute",o&&(e.style.left=0,e.style.right=0),s&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,n,r,s){var o=r||{},c=Js[n];if(!c)throw new Error("Event type "+n+" not supported.");var d=document.createEvent(c);switch(c){case"MouseEvents":{var m=o.x||o.clientX||0,E=o.y||o.clientY||0;d.initMouseEvent(n,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,m,E,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var M=d.initKeyboardEvent||d.initKeyEvent;S.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),M(n,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break}default:{d.initEvent(n,o.bubbles||!1,o.cancelable||!0);break}}S.defaults(d,s),e.dispatchEvent(d)},bind:function(e,n,r,s){var o=s||!1;return e.addEventListener?e.addEventListener(n,r,o):e.attachEvent&&e.attachEvent("on"+n,r),F},unbind:function(e,n,r,s){var o=s||!1;return e.removeEventListener?e.removeEventListener(n,r,o):e.detachEvent&&e.detachEvent("on"+n,r),F},addClass:function(e,n){if(e.className===void 0)e.className=n;else if(e.className!==n){var r=e.className.split(/ +/);r.indexOf(n)===-1&&(r.push(n),e.className=r.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return F},removeClass:function(e,n){if(n)if(e.className===n)e.removeAttribute("class");else{var r=e.className.split(/ +/),s=r.indexOf(n);s!==-1&&(r.splice(s,1),e.className=r.join(" "))}else e.className=void 0;return F},hasClass:function(e,n){return new RegExp("(?:^|\\s+)"+n+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var n=getComputedStyle(e);return tt(n["border-left-width"])+tt(n["border-right-width"])+tt(n["padding-left"])+tt(n["padding-right"])+tt(n.width)},getHeight:function(e){var n=getComputedStyle(e);return tt(n["border-top-width"])+tt(n["border-bottom-width"])+tt(n["padding-top"])+tt(n["padding-bottom"])+tt(n.height)},getOffset:function(e){var n=e,r={left:0,top:0};if(n.offsetParent)do r.left+=n.offsetLeft,r.top+=n.offsetTop,n=n.offsetParent;while(n);return r},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},Ns=(function(t){ut(e,t);function e(n,r){qe(this,e);var s=ft(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),o=s;s.__prev=s.getValue(),s.__checkbox=document.createElement("input"),s.__checkbox.setAttribute("type","checkbox");function c(){o.setValue(!o.__prev)}return F.bind(s.__checkbox,"change",c,!1),s.domElement.appendChild(s.__checkbox),s.updateDisplay(),s}return et(e,[{key:"setValue",value:function(r){var s=at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,r);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),s}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e})(At),ii=(function(t){ut(e,t);function e(n,r,s){qe(this,e);var o=ft(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),c=s,d=o;if(o.__select=document.createElement("select"),S.isArray(c)){var m={};S.each(c,function(E){m[E]=E}),c=m}return S.each(c,function(E,M){var D=document.createElement("option");D.innerHTML=M,D.setAttribute("value",E),d.__select.appendChild(D)}),o.updateDisplay(),F.bind(o.__select,"change",function(){var E=this.options[this.selectedIndex].value;d.setValue(E)}),o.domElement.appendChild(o.__select),o}return et(e,[{key:"setValue",value:function(r){var s=at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,r);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),s}},{key:"updateDisplay",value:function(){return F.isActive(this.__select)?this:(this.__select.value=this.getValue(),at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e})(At),ai=(function(t){ut(e,t);function e(n,r){qe(this,e);var s=ft(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),o=s;function c(){o.setValue(o.__input.value)}function d(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),F.bind(s.__input,"keyup",c),F.bind(s.__input,"change",c),F.bind(s.__input,"blur",d),F.bind(s.__input,"keydown",function(m){m.keyCode===13&&this.blur()}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return et(e,[{key:"updateDisplay",value:function(){return F.isActive(this.__input)||(this.__input.value=this.getValue()),at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e})(At);function kr(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var ks=(function(t){ut(e,t);function e(n,r,s){qe(this,e);var o=ft(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),c=s||{};return o.__min=c.min,o.__max=c.max,o.__step=c.step,S.isUndefined(o.__step)?o.initialValue===0?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=kr(o.__impliedStep),o}return et(e,[{key:"setValue",value:function(r){var s=r;return this.__min!==void 0&&s<this.__min?s=this.__min:this.__max!==void 0&&s>this.__max&&(s=this.__max),this.__step!==void 0&&s%this.__step!==0&&(s=Math.round(s/this.__step)*this.__step),at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,s)}},{key:"min",value:function(r){return this.__min=r,this}},{key:"max",value:function(r){return this.__max=r,this}},{key:"step",value:function(r){return this.__step=r,this.__impliedStep=r,this.__precision=kr(r),this}}]),e})(At);function ci(t,e){var n=Math.pow(10,e);return Math.round(t*n)/n}var hn=(function(t){ut(e,t);function e(n,r,s){qe(this,e);var o=ft(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r,s));o.__truncationSuspended=!1;var c=o,d=void 0;function m(){var H=parseFloat(c.__input.value);S.isNaN(H)||c.setValue(H)}function E(){c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}function M(){E()}function D(H){var J=d-H.clientY;c.setValue(c.getValue()+J*c.__impliedStep),d=H.clientY}function R(){F.unbind(window,"mousemove",D),F.unbind(window,"mouseup",R),E()}function L(H){F.bind(window,"mousemove",D),F.bind(window,"mouseup",R),d=H.clientY}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),F.bind(o.__input,"change",m),F.bind(o.__input,"blur",M),F.bind(o.__input,"mousedown",L),F.bind(o.__input,"keydown",function(H){H.keyCode===13&&(c.__truncationSuspended=!0,this.blur(),c.__truncationSuspended=!1,E())}),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return et(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():ci(this.getValue(),this.__precision),at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e})(ks);function Kr(t,e,n,r,s){return r+(s-r)*((t-e)/(n-e))}var $n=(function(t){ut(e,t);function e(n,r,s,o,c){qe(this,e);var d=ft(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r,{min:s,max:o,step:c})),m=d;d.__background=document.createElement("div"),d.__foreground=document.createElement("div"),F.bind(d.__background,"mousedown",E),F.bind(d.__background,"touchstart",R),F.addClass(d.__background,"slider"),F.addClass(d.__foreground,"slider-fg");function E(J){document.activeElement.blur(),F.bind(window,"mousemove",M),F.bind(window,"mouseup",D),M(J)}function M(J){J.preventDefault();var K=m.__background.getBoundingClientRect();return m.setValue(Kr(J.clientX,K.left,K.right,m.__min,m.__max)),!1}function D(){F.unbind(window,"mousemove",M),F.unbind(window,"mouseup",D),m.__onFinishChange&&m.__onFinishChange.call(m,m.getValue())}function R(J){J.touches.length===1&&(F.bind(window,"touchmove",L),F.bind(window,"touchend",H),L(J))}function L(J){var K=J.touches[0].clientX,z=m.__background.getBoundingClientRect();m.setValue(Kr(K,z.left,z.right,m.__min,m.__max))}function H(){F.unbind(window,"touchmove",L),F.unbind(window,"touchend",H),m.__onFinishChange&&m.__onFinishChange.call(m,m.getValue())}return d.updateDisplay(),d.__background.appendChild(d.__foreground),d.domElement.appendChild(d.__background),d}return et(e,[{key:"updateDisplay",value:function(){var r=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=r*100+"%",at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e})(ks),Ks=(function(t){ut(e,t);function e(n,r,s){qe(this,e);var o=ft(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),c=o;return o.__button=document.createElement("div"),o.__button.innerHTML=s===void 0?"Fire":s,F.bind(o.__button,"click",function(d){return d.preventDefault(),c.fire(),!1}),F.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return et(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e})(At),Wn=(function(t){ut(e,t);function e(n,r){qe(this,e);var s=ft(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r));s.__color=new he(s.getValue()),s.__temp=new he(0);var o=s;s.domElement=document.createElement("div"),F.makeSelectable(s.domElement,!1),s.__selector=document.createElement("div"),s.__selector.className="selector",s.__saturation_field=document.createElement("div"),s.__saturation_field.className="saturation-field",s.__field_knob=document.createElement("div"),s.__field_knob.className="field-knob",s.__field_knob_border="2px solid ",s.__hue_knob=document.createElement("div"),s.__hue_knob.className="hue-knob",s.__hue_field=document.createElement("div"),s.__hue_field.className="hue-field",s.__input=document.createElement("input"),s.__input.type="text",s.__input_textShadow="0 1px 1px ",F.bind(s.__input,"keydown",function(J){J.keyCode===13&&D.call(this)}),F.bind(s.__input,"blur",D),F.bind(s.__selector,"mousedown",function(){F.addClass(this,"drag").bind(window,"mouseup",function(){F.removeClass(o.__selector,"drag")})}),F.bind(s.__selector,"touchstart",function(){F.addClass(this,"drag").bind(window,"touchend",function(){F.removeClass(o.__selector,"drag")})});var c=document.createElement("div");S.extend(s.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),S.extend(s.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:s.__field_knob_border+(s.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),S.extend(s.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),S.extend(s.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),S.extend(c.style,{width:"100%",height:"100%",background:"none"}),jr(c,"top","rgba(0,0,0,0)","#000"),S.extend(s.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),fi(s.__hue_field),S.extend(s.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:s.__input_textShadow+"rgba(0,0,0,0.7)"}),F.bind(s.__saturation_field,"mousedown",d),F.bind(s.__saturation_field,"touchstart",d),F.bind(s.__field_knob,"mousedown",d),F.bind(s.__field_knob,"touchstart",d),F.bind(s.__hue_field,"mousedown",m),F.bind(s.__hue_field,"touchstart",m);function d(J){L(J),F.bind(window,"mousemove",L),F.bind(window,"touchmove",L),F.bind(window,"mouseup",E),F.bind(window,"touchend",E)}function m(J){H(J),F.bind(window,"mousemove",H),F.bind(window,"touchmove",H),F.bind(window,"mouseup",M),F.bind(window,"touchend",M)}function E(){F.unbind(window,"mousemove",L),F.unbind(window,"touchmove",L),F.unbind(window,"mouseup",E),F.unbind(window,"touchend",E),R()}function M(){F.unbind(window,"mousemove",H),F.unbind(window,"touchmove",H),F.unbind(window,"mouseup",M),F.unbind(window,"touchend",M),R()}function D(){var J=Yn(this.value);J!==!1?(o.__color.__state=J,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function R(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}s.__saturation_field.appendChild(c),s.__selector.appendChild(s.__field_knob),s.__selector.appendChild(s.__saturation_field),s.__selector.appendChild(s.__hue_field),s.__hue_field.appendChild(s.__hue_knob),s.domElement.appendChild(s.__input),s.domElement.appendChild(s.__selector),s.updateDisplay();function L(J){J.type.indexOf("touch")===-1&&J.preventDefault();var K=o.__saturation_field.getBoundingClientRect(),z=J.touches&&J.touches[0]||J,$=z.clientX,X=z.clientY,re=($-K.left)/(K.right-K.left),ce=1-(X-K.top)/(K.bottom-K.top);return ce>1?ce=1:ce<0&&(ce=0),re>1?re=1:re<0&&(re=0),o.__color.v=ce,o.__color.s=re,o.setValue(o.__color.toOriginal()),!1}function H(J){J.type.indexOf("touch")===-1&&J.preventDefault();var K=o.__hue_field.getBoundingClientRect(),z=J.touches&&J.touches[0]||J,$=z.clientY,X=1-($-K.top)/(K.bottom-K.top);return X>1?X=1:X<0&&(X=0),o.__color.h=X*360,o.setValue(o.__color.toOriginal()),!1}return s}return et(e,[{key:"updateDisplay",value:function(){var r=Yn(this.getValue());if(r!==!1){var s=!1;S.each(he.COMPONENTS,function(d){if(!S.isUndefined(r[d])&&!S.isUndefined(this.__color.__state[d])&&r[d]!==this.__color.__state[d])return s=!0,{}},this),s&&S.extend(this.__color.__state,r)}S.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var o=this.__color.v<.5||this.__color.s>.5?255:0,c=255-o;S.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+o+","+o+","+o+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,jr(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),S.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+o+","+o+","+o+")",textShadow:this.__input_textShadow+"rgba("+c+","+c+","+c+",.7)"})}}]),e})(At),ui=["-moz-","-o-","-webkit-","-ms-",""];function jr(t,e,n,r){t.style.background="",S.each(ui,function(s){t.style.cssText+="background: "+s+"linear-gradient("+e+", "+n+" 0%, "+r+" 100%); "})}function fi(t){t.style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var li={load:function(e,n){var r=n||document,s=r.createElement("link");s.type="text/css",s.rel="stylesheet",s.href=e,r.getElementsByTagName("head")[0].appendChild(s)},inject:function(e,n){var r=n||document,s=document.createElement("style");s.type="text/css",s.innerHTML=e;var o=r.getElementsByTagName("head")[0];try{o.appendChild(s)}catch{}}},di=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,hi=function(e,n){var r=e[n];return S.isArray(arguments[2])||S.isObject(arguments[2])?new ii(e,n,arguments[2]):S.isNumber(r)?S.isNumber(arguments[2])&&S.isNumber(arguments[3])?S.isNumber(arguments[4])?new $n(e,n,arguments[2],arguments[3],arguments[4]):new $n(e,n,arguments[2],arguments[3]):S.isNumber(arguments[4])?new hn(e,n,{min:arguments[2],max:arguments[3],step:arguments[4]}):new hn(e,n,{min:arguments[2],max:arguments[3]}):S.isString(r)?new ai(e,n):S.isFunction(r)?new Ks(e,n,""):S.isBoolean(r)?new Ns(e,n):null};function Ai(t){setTimeout(t,1e3/60)}var gi=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||Ai,pi=(function(){function t(){qe(this,t),this.backgroundElement=document.createElement("div"),S.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),F.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),S.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;F.bind(this.backgroundElement,"click",function(){e.hide()})}return et(t,[{key:"show",value:function(){var n=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),S.defer(function(){n.backgroundElement.style.opacity=1,n.domElement.style.opacity=1,n.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var n=this,r=function s(){n.domElement.style.display="none",n.backgroundElement.style.display="none",F.unbind(n.domElement,"webkitTransitionEnd",s),F.unbind(n.domElement,"transitionend",s),F.unbind(n.domElement,"oTransitionEnd",s)};F.bind(this.domElement,"webkitTransitionEnd",r),F.bind(this.domElement,"transitionend",r),F.bind(this.domElement,"oTransitionEnd",r),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-F.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-F.getHeight(this.domElement)/2+"px"}}]),t})(),mi=ti(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);li.inject(mi);var Vr="dg",Xr=72,Qr=20,Pt="Default",Gt=(function(){try{return!!window.localStorage}catch{return!1}})(),St=void 0,zr=!0,Ct=void 0,Dn=!1,js=[],oe=function t(e){var n=this,r=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),F.addClass(this.domElement,Vr),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=S.defaults(r,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),r=S.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),S.isUndefined(r.load)?r.load={preset:Pt}:r.preset&&(r.load.preset=r.preset),S.isUndefined(r.parent)&&r.hideable&&js.push(this),r.resizable=S.isUndefined(r.parent)&&r.resizable,r.autoPlace&&S.isUndefined(r.scrollable)&&(r.scrollable=!0);var s=Gt&&localStorage.getItem(wt(this,"isLocal"))==="true",o=void 0,c=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(R){n.parent?n.getRoot().preset=R:r.load.preset=R,_i(this),n.revert()}},width:{get:function(){return r.width},set:function(R){r.width=R,er(n,R)}},name:{get:function(){return r.name},set:function(R){r.name=R,c&&(c.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(R){r.closed=R,r.closed?F.addClass(n.__ul,t.CLASS_CLOSED):F.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=R?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return s},set:function(R){Gt&&(s=R,R?F.bind(window,"unload",o):F.unbind(window,"unload",o),localStorage.setItem(wt(n,"isLocal"),R))}}}),S.isUndefined(r.parent)){if(this.closed=r.closed||!1,F.addClass(this.domElement,t.CLASS_MAIN),F.makeSelectable(this.domElement,!1),Gt&&s){n.useLocalStorage=!0;var d=localStorage.getItem(wt(this,"gui"));d&&(r.load=JSON.parse(d))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,F.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),r.closeOnTop?(F.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(F.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),F.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{r.closed===void 0&&(r.closed=!0);var m=document.createTextNode(r.name);F.addClass(m,"controller-name"),c=hr(n,m);var E=function(R){return R.preventDefault(),n.closed=!n.closed,!1};F.addClass(this.__ul,t.CLASS_CLOSED),F.addClass(c,"title"),F.bind(c,"click",E),r.closed||(this.closed=!1)}r.autoPlace&&(S.isUndefined(r.parent)&&(zr&&(Ct=document.createElement("div"),F.addClass(Ct,Vr),F.addClass(Ct,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Ct),zr=!1),Ct.appendChild(this.domElement),F.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||er(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},F.bind(window,"resize",this.__resizeHandler),F.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),F.bind(this.__ul,"transitionend",this.__resizeHandler),F.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&bi(this),o=function(){Gt&&localStorage.getItem(wt(n,"isLocal"))==="true"&&localStorage.setItem(wt(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=o;function M(){var D=n.getRoot();D.width+=1,S.defer(function(){D.width-=1})}r.parent||M()};oe.toggleHide=function(){Dn=!Dn,S.each(js,function(t){t.domElement.style.display=Dn?"none":""})};oe.CLASS_AUTO_PLACE="a";oe.CLASS_AUTO_PLACE_CONTAINER="ac";oe.CLASS_MAIN="main";oe.CLASS_CONTROLLER_ROW="cr";oe.CLASS_TOO_TALL="taller-than-window";oe.CLASS_CLOSED="closed";oe.CLASS_CLOSE_BUTTON="close-button";oe.CLASS_CLOSE_TOP="close-top";oe.CLASS_CLOSE_BOTTOM="close-bottom";oe.CLASS_DRAG="drag";oe.DEFAULT_WIDTH=245;oe.TEXT_CLOSED="Close Controls";oe.TEXT_OPEN="Open Controls";oe._keydownHandler=function(t){document.activeElement.type!=="text"&&(t.which===Xr||t.keyCode===Xr)&&oe.toggleHide()};F.bind(window,"keydown",oe._keydownHandler,!1);S.extend(oe.prototype,{add:function(e,n){return Rt(this,e,n,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,n){return Rt(this,e,n,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var n=this;S.defer(function(){n.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Ct.removeChild(this.domElement);var e=this;S.each(this.__folders,function(n){e.removeFolder(n)}),F.unbind(window,"keydown",oe._keydownHandler,!1),Yr(this)},addFolder:function(e){if(this.__folders[e]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+e+'"');var n={name:e,parent:this};n.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(n.closed=this.load.folders[e].closed,n.load=this.load.folders[e]);var r=new oe(n);this.__folders[e]=r;var s=hr(this,r.domElement);return F.addClass(s,"folder"),r},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],Yr(e);var n=this;S.each(e.__folders,function(r){e.removeFolder(r)}),S.defer(function(){n.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var n=F.getOffset(e.__ul).top,r=0;S.each(e.__ul.childNodes,function(s){e.autoPlace&&s===e.__save_row||(r+=F.getHeight(s))}),window.innerHeight-n-Qr<r?(F.addClass(e.domElement,oe.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-n-Qr+"px"):(F.removeClass(e.domElement,oe.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&S.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:S.debounce(function(){this.onResize()},50),remember:function(){if(S.isUndefined(St)&&(St=new pi,St.domElement.innerHTML=di),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;S.each(Array.prototype.slice.call(arguments),function(n){e.__rememberedObjects.length===0&&yi(e),e.__rememberedObjects.indexOf(n)===-1&&e.__rememberedObjects.push(n)}),this.autoPlace&&er(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=nn(this)),e.folders={},S.each(this.__folders,function(n,r){e.folders[r]=n.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=nn(this),Zn(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[Pt]=nn(this,!0)),this.load.remembered[e]=nn(this),this.preset=e,qn(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){S.each(this.__controllers,function(n){this.getRoot().load.remembered?Vs(e||this.getRoot(),n):n.setValue(n.initialValue),n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())},this),S.each(this.__folders,function(n){n.revert(n)}),e||Zn(this.getRoot(),!1)},listen:function(e){var n=this.__listening.length===0;this.__listening.push(e),n&&Xs(this.__listening)},updateDisplay:function(){S.each(this.__controllers,function(e){e.updateDisplay()}),S.each(this.__folders,function(e){e.updateDisplay()})}});function hr(t,e,n){var r=document.createElement("li");return e&&r.appendChild(e),n?t.__ul.insertBefore(r,n):t.__ul.appendChild(r),t.onResize(),r}function Yr(t){F.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&F.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function Zn(t,e){var n=t.__preset_select[t.__preset_select.selectedIndex];e?n.innerHTML=n.value+"*":n.innerHTML=n.value}function Bi(t,e,n){if(n.__li=e,n.__gui=t,S.extend(n,{options:function(c){if(arguments.length>1){var d=n.__li.nextElementSibling;return n.remove(),Rt(t,n.object,n.property,{before:d,factoryArgs:[S.toArray(arguments)]})}if(S.isArray(c)||S.isObject(c)){var m=n.__li.nextElementSibling;return n.remove(),Rt(t,n.object,n.property,{before:m,factoryArgs:[c]})}},name:function(c){return n.__li.firstElementChild.firstElementChild.innerHTML=c,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof $n){var r=new hn(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});S.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(o){var c=n[o],d=r[o];n[o]=r[o]=function(){var m=Array.prototype.slice.call(arguments);return d.apply(r,m),c.apply(n,m)}}),F.addClass(e,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof hn){var s=function(c){if(S.isNumber(n.__min)&&S.isNumber(n.__max)){var d=n.__li.firstElementChild.firstElementChild.innerHTML,m=n.__gui.__listening.indexOf(n)>-1;n.remove();var E=Rt(t,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return E.name(d),m&&E.listen(),E}return c};n.min=S.compose(s,n.min),n.max=S.compose(s,n.max)}else n instanceof Ns?(F.bind(e,"click",function(){F.fakeEvent(n.__checkbox,"click")}),F.bind(n.__checkbox,"click",function(o){o.stopPropagation()})):n instanceof Ks?(F.bind(e,"click",function(){F.fakeEvent(n.__button,"click")}),F.bind(e,"mouseover",function(){F.addClass(n.__button,"hover")}),F.bind(e,"mouseout",function(){F.removeClass(n.__button,"hover")})):n instanceof Wn&&(F.addClass(e,"color"),n.updateDisplay=S.compose(function(o){return e.style.borderLeftColor=n.__color.toString(),o},n.updateDisplay),n.updateDisplay());n.setValue=S.compose(function(o){return t.getRoot().__preset_select&&n.isModified()&&Zn(t.getRoot(),!0),o},n.setValue)}function Vs(t,e){var n=t.getRoot(),r=n.__rememberedObjects.indexOf(e.object);if(r!==-1){var s=n.__rememberedObjectIndecesToControllers[r];if(s===void 0&&(s={},n.__rememberedObjectIndecesToControllers[r]=s),s[e.property]=e,n.load&&n.load.remembered){var o=n.load.remembered,c=void 0;if(o[t.preset])c=o[t.preset];else if(o[Pt])c=o[Pt];else return;if(c[r]&&c[r][e.property]!==void 0){var d=c[r][e.property];e.initialValue=d,e.setValue(d)}}}}function Rt(t,e,n,r){if(e[n]===void 0)throw new Error('Object "'+e+'" has no property "'+n+'"');var s=void 0;if(r.color)s=new Wn(e,n);else{var o=[e,n].concat(r.factoryArgs);s=hi.apply(t,o)}r.before instanceof At&&(r.before=r.before.__li),Vs(t,s),F.addClass(s.domElement,"c");var c=document.createElement("span");F.addClass(c,"property-name"),c.innerHTML=s.property;var d=document.createElement("div");d.appendChild(c),d.appendChild(s.domElement);var m=hr(t,d,r.before);return F.addClass(m,oe.CLASS_CONTROLLER_ROW),s instanceof Wn?F.addClass(m,"color"):F.addClass(m,ri(s.getValue())),Bi(t,m,s),t.__controllers.push(s),s}function wt(t,e){return document.location.href+"."+e}function qn(t,e,n){var r=document.createElement("option");r.innerHTML=e,r.value=e,t.__preset_select.appendChild(r),n&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function $r(t,e){e.style.display=t.useLocalStorage?"block":"none"}function yi(t){var e=t.__save_row=document.createElement("li");F.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),F.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",F.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",F.addClass(r,"button"),F.addClass(r,"save");var s=document.createElement("span");s.innerHTML="New",F.addClass(s,"button"),F.addClass(s,"save-as");var o=document.createElement("span");o.innerHTML="Revert",F.addClass(o,"button"),F.addClass(o,"revert");var c=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?S.each(t.load.remembered,function(D,R){qn(t,R,R===t.preset)}):qn(t,Pt,!1),F.bind(c,"change",function(){for(var D=0;D<t.__preset_select.length;D++)t.__preset_select[D].innerHTML=t.__preset_select[D].value;t.preset=this.value}),e.appendChild(c),e.appendChild(n),e.appendChild(r),e.appendChild(s),e.appendChild(o),Gt){var d=document.getElementById("dg-local-explain"),m=document.getElementById("dg-local-storage"),E=document.getElementById("dg-save-locally");E.style.display="block",localStorage.getItem(wt(t,"isLocal"))==="true"&&m.setAttribute("checked","checked"),$r(t,d),F.bind(m,"change",function(){t.useLocalStorage=!t.useLocalStorage,$r(t,d)})}var M=document.getElementById("dg-new-constructor");F.bind(M,"keydown",function(D){D.metaKey&&(D.which===67||D.keyCode===67)&&St.hide()}),F.bind(n,"click",function(){M.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),St.show(),M.focus(),M.select()}),F.bind(r,"click",function(){t.save()}),F.bind(s,"click",function(){var D=prompt("Enter a new preset name.");D&&t.saveAs(D)}),F.bind(o,"click",function(){t.revert()})}function bi(t){var e=void 0;t.__resize_handle=document.createElement("div"),S.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function n(o){return o.preventDefault(),t.width+=e-o.clientX,t.onResize(),e=o.clientX,!1}function r(){F.removeClass(t.__closeButton,oe.CLASS_DRAG),F.unbind(window,"mousemove",n),F.unbind(window,"mouseup",r)}function s(o){return o.preventDefault(),e=o.clientX,F.addClass(t.__closeButton,oe.CLASS_DRAG),F.bind(window,"mousemove",n),F.bind(window,"mouseup",r),!1}F.bind(t.__resize_handle,"mousedown",s),F.bind(t.__closeButton,"mousedown",s),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function er(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function nn(t,e){var n={};return S.each(t.__rememberedObjects,function(r,s){var o={},c=t.__rememberedObjectIndecesToControllers[s];S.each(c,function(d,m){o[m]=e?d.initialValue:d.getValue()}),n[s]=o}),n}function _i(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}function Xs(t){t.length!==0&&gi.call(window,function(){Xs(t)}),S.each(t,function(e){e.updateDisplay()})}var Ci=oe,ae,Ht,Jt,N,Qs;const wi=45;var kt,Kt;async function Ei(){ae=document.getElementById("mainCanvas");const t=window.devicePixelRatio;if(ae.width=ae.clientWidth*t,ae.height=ae.clientHeight*t,Qs=ae.width/ae.height,!navigator.gpu){let n=document.createElement("h1");throw n.textContent="This browser doesn't support WebGPU! Try using Google Chrome.",n.style.paddingLeft="0.4em",document.body.innerHTML="",document.body.appendChild(n),new Error("WebGPU not supported on this browser")}const e=await navigator.gpu.requestAdapter();if(!e)throw new Error("no appropriate GPUAdapter found");N=await e.requestDevice(),Jt=ae.getContext("webgpu"),Ht=navigator.gpu.getPreferredCanvasFormat(),Jt.configure({device:N,format:Ht}),console.log("WebGPU init successsful"),kt=N.createBindGroupLayout({label:"model bind group layout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),Kt=N.createBindGroupLayout({label:"material bind group layout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]})}const Ar={arrayStride:32,attributes:[{format:"float32x3",offset:0,shaderLocation:0},{format:"float32x3",offset:12,shaderLocation:1},{format:"float32x2",offset:24,shaderLocation:2}]};class gr{scene;lights;camera;stats;prevTime=0;deltaTimeSum=0;deltaTimeCount=0;frameRequestId;constructor(e){this.scene=e.scene,this.lights=e.lights,this.camera=e.camera,this.stats=e.stats,this.frameRequestId=requestAnimationFrame(n=>this.onFrame(n))}stop(){cancelAnimationFrame(this.frameRequestId)}onFrame(e){this.prevTime==0&&(this.prevTime=e);let n=e-this.prevTime;if(this.camera.onFrame(n),this.lights.onFrame(e),this.stats.begin(),this.draw(),this.stats.end(),this.prevTime=e,this.frameRequestId=requestAnimationFrame(r=>this.onFrame(r)),this.deltaTimeSum+=n,this.deltaTimeCount++,this.deltaTimeCount%100===0){const r=this.deltaTimeSum/this.deltaTimeCount;console.log(`Average frame time over last ${this.deltaTimeCount} frames: ${r.toFixed(2)} ms (${(1e3/r).toFixed(2)} FPS)`)}}}const xi=`// CHECKITOUT: code that you add here will be prepended to all shaders

struct Light {
    pos: vec3f,
    color: vec3f
}

struct LightSet {
    numLights: u32,
    lights: array<Light>
}

// TODO-2: you may want to create a ClusterSet struct similar to LightSet
struct Cluster {
    numLights: u32,
    lightIndices: array<u32, \${maxLightsPerCluster}>
}

struct ClusterSet {
    numClustersX: u32,
    numClustersY: u32,
    clusters: array<Cluster>
}

struct CameraUniforms {
    // TODO-1.3: add an entry for the view proj mat (of type mat4x4f)
    viewProjMat: mat4x4<f32>,
    invProjMat: mat4x4f,
    viewMat: mat4x4<f32>,
}

// CHECKITOUT: this special attenuation function ensures lights don't affect geometry outside the maximum light radius
fn rangeAttenuation(distance: f32) -> f32 {
    return clamp(1.f - pow(distance / \${lightRadius}, 4.f), 0.f, 1.f) / (distance * distance);
}

fn calculateLightContrib(light: Light, posWorld: vec3f, nor: vec3f) -> vec3f {
    let vecToLight = light.pos - posWorld;
    let distToLight = length(vecToLight);

    let lambert = max(dot(nor, normalize(vecToLight)), 0.f);
    return light.color * lambert * rangeAttenuation(distToLight);
}

fn computeIndexZ(viewZ: f32) -> u32 {
    let z = -viewZ; // positive
    let index = (z - \${clusterNear}) / (\${clusterFar} - \${clusterNear}) * f32(\${numClustersZ});
    return u32(clamp(index, 0.f, f32(\${numClustersZ} - 0.5f)));
}

fn computeClusterIndex(fragPosition: vec4f, viewPosition: vec3f, numClustersX: u32, numClustersY: u32) -> u32 {
    let indexX = u32(fragPosition.x / f32(\${clusterPixelSize}));
    let indexY = u32(fragPosition.y / f32(\${clusterPixelSize}));
    let indexZ = computeIndexZ(viewPosition.z);
    return (indexX * numClustersY + indexY) * \${numClustersZ} + indexZ;
}
`,Mi=`// CHECKITOUT: you can use this vertex shader for all of the renderers

// TODO-1.3: add a uniform variable here for camera uniforms (of type CameraUniforms)
// make sure to use \${bindGroup_scene} for the group
@group(\${bindGroup_scene}) @binding(0) var<uniform> cameraUniforms: CameraUniforms;

@group(\${bindGroup_model}) @binding(0) var<uniform> modelMat: mat4x4f;

struct VertexInput
{
    @location(0) pos: vec3f,
    @location(1) nor: vec3f,
    @location(2) uv: vec2f
}

struct VertexOutput
{
    @builtin(position) fragPos: vec4f,
    @location(0) pos: vec3f,
    @location(1) nor: vec3f,
    @location(2) uv: vec2f,
    @location(3) viewPos: vec3f
}

@vertex
fn main(in: VertexInput) -> VertexOutput
{
    let modelPos = modelMat * vec4(in.pos, 1);
    let viewPos = cameraUniforms.viewMat * modelPos;

    var out: VertexOutput;
    out.fragPos = cameraUniforms.viewProjMat * modelPos; // TODO-1.3: replace ??? with the view proj mat from your CameraUniforms uniform variable
    out.pos = modelPos.xyz / modelPos.w;
    out.nor = in.nor;
    out.uv = in.uv;
    out.viewPos = viewPos.xyz / viewPos.w;
    return out;
}
`,Ti=`@group(\${bindGroup_scene}) @binding(1) var<storage, read> lightSet: LightSet;

@group(\${bindGroup_material}) @binding(0) var diffuseTex: texture_2d<f32>;
@group(\${bindGroup_material}) @binding(1) var diffuseTexSampler: sampler;

struct FragmentInput
{
    @location(0) pos: vec3f,
    @location(1) nor: vec3f,
    @location(2) uv: vec2f
}

@fragment
fn main(in: FragmentInput) -> @location(0) vec4f
{
    let diffuseColor = textureSample(diffuseTex, diffuseTexSampler, in.uv);
    if (diffuseColor.a < 0.5f) {
        discard;
    }

    var totalLightContrib = vec3f(0, 0, 0);
    for (var lightIdx = 0u; lightIdx < lightSet.numLights; lightIdx++) {
        let light = lightSet.lights[lightIdx];
        totalLightContrib += calculateLightContrib(light, in.pos, normalize(in.nor));
    }

    var finalColor = diffuseColor.rgb * totalLightContrib;
    return vec4(finalColor, 1);
}
`,vi=`// TODO-2: implement the Forward+ fragment shader

// See naive.fs.wgsl for basic fragment shader setup; this shader should use light clusters instead of looping over all lights

// ------------------------------------
// Shading process:
// ------------------------------------
// Determine which cluster contains the current fragment.
// Retrieve the number of lights that affect the current fragment from the cluster’s data.
// Initialize a variable to accumulate the total light contribution for the fragment.
// For each light in the cluster:
//     Access the light's properties using its index.
//     Calculate the contribution of the light based on its position, the fragment’s position, and the surface normal.
//     Add the calculated contribution to the total light accumulation.
// Multiply the fragment’s diffuse color by the accumulated light contribution.
// Return the final color, ensuring that the alpha component is set appropriately (typically to 1).

@group(\${bindGroup_scene}) @binding(1) var<storage, read> lightSet: LightSet;

@group(\${bindGroup_clusterSet}) @binding(0) var<storage, read> clusterSet: ClusterSet;

@group(\${bindGroup_material}) @binding(0) var diffuseTex: texture_2d<f32>;
@group(\${bindGroup_material}) @binding(1) var diffuseTexSampler: sampler;

struct FragmentInput
{
    @builtin(position) fragPos: vec4f,
    @location(0) pos: vec3f,
    @location(1) nor: vec3f,
    @location(2) uv: vec2f,
    @location(3) viewPos: vec3f,
}

@fragment
fn main(in: FragmentInput) -> @location(0) vec4f
{
    let diffuseColor = textureSample(diffuseTex, diffuseTexSampler, in.uv);
    if (diffuseColor.a < 0.5f) {
        discard;
    }

    var clusterIndex = computeClusterIndex(in.fragPos, in.viewPos, clusterSet.numClustersX, clusterSet.numClustersY);
    let numLights = clusterSet.clusters[clusterIndex].numLights;

    var totalLightContrib = vec3f(0.0f, 0.0f, 0.0f);
    for (var lightIdx = 0u; lightIdx < numLights; lightIdx++) {
        let light = lightSet.lights[clusterSet.clusters[clusterIndex].lightIndices[lightIdx]];
        totalLightContrib += calculateLightContrib(light, in.pos, normalize(in.nor));
    }

    let finalColor = diffuseColor.rgb * totalLightContrib;
    return vec4(finalColor, 1.0f);
}
`,Di=`// TODO-3: implement the Clustered Deferred G-buffer fragment shader

// This shader should only store G-buffer information and should not do any shading.

@group(\${bindGroup_material}) @binding(0) var diffuseTex: texture_2d<f32>;
@group(\${bindGroup_material}) @binding(1) var diffuseTexSampler: sampler;

struct FragmentInput
{
    @location(0) pos: vec3f,
    @location(1) nor: vec3f,
    @location(2) uv: vec2f
}

struct FragmentOutput {
    @location(0) albedo : vec4f,
    @location(1) normal : vec4f
};

@fragment
fn main(in: FragmentInput) -> FragmentOutput
{
    let diffuseColor = textureSample(diffuseTex, diffuseTexSampler, in.uv);
    if (diffuseColor.a < 0.5f) {
        discard;
    }

    var out: FragmentOutput;
    out.albedo = vec4(diffuseColor.rgb, 1.0);
    out.normal = vec4(normalize(in.nor), 1.0);

    return out;
}
`,Fi=`// TODO-3: implement the Clustered Deferred fullscreen vertex shader

// This shader should be very simple as it does not need all of the information passed by the the naive vertex shader.

struct VertexOutput
{
    @builtin(position) fragPos: vec4f,
    @location(0) uv: vec2f
}

@vertex
fn main(@builtin(vertex_index) index: u32) -> VertexOutput {
    // Use an oversized triangle to cover the screen.
    let positions = array<vec2f, 3>(
        vec2f(-1.0, -1.0),
        vec2f( 3.0, -1.0),
        vec2f(-1.0,  3.0)
    );
    let texCoords = array<vec2f, 3>(
        vec2f(0.0, 0.0),
        vec2f(2.0, 0.0),
        vec2f(0.0, 2.0)
    );

    var out: VertexOutput;
    out.fragPos = vec4f(positions[index], 0.0, 1.0);
    out.uv = texCoords[index];
    return out;
};
`,Gi=`// TODO-3: implement the Clustered Deferred fullscreen fragment shader

// Similar to the Forward+ fragment shader, but with vertex information coming from the G-buffer instead.

@group(\${bindGroup_scene}) @binding(0) var<uniform> cameraUniforms: CameraUniforms;
@group(\${bindGroup_scene}) @binding(1) var<storage, read> lightSet: LightSet;

@group(\${bindGroup_gBuffer}) @binding(0) var albedoTex: texture_2d<f32>;
@group(\${bindGroup_gBuffer}) @binding(1) var normalTex: texture_2d<f32>;
@group(\${bindGroup_gBuffer}) @binding(2) var depthTex: texture_depth_2d;
@group(\${bindGroup_gBuffer}) @binding(3) var texSampler: sampler;

@group(\${bindGroup_clusterSet}) @binding(0) var<storage, read> clusterSet: ClusterSet;

struct FragmentInput
{
    @builtin(position) fragPos: vec4f,
    @location(0) uv: vec2f,
}

@fragment
fn main(in: FragmentInput) -> @location(0) vec4f
{
    // NDC: +y is up; texture: +y is down.
    let uv = vec2f(in.uv.x, 1.0 - in.uv.y);

    let albedo = textureSample(albedoTex, texSampler, uv).xyz;
    let normal = textureSample(normalTex, texSampler, uv).xyz;
    let depth = textureLoad(depthTex, vec2<i32>(in.fragPos.xy), 0);

    let ndcPosition = vec4f(in.uv * 2.0f - 1.0f, depth, 1.0f);
    let viewPositionH = cameraUniforms.invProjMat * ndcPosition;
    let viewPosition = viewPositionH.xyz / viewPositionH.w;

    let viewNormal = normalize((cameraUniforms.viewMat * vec4f(normal, 0.0f)).xyz);

    let clusterIndex = computeClusterIndex(in.fragPos, viewPosition, clusterSet.numClustersX, clusterSet.numClustersY);
    let numLights = clusterSet.clusters[clusterIndex].numLights;

    var totalLightContrib = vec3f(0.0f, 0.0f, 0.0f);
    for (var lightIdx = 0u; lightIdx < numLights; lightIdx++) {
        let light = lightSet.lights[clusterSet.clusters[clusterIndex].lightIndices[lightIdx]];
        let lightViewPosition = (cameraUniforms.viewMat * vec4f(light.pos, 1.0)).xyz;

        let vectorToLight = lightViewPosition - viewPosition;
        let distanceToLight = length(vectorToLight);

        let lambert = max(dot(viewNormal, normalize(vectorToLight)), 0.0f);
        totalLightContrib += light.color * lambert * rangeAttenuation(distanceToLight);
    }

    let finalColor = albedo * totalLightContrib;
    return vec4f(albedo * totalLightContrib, 1.0f);
}
`,Ii=`@group(\${bindGroup_scene}) @binding(0) var<storage, read_write> lightSet: LightSet;
@group(\${bindGroup_scene}) @binding(1) var<uniform> time: f32;

// https://gist.github.com/munrocket/236ed5ba7e409b8bdf1ff6eca5dcdc39
// MIT License. © Stefan Gustavson, Munrocket
fn permute4(x: vec4f) -> vec4f { return ((x * 34. + 1.) * x) % vec4f(289.); }
fn fade2(t: vec2f) -> vec2f { return t * t * t * (t * (t * 6. - 15.) + 10.); }

fn perlin(P: vec2f) -> f32 {
    var Pi: vec4f = floor(P.xyxy) + vec4f(0., 0., 1., 1.);
    let Pf = fract(P.xyxy) - vec4f(0., 0., 1., 1.);
    Pi = Pi % vec4f(289.); // To avoid truncation effects in permutation
    let ix = Pi.xzxz;
    let iy = Pi.yyww;
    let fx = Pf.xzxz;
    let fy = Pf.yyww;
    let i = permute4(permute4(ix) + iy);
    var gx: vec4f = 2. * fract(i * 0.0243902439) - 1.; // 1/41 = 0.024...
    let gy = abs(gx) - 0.5;
    let tx = floor(gx + 0.5);
    gx = gx - tx;
    var g00: vec2f = vec2f(gx.x, gy.x);
    var g10: vec2f = vec2f(gx.y, gy.y);
    var g01: vec2f = vec2f(gx.z, gy.z);
    var g11: vec2f = vec2f(gx.w, gy.w);
    let norm = 1.79284291400159 - 0.85373472095314 *
        vec4f(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11));
    g00 = g00 * norm.x;
    g01 = g01 * norm.y;
    g10 = g10 * norm.z;
    g11 = g11 * norm.w;
    let n00 = dot(g00, vec2f(fx.x, fy.x));
    let n10 = dot(g10, vec2f(fx.y, fy.y));
    let n01 = dot(g01, vec2f(fx.z, fy.z));
    let n11 = dot(g11, vec2f(fx.w, fy.w));
    let fade_xy = fade2(Pf.xy);
    let n_x = mix(vec2f(n00, n01), vec2f(n10, n11), vec2f(fade_xy.x));
    let n_xy = mix(n_x.x, n_x.y, fade_xy.y);
    return 2.3 * n_xy;
}

fn perlin3(lightIdx: u32, scaledTime: f32) -> vec3f {
    let seedPos = vec2f(f32(lightIdx) * 163.81f, scaledTime);
    return vec3f(perlin(seedPos), perlin(seedPos + 110.93), perlin(seedPos + 350.51));
}

const bboxMin = vec3f(-10, 0, -5);
const bboxMax = vec3f(10, 8, 5);

// CHECKITOUT: this is an example of a compute shader entry point function
@compute
@workgroup_size(\${moveLightsWorkgroupSize})
fn main(@builtin(global_invocation_id) globalIdx: vec3u) {
    let lightIdx = globalIdx.x;
    if (lightIdx >= lightSet.numLights) {
        return;
    }

    let scaledTime = time / 5000.f;

    let noise = perlin3(lightIdx, scaledTime);
    // perlin noise rarely reaches the extremes (-1 and 1), so scale accordingly here to ensure lights reach
    // the bounding box's sides
    let scaledNoise = (noise + 0.5) * 0.8;
    lightSet.lights[lightIdx].pos = mix(bboxMin, bboxMax, scaledNoise);
}
`,Si=`// TODO-2: implement the light clustering compute shader

// ------------------------------------
// Calculating cluster bounds:
// ------------------------------------
// For each cluster (X, Y, Z):
//     - Calculate the screen-space bounds for this cluster in 2D (XY).
//     - Calculate the depth bounds for this cluster in Z (near and far planes).
//     - Convert these screen and depth bounds into view-space coordinates.
//     - Store the computed bounding box (AABB) for the cluster.

// ------------------------------------
// Assigning lights to clusters:
// ------------------------------------
// For each cluster:
//     - Initialize a counter for the number of lights in this cluster.

//     For each light:
//         - Check if the light intersects with the cluster’s bounding box (AABB).
//         - If it does, add the light to the cluster's light list.
//         - Stop adding lights if the maximum number of lights is reached.

//     - Store the number of lights assigned to this cluster.

@group(0) @binding(0) var<uniform> cameraUniforms: CameraUniforms;

@group(1) @binding(0) var<storage, read> lightSet: LightSet;
@group(1) @binding(1) var<storage, read_write> clusterSet: ClusterSet;

fn computeRayDirection(ndcX: f32, ndcY: f32) -> vec3f {
    let position = cameraUniforms.invProjMat * vec4f(ndcX, ndcY, 1.0f, 1.0f);
    return normalize(position.xyz / position.w); 
}

fn isSphereIntersectingFrustum(normals: array<vec3f, 6>, offsets: array<f32, 6>, center: vec3f, radius: f32) -> bool {
    for (var i: u32 = 0u; i < 6u; i += 1u) {
        let distance = dot(normals[i], center) - offsets[i];
        if (distance > radius) {
            return false;
        }
    }
    return true;
}

@compute @workgroup_size(\${clusteringWorkGroupSize})
fn main(@builtin(global_invocation_id) globalID: vec3u) {
    let sizeYZ = clusterSet.numClustersY * \${numClustersZ};
    let sizeXYZ = clusterSet.numClustersX * sizeYZ;
    let indexXYZ = globalID.x;
    if (indexXYZ >= sizeXYZ) {
        return;
    }
    let indexX = indexXYZ / sizeYZ;
    let indexYZ = indexXYZ - indexX * sizeYZ;
    let indexY = indexYZ / \${numClustersZ};
    let indexZ = indexYZ - indexY * \${numClustersZ};

    // [-1, 1] NDC coordinates
    let xMin = f32(indexX) / f32(clusterSet.numClustersX) * 2.0f - 1.0f;
    let xMax = f32(indexX + 1u) / f32(clusterSet.numClustersX) * 2.0f - 1.0f;
    let yMin = f32(indexY) / f32(clusterSet.numClustersY) * 2.0f - 1.0f;
    let yMax = f32(indexY + 1u) / f32(clusterSet.numClustersY) * 2.0f - 1.0f;

    // Linear depth values (positive)
    let zNear = mix(\${clusterNear}, \${clusterFar}, f32(indexZ) / f32(\${numClustersZ}));
    let zFar = mix(\${clusterNear}, \${clusterFar}, f32(indexZ + 1u) / f32(\${numClustersZ}));

    // Ray directions for the four corners of the frustum (view space)
    let rayBL = computeRayDirection(xMin, yMin); // bottom-left
    let rayBR = computeRayDirection(xMax, yMin); // bottom-right
    let rayTL = computeRayDirection(xMin, yMax); // top-left
    let rayTR = computeRayDirection(xMax, yMax); // top-right

    // Plane normals (view space)
    let planeNormals = array<vec3f, 6>(
        vec3f(0.0f, 0.0f, 1.0f), // near
        vec3f(0.0f, 0.0f, -1.0f), // far
        normalize(cross(rayTL, rayBL)), // left
        normalize(cross(rayBR, rayTR)), // right
        normalize(cross(rayBL, rayBR)), // bottom
        normalize(cross(rayTR, rayTL))  // top
    );
    // dot(normal, point) - offset > 0 => outside plane
    let planeOffsets = array<f32, 6>(
        -zNear,  // near
        zFar,   // far
        0.0f,     // left
        0.0f,     // right
        0.0f,     // bottom
        0.0f      // top
    );

    var numLights: u32 = 0u;
    for (var i: u32 = 0u; i < lightSet.numLights && numLights < \${maxLightsPerCluster}; i += 1u) {
        let light = lightSet.lights[i];
        // View space position of the light
        let position = (cameraUniforms.viewMat * vec4f(light.pos, 1.0f)).xyz;
        if (isSphereIntersectingFrustum(planeNormals, planeOffsets, position, \${lightRadius})) {
            clusterSet.clusters[indexXYZ].lightIndices[numLights] = i;
            numLights += 1u;
        }
    }
    clusterSet.clusters[indexXYZ].numLights = numLights;
}
`,ue={bindGroup_scene:0,bindGroup_model:1,bindGroup_gBuffer:1,bindGroup_material:2,bindGroup_clusterSet:3,moveLightsWorkgroupSize:128,lightRadius:2,clusterPixelSize:64,numClustersZ:16,maxLightsPerCluster:511,clusterNear:.01,clusterFar:30,clusteringWorkGroupSize:128},Ri=/\$\{([A-Za-z0-9_]+)\}/g;function zs(t){return t.replace(Ri,(e,n)=>{if(!(n in ue))throw new Error(`Unknown shader constant: ${n}`);return String(ue[n])})}const Oi=zs(xi);function lt(t){return Oi+zs(t)}const pr=lt(Mi),Li=lt(Ti),Ui=lt(vi),Pi=lt(Di),Hi=lt(Fi),Ji=lt(Gi),Ni=lt(Ii),ki=lt(Si);class Ki extends gr{sceneUniformsBindGroupLayout;sceneUniformsBindGroup;depthTexture;depthTextureView;pipeline;constructor(e){super(e),this.sceneUniformsBindGroupLayout=N.createBindGroupLayout({label:"scene uniforms bind group layout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),this.sceneUniformsBindGroup=N.createBindGroup({label:"scene uniforms bind group",layout:this.sceneUniformsBindGroupLayout,entries:[{binding:0,resource:{buffer:this.camera.uniformsBuffer}},{binding:1,resource:{buffer:this.lights.lightSetStorageBuffer}}]}),this.depthTexture=N.createTexture({size:[ae.width,ae.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.depthTextureView=this.depthTexture.createView(),this.pipeline=N.createRenderPipeline({layout:N.createPipelineLayout({label:"naive pipeline layout",bindGroupLayouts:[this.sceneUniformsBindGroupLayout,kt,Kt]}),depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"},vertex:{module:N.createShaderModule({label:"naive vert shader",code:pr}),buffers:[Ar]},fragment:{module:N.createShaderModule({label:"naive frag shader",code:Li}),targets:[{format:Ht}]}})}draw(){const e=N.createCommandEncoder(),n=Jt.getCurrentTexture().createView(),r=e.beginRenderPass({label:"naive render pass",colorAttachments:[{view:n,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthTextureView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});r.setPipeline(this.pipeline),r.setBindGroup(ue.bindGroup_scene,this.sceneUniformsBindGroup),this.scene.iterate(s=>{r.setBindGroup(ue.bindGroup_model,s.modelBindGroup)},s=>{r.setBindGroup(ue.bindGroup_material,s.materialBindGroup)},s=>{r.setVertexBuffer(0,s.vertexBuffer),r.setIndexBuffer(s.indexBuffer,"uint32"),r.drawIndexed(s.numIndices)}),r.end(),N.queue.submit([e.finish()])}}class ji extends gr{sceneUniformsBindGroupLayout;sceneUniformsBindGroup;clusterSetBindGroupLayout;clusterSetBindGroup;depthTexture;depthTextureView;pipeline;constructor(e){super(e),this.sceneUniformsBindGroupLayout=N.createBindGroupLayout({label:"scene uniforms bind group layout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),this.sceneUniformsBindGroup=N.createBindGroup({label:"scene uniforms bind group",layout:this.sceneUniformsBindGroupLayout,entries:[{binding:0,resource:{buffer:this.camera.uniformsBuffer}},{binding:1,resource:{buffer:this.lights.lightSetStorageBuffer}}]}),this.clusterSetBindGroupLayout=N.createBindGroupLayout({label:"cluster set bind group layout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),this.clusterSetBindGroup=N.createBindGroup({label:"cluster set bind group",layout:this.clusterSetBindGroupLayout,entries:[{binding:0,resource:{buffer:this.lights.clusterSetStorageBuffer}}]}),this.depthTexture=N.createTexture({size:[ae.width,ae.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.depthTextureView=this.depthTexture.createView(),this.pipeline=N.createRenderPipeline({layout:N.createPipelineLayout({label:"forward plus pipeline layout",bindGroupLayouts:[this.sceneUniformsBindGroupLayout,kt,Kt,this.clusterSetBindGroupLayout]}),depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"},vertex:{module:N.createShaderModule({label:"forward plus vert shader",code:pr}),buffers:[Ar]},fragment:{module:N.createShaderModule({label:"forward plus frag shader",code:Ui}),targets:[{format:Ht}]}})}draw(){const e=N.createCommandEncoder(),n=Jt.getCurrentTexture().createView();this.lights.doLightClustering(e);const r=e.beginRenderPass({label:"forward plus render pass",colorAttachments:[{view:n,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthTextureView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});r.setPipeline(this.pipeline),r.setBindGroup(ue.bindGroup_scene,this.sceneUniformsBindGroup),r.setBindGroup(ue.bindGroup_clusterSet,this.clusterSetBindGroup),this.scene.iterate(s=>{r.setBindGroup(ue.bindGroup_model,s.modelBindGroup)},s=>{r.setBindGroup(ue.bindGroup_material,s.materialBindGroup)},s=>{r.setVertexBuffer(0,s.vertexBuffer),r.setIndexBuffer(s.indexBuffer,"uint32"),r.drawIndexed(s.numIndices)}),r.end(),N.queue.submit([e.finish()])}}class Vi extends gr{sceneUniformsBindGroupLayout;sceneUniformsBindGroup;clusterSetBindGroupLayout;clusterSetBindGroup;gBufferBindGroupLayout;gBufferBindGroup;depthTexture;depthTextureView;albedoTexture;albedoTextureView;normalTexture;normalTextureView;texSampler;geometryPipeline;lightingPipeline;constructor(e){super(e),this.sceneUniformsBindGroupLayout=N.createBindGroupLayout({label:"scene uniforms bind group layout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),this.sceneUniformsBindGroup=N.createBindGroup({label:"scene uniforms bind group",layout:this.sceneUniformsBindGroupLayout,entries:[{binding:0,resource:{buffer:this.camera.uniformsBuffer}},{binding:1,resource:{buffer:this.lights.lightSetStorageBuffer}}]}),this.clusterSetBindGroupLayout=N.createBindGroupLayout({label:"cluster set bind group layout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),this.clusterSetBindGroup=N.createBindGroup({label:"cluster set bind group",layout:this.clusterSetBindGroupLayout,entries:[{binding:0,resource:{buffer:this.lights.clusterSetStorageBuffer}}]}),this.depthTexture=N.createTexture({size:[ae.width,ae.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),this.depthTextureView=this.depthTexture.createView(),this.albedoTexture=N.createTexture({size:[ae.width,ae.height],format:"rgba8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),this.albedoTextureView=this.albedoTexture.createView(),this.normalTexture=N.createTexture({size:[ae.width,ae.height],format:"rgba16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),this.normalTextureView=this.normalTexture.createView(),this.texSampler=N.createSampler({magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge"}),this.gBufferBindGroupLayout=N.createBindGroupLayout({label:"G-buffer bind group layout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"depth"}},{binding:3,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]}),this.gBufferBindGroup=N.createBindGroup({label:"G-buffer bind group",layout:this.gBufferBindGroupLayout,entries:[{binding:0,resource:this.albedoTextureView},{binding:1,resource:this.normalTextureView},{binding:2,resource:this.depthTextureView},{binding:3,resource:this.texSampler}]}),this.geometryPipeline=N.createRenderPipeline({layout:N.createPipelineLayout({label:"geometry pipeline layout",bindGroupLayouts:[this.sceneUniformsBindGroupLayout,kt,Kt]}),depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"},vertex:{module:N.createShaderModule({label:"clustered deferred geometry vert shader",code:pr}),buffers:[Ar]},fragment:{module:N.createShaderModule({label:"clustered deferred geometry frag shader",code:Pi}),targets:[{format:"rgba8unorm"},{format:"rgba16float"}]}}),this.lightingPipeline=N.createRenderPipeline({layout:N.createPipelineLayout({label:"lighting pipeline layout",bindGroupLayouts:[this.sceneUniformsBindGroupLayout,this.gBufferBindGroupLayout,null,this.clusterSetBindGroupLayout]}),vertex:{module:N.createShaderModule({label:"clustered deferred lighting vert shader",code:Hi}),buffers:[]},fragment:{module:N.createShaderModule({label:"clustered deferred lighting frag shader",code:Ji}),targets:[{format:Ht}]}})}draw(){const e=N.createCommandEncoder(),n=Jt.getCurrentTexture().createView();this.lights.doLightClustering(e);const r=e.beginRenderPass({label:"clustered deferred geometry pass",colorAttachments:[{view:this.albedoTextureView,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"},{view:this.normalTextureView,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthTextureView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});r.setPipeline(this.geometryPipeline),r.setBindGroup(ue.bindGroup_scene,this.sceneUniformsBindGroup),this.scene.iterate(o=>{r.setBindGroup(ue.bindGroup_model,o.modelBindGroup)},o=>{r.setBindGroup(ue.bindGroup_material,o.materialBindGroup)},o=>{r.setVertexBuffer(0,o.vertexBuffer),r.setIndexBuffer(o.indexBuffer,"uint32"),r.drawIndexed(o.numIndices)}),r.end();const s=e.beginRenderPass({label:"clustered deferred lighting pass",colorAttachments:[{view:n,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}]});s.setPipeline(this.lightingPipeline),s.setBindGroup(ue.bindGroup_scene,this.sceneUniformsBindGroup),s.setBindGroup(ue.bindGroup_gBuffer,this.gBufferBindGroup),s.setBindGroup(ue.bindGroup_clusterSet,this.clusterSetBindGroup),s.draw(3),s.end(),N.queue.submit([e.finish()])}}async function Ys(t,e,n,r){return r._parse(t,e,n,r)}function rt(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Cn=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Wr=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Wr&&parseFloat(Wr[1]);const Zr=globalThis,qr=globalThis.process||{};function Xi(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const n=typeof navigator<"u"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function mr(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||Xi()}const $s="4.1.0";function Qi(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class zi{constructor(e,n,r="sessionStorage"){this.storage=Qi(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function Yi(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function $i(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var An;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(An||(An={}));const Wi=10;function es(t){return typeof t!="string"?t:(t=t.toUpperCase(),An[t]||An.WHITE)}function Zi(t,e,n){return!mr&&typeof t=="string"&&(e&&(t=`\x1B[${es(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${es(n)+Wi}m${t}\x1B[49m`)),t}function qi(t,e=["constructor"]){const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),s=t;for(const o of r){const c=s[o];typeof c=="function"&&(e.find(d=>o===d)||(s[o]=c.bind(t)))}}function Br(t,e){if(!t)throw new Error("Assertion failed")}function mt(){let t;if(mr()&&Zr.performance)t=Zr?.performance?.now?.();else if("hrtime"in qr){const e=qr?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}const Bt={debug:mr()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},ea={enabled:!0,level:0};function yt(){}const ts={},ns={once:!0};class yr{constructor({id:e}={id:""}){this.VERSION=$s,this._startTs=mt(),this._deltaTs=mt(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new zi(`__probe-${this.id}__`,ea),this.timeStamp(`${this.id} started`),qi(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((mt()-this._startTs).toPrecision(10))}getDelta(){return Number((mt()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Bt.warn,arguments,ns)}error(e){return this._getLogFunction(0,e,Bt.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,Bt.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Bt.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,Bt.debug||Bt.info,arguments,ns)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||yt,r&&[r],{tag:na(n)}):yt}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||yt)}group(e,n,r={collapsed:!1}){const s=rs({logLevel:e,message:n,opts:r}),{collapsed:o}=r;return s.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,n,r={}){return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||yt)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Ws(e)}_getLogFunction(e,n,r,s,o){if(this._shouldLog(e)){o=rs({logLevel:e,message:n,args:s,opts:o}),r=r||o.method,Br(r),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=mt();const c=o.tag||o.message;if(o.once&&c)if(!ts[c])ts[c]=mt();else return yt;return n=ta(this.id,o.message,o),r.bind(console,n,...o.args)}return yt}}yr.VERSION=$s;function Ws(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Br(Number.isFinite(e)&&e>=0),e}function rs(t){const{logLevel:e,message:n}=t;t.logLevel=Ws(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const s=typeof t.message;return Br(s==="string"||s==="object"),Object.assign(t,{args:r},t.opts)}function ta(t,e,n){if(typeof e=="string"){const r=n.time?$i(Yi(n.total)):"";e=n.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=Zi(e,n.color,n.background)}return e}function na(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const Fn="4.3.3",ra=Fn[0]>="0"&&Fn[0]<="9"?`v${Fn}`:"";function sa(){const t=new yr({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=ra,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const oa=sa();function ia(t,e){return Zs(t||{},e)}function Zs(t,e,n=0){if(n>3)return e;const r={...t};for(const[s,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?r[s]=Zs(r[s]||{},e[s],n+1):r[s]=e[s];return r}function aa(t){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,t)}function ca(t){return globalThis.loaders?.modules?.[t]||null}const ua="latest";function fa(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const qs=fa();function st(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Xe=typeof process!="object"||String(process)!=="[object process]"||process.browser,br=typeof importScripts=="function",la=typeof window<"u"&&typeof window.orientation<"u",ss=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);ss&&parseFloat(ss[1]);class da{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,n){this.name=e,this.workerThread=n,this.result=new Promise((r,s)=>{this._resolve=r,this._reject=s})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){st(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){st(this.isRunning),this.isRunning=!1,this._reject(e)}}class Gn{terminate(){}}const In=new Map;function ha(t){st(t.source&&!t.url||!t.source&&t.url);let e=In.get(t.source||t.url);return e||(t.url&&(e=Aa(t.url),In.set(t.url,e)),t.source&&(e=eo(t.source),In.set(t.source,e))),st(e),e}function Aa(t){if(!t.startsWith("http"))return t;const e=ga(t);return eo(e)}function eo(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function ga(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function to(t,e=!0,n){const r=n||new Set;if(t){if(os(t))r.add(t);else if(os(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const s in t)to(t[s],e,r)}}return n===void 0?Array.from(r):[]}function os(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Sn=()=>{};class tr{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&Xe||typeof Gn<"u"&&!Xe}constructor(e){const{name:n,source:r,url:s}=e;st(r||s),this.name=n,this.source=r,this.url=s,this.onMessage=Sn,this.onError=o=>console.log(o),this.worker=Xe?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Sn,this.onError=Sn,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||to(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=ha({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Gn(r,{eval:!1})}else if(this.source)e=new Gn(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class pa{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return tr.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(s,o,c)=>s.done(c),r=(s,o)=>s.error(o)){const s=new Promise(o=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:o}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new da(n.name,e);e.onMessage=s=>n.onMessage(r,s.type,s.payload),e.onError=s=>n.onError(r,s),n.onStart(r);try{await r.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Xe||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new tr({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return la?this.maxMobileConcurrency:this.maxConcurrency}}const ma={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class ot{props;workerPools=new Map;static _workerFarm;static isSupported(){return tr.isSupported()}static getWorkerFarm(e={}){return ot._workerFarm=ot._workerFarm||new ot({}),ot._workerFarm.setProps(e),ot._workerFarm}constructor(e){this.props={...ma},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:s}=e;let o=this.workerPools.get(n);return o||(o=new pa({name:n,source:r,url:s}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function Ba(t,e={}){const n=e[t.id]||{},r=Xe?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let s=n.workerUrl;if(!s&&t.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(Xe?s=`modules/${t.module}/dist/${r}`:s=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!s){let o=t.version;o==="latest"&&(o=ua);const c=o?`@${o}`:"";s=`https://unpkg.com/@loaders.gl/${t.module}${c}/dist/${r}`}return st(s),s}function ya(t,e=qs){st(t,"no worker provided");const n=t.version;return!(!e||!n)}const Rn={};async function ht(t,e=null,n={},r=null){return e&&(t=ba(t,e,n,r)),Rn[t]=Rn[t]||_a(t),await Rn[t]}function ba(t,e,n={},r=null){if(!n.useLocalLibraries&&t.startsWith("http"))return t;r=r||t;const s=n.modules||{};return s[r]?s[r]:Xe?n.CDN?(st(n.CDN.startsWith("http")),`${n.CDN}/${e}@${qs}/dist/libs/${r}`):br?`../src/libs/${r}`:`modules/${e}/src/libs/${r}`:`modules/${e}/dist/libs/${r}`}async function _a(t){if(t.endsWith("wasm"))return await wa(t);if(!Xe)try{const{requireFromFile:n}=globalThis.loaders||{};return await n?.(t)}catch(n){return console.error(n),null}if(br)return importScripts(t);const e=await Ea(t);return Ca(e,t)}function Ca(t,e){if(!Xe){const{requireFromString:r}=globalThis.loaders||{};return r?.(t,e)}if(br)return eval.call(globalThis,t),null;const n=document.createElement("script");n.id=e;try{n.appendChild(document.createTextNode(t))}catch{n.text=t}return document.body.appendChild(n),null}async function wa(t){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return Xe||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function Ea(t){const{readFileAsText:e}=globalThis.loaders||{};return Xe||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}function xa(t,e){return!ot.isSupported()||!Xe&&!e?._nodeWorkers?!1:t.worker&&e?.worker}async function Ma(t,e,n,r,s){const o=t.id,c=Ba(t,n),m=ot.getWorkerFarm(n).getWorkerPool({name:o,url:c});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const E=await m.startJob("process-on-worker",Ta.bind(null,s));return E.postMessage("process",{input:e,options:n,context:r}),await(await E.result).result}async function Ta(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:s,input:o,options:c}=r;try{const d=await t(o,c);e.postMessage("done",{id:s,result:d})}catch(d){const m=d instanceof Error?d.message:"unknown error";e.postMessage("error",{id:s,error:m})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function va(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?is(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?is(t,0,e):""}function is(t,e,n){if(t.byteLength<=e+n)return"";const r=new DataView(t);let s="";for(let o=0;o<n;o++)s+=String.fromCharCode(r.getUint8(e+o));return s}function Da(t){try{return JSON.parse(t)}catch{throw new Error(`Failed to parse JSON from data starting with "${va(t)}"`)}}function Fa(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),s=new Uint8Array(e);for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0}function Ga(...t){return Ia(t)}function Ia(t){const e=t.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),n=e.reduce((o,c)=>o+c.byteLength,0),r=new Uint8Array(n);let s=0;for(const o of e)r.set(o,s),s+=o.byteLength;return r.buffer}function no(t,e,n){const r=n!==void 0?new Uint8Array(t).subarray(e,e+n):new Uint8Array(t).subarray(e);return new Uint8Array(r).buffer}function jt(t,e){return rt(t>=0),rt(e>0),t+(e-1)&-4}function Sa(t,e,n){let r;if(t instanceof ArrayBuffer)r=new Uint8Array(t);else{const s=t.byteOffset,o=t.byteLength;r=new Uint8Array(t.buffer||t.arrayBuffer,s,o)}return e.set(r,n),n+jt(r.byteLength,4)}async function Ra(t){const e=[];for await(const n of t)e.push(n);return Ga(...e)}let Oa="";const as={};function La(t){for(const e in as)if(t.startsWith(e)){const n=as[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${Oa}${t}`),t}function Ua(t){return t&&typeof t=="object"&&t.isBuffer}function ro(t){if(Ua(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function so(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function Pa(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const Ha=t=>typeof t=="boolean",Ot=t=>typeof t=="function",Vt=t=>t!==null&&typeof t=="object",cs=t=>Vt(t)&&t.constructor==={}.constructor,Ja=t=>!!t&&typeof t[Symbol.iterator]=="function",Na=t=>t&&typeof t[Symbol.asyncIterator]=="function",gt=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,pt=t=>typeof Blob<"u"&&t instanceof Blob,ka=t=>t&&typeof t=="object"&&t.isBuffer,Ka=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Vt(t)&&Ot(t.tee)&&Ot(t.cancel)&&Ot(t.getReader),ja=t=>Vt(t)&&Ot(t.read)&&Ot(t.pipe)&&Ha(t.readable),oo=t=>Ka(t)||ja(t);class Va extends Error{constructor(e,n){super(e),this.reason=n.reason,this.url=n.url,this.response=n.response}reason;url;response}const Xa=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Qa=/^([-\w.]+\/[-\w.+]+)/;function us(t,e){return t.toLowerCase()===e.toLowerCase()}function za(t){const e=Qa.exec(t);return e?e[1]:t}function fs(t){const e=Xa.exec(t);return e?e[1]:""}const io=/\?.*/;function Ya(t){const e=t.match(io);return e&&e[0]}function _r(t){return t.replace(io,"")}function $a(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function wn(t){return gt(t)?t.url:pt(t)?t.name||"":typeof t=="string"?t:""}function Cr(t){if(gt(t)){const e=t,n=e.headers.get("content-type")||"",r=_r(e.url);return za(n)||fs(r)}return pt(t)?t.type||"":typeof t=="string"?fs(t):""}function Wa(t){return gt(t)?t.headers["content-length"]||-1:pt(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function ao(t){if(gt(t))return t;const e={},n=Wa(t);n>=0&&(e["content-length"]=String(n));const r=wn(t),s=Cr(t);s&&(e["content-type"]=s);const o=await ec(t);o&&(e["x-first-bytes"]=o),typeof t=="string"&&(t=new TextEncoder().encode(t));const c=new Response(t,{headers:e});return Object.defineProperty(c,"url",{value:r}),c}async function Za(t){if(!t.ok)throw await qa(t)}async function qa(t){const e=$a(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const r={reason:t.statusText,url:t.url,response:t};try{const s=t.headers.get("Content-Type");r.reason=!t.bodyUsed&&s?.includes("application/json")?await t.json():await t.text()}catch{}return new Va(n,r)}async function ec(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const s=new FileReader;s.onload=o=>r(o?.target?.result),s.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${tc(n)}`}return null}function tc(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function nc(t){return!rc(t)&&!sc(t)}function rc(t){return t.startsWith("http:")||t.startsWith("https:")}function sc(t){return t.startsWith("data:")}async function ls(t,e){if(typeof t=="string"){const n=La(t);return nc(n)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(n,e):await fetch(n,e)}return await ao(t)}const ds=new yr({id:"loaders.gl"});class oc{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class ic{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const co={fetch:null,mimeType:void 0,nothrow:!1,log:new ic,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Cn,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},ac={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function uo(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function fo(){const t=uo();return t.globalOptions=t.globalOptions||{...co},t.globalOptions}function cc(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],uc(t,n),lc(e,t,r)}function uc(t,e){hs(t,null,co,ac,e);for(const n of e){const r=t&&t[n.id]||{},s=n.options&&n.options[n.id]||{},o=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};hs(r,n.id,s,o,e)}}function hs(t,e,n,r,s){const o=e||"Top level",c=e?`${e}.`:"";for(const d in t){const m=!e&&Vt(t[d]),E=d==="baseUri"&&!e,M=d==="workerUrl"&&e;if(!(d in n)&&!E&&!M){if(d in r)ds.warn(`${o} loader option '${c}${d}' no longer supported, use '${r[d]}'`)();else if(!m){const D=fc(d,s);ds.warn(`${o} loader option '${c}${d}' not recognized. ${D}`)()}}}}function fc(t,e){const n=t.toLowerCase();let r="";for(const s of e)for(const o in s.options){if(t===o)return`Did you mean '${s.id}.${o}'?`;const c=o.toLowerCase();(n.startsWith(c)||c.startsWith(n))&&(r=r||`Did you mean '${s.id}.${o}'?`)}return r}function lc(t,e,n){const s={...t.options||{}};return dc(s,n),s.log===null&&(s.log=new oc),As(s,fo()),As(s,e),s}function As(t,e){for(const n in e)if(n in e){const r=e[n];cs(r)&&cs(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function dc(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function wr(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t?.extensions)):!1}function Er(t){rt(t,"null loader"),rt(wr(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t?.parseTextSync||t?.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const lo=()=>{const t=uo();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function hc(t){const e=lo();t=Array.isArray(t)?t:[t];for(const n of t){const r=Er(n);e.find(s=>r===s)||e.unshift(r)}}function Ac(){return lo()}const gc=/\.([^.]+)$/;async function pc(t,e=[],n,r){if(!ho(t))return null;let s=gs(t,e,{...n,nothrow:!0},r);if(s)return s;if(pt(t)&&(t=await t.slice(0,10).arrayBuffer(),s=gs(t,e,n,r)),!s&&!n?.nothrow)throw new Error(Ao(t));return s}function gs(t,e=[],n,r){if(!ho(t))return null;if(e&&!Array.isArray(e))return Er(e);let s=[];e&&(s=s.concat(e)),n?.ignoreRegisteredLoaders||s.push(...Ac()),Bc(s);const o=mc(t,s,n,r);if(!o&&!n?.nothrow)throw new Error(Ao(t));return o}function mc(t,e,n,r){const s=wn(t),o=Cr(t),c=_r(s)||r?.url;let d=null,m="";return n?.mimeType&&(d=On(e,n?.mimeType),m=`match forced by supplied MIME type ${n?.mimeType}`),d=d||yc(e,c),m=m||(d?`matched url ${c}`:""),d=d||On(e,o),m=m||(d?`matched MIME type ${o}`:""),d=d||_c(e,t),m=m||(d?`matched initial data ${go(t)}`:""),n?.fallbackMimeType&&(d=d||On(e,n?.fallbackMimeType),m=m||(d?`matched fallback MIME type ${o}`:"")),m&&oa.log(1,`selectLoader selected ${d?.name}: ${m}.`),d}function ho(t){return!(t instanceof Response&&t.status===204)}function Ao(t){const e=wn(t),n=Cr(t);let r="No valid loader found (";r+=e?`${so(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const s=t?go(t):"";return r+=s?` first bytes: "${s}"`:"first bytes: not available",r+=")",r}function Bc(t){for(const e of t)Er(e)}function yc(t,e){const n=e&&gc.exec(e),r=n&&n[1];return r?bc(t,r):null}function bc(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function On(t,e){for(const n of t)if(n.mimeTypes?.some(r=>us(e,r))||us(e,`application/x.${n.id}`))return n;return null}function _c(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(Cc(e,n))return n}else if(ArrayBuffer.isView(e)){if(ps(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&ps(e,0,n))return n;return null}function Cc(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function ps(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(s=>wc(t,e,n,s))}function wc(t,e,n,r){if(r instanceof ArrayBuffer)return Fa(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const s=nr(t,e,r.length);return r===s;default:return!1}}function go(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?nr(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?nr(t,0,e):""}function nr(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let s="";for(let o=0;o<n;o++)s+=String.fromCharCode(r.getUint8(e+o));return s}const Ec=256*1024;function*xc(t,e){const n=e?.chunkSize||Ec;let r=0;const s=new TextEncoder;for(;r<t.length;){const o=Math.min(t.length-r,n),c=t.slice(r,r+o);r+=o,yield s.encode(c)}}const Mc=256*1024;function*Tc(t,e={}){const{chunkSize:n=Mc}=e;let r=0;for(;r<t.byteLength;){const s=Math.min(t.byteLength-r,n),o=new ArrayBuffer(s),c=new Uint8Array(t,r,s);new Uint8Array(o).set(c),r+=s,yield o}}const vc=1024*1024;async function*Dc(t,e){const n=e?.chunkSize||vc;let r=0;for(;r<t.size;){const s=r+n,o=await t.slice(r,s).arrayBuffer();r=s,yield o}}function ms(t,e){return Cn?Fc(t,e):Gc(t)}async function*Fc(t,e){const n=t.getReader();let r;try{for(;;){const s=r||n.read();e?._streamReadAhead&&(r=n.read());const{done:o,value:c}=await s;if(o)return;yield ro(c)}}catch{n.releaseLock()}}async function*Gc(t,e){for await(const n of t)yield ro(n)}function Ic(t,e){if(typeof t=="string")return xc(t,e);if(t instanceof ArrayBuffer)return Tc(t,e);if(pt(t))return Dc(t,e);if(oo(t))return ms(t,e);if(gt(t))return ms(t.body,e);throw new Error("makeIterator")}const po="Cannot convert supplied data type";function Sc(t,e,n){if(e.text&&typeof t=="string")return t;if(ka(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const s=t.byteLength||t.length;return(t.byteOffset!==0||s!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+s)),r}throw new Error(po)}async function Rc(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return Sc(t,e);if(pt(t)&&(t=await ao(t)),gt(t)){const s=t;return await Za(s),e.binary?await s.arrayBuffer():await s.text()}if(oo(t)&&(t=Ic(t,n)),Ja(t)||Na(t))return Ra(t);throw new Error(po)}function mo(t,e){const n=fo(),r=t||n;return typeof r.fetch=="function"?r.fetch:Vt(r.fetch)?s=>ls(s,r.fetch):e?.fetch?e?.fetch:ls}function Oc(t,e,n){if(n)return n;const r={fetch:mo(e,t),...t};if(r.url){const s=_r(r.url);r.baseUrl=s,r.queryString=Ya(r.url),r.filename=so(s),r.baseUrl=Pa(s)}return Array.isArray(r.loaders)||(r.loaders=null),r}function Lc(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:void 0}async function gn(t,e,n,r){e&&!Array.isArray(e)&&!wr(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const s=wn(t),c=Lc(e,r),d=await pc(t,c,n);return d?(n=cc(n,d,c,s),r=Oc({url:s,_parse:gn,loaders:c},n,r||null),await Uc(d,t,n,r)):null}async function Uc(t,e,n,r){if(ya(t),n=ia(t.options,n),gt(e)){const o=e,{ok:c,redirected:d,status:m,statusText:E,type:M,url:D}=o,R=Object.fromEntries(o.headers.entries());r.response={headers:R,ok:c,redirected:d,status:m,statusText:E,type:M,url:D}}e=await Rc(e,t,n);const s=t;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,n,r);if(xa(t,n))return await Ma(t,e,n,r,gn);if(s.parseText&&typeof e=="string")return await s.parseText(e,n,r);if(s.parse)return await s.parse(e,n,r);throw st(!s.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}function Pc(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function Hc(t){let e=1/0,n=1/0,r=1/0,s=-1/0,o=-1/0,c=-1/0;const d=t.POSITION?t.POSITION.value:[],m=d&&d.length;for(let E=0;E<m;E+=3){const M=d[E],D=d[E+1],R=d[E+2];e=M<e?M:e,n=D<n?D:n,r=R<r?R:r,s=M>s?M:s,o=D>o?D:o,c=R>c?R:c}return[[e,n,r],[s,o,c]]}function Jc(t,e,n){const r=Pc(e.value),s=n||Nc(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:r}]},nullable:!1,metadata:s}}function Nc(t){const e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}async function kc(t,e,n,r){let s,o;!Array.isArray(e)&&!wr(e)?(s=[],o=e):(s=e,o=n);const c=mo(o);let d=t;return typeof t=="string"&&(d=await c(t)),pt(t)&&(d=await c(t)),Array.isArray(s)?await gn(d,s,o):await gn(d,s,o)}const Kc="4.3.3",jc=globalThis.loaders?.parseImageNode,rr=typeof Image<"u",sr=typeof ImageBitmap<"u",Vc=!!jc,or=Cn?!0:Vc;function Xc(t){switch(t){case"auto":return sr||rr||or;case"imagebitmap":return sr;case"image":return rr;case"data":return or;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function Qc(){if(sr)return"imagebitmap";if(rr)return"image";if(or)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function zc(t){const e=Yc(t);if(!e)throw new Error("Not an image");return e}function Bo(t){switch(zc(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function Yc(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const $c=/^data:image\/svg\+xml/,Wc=/\.svg((\?|#).*)?$/;function xr(t){return t&&($c.test(t)||Wc.test(t))}function Zc(t,e){if(xr(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return yo(t,e)}function yo(t,e){if(xr(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function bo(t,e,n){const r=Zc(t,n),s=self.URL||self.webkitURL,o=typeof r!="string"&&s.createObjectURL(r);try{return await qc(o||r,e)}finally{o&&s.revokeObjectURL(o)}}async function qc(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,s)=>{try{n.onload=()=>r(n),n.onerror=o=>{const c=o instanceof Error?o.message:"error";s(new Error(c))}}catch(o){s(o)}})}const eu={};let Bs=!0;async function tu(t,e,n){let r;xr(n)?r=await bo(t,e,n):r=yo(t,n);const s=e&&e.imagebitmap;return await nu(r,s)}async function nu(t,e=null){if((ru(e)||!Bs)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),Bs=!1}return await createImageBitmap(t)}function ru(t){for(const e in t||eu)return!1;return!0}function su(t){return!cu(t,"ftyp",4)||(t[8]&96)===0?null:ou(t)}function ou(t){switch(iu(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function iu(t,e,n){return String.fromCharCode(...t.slice(e,n))}function au(t){return[...t].map(e=>e.charCodeAt(0))}function cu(t,e,n=0){const r=au(e);for(let s=0;s<r.length;++s)if(r[s]!==t[s+n])return!1;return!0}const nt=!1,Lt=!0;function Mr(t){const e=Xt(t);return fu(e)||hu(e)||lu(e)||du(e)||uu(e)}function uu(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=su(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function fu(t){const e=Xt(t);return e.byteLength>=24&&e.getUint32(0,nt)===2303741511?{mimeType:"image/png",width:e.getUint32(16,nt),height:e.getUint32(20,nt)}:null}function lu(t){const e=Xt(t);return e.byteLength>=10&&e.getUint32(0,nt)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Lt),height:e.getUint16(8,Lt)}:null}function du(t){const e=Xt(t);return e.byteLength>=14&&e.getUint16(0,nt)===16973&&e.getUint32(2,Lt)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Lt),height:e.getUint32(22,Lt)}:null}function hu(t){const e=Xt(t);if(!(e.byteLength>=3&&e.getUint16(0,nt)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:s}=Au();let o=2;for(;o+9<e.byteLength;){const c=e.getUint16(o,nt);if(s.has(c))return{mimeType:"image/jpeg",height:e.getUint16(o+5,nt),width:e.getUint16(o+7,nt)};if(!r.has(c))return null;o+=2,o+=e.getUint16(o,nt)}return null}function Au(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Xt(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function gu(t,e){const{mimeType:n}=Mr(t)||{},r=globalThis.loaders?.parseImageNode;return rt(r),await r(t,n)}async function pu(t,e,n){e=e||{};const s=(e.image||{}).type||"auto",{url:o}=n||{},c=mu(s);let d;switch(c){case"imagebitmap":d=await tu(t,e,o);break;case"image":d=await bo(t,e,o);break;case"data":d=await gu(t);break;default:rt(!1)}return s==="data"&&(d=Bo(d)),d}function mu(t){switch(t){case"auto":case"data":return Qc();default:return Xc(t),t}}const Bu=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],yu=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],bu={image:{type:"auto",decode:!0}},_o={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:Kc,mimeTypes:yu,extensions:Bu,parse:pu,tests:[t=>!!Mr(new DataView(t))],options:bu},Ln={};function _u(t){if(Ln[t]===void 0){const e=Cn?wu(t):Cu(t);Ln[t]=e}return Ln[t]}function Cu(t){const e=["image/png","image/jpeg","image/gif"],n=globalThis.loaders?.imageFormatsNode||e;return!!globalThis.loaders?.parseImageNode&&n.includes(t)}function wu(t){switch(t){case"image/avif":case"image/webp":return Eu(t);default:return!0}}function Eu(t){try{return document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)===0}catch{return!1}}function Ve(t,e){if(!t)throw new Error(e||"assert failed: gltf")}const Co={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},wo={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ys=["SCALAR","VEC2","VEC3","VEC4"],xu=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Mu=new Map(xu),Tu={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vu={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Du={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Eo(t){return ys[t-1]||ys[0]}function En(t){const e=Mu.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function xo(t,e){const n=Du[t.componentType],r=Tu[t.type],s=vu[t.componentType],o=t.count*r,c=t.count*r*s;Ve(c>=0&&c<=e.byteLength);const d=wo[t.componentType],m=Co[t.type];return{ArrayType:n,length:o,byteLength:c,componentByteSize:d,numberOfComponentsInElement:m}}function Fu(t,e,n){const r=t.bufferViews[n];Ve(r);const s=r.buffer,o=e[s];Ve(o);const c=(r.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,c,r.byteLength)}function Gu(t,e,n){const r=typeof n=="number"?t.accessors?.[n]:n;if(!r)throw new Error(`No gltf accessor ${JSON.stringify(n)}`);const s=t.bufferViews?.[r.bufferView||0];if(!s)throw new Error(`No gltf buffer view for accessor ${s}`);const{arrayBuffer:o,byteOffset:c}=e[s.buffer],d=(c||0)+(r.byteOffset||0)+(s.byteOffset||0),{ArrayType:m,length:E,componentByteSize:M,numberOfComponentsInElement:D}=xo(r,s),R=M*D,L=s.byteStride||R;if(typeof s.byteStride>"u"||s.byteStride===R)return new m(o,d,E);const H=new m(E);for(let J=0;J<r.count;J++){const K=new m(o,d+J*L,D);H.set(K,J*D)}return H}function Iu(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class Ae{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||Iu(),buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const n=this.getUsedExtensions().find(s=>s===e),r=this.getRequiredExtensions().find(s=>s===e);return typeof n=="string"||typeof r=="string"}getExtension(e){const n=this.getUsedExtensions().find(s=>s===e),r=this.json.extensions||{};return n?r[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(r=>r===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,n){return(e.extensions||{})[n]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,n){if(typeof n=="object")return n;const r=this.json[e]&&this.json[e][n];if(!r)throw new Error(`glTF file error: Could not find ${e}[${n}]`);return r}getTypedArrayForBufferView(e){e=this.getBufferView(e);const n=e.buffer,r=this.gltf.buffers[n];Ve(r);const s=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,s,e.byteLength)}getTypedArrayForAccessor(e){const n=this.getAccessor(e);return Gu(this.gltf.json,this.gltf.buffers,n)}getTypedArrayForImageData(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),s=this.getBuffer(n.buffer).data,o=n.byteOffset||0;return new Uint8Array(s,o,n.byteLength)}addApplicationData(e,n){return this.json[e]=n,this}addExtraData(e,n){return this.json.extras=this.json.extras||{},this.json.extras[e]=n,this}addObjectExtension(e,n,r){return e.extensions=e.extensions||{},e.extensions[n]=r,this.registerUsedExtension(n),this}setObjectExtension(e,n,r){const s=e.extensions||{};s[n]=r}removeObjectExtension(e,n){const r=e?.extensions||{};if(r[n]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const s=this.json.extensionsRemoved;s.includes(n)||s.push(n)}delete r[n]}addExtension(e,n={}){return Ve(n),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=n,this.registerUsedExtension(e),n}addRequiredExtension(e,n={}){return Ve(n),this.addExtension(e,n),this.registerRequiredExtension(e),n}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(n=>n===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(n=>n===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:n}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:n}),this.json.scenes.length-1}addNode(e){const{meshIndex:n,matrix:r}=e;this.json.nodes=this.json.nodes||[];const s={mesh:n};return r&&(s.matrix=r),this.json.nodes.push(s),this.json.nodes.length-1}addMesh(e){const{attributes:n,indices:r,material:s,mode:o=4}=e,d={primitives:[{attributes:this._addAttributes(n),mode:o}]};if(r){const m=this._addIndices(r);d.primitives[0].indices=m}return Number.isFinite(s)&&(d.primitives[0].material=s),this.json.meshes=this.json.meshes||[],this.json.meshes.push(d),this.json.meshes.length-1}addPointCloud(e){const r={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addImage(e,n){const r=Mr(e),s=n||r?.mimeType,c={bufferView:this.addBufferView(e),mimeType:s};return this.json.images=this.json.images||[],this.json.images.push(c),this.json.images.length-1}addBufferView(e,n=0,r=this.byteLength){const s=e.byteLength;Ve(Number.isFinite(s)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const o={buffer:n,byteOffset:r,byteLength:s};return this.byteLength+=jt(s,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(o),this.json.bufferViews.length-1}addAccessor(e,n){const r={bufferView:e,type:Eo(n.size),componentType:n.componentType,count:n.count,max:n.max,min:n.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(e,n={size:3}){const r=this.addBufferView(e);let s={min:n.min,max:n.max};(!s.min||!s.max)&&(s=this._getAccessorMinMax(e,n.size));const o={size:n.size,componentType:En(e),count:Math.round(e.length/n.size),min:s.min,max:s.max};return this.addAccessor(r,Object.assign(o,n))}addTexture(e){const{imageIndex:n}=e,r={source:n};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){const e=this.byteLength,n=new ArrayBuffer(e),r=new Uint8Array(n);let s=0;for(const o of this.sourceBuffers||[])s=Sa(o,r,s);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=n,this.sourceBuffers=[n],this.gltf.buffers=[{arrayBuffer:n,byteOffset:0,byteLength:n.byteLength}]}_removeStringFromArray(e,n){let r=!0;for(;r;){const s=e.indexOf(n);s>-1?e.splice(s,1):r=!1}}_addAttributes(e={}){const n={};for(const r in e){const s=e[r],o=this._getGltfAttributeName(r),c=this.addBinaryBuffer(s.value,s);n[o]=c}return n}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,n){const r={min:null,max:null};if(e.length<n)return r;r.min=[],r.max=[];const s=e.subarray(0,n);for(const o of s)r.min.push(o),r.max.push(o);for(let o=n;o<e.length;o+=n)for(let c=0;c<n;c++)r.min[0+c]=Math.min(r.min[0+c],e[o+c]),r.max[0+c]=Math.max(r.max[0+c],e[o+c]);return r}}function bs(t){return(t%1+1)%1}const Mo={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Su={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},To={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Tr(t,e){return To[e]*Mo[t]}function xn(t,e,n,r){if(n!=="UINT8"&&n!=="UINT16"&&n!=="UINT32"&&n!=="UINT64")return null;const s=t.getTypedArrayForBufferView(e),o=Mn(s,"SCALAR",n,r+1);return o instanceof BigInt64Array||o instanceof BigUint64Array?null:o}function Mn(t,e,n,r=1){const s=Mo[e],o=Su[n],c=To[n],d=r*s,m=d*c;let E=t.buffer,M=t.byteOffset;return M%c!==0&&(E=new Uint8Array(E).slice(M,M+m).buffer,M=0),new o(E,M,d)}function vr(t,e,n){const r=`TEXCOORD_${e.texCoord||0}`,s=n.attributes[r],o=t.getTypedArrayForAccessor(s),c=t.gltf.json,d=e.index,m=c.textures?.[d]?.source;if(typeof m<"u"){const E=c.images?.[m]?.mimeType,M=t.gltf.images?.[m];if(M&&typeof M.width<"u"){const D=[];for(let R=0;R<o.length;R+=2){const L=Ru(M,E,o,R,e.channels);D.push(L)}return D}}return[]}function vo(t,e,n,r,s){if(!n?.length)return;const o=[];for(const M of n){let D=r.findIndex(R=>R===M);D===-1&&(D=r.push(M)-1),o.push(D)}const c=new Uint32Array(o),d=t.gltf.buffers.push({arrayBuffer:c.buffer,byteOffset:c.byteOffset,byteLength:c.byteLength})-1,m=t.addBufferView(c,d,0),E=t.addAccessor(m,{size:1,componentType:En(c),count:c.length});s.attributes[e]=E}function Ru(t,e,n,r,s=[0]){const o={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},c=n[r],d=n[r+1];let m=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(m=4);const E=Ou(c,d,t,m);let M=0;for(const D of s){const R=typeof D=="number"?Object.values(o)[D]:o[D],L=E+R.offset,H=Bo(t);if(H.data.length<=L)throw new Error(`${H.data.length} <= ${L}`);const J=H.data[L];M|=J<<R.shift}return M}function Ou(t,e,n,r=1){const s=n.width,o=bs(t)*(s-1),c=Math.round(o),d=n.height,m=bs(e)*(d-1),E=Math.round(m),M=n.components?n.components:r;return(E*s+c)*M}function Do(t,e,n,r,s){const o=[];for(let c=0;c<e;c++){const d=n[c],m=n[c+1]-n[c];if(m+d>r)break;const E=d/s,M=m/s;o.push(t.slice(E,E+M))}return o}function Fo(t,e,n){const r=[];for(let s=0;s<e;s++){const o=s*n;r.push(t.slice(o,o+n))}return r}function Go(t,e,n,r){if(n)throw new Error("Not implemented - arrayOffsets for strings is specified");if(r){const s=[],o=new TextDecoder("utf8");let c=0;for(let d=0;d<t;d++){const m=r[d+1]-r[d];if(m+c<=e.length){const E=e.subarray(c,m+c),M=o.decode(E);s.push(M),c+=m}}return s}return[]}const Mt="EXT_mesh_features",Lu=Mt;async function Uu(t,e){const n=new Ae(t);Hu(n,e)}function Pu(t,e){const n=new Ae(t);return Nu(n),n.createBinaryChunk(),n.gltf}function Hu(t,e){const n=t.gltf.json;if(n.meshes)for(const r of n.meshes)for(const s of r.primitives)Ju(t,s,e)}function Ju(t,e,n){if(!n?.gltf?.loadBuffers)return;const s=e.extensions?.[Mt]?.featureIds;if(s)for(const o of s){let c;if(typeof o.attribute<"u"){const d=`_FEATURE_ID_${o.attribute}`,m=e.attributes[d];c=t.getTypedArrayForAccessor(m)}else typeof o.texture<"u"&&n?.gltf?.loadImages?c=vr(t,o.texture,e):c=[];o.data=c}}function Nu(t,e){const n=t.gltf.json.meshes;if(n)for(const r of n)for(const s of r.primitives)Ku(t,s)}function ku(t,e,n,r){e.extensions||(e.extensions={});let s=e.extensions[Mt];s||(s={featureIds:[]},e.extensions[Mt]=s);const{featureIds:o}=s,c={featureCount:n.length,propertyTable:r,data:n};o.push(c),t.addObjectExtension(e,Mt,s)}function Ku(t,e){const n=e.extensions?.[Mt];if(!n)return;const r=n.featureIds;r.forEach((s,o)=>{if(s.data){const{accessorKey:c,index:d}=ju(e.attributes),m=new Uint32Array(s.data);r[o]={featureCount:m.length,propertyTable:s.propertyTable,attribute:d},t.gltf.buffers.push({arrayBuffer:m.buffer,byteOffset:m.byteOffset,byteLength:m.byteLength});const E=t.addBufferView(m),M=t.addAccessor(E,{size:1,componentType:En(m),count:m.length});e.attributes[c]=M}})}function ju(t){const e="_FEATURE_ID_",n=Object.keys(t).filter(o=>o.indexOf(e)===0);let r=-1;for(const o of n){const c=Number(o.substring(e.length));c>r&&(r=c)}return r++,{accessorKey:`${e}${r}`,index:r}}const Vu=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:ku,decode:Uu,encode:Pu,name:Lu},Symbol.toStringTag,{value:"Module"})),Tt="EXT_structural_metadata",Xu=Tt;async function Qu(t,e){const n=new Ae(t);Yu(n,e)}function zu(t,e){const n=new Ae(t);return df(n),n.createBinaryChunk(),n.gltf}function Yu(t,e){if(!e.gltf?.loadBuffers)return;const n=t.getExtension(Tt);n&&(e.gltf?.loadImages&&$u(t,n),Wu(t,n))}function $u(t,e){const n=e.propertyTextures,r=t.gltf.json;if(n&&r.meshes)for(const s of r.meshes)for(const o of s.primitives)qu(t,n,o,e)}function Wu(t,e){const n=e.schema;if(!n)return;const r=n.classes,s=e.propertyTables;if(r&&s)for(const o in r){const c=Zu(s,o);c&&tf(t,n,c)}}function Zu(t,e){for(const n of t)if(n.class===e)return n;return null}function qu(t,e,n,r){if(!e)return;const o=n.extensions?.[Tt]?.propertyTextures;if(o)for(const c of o){const d=e[c];ef(t,d,n,r)}}function ef(t,e,n,r){if(!e.properties)return;r.dataAttributeNames||(r.dataAttributeNames=[]);const s=e.class;for(const o in e.properties){const c=`${s}_${o}`,d=e.properties?.[o];if(!d)continue;d.data||(d.data=[]);const m=d.data,E=vr(t,d,n);E!==null&&(vo(t,c,E,m,n),d.data=m,r.dataAttributeNames.push(c))}}function tf(t,e,n){const r=e.classes?.[n.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const s=n.count;for(const o in r.properties){const c=r.properties[o],d=n.properties?.[o];if(d){const m=nf(t,e,c,s,d);d.data=m}}}function nf(t,e,n,r,s){let o=[];const c=s.values,d=t.getTypedArrayForBufferView(c),m=rf(t,n,s,r),E=sf(t,s,r);switch(n.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{o=of(n,r,d,m);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${n.type}`);case"STRING":{o=Go(r,d,m,E);break}case"ENUM":{o=af(e,n,r,d,m);break}default:throw new Error(`Unknown classProperty type ${n.type}`)}return o}function rf(t,e,n,r){return e.array&&typeof e.count>"u"&&typeof n.arrayOffsets<"u"?xn(t,n.arrayOffsets,n.arrayOffsetType||"UINT32",r):null}function sf(t,e,n){return typeof e.stringOffsets<"u"?xn(t,e.stringOffsets,e.stringOffsetType||"UINT32",n):null}function of(t,e,n,r){const s=t.array,o=t.count,c=Tr(t.type,t.componentType),d=n.byteLength/c;let m;return t.componentType?m=Mn(n,t.type,t.componentType,d):m=n,s?r?Do(m,e,r,n.length,c):o?Fo(m,e,o):[]:m}function af(t,e,n,r,s){const o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const c=t.enums?.[o];if(!c)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const d=c.valueType||"UINT16",m=Tr(e.type,d),E=r.byteLength/m;let M=Mn(r,e.type,d,E);if(M||(M=r),e.array){if(s)return cf({valuesData:M,numberOfElements:n,arrayOffsets:s,valuesDataBytesLength:r.length,elementSize:m,enumEntry:c});const D=e.count;return D?uf(M,n,D,c):[]}return Dr(M,0,n,c)}function cf(t){const{valuesData:e,numberOfElements:n,arrayOffsets:r,valuesDataBytesLength:s,elementSize:o,enumEntry:c}=t,d=[];for(let m=0;m<n;m++){const E=r[m],M=r[m+1]-r[m];if(M+E>s)break;const D=E/o,R=M/o,L=Dr(e,D,R,c);d.push(L)}return d}function uf(t,e,n,r){const s=[];for(let o=0;o<e;o++){const c=n*o,d=Dr(t,c,n,r);s.push(d)}return s}function Dr(t,e,n,r){const s=[];for(let o=0;o<n;o++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)s.push("");else{const c=t[e+o],d=ff(r,c);d?s.push(d.name):s.push("")}return s}function ff(t,e){for(const n of t.values)if(n.value===e)return n;return null}const lf="schemaClassId";function df(t,e){const n=t.getExtension(Tt);if(n&&n.propertyTables)for(const r of n.propertyTables){const s=r.class,o=n.schema?.classes?.[s];r.properties&&o&&hf(r,o,t)}}function hf(t,e,n){for(const r in t.properties){const s=t.properties[r].data;if(s){const o=e.properties[r];if(o){const c=mf(s,o,n);t.properties[r]=c}}}}function Af(t,e,n=lf){let r=t.getExtension(Tt);r||(r=t.addExtension(Tt)),r.schema=gf(e,n,r.schema);const s=pf(e,n,r.schema);return r.propertyTables||(r.propertyTables=[]),r.propertyTables.push(s)-1}function gf(t,e,n){const r=n??{id:"schema_id"},s={properties:{}};for(const o of t){const c={type:o.elementType,componentType:o.componentType};s.properties[o.name]=c}return r.classes={},r.classes[e]=s,r}function pf(t,e,n){const r={class:e,count:0};let s=0;const o=n.classes?.[e];for(const c of t){if(s===0&&(s=c.values.length),s!==c.values.length&&c.values.length)throw new Error("Illegal values in attributes");o?.properties[c.name]&&(r.properties||(r.properties={}),r.properties[c.name]={values:0,data:c.values})}return r.count=s,r}function mf(t,e,n){const r={values:0};if(e.type==="STRING"){const{stringData:s,stringOffsets:o}=bf(t);r.stringOffsets=Un(o,n),r.values=Un(s,n)}else if(e.type==="SCALAR"&&e.componentType){const s=yf(t,e.componentType);r.values=Un(s,n)}return r}const Bf={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function yf(t,e){const n=[];for(const s of t)n.push(Number(s));const r=Bf[e];if(!r)throw new Error("Illegal component type");return new r(n)}function bf(t){const e=new TextEncoder,n=[];let r=0;for(const m of t){const E=e.encode(m);r+=E.length,n.push(E)}const s=new Uint8Array(r),o=[];let c=0;for(const m of n)s.set(m,c),o.push(c),c+=m.length;o.push(c);const d=new Uint32Array(o);return{stringData:s,stringOffsets:d}}function Un(t,e){return e.gltf.buffers.push({arrayBuffer:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength}),e.addBufferView(t)}const _f=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:Af,decode:Qu,encode:zu,name:Xu},Symbol.toStringTag,{value:"Module"})),Io="EXT_feature_metadata",Cf=Io;async function wf(t,e){const n=new Ae(t);Ef(n,e)}function Ef(t,e){if(!e.gltf?.loadBuffers)return;const n=t.getExtension(Io);n&&(e.gltf?.loadImages&&xf(t,n),Mf(t,n))}function xf(t,e){const n=e.schema;if(!n)return;const r=n.classes,{featureTextures:s}=e;if(r&&s)for(const o in r){const c=r[o],d=vf(s,o);d&&Ff(t,d,c)}}function Mf(t,e){const n=e.schema;if(!n)return;const r=n.classes,s=e.featureTables;if(r&&s)for(const o in r){const c=Tf(s,o);c&&Df(t,n,c)}}function Tf(t,e){for(const n in t){const r=t[n];if(r.class===e)return r}return null}function vf(t,e){for(const n in t){const r=t[n];if(r.class===e)return r}return null}function Df(t,e,n){if(!n.class)return;const r=e.classes?.[n.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const s=n.count;for(const o in r.properties){const c=r.properties[o],d=n.properties?.[o];if(d){const m=Gf(t,e,c,s,d);d.data=m}}}function Ff(t,e,n){const r=e.class;for(const s in n.properties){const o=e?.properties?.[s];if(o){const c=Lf(t,o,r);o.data=c}}}function Gf(t,e,n,r,s){let o=[];const c=s.bufferView,d=t.getTypedArrayForBufferView(c),m=If(t,n,s,r),E=Sf(t,n,s,r);return n.type==="STRING"||n.componentType==="STRING"?o=Go(r,d,m,E):Rf(n)&&(o=Of(n,r,d,m)),o}function If(t,e,n,r){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof n.arrayOffsetBufferView<"u"?xn(t,n.arrayOffsetBufferView,n.offsetType||"UINT32",r):null}function Sf(t,e,n,r){return typeof n.stringOffsetBufferView<"u"?xn(t,n.stringOffsetBufferView,n.offsetType||"UINT32",r):null}function Rf(t){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function Of(t,e,n,r){const s=t.type==="ARRAY",o=t.componentCount,c="SCALAR",d=t.componentType||t.type,m=Tr(c,d),E=n.byteLength/m,M=Mn(n,c,d,E);return s?r?Do(M,e,r,n.length,m):o?Fo(M,e,o):[]:M}function Lf(t,e,n){const r=t.gltf.json;if(!r.meshes)return[];const s=[];for(const o of r.meshes)for(const c of o.primitives)Uf(t,n,e,s,c);return s}function Uf(t,e,n,r,s){const o={channels:n.channels,...n.texture},c=vr(t,o,s);c&&vo(t,e,c,r,s)}const Pf=Object.freeze(Object.defineProperty({__proto__:null,decode:wf,name:Cf},Symbol.toStringTag,{value:"Module"})),Hf="4.3.3",Jf="4.3.3",pn={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let _s;async function Cs(t){aa(t.modules);const e=ca("basis");return e||(_s||=Nf(t),await _s)}async function Nf(t){let e=null,n=null;return[e,n]=await Promise.all([await ht(pn.TRANSCODER,"textures",t),await ht(pn.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await kf(e,n)}function kf(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t(n).then(s=>{const{BasisFile:o,initializeBasis:c}=s;c(),r({BasisFile:o})})})}let Pn;async function ws(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(Pn=Pn||Kf(t),await Pn)}async function Kf(t){let e=null,n=null;return[e,n]=await Promise.all([await ht(pn.ENCODER,"textures",t),await ht(pn.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await jf(e,n)}function jf(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t(n).then(s=>{const{BasisFile:o,KTX2File:c,initializeBasis:d,BasisEncoder:m}=s;d(),r({BasisFile:o,KTX2File:c,BasisEncoder:m})})})}const bt={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},Vf=["","WEBKIT_","MOZ_"],Es={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let rn=null;function Xf(t){if(!rn){t=t||Qf()||void 0,rn=new Set;for(const e of Vf)for(const n in Es)if(t&&t.getExtension(`${e}${n}`)){const r=Es[n];rn.add(r)}}return rn}function Qf(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const Je=[171,75,84,88,32,50,48,187,13,10,26,10];function zf(t){const e=new Uint8Array(t);return!(e.byteLength<Je.length||e[0]!==Je[0]||e[1]!==Je[1]||e[2]!==Je[2]||e[3]!==Je[3]||e[4]!==Je[4]||e[5]!==Je[5]||e[6]!==Je[6]||e[7]!==Je[7]||e[8]!==Je[8]||e[9]!==Je[9]||e[10]!==Je[10]||e[11]!==Je[11])}const Yf={etc1:{basisFormat:0,compressed:!0,format:bt.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:bt.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:bt.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:bt.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:bt.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:bt.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function $f(t,e){if(e.basis.containerFormat==="auto"){if(zf(t)){const r=await ws(e);return xs(r.KTX2File,t,e)}const{BasisFile:n}=await Cs(e);return Hn(n,t,e)}switch(e.basis.module){case"encoder":const n=await ws(e);switch(e.basis.containerFormat){case"ktx2":return xs(n.KTX2File,t,e);case"basis":default:return Hn(n.BasisFile,t,e)}case"transcoder":default:const{BasisFile:r}=await Cs(e);return Hn(r,t,e)}}function Hn(t,e,n){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");const s=r.getNumImages(),o=[];for(let c=0;c<s;c++){const d=r.getNumLevels(c),m=[];for(let E=0;E<d;E++)m.push(Wf(r,c,E,n));o.push(m)}return o}finally{r.close(),r.delete()}}function Wf(t,e,n,r){const s=t.getImageWidth(e,n),o=t.getImageHeight(e,n),c=t.getHasAlpha(),{compressed:d,format:m,basisFormat:E}=So(r,c),M=t.getImageTranscodedSizeInBytes(e,n,E),D=new Uint8Array(M);if(!t.transcodeImage(D,e,n,E,0,0))throw new Error("failed to start Basis transcoding");return{width:s,height:o,data:D,compressed:d,format:m,hasAlpha:c}}function xs(t,e,n){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");const s=r.getLevels(),o=[];for(let c=0;c<s;c++)o.push(Zf(r,c,n));return[o]}finally{r.close(),r.delete()}}function Zf(t,e,n){const{alphaFlag:r,height:s,width:o}=t.getImageLevelInfo(e,0,0),{compressed:c,format:d,basisFormat:m}=So(n,r),E=t.getImageTranscodedSizeInBytes(e,0,0,m),M=new Uint8Array(E);if(!t.transcodeImage(M,e,0,0,m,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:s,data:M,compressed:c,levelSize:E,hasAlpha:r,format:d}}function So(t,e){let n=t&&t.basis&&t.basis.format;return n==="auto"&&(n=Ro()),typeof n=="object"&&(n=e?n.alpha:n.noAlpha),n=n.toLowerCase(),Yf[n]}function Ro(){const t=Xf();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const qf={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:Jf,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},el={...qf,parse:$f},vt=!0,Ms=1735152710,Fr=12,mn=8,tl=1313821514,nl=5130562,rl=0,sl=0,ol=1;function il(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function al(t,e=0,n={}){const r=new DataView(t),{magic:s=Ms}=n,o=r.getUint32(e,!1);return o===s||o===Ms}function cl(t,e,n=0,r={}){const s=new DataView(e),o=il(s,n+0),c=s.getUint32(n+4,vt),d=s.getUint32(n+8,vt);switch(Object.assign(t,{header:{byteOffset:n,byteLength:d,hasBinChunk:!1},type:o,version:c,json:{},binChunks:[]}),n+=Fr,t.version){case 1:return ul(t,s,n);case 2:return fl(t,s,n,r={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function ul(t,e,n){rt(t.header.byteLength>Fr+mn);const r=e.getUint32(n+0,vt),s=e.getUint32(n+4,vt);return n+=mn,rt(s===rl),ir(t,e,n,r),n+=r,n+=ar(t,e,n,t.header.byteLength),n}function fl(t,e,n,r){return rt(t.header.byteLength>Fr+mn),ll(t,e,n,r),n+t.header.byteLength}function ll(t,e,n,r){for(;n+8<=t.header.byteLength;){const s=e.getUint32(n+0,vt),o=e.getUint32(n+4,vt);switch(n+=mn,o){case tl:ir(t,e,n,s);break;case nl:ar(t,e,n,s);break;case sl:r.strict||ir(t,e,n,s);break;case ol:r.strict||ar(t,e,n,s);break}n+=jt(s,4)}return n}function ir(t,e,n,r){const s=new Uint8Array(e.buffer,n,r),c=new TextDecoder("utf8").decode(s);return t.json=JSON.parse(c),jt(r,4)}function ar(t,e,n,r){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:n,byteLength:r,arrayBuffer:e.buffer}),jt(r,4)}function Oo(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const r=e.baseUri||e.uri;if(!r)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return r.substr(0,r.lastIndexOf("/")+1)+t}const dl="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",hl="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",Al=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),gl=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),pl={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ml={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function Bl(t,e,n,r,s,o="NONE"){const c=await yl();Cl(c,c.exports[ml[s]],t,e,n,r,c.exports[pl[o||"NONE"]])}let Jn;async function yl(){return Jn||(Jn=bl()),Jn}async function bl(){let t=dl;WebAssembly.validate(Al)&&(t=hl,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(_l(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function _l(t){const e=new Uint8Array(t.length);for(let r=0;r<t.length;++r){const s=t.charCodeAt(r);e[r]=s>96?s-71:s>64?s-65:s>47?s+4:s>46?63:62}let n=0;for(let r=0;r<t.length;++r)e[n++]=e[r]<60?gl[e[r]]:(e[r]-60)*64+e[++r];return e.buffer.slice(0,n)}function Cl(t,e,n,r,s,o,c){const d=t.exports.sbrk,m=r+3&-4,E=d(m*s),M=d(o.length),D=new Uint8Array(t.exports.memory.buffer);D.set(o,M);const R=e(E,r,s,M,o.length);if(R===0&&c&&c(E,m,s),n.set(D.subarray(E,E+r*s)),d(E-d(0)),R!==0)throw new Error(`Malformed buffer data: ${R}`)}const Bn="EXT_meshopt_compression",wl=Bn;async function El(t,e){const n=new Ae(t);if(!e?.gltf?.decompressMeshes||!e.gltf?.loadBuffers)return;const r=[];for(const s of t.json.bufferViews||[])r.push(xl(n,s));await Promise.all(r),n.removeExtension(Bn)}async function xl(t,e){const n=t.getObjectExtension(e,Bn);if(n){const{byteOffset:r=0,byteLength:s=0,byteStride:o,count:c,mode:d,filter:m="NONE",buffer:E}=n,M=t.gltf.buffers[E],D=new Uint8Array(M.arrayBuffer,M.byteOffset+r,s),R=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await Bl(R,c,o,D,d,m),t.removeObjectExtension(e,Bn)}}const Ml=Object.freeze(Object.defineProperty({__proto__:null,decode:El,name:wl},Symbol.toStringTag,{value:"Module"})),Et="EXT_texture_webp",Tl=Et;function vl(t,e){const n=new Ae(t);if(!_u("image/webp")){if(n.getRequiredExtensions().includes(Et))throw new Error(`gltf: Required extension ${Et} not supported by browser`);return}const{json:r}=n;for(const s of r.textures||[]){const o=n.getObjectExtension(s,Et);o&&(s.source=o.source),n.removeObjectExtension(s,Et)}n.removeExtension(Et)}const Dl=Object.freeze(Object.defineProperty({__proto__:null,name:Tl,preprocess:vl},Symbol.toStringTag,{value:"Module"})),ln="KHR_texture_basisu",Fl=ln;function Gl(t,e){const n=new Ae(t),{json:r}=n;for(const s of r.textures||[]){const o=n.getObjectExtension(s,ln);o&&(s.source=o.source,n.removeObjectExtension(s,ln))}n.removeExtension(ln)}const Il=Object.freeze(Object.defineProperty({__proto__:null,name:Fl,preprocess:Gl},Symbol.toStringTag,{value:"Module"})),Sl="4.3.3",Rl={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:Sl,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function Ol(t,e,n){const r=Lo(e.metadata),s=[],o=Ll(e.attributes);for(const c in t){const d=t[c],m=Ts(c,d,o[c]);s.push(m)}if(n){const c=Ts("indices",n);s.push(c)}return{fields:s,metadata:r}}function Ll(t){const e={};for(const n in t){const r=t[n];e[r.name||"undefined"]=r}return e}function Ts(t,e,n){const r=n?Lo(n.metadata):void 0;return Jc(t,e,r)}function Lo(t){Object.entries(t);const e={};for(const n in t)e[`${n}.string`]=JSON.stringify(t[n]);return e}const vs={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Ul={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},Pl=4;class Hl{draco;decoder;metadataQuerier;constructor(e){this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,n={}){const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(n);const s=this.decoder.GetEncodedGeometryType(r),o=s===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let c;switch(s){case this.draco.TRIANGULAR_MESH:c=this.decoder.DecodeBufferToMesh(r,o);break;case this.draco.POINT_CLOUD:c=this.decoder.DecodeBufferToPointCloud(r,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!c.ok()||!o.ptr){const R=`DRACO decompression failed: ${c.error_msg()}`;throw new Error(R)}const d=this._getDracoLoaderData(o,s,n),m=this._getMeshData(o,d,n),E=Hc(m.attributes),M=Ol(m.attributes,d,m.indices);return{loader:"draco",loaderData:d,header:{vertexCount:o.num_points(),boundingBox:E},...m,schema:M}}finally{this.draco.destroy(r),o&&this.draco.destroy(o)}}_getDracoLoaderData(e,n,r){const s=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,r);return{geometry_type:n,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:s,attributes:o}}_getDracoAttributes(e,n){const r={};for(let s=0;s<e.num_attributes();s++){const o=this.decoder.GetAttribute(e,s),c=this._getAttributeMetadata(e,s);r[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:s,metadata:c};const d=this._getQuantizationTransform(o,n);d&&(r[o.unique_id()].quantization_transform=d);const m=this._getOctahedronTransform(o,n);m&&(r[o.unique_id()].octahedron_transform=m)}return r}_getMeshData(e,n,r){const s=this._getMeshAttributes(n,e,r);if(!s.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:s,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:s,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:s}}_getMeshAttributes(e,n,r){const s={};for(const o of Object.values(e.attributes)){const c=this._deduceAttributeName(o,r);o.name=c;const d=this._getAttributeValues(n,o);if(d){const{value:m,size:E}=d;s[c]={value:m,size:E,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}}return s}_getTriangleListIndices(e){const r=e.num_faces()*3,s=r*Pl,o=this.draco._malloc(s);try{return this.decoder.GetTrianglesUInt32Array(e,s,o),new Uint32Array(this.draco.HEAPF32.buffer,o,r).slice()}finally{this.draco._free(o)}}_getTriangleStripIndices(e){const n=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,n),kl(n)}finally{this.draco.destroy(n)}}_getAttributeValues(e,n){const r=Ul[n.data_type];if(!r)return console.warn(`DRACO: Unsupported attribute type ${n.data_type}`),null;const s=n.num_components,c=e.num_points()*s,d=c*r.BYTES_PER_ELEMENT,m=Jl(this.draco,r);let E;const M=this.draco._malloc(d);try{const D=this.decoder.GetAttribute(e,n.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,D,m,d,M),E=new r(this.draco.HEAPF32.buffer,M,c).slice()}finally{this.draco._free(M)}return{value:E,size:s}}_deduceAttributeName(e,n){const r=e.unique_id;for(const[c,d]of Object.entries(n.extraAttributes||{}))if(d===r)return c;const s=e.attribute_type;for(const c in vs)if(this.draco[c]===s)return vs[c];const o=n.attributeNameEntry||"name";return e.metadata[o]?e.metadata[o].string:`CUSTOM_ATTRIBUTE_${r}`}_getTopLevelMetadata(e){const n=this.decoder.GetMetadata(e);return this._getDracoMetadata(n)}_getAttributeMetadata(e,n){const r=this.decoder.GetAttributeMetadata(e,n);return this._getDracoMetadata(r)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const n={},r=this.metadataQuerier.NumEntries(e);for(let s=0;s<r;s++){const o=this.metadataQuerier.GetEntryName(e,s);n[o]=this._getDracoMetadataField(e,o)}return n}_getDracoMetadataField(e,n){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,n,r);const s=Nl(r);return{int:this.metadataQuerier.GetIntEntry(e,n),string:this.metadataQuerier.GetStringEntry(e,n),double:this.metadataQuerier.GetDoubleEntry(e,n),intArray:s}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(e){const{quantizedAttributes:n=[],octahedronAttributes:r=[]}=e,s=[...n,...r];for(const o of s)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(e,n){const{quantizedAttributes:r=[]}=n,s=e.attribute_type();if(r.map(c=>this.decoder[c]).includes(s)){const c=new this.draco.AttributeQuantizationTransform;try{if(c.InitFromAttribute(e))return{quantization_bits:c.quantization_bits(),range:c.range(),min_values:new Float32Array([1,2,3]).map(d=>c.min_value(d))}}finally{this.draco.destroy(c)}}return null}_getOctahedronTransform(e,n){const{octahedronAttributes:r=[]}=n,s=e.attribute_type();if(r.map(c=>this.decoder[c]).includes(s)){const c=new this.draco.AttributeQuantizationTransform;try{if(c.InitFromAttribute(e))return{quantization_bits:c.quantization_bits()}}finally{this.draco.destroy(c)}}return null}}function Jl(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function Nl(t){const e=t.size(),n=new Int32Array(e);for(let r=0;r<e;r++)n[r]=t.GetValue(r);return n}function kl(t){const e=t.size(),n=new Int32Array(e);for(let r=0;r<e;r++)n[r]=t.GetValue(r);return n}const Kl="1.5.6",jl="1.4.1",Nn=`https://www.gstatic.com/draco/versioned/decoders/${Kl}`,Ie={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},kn={[Ie.DECODER]:`${Nn}/${Ie.DECODER}`,[Ie.DECODER_WASM]:`${Nn}/${Ie.DECODER_WASM}`,[Ie.FALLBACK_DECODER]:`${Nn}/${Ie.FALLBACK_DECODER}`,[Ie.ENCODER]:`https://raw.githubusercontent.com/google/draco/${jl}/javascript/${Ie.ENCODER}`};let Kn;async function Vl(t){const e=t.modules||{};return e.draco3d?Kn||=e.draco3d.createDecoderModule({}).then(n=>({draco:n})):Kn||=Xl(t),await Kn}async function Xl(t){let e,n;switch(t.draco&&t.draco.decoderType){case"js":e=await ht(kn[Ie.FALLBACK_DECODER],"draco",t,Ie.FALLBACK_DECODER);break;case"wasm":default:[e,n]=await Promise.all([await ht(kn[Ie.DECODER],"draco",t,Ie.DECODER),await ht(kn[Ie.DECODER_WASM],"draco",t,Ie.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await Ql(e,n)}function Ql(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t({...n,onModuleLoaded:s=>r({draco:s})})})}const zl={...Rl,parse:Yl};async function Yl(t,e){const{draco:n}=await Vl(e),r=new Hl(n);try{return r.parseSync(t,e?.draco)}finally{r.destroy()}}function $l(t){const e={};for(const n in t){const r=t[n];if(n!=="indices"){const s=Uo(r);e[n]=s}}return e}function Uo(t){const{buffer:e,size:n,count:r}=Wl(t);return{value:e,size:n,byteOffset:0,count:r,type:Eo(n),componentType:En(e)}}function Wl(t){let e=t,n=1,r=0;return t&&t.value&&(e=t.value,n=t.size||1),e&&(ArrayBuffer.isView(e)||(e=Zl(e,Float32Array)),r=e.length/n),{buffer:e,size:n,count:r}}function Zl(t,e,n=!1){return t?Array.isArray(t)?new e(t):n&&!(t instanceof e)?new e(t):t:null}const ct="KHR_draco_mesh_compression",ql=ct;function ed(t,e,n){const r=new Ae(t);for(const s of Po(r))r.getObjectExtension(s,ct)}async function td(t,e,n){if(!e?.gltf?.decompressMeshes)return;const r=new Ae(t),s=[];for(const o of Po(r))r.getObjectExtension(o,ct)&&s.push(rd(r,o,e,n));await Promise.all(s),r.removeExtension(ct)}function nd(t,e={}){const n=new Ae(t);for(const r of n.json.meshes||[])sd(r),n.addRequiredExtension(ct)}async function rd(t,e,n,r){const s=t.getObjectExtension(e,ct);if(!s)return;const o=t.getTypedArrayForBufferView(s.bufferView),c=no(o.buffer,o.byteOffset),d={...n};delete d["3d-tiles"];const m=await Ys(c,zl,d,r),E=$l(m.attributes);for(const[M,D]of Object.entries(E))if(M in e.attributes){const R=e.attributes[M],L=t.getAccessor(R);L?.min&&L?.max&&(D.min=L.min,D.max=L.max)}e.attributes=E,m.indices&&(e.indices=Uo(m.indices)),t.removeObjectExtension(e,ct),od(e)}function sd(t,e,n=4,r,s){if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=r.DracoWriter.encodeSync({attributes:t}),c=s?.parseSync?.({attributes:t}),d=r._addFauxAttributes(c.attributes),m=r.addBufferView(o);return{primitives:[{attributes:d,mode:n,extensions:{[ct]:{bufferView:m,attributes:d}}}]}}function od(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*Po(t){for(const e of t.json.meshes||[])for(const n of e.primitives)yield n}const id=Object.freeze(Object.defineProperty({__proto__:null,decode:td,encode:nd,name:ql,preprocess:ed},Symbol.toStringTag,{value:"Module"})),ad={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...ad}};const Qe=globalThis.mathgl.config;function cd(t,{precision:e=Qe.precision}={}){return t=ud(t),`${parseFloat(t.toPrecision(e))}`}function yn(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Ho(t,e,n){const r=Qe.EPSILON;try{if(t===e)return!0;if(yn(t)&&yn(e)){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(!Ho(t[s],e[s]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Qe.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Qe.EPSILON=r}}function ud(t){return Math.round(t/Qe.EPSILON)*Qe.EPSILON}class Jo extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:yn(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Qe)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+cd(this[r],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Ho(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let s=0;s<this.ELEMENTS;++s){const o=e[s],c=typeof n=="number"?n:n[s];this[s]=o+r*(c-o)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Qe.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function fd(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Ne(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function ld(t,e,n=""){if(Qe.debug&&!fd(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function Ds(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class dd extends Jo{get x(){return this[0]}set x(e){this[0]=Ne(e)}get y(){return this[1]}set y(e){this[1]=Ne(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const s=this[r]-e[r];n+=s*s}return Ne(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return Ne(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Ds(e>=0&&e<this.ELEMENTS,"index is out of range"),Ne(this[e])}setComponent(e,n){return Ds(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}let bn=typeof Float32Array<"u"?Float32Array:Array;function hd(){const t=new bn(2);return bn!=Float32Array&&(t[0]=0,t[1]=0),t}function Ad(t,e,n){const r=e[0],s=e[1];return t[0]=n[0]*r+n[3]*s+n[6],t[1]=n[1]*r+n[4]*s+n[7],t}(function(){const t=hd();return function(e,n,r,s,o,c){let d,m;for(n||(n=2),r||(r=0),s?m=Math.min(s*n+r,e.length):m=e.length,d=r;d<m;d+=n)t[0]=e[d],t[1]=e[d+1],o(t,t,c),e[d]=t[0],e[d+1]=t[1];return e}})();function gd(t,e,n){const r=e[0],s=e[1],o=e[2],c=n[3]*r+n[7]*s+n[11]*o||1;return t[0]=(n[0]*r+n[4]*s+n[8]*o)/c,t[1]=(n[1]*r+n[5]*s+n[9]*o)/c,t[2]=(n[2]*r+n[6]*s+n[10]*o)/c,t}function pd(t,e,n){const r=e[0],s=e[1];return t[0]=n[0]*r+n[2]*s,t[1]=n[1]*r+n[3]*s,t[2]=e[2],t}function md(t,e,n){const r=e[0],s=e[1],o=e[2];return t[0]=n[0]*r+n[3]*s+n[6]*o,t[1]=n[1]*r+n[4]*s+n[7]*o,t[2]=n[2]*r+n[5]*s+n[8]*o,t[3]=e[3],t}function Bd(){const t=new bn(3);return bn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function yd(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function bd(t,e,n){const r=e[0],s=e[1],o=e[2],c=n[0],d=n[1],m=n[2];return t[0]=s*m-o*d,t[1]=o*c-r*m,t[2]=r*d-s*c,t}function _d(t,e,n){const r=e[0],s=e[1],o=e[2];let c=n[3]*r+n[7]*s+n[11]*o+n[15];return c=c||1,t[0]=(n[0]*r+n[4]*s+n[8]*o+n[12])/c,t[1]=(n[1]*r+n[5]*s+n[9]*o+n[13])/c,t[2]=(n[2]*r+n[6]*s+n[10]*o+n[14])/c,t}function No(t,e,n){const r=e[0],s=e[1],o=e[2];return t[0]=r*n[0]+s*n[3]+o*n[6],t[1]=r*n[1]+s*n[4]+o*n[7],t[2]=r*n[2]+s*n[5]+o*n[8],t}function Cd(t,e,n){const r=n[0],s=n[1],o=n[2],c=n[3],d=e[0],m=e[1],E=e[2];let M=s*E-o*m,D=o*d-r*E,R=r*m-s*d,L=s*R-o*D,H=o*M-r*R,J=r*D-s*M;const K=c*2;return M*=K,D*=K,R*=K,L*=2,H*=2,J*=2,t[0]=d+M+L,t[1]=m+D+H,t[2]=E+R+J,t}function wd(t,e,n,r){const s=[],o=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],o[0]=s[0],o[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),o[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Ed(t,e,n,r){const s=[],o=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],o[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),o[1]=s[1],o[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function xd(t,e,n,r){const s=[],o=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],o[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),o[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),o[2]=s[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Md(t,e){const n=t[0],r=t[1],s=t[2],o=e[0],c=e[1],d=e[2],m=Math.sqrt((n*n+r*r+s*s)*(o*o+c*c+d*d)),E=m&&yd(t,e)/m;return Math.acos(Math.min(Math.max(E,-1),1))}(function(){const t=Bd();return function(e,n,r,s,o,c){let d,m;for(n||(n=3),r||(r=0),s?m=Math.min(s*n+r,e.length):m=e.length,d=r;d<m;d+=n)t[0]=e[d],t[1]=e[d+1],t[2]=e[d+2],o(t,t,c),e[d]=t[0],e[d+1]=t[1],e[d+2]=t[2];return e}})();const jn=[0,0,0];let sn;class Gr extends dd{static get ZERO(){return sn||(sn=new Gr(0,0,0),Object.freeze(sn)),sn}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&yn(e)?this.copy(e):(Qe.debug&&(Ne(e),Ne(n),Ne(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Qe.debug&&(Ne(e.x),Ne(e.y),Ne(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Ne(e)}angle(e){return Md(this,e)}cross(e){return bd(this,this,e),this.check()}rotateX({radians:e,origin:n=jn}){return wd(this,this,n,e),this.check()}rotateY({radians:e,origin:n=jn}){return Ed(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=jn}){return xd(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return _d(this,this,e),this.check()}transformAsVector(e){return gd(this,this,e),this.check()}transformByMatrix3(e){return No(this,this,e),this.check()}transformByMatrix2(e){return pd(this,this,e),this.check()}transformByQuaternion(e){return Cd(this,this,e),this.check()}}class Td extends Jo{toString(){let e="[";if(Qe.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=Ne(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)n[s]=this[r+s];return n}setColumn(e,n){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)this[r+s]=n[s];return this}}function vd(t,e){if(t===e){const n=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Dd(t,e){const n=e[0],r=e[1],s=e[2],o=e[3],c=e[4],d=e[5],m=e[6],E=e[7],M=e[8],D=M*c-d*E,R=-M*o+d*m,L=E*o-c*m;let H=n*D+r*R+s*L;return H?(H=1/H,t[0]=D*H,t[1]=(-M*r+s*E)*H,t[2]=(d*r-s*c)*H,t[3]=R*H,t[4]=(M*n-s*m)*H,t[5]=(-d*n+s*o)*H,t[6]=L*H,t[7]=(-E*n+r*m)*H,t[8]=(c*n-r*o)*H,t):null}function Fd(t){const e=t[0],n=t[1],r=t[2],s=t[3],o=t[4],c=t[5],d=t[6],m=t[7],E=t[8];return e*(E*o-c*m)+n*(-E*s+c*d)+r*(m*s-o*d)}function Fs(t,e,n){const r=e[0],s=e[1],o=e[2],c=e[3],d=e[4],m=e[5],E=e[6],M=e[7],D=e[8],R=n[0],L=n[1],H=n[2],J=n[3],K=n[4],z=n[5],$=n[6],X=n[7],re=n[8];return t[0]=R*r+L*c+H*E,t[1]=R*s+L*d+H*M,t[2]=R*o+L*m+H*D,t[3]=J*r+K*c+z*E,t[4]=J*s+K*d+z*M,t[5]=J*o+K*m+z*D,t[6]=$*r+X*c+re*E,t[7]=$*s+X*d+re*M,t[8]=$*o+X*m+re*D,t}function Gd(t,e,n){const r=e[0],s=e[1],o=e[2],c=e[3],d=e[4],m=e[5],E=e[6],M=e[7],D=e[8],R=n[0],L=n[1];return t[0]=r,t[1]=s,t[2]=o,t[3]=c,t[4]=d,t[5]=m,t[6]=R*r+L*c+E,t[7]=R*s+L*d+M,t[8]=R*o+L*m+D,t}function Id(t,e,n){const r=e[0],s=e[1],o=e[2],c=e[3],d=e[4],m=e[5],E=e[6],M=e[7],D=e[8],R=Math.sin(n),L=Math.cos(n);return t[0]=L*r+R*c,t[1]=L*s+R*d,t[2]=L*o+R*m,t[3]=L*c-R*r,t[4]=L*d-R*s,t[5]=L*m-R*o,t[6]=E,t[7]=M,t[8]=D,t}function Gs(t,e,n){const r=n[0],s=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Sd(t,e){const n=e[0],r=e[1],s=e[2],o=e[3],c=n+n,d=r+r,m=s+s,E=n*c,M=r*c,D=r*d,R=s*c,L=s*d,H=s*m,J=o*c,K=o*d,z=o*m;return t[0]=1-D-H,t[3]=M-z,t[6]=R+K,t[1]=M+z,t[4]=1-E-H,t[7]=L-J,t[2]=R-K,t[5]=L+J,t[8]=1-E-D,t}var cr;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(cr||(cr={}));const Rd=Object.freeze([1,0,0,0,1,0,0,0,1]);class Qt extends Td{static get IDENTITY(){return Ld()}static get ZERO(){return Od()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return cr}constructor(e,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(Rd)}fromObject(e){return this.check()}fromQuaternion(e){return Sd(this,e),this.check()}set(e,n,r,s,o,c,d,m,E){return this[0]=e,this[1]=n,this[2]=r,this[3]=s,this[4]=o,this[5]=c,this[6]=d,this[7]=m,this[8]=E,this.check()}setRowMajor(e,n,r,s,o,c,d,m,E){return this[0]=e,this[1]=s,this[2]=d,this[3]=n,this[4]=o,this[5]=m,this[6]=r,this[7]=c,this[8]=E,this.check()}determinant(){return Fd(this)}transpose(){return vd(this,this),this.check()}invert(){return Dd(this,this),this.check()}multiplyLeft(e){return Fs(this,e,this),this.check()}multiplyRight(e){return Fs(this,this,e),this.check()}rotate(e){return Id(this,this,e),this.check()}scale(e){return Array.isArray(e)?Gs(this,this,e):Gs(this,this,[e,e]),this.check()}translate(e){return Gd(this,this,e),this.check()}transform(e,n){let r;switch(e.length){case 2:r=Ad(n||[-0,-0],e,this);break;case 3:r=No(n||[-0,-0,-0],e,this);break;case 4:r=md(n||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return ld(r,e.length),r}transformVector(e,n){return this.transform(e,n)}transformVector2(e,n){return this.transform(e,n)}transformVector3(e,n){return this.transform(e,n)}}let on,an=null;function Od(){return on||(on=new Qt([0,0,0,0,0,0,0,0,0]),Object.freeze(on)),on}function Ld(){return an||(an=new Qt,Object.freeze(an)),an}const Tn="KHR_texture_transform",Ud=Tn,cn=new Gr,Pd=new Qt,Hd=new Qt;async function Jd(t,e){if(!new Ae(t).hasExtension(Tn)||!e.gltf?.loadBuffers)return;const s=t.json.materials||[];for(let o=0;o<s.length;o++)Nd(o,t)}function Nd(t,e){const n=e.json.materials?.[t],r=[n?.pbrMetallicRoughness?.baseColorTexture,n?.emissiveTexture,n?.normalTexture,n?.occlusionTexture,n?.pbrMetallicRoughness?.metallicRoughnessTexture],s=[];for(const o of r)o&&o?.extensions?.[Tn]&&kd(e,t,o,s)}function kd(t,e,n,r){const s=Kd(n,r);if(!s)return;const o=t.json.meshes||[];for(const c of o)for(const d of c.primitives){const m=d.material;Number.isFinite(m)&&e===m&&jd(t,d,s)}}function Kd(t,e){const n=t.extensions?.[Tn],{texCoord:r=0}=t,{texCoord:s=r}=n;if(!(e.findIndex(([c,d])=>c===r&&d===s)!==-1)){const c=Qd(n);return r!==s&&(t.texCoord=s),e.push([r,s]),{originalTexCoord:r,texCoord:s,matrix:c}}return null}function jd(t,e,n){const{originalTexCoord:r,texCoord:s,matrix:o}=n,c=e.attributes[`TEXCOORD_${r}`];if(Number.isFinite(c)){const d=t.json.accessors?.[c];if(d&&d.bufferView){const m=t.json.bufferViews?.[d.bufferView];if(m){const{arrayBuffer:E,byteOffset:M}=t.buffers[m.buffer],D=(M||0)+(d.byteOffset||0)+(m.byteOffset||0),{ArrayType:R,length:L}=xo(d,m),H=wo[d.componentType],J=Co[d.type],K=m.byteStride||H*J,z=new Float32Array(L);for(let $=0;$<d.count;$++){const X=new R(E,D+$*K,2);cn.set(X[0],X[1],1),cn.transformByMatrix3(o),z.set([cn[0],cn[1]],$*J)}r===s?Vd(d,m,t.buffers,z):Xd(s,d,e,t,z)}}}}function Vd(t,e,n,r){t.componentType=5126,n.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),e.buffer=n.length-1,e.byteLength=r.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function Xd(t,e,n,r,s){r.buffers.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength});const o=r.json.bufferViews;if(!o)return;o.push({buffer:r.buffers.length-1,byteLength:s.buffer.byteLength,byteOffset:0});const c=r.json.accessors;c&&(c.push({bufferView:o?.length-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),n.attributes[`TEXCOORD_${t}`]=c.length-1)}function Qd(t){const{offset:e=[0,0],rotation:n=0,scale:r=[1,1]}=t,s=new Qt().set(1,0,0,0,1,0,e[0],e[1],1),o=Pd.set(Math.cos(n),Math.sin(n),0,-Math.sin(n),Math.cos(n),0,0,0,1),c=Hd.set(r[0],0,0,0,r[1],0,0,0,1);return s.multiplyRight(o).multiplyRight(c)}const zd=Object.freeze(Object.defineProperty({__proto__:null,decode:Jd,name:Ud},Symbol.toStringTag,{value:"Module"})),dt="KHR_lights_punctual",Yd=dt;async function $d(t){const e=new Ae(t),{json:n}=e,r=e.getExtension(dt);r&&(e.json.lights=r.lights,e.removeExtension(dt));for(const s of n.nodes||[]){const o=e.getObjectExtension(s,dt);o&&(s.light=o.light),e.removeObjectExtension(s,dt)}}async function Wd(t){const e=new Ae(t),{json:n}=e;if(n.lights){const r=e.addExtension(dt);Ve(!r.lights),r.lights=n.lights,delete n.lights}if(e.json.lights){for(const r of e.json.lights){const s=r.node;e.addObjectExtension(s,dt,r)}delete e.json.lights}}const Zd=Object.freeze(Object.defineProperty({__proto__:null,decode:$d,encode:Wd,name:Yd},Symbol.toStringTag,{value:"Module"})),Nt="KHR_materials_unlit",qd=Nt;async function eh(t){const e=new Ae(t),{json:n}=e;for(const r of n.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),e.removeObjectExtension(r,Nt);e.removeExtension(Nt)}function th(t){const e=new Ae(t),{json:n}=e;if(e.materials)for(const r of n.materials||[])r.unlit&&(delete r.unlit,e.addObjectExtension(r,Nt,{}),e.addExtension(Nt))}const nh=Object.freeze(Object.defineProperty({__proto__:null,decode:eh,encode:th,name:qd},Symbol.toStringTag,{value:"Module"})),It="KHR_techniques_webgl",rh=It;async function sh(t){const e=new Ae(t),{json:n}=e,r=e.getExtension(It);if(r){const s=ih(r,e);for(const o of n.materials||[]){const c=e.getObjectExtension(o,It);c&&(o.technique=Object.assign({},c,s[c.technique]),o.technique.values=ah(o.technique,e)),e.removeObjectExtension(o,It)}e.removeExtension(It)}}async function oh(t,e){}function ih(t,e){const{programs:n=[],shaders:r=[],techniques:s=[]}=t,o=new TextDecoder;return r.forEach(c=>{if(Number.isFinite(c.bufferView))c.code=o.decode(e.getTypedArrayForBufferView(c.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),n.forEach(c=>{c.fragmentShader=r[c.fragmentShader],c.vertexShader=r[c.vertexShader]}),s.forEach(c=>{c.program=n[c.program]}),s}function ah(t,e){const n=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(r=>{t.uniforms[r].value&&!(r in n)&&(n[r]=t.uniforms[r].value)}),Object.keys(n).forEach(r=>{typeof n[r]=="object"&&n[r].index!==void 0&&(n[r].texture=e.getTexture(n[r].index))}),n}const ch=Object.freeze(Object.defineProperty({__proto__:null,decode:sh,encode:oh,name:rh},Symbol.toStringTag,{value:"Module"})),ko=[_f,Vu,Ml,Dl,Il,id,Zd,nh,ch,zd,Pf];function uh(t,e={},n){const r=ko.filter(s=>Ko(s.name,e));for(const s of r)s.preprocess?.(t,e,n)}async function fh(t,e={},n){const r=ko.filter(s=>Ko(s.name,e));for(const s of r)await s.decode?.(t,e,n)}function Ko(t,e){const n=e?.gltf?.excludeExtensions||{};return!(t in n&&!n[t])}const Vn="KHR_binary_glTF";function lh(t){const e=new Ae(t),{json:n}=e;for(const r of n.images||[]){const s=e.getObjectExtension(r,Vn);s&&Object.assign(r,s),e.removeObjectExtension(r,Vn)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,e.removeExtension(Vn)}const Is={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},dh={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class hh{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,n){this.json=e.json;const r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${r.asset.version}`);return}if(!n.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),lh(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const n in Is)this._convertTopLevelObjectToArray(e,n)}_convertTopLevelObjectToArray(e,n){const r=e[n];if(!(!r||Array.isArray(r))){e[n]=[];for(const s in r){const o=r[s];o.id=o.id||s;const c=e[n].length;e[n].push(o),this.idToIndexMap[n][s]=c}}}_convertObjectIdsToArrayIndices(e){for(const n in Is)this._convertIdsToIndices(e,n);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const n of e.textures)this._convertTextureIds(n);for(const n of e.meshes)this._convertMeshIds(n);for(const n of e.nodes)this._convertNodeIds(n);for(const n of e.scenes)this._convertSceneIds(n)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const n of e.primitives){const{attributes:r,indices:s,material:o}=n;for(const c in r)r[c]=this._convertIdToIndex(r[c],"accessor");s&&(n.indices=this._convertIdToIndex(s,"accessor")),o&&(n.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(n=>this._convertIdToIndex(n,"node"))),e.meshes&&(e.meshes=e.meshes.map(n=>this._convertIdToIndex(n,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(n=>this._convertIdToIndex(n,"node")))}_convertIdsToIndices(e,n){e[n]||(console.warn(`gltf v1: json doesn't contain attribute ${n}`),e[n]=[]);for(const r of e[n])for(const s in r){const o=r[s],c=this._convertIdToIndex(o,s);r[s]=c}}_convertIdToIndex(e,n){const r=dh[n];if(r in this.idToIndexMap){const s=this.idToIndexMap[r][e];if(!Number.isFinite(s))throw new Error(`gltf v1: failed to resolve ${n} with id ${e}`);return s}return e}_updateObjects(e){for(const n of this.json.buffers)delete n.type}_updateMaterial(e){for(const n of e.materials){n.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const r=n.values?.tex||n.values?.texture2d_0||n.values?.diffuseTex,s=e.textures.findIndex(o=>o.id===r);s!==-1&&(n.pbrMetallicRoughness.baseColorTexture={index:s})}}}function Ah(t,e={}){return new hh().normalize(t,e)}async function gh(t,e,n=0,r,s){return ph(t,e,n,r),Ah(t,{normalize:r?.gltf?.normalize}),uh(t,r,s),r?.gltf?.loadBuffers&&t.json.buffers&&await mh(t,r,s),r?.gltf?.loadImages&&await Bh(t,r,s),await fh(t,r,s),t}function ph(t,e,n,r){if(r.uri&&(t.baseUri=r.uri),e instanceof ArrayBuffer&&!al(e,n,r)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=Da(e);else if(e instanceof ArrayBuffer){const c={};n=cl(c,e,n,r.glb),Ve(c.type==="glTF",`Invalid GLB magic string ${c.type}`),t._glb=c,t.json=c.json}else Ve(!1,"GLTF: must be ArrayBuffer or string");const s=t.json.buffers||[];if(t.buffers=new Array(s.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:c}=t._glb;t.buffers[0]={arrayBuffer:c[0].arrayBuffer,byteOffset:c[0].byteOffset,byteLength:c[0].byteLength}}const o=t.json.images||[];t.images=new Array(o.length).fill({})}async function mh(t,e,n){const r=t.json.buffers||[];for(let s=0;s<r.length;++s){const o=r[s];if(o.uri){const{fetch:c}=n;Ve(c);const d=Oo(o.uri,e),E=await(await n?.fetch?.(d))?.arrayBuffer?.();t.buffers[s]={arrayBuffer:E,byteOffset:0,byteLength:E.byteLength},delete o.uri}else t.buffers[s]===null&&(t.buffers[s]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function Bh(t,e,n){const r=yh(t),s=t.json.images||[],o=[];for(const c of r)o.push(bh(t,s[c],c,e,n));return await Promise.all(o)}function yh(t){const e=new Set,n=t.json.textures||[];for(const r of n)r.source!==void 0&&e.add(r.source);return Array.from(e).sort()}async function bh(t,e,n,r,s){let o;if(e.uri&&!e.hasOwnProperty("bufferView")){const d=Oo(e.uri,r),{fetch:m}=s;o=await(await m(d)).arrayBuffer(),e.bufferView={data:o}}if(Number.isFinite(e.bufferView)){const d=Fu(t.json,t.buffers,e.bufferView);o=no(d.buffer,d.byteOffset,d.byteLength)}Ve(o,"glTF image has no data");let c=await Ys(o,[_o,el],{...r,mimeType:e.mimeType,basis:r.basis||{format:Ro()}},s);c&&c[0]&&(c={compressed:!0,mipmaps:!1,width:c[0].width,height:c[0].height,data:c[0]}),t.images=t.images||[],t.images[n]=c}const ur={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:Hf,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:_h,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function _h(t,e={},n){e={...ur.options,...e},e.gltf={...ur.options.gltf,...e.gltf};const{byteOffset:r=0}=e;return await gh({},t,r,e,n)}function Ch(t,e){return class extends t{constructor(...n){super(...n),e(this)}}}const wh=Ch(Array,t=>t.fill(0));let W=1e-6;function Eh(t){function e(C=0,w=0){const x=new t(2);return C!==void 0&&(x[0]=C,w!==void 0&&(x[1]=w)),x}const n=e;function r(C,w,x){const i=x??new t(2);return i[0]=C,i[1]=w,i}function s(C,w){const x=w??new t(2);return x[0]=Math.ceil(C[0]),x[1]=Math.ceil(C[1]),x}function o(C,w){const x=w??new t(2);return x[0]=Math.floor(C[0]),x[1]=Math.floor(C[1]),x}function c(C,w){const x=w??new t(2);return x[0]=Math.round(C[0]),x[1]=Math.round(C[1]),x}function d(C,w=0,x=1,i){const p=i??new t(2);return p[0]=Math.min(x,Math.max(w,C[0])),p[1]=Math.min(x,Math.max(w,C[1])),p}function m(C,w,x){const i=x??new t(2);return i[0]=C[0]+w[0],i[1]=C[1]+w[1],i}function E(C,w,x,i){const p=i??new t(2);return p[0]=C[0]+w[0]*x,p[1]=C[1]+w[1]*x,p}function M(C,w){const x=C[0],i=C[1],p=w[0],f=w[1],h=Math.sqrt(x*x+i*i),u=Math.sqrt(p*p+f*f),A=h*u,_=A&&Le(C,w)/A;return Math.acos(_)}function D(C,w,x){const i=x??new t(2);return i[0]=C[0]-w[0],i[1]=C[1]-w[1],i}const R=D;function L(C,w){return Math.abs(C[0]-w[0])<W&&Math.abs(C[1]-w[1])<W}function H(C,w){return C[0]===w[0]&&C[1]===w[1]}function J(C,w,x,i){const p=i??new t(2);return p[0]=C[0]+x*(w[0]-C[0]),p[1]=C[1]+x*(w[1]-C[1]),p}function K(C,w,x,i){const p=i??new t(2);return p[0]=C[0]+x[0]*(w[0]-C[0]),p[1]=C[1]+x[1]*(w[1]-C[1]),p}function z(C,w,x){const i=x??new t(2);return i[0]=Math.max(C[0],w[0]),i[1]=Math.max(C[1],w[1]),i}function $(C,w,x){const i=x??new t(2);return i[0]=Math.min(C[0],w[0]),i[1]=Math.min(C[1],w[1]),i}function X(C,w,x){const i=x??new t(2);return i[0]=C[0]*w,i[1]=C[1]*w,i}const re=X;function ce(C,w,x){const i=x??new t(2);return i[0]=C[0]/w,i[1]=C[1]/w,i}function Re(C,w){const x=w??new t(2);return x[0]=1/C[0],x[1]=1/C[1],x}const ke=Re;function Oe(C,w,x){const i=x??new t(3),p=C[0]*w[1]-C[1]*w[0];return i[0]=0,i[1]=0,i[2]=p,i}function Le(C,w){return C[0]*w[0]+C[1]*w[1]}function ge(C){const w=C[0],x=C[1];return Math.sqrt(w*w+x*x)}const ze=ge;function Ee(C){const w=C[0],x=C[1];return w*w+x*x}const Ye=Ee;function me(C,w){const x=C[0]-w[0],i=C[1]-w[1];return Math.sqrt(x*x+i*i)}const q=me;function ee(C,w){const x=C[0]-w[0],i=C[1]-w[1];return x*x+i*i}const Z=ee;function xe(C,w){const x=w??new t(2),i=C[0],p=C[1],f=Math.sqrt(i*i+p*p);return f>1e-5?(x[0]=i/f,x[1]=p/f):(x[0]=0,x[1]=0),x}function $e(C,w){const x=w??new t(2);return x[0]=-C[0],x[1]=-C[1],x}function ie(C,w){const x=w??new t(2);return x[0]=C[0],x[1]=C[1],x}const We=ie;function Fe(C,w,x){const i=x??new t(2);return i[0]=C[0]*w[0],i[1]=C[1]*w[1],i}const Ze=Fe;function Ge(C,w,x){const i=x??new t(2);return i[0]=C[0]/w[0],i[1]=C[1]/w[1],i}const Ke=Ge;function je(C=1,w){const x=w??new t(2),i=Math.random()*2*Math.PI;return x[0]=Math.cos(i)*C,x[1]=Math.sin(i)*C,x}function T(C){const w=C??new t(2);return w[0]=0,w[1]=0,w}function O(C,w,x){const i=x??new t(2),p=C[0],f=C[1];return i[0]=p*w[0]+f*w[4]+w[12],i[1]=p*w[1]+f*w[5]+w[13],i}function b(C,w,x){const i=x??new t(2),p=C[0],f=C[1];return i[0]=w[0]*p+w[4]*f+w[8],i[1]=w[1]*p+w[5]*f+w[9],i}function a(C,w,x,i){const p=i??new t(2),f=C[0]-w[0],h=C[1]-w[1],u=Math.sin(x),A=Math.cos(x);return p[0]=f*A-h*u+w[0],p[1]=f*u+h*A+w[1],p}function g(C,w,x){const i=x??new t(2);return xe(C,i),X(i,w,i)}function l(C,w,x){const i=x??new t(2);return ge(C)>w?g(C,w,i):ie(C,i)}function B(C,w,x){const i=x??new t(2);return J(C,w,.5,i)}return{create:e,fromValues:n,set:r,ceil:s,floor:o,round:c,clamp:d,add:m,addScaled:E,angle:M,subtract:D,sub:R,equalsApproximately:L,equals:H,lerp:J,lerpV:K,max:z,min:$,mulScalar:X,scale:re,divScalar:ce,inverse:Re,invert:ke,cross:Oe,dot:Le,length:ge,len:ze,lengthSq:Ee,lenSq:Ye,distance:me,dist:q,distanceSq:ee,distSq:Z,normalize:xe,negate:$e,copy:ie,clone:We,multiply:Fe,mul:Ze,divide:Ge,div:Ke,random:je,zero:T,transformMat4:O,transformMat3:b,rotate:a,setLength:g,truncate:l,midpoint:B}}const Ss=new Map;function jo(t){let e=Ss.get(t);return e||(e=Eh(t),Ss.set(t,e)),e}function xh(t){function e(u,A,_){const y=new t(3);return u!==void 0&&(y[0]=u,A!==void 0&&(y[1]=A,_!==void 0&&(y[2]=_))),y}const n=e;function r(u,A,_,y){const v=y??new t(3);return v[0]=u,v[1]=A,v[2]=_,v}function s(u,A){const _=A??new t(3);return _[0]=Math.ceil(u[0]),_[1]=Math.ceil(u[1]),_[2]=Math.ceil(u[2]),_}function o(u,A){const _=A??new t(3);return _[0]=Math.floor(u[0]),_[1]=Math.floor(u[1]),_[2]=Math.floor(u[2]),_}function c(u,A){const _=A??new t(3);return _[0]=Math.round(u[0]),_[1]=Math.round(u[1]),_[2]=Math.round(u[2]),_}function d(u,A=0,_=1,y){const v=y??new t(3);return v[0]=Math.min(_,Math.max(A,u[0])),v[1]=Math.min(_,Math.max(A,u[1])),v[2]=Math.min(_,Math.max(A,u[2])),v}function m(u,A,_){const y=_??new t(3);return y[0]=u[0]+A[0],y[1]=u[1]+A[1],y[2]=u[2]+A[2],y}function E(u,A,_,y){const v=y??new t(3);return v[0]=u[0]+A[0]*_,v[1]=u[1]+A[1]*_,v[2]=u[2]+A[2]*_,v}function M(u,A){const _=u[0],y=u[1],v=u[2],G=A[0],I=A[1],k=A[2],U=Math.sqrt(_*_+y*y+v*v),P=Math.sqrt(G*G+I*I+k*k),j=U*P,Y=j&&Le(u,A)/j;return Math.acos(Y)}function D(u,A,_){const y=_??new t(3);return y[0]=u[0]-A[0],y[1]=u[1]-A[1],y[2]=u[2]-A[2],y}const R=D;function L(u,A){return Math.abs(u[0]-A[0])<W&&Math.abs(u[1]-A[1])<W&&Math.abs(u[2]-A[2])<W}function H(u,A){return u[0]===A[0]&&u[1]===A[1]&&u[2]===A[2]}function J(u,A,_,y){const v=y??new t(3);return v[0]=u[0]+_*(A[0]-u[0]),v[1]=u[1]+_*(A[1]-u[1]),v[2]=u[2]+_*(A[2]-u[2]),v}function K(u,A,_,y){const v=y??new t(3);return v[0]=u[0]+_[0]*(A[0]-u[0]),v[1]=u[1]+_[1]*(A[1]-u[1]),v[2]=u[2]+_[2]*(A[2]-u[2]),v}function z(u,A,_){const y=_??new t(3);return y[0]=Math.max(u[0],A[0]),y[1]=Math.max(u[1],A[1]),y[2]=Math.max(u[2],A[2]),y}function $(u,A,_){const y=_??new t(3);return y[0]=Math.min(u[0],A[0]),y[1]=Math.min(u[1],A[1]),y[2]=Math.min(u[2],A[2]),y}function X(u,A,_){const y=_??new t(3);return y[0]=u[0]*A,y[1]=u[1]*A,y[2]=u[2]*A,y}const re=X;function ce(u,A,_){const y=_??new t(3);return y[0]=u[0]/A,y[1]=u[1]/A,y[2]=u[2]/A,y}function Re(u,A){const _=A??new t(3);return _[0]=1/u[0],_[1]=1/u[1],_[2]=1/u[2],_}const ke=Re;function Oe(u,A,_){const y=_??new t(3),v=u[2]*A[0]-u[0]*A[2],G=u[0]*A[1]-u[1]*A[0];return y[0]=u[1]*A[2]-u[2]*A[1],y[1]=v,y[2]=G,y}function Le(u,A){return u[0]*A[0]+u[1]*A[1]+u[2]*A[2]}function ge(u){const A=u[0],_=u[1],y=u[2];return Math.sqrt(A*A+_*_+y*y)}const ze=ge;function Ee(u){const A=u[0],_=u[1],y=u[2];return A*A+_*_+y*y}const Ye=Ee;function me(u,A){const _=u[0]-A[0],y=u[1]-A[1],v=u[2]-A[2];return Math.sqrt(_*_+y*y+v*v)}const q=me;function ee(u,A){const _=u[0]-A[0],y=u[1]-A[1],v=u[2]-A[2];return _*_+y*y+v*v}const Z=ee;function xe(u,A){const _=A??new t(3),y=u[0],v=u[1],G=u[2],I=Math.sqrt(y*y+v*v+G*G);return I>1e-5?(_[0]=y/I,_[1]=v/I,_[2]=G/I):(_[0]=0,_[1]=0,_[2]=0),_}function $e(u,A){const _=A??new t(3);return _[0]=-u[0],_[1]=-u[1],_[2]=-u[2],_}function ie(u,A){const _=A??new t(3);return _[0]=u[0],_[1]=u[1],_[2]=u[2],_}const We=ie;function Fe(u,A,_){const y=_??new t(3);return y[0]=u[0]*A[0],y[1]=u[1]*A[1],y[2]=u[2]*A[2],y}const Ze=Fe;function Ge(u,A,_){const y=_??new t(3);return y[0]=u[0]/A[0],y[1]=u[1]/A[1],y[2]=u[2]/A[2],y}const Ke=Ge;function je(u=1,A){const _=A??new t(3),y=Math.random()*2*Math.PI,v=Math.random()*2-1,G=Math.sqrt(1-v*v)*u;return _[0]=Math.cos(y)*G,_[1]=Math.sin(y)*G,_[2]=v*u,_}function T(u){const A=u??new t(3);return A[0]=0,A[1]=0,A[2]=0,A}function O(u,A,_){const y=_??new t(3),v=u[0],G=u[1],I=u[2],k=A[3]*v+A[7]*G+A[11]*I+A[15]||1;return y[0]=(A[0]*v+A[4]*G+A[8]*I+A[12])/k,y[1]=(A[1]*v+A[5]*G+A[9]*I+A[13])/k,y[2]=(A[2]*v+A[6]*G+A[10]*I+A[14])/k,y}function b(u,A,_){const y=_??new t(3),v=u[0],G=u[1],I=u[2];return y[0]=v*A[0]+G*A[4]+I*A[8],y[1]=v*A[1]+G*A[5]+I*A[9],y[2]=v*A[2]+G*A[6]+I*A[10],y}function a(u,A,_){const y=_??new t(3),v=u[0],G=u[1],I=u[2];return y[0]=v*A[0]+G*A[4]+I*A[8],y[1]=v*A[1]+G*A[5]+I*A[9],y[2]=v*A[2]+G*A[6]+I*A[10],y}function g(u,A,_){const y=_??new t(3),v=A[0],G=A[1],I=A[2],k=A[3]*2,U=u[0],P=u[1],j=u[2],Y=G*j-I*P,V=I*U-v*j,Q=v*P-G*U;return y[0]=U+Y*k+(G*Q-I*V)*2,y[1]=P+V*k+(I*Y-v*Q)*2,y[2]=j+Q*k+(v*V-G*Y)*2,y}function l(u,A){const _=A??new t(3);return _[0]=u[12],_[1]=u[13],_[2]=u[14],_}function B(u,A,_){const y=_??new t(3),v=A*4;return y[0]=u[v+0],y[1]=u[v+1],y[2]=u[v+2],y}function C(u,A){const _=A??new t(3),y=u[0],v=u[1],G=u[2],I=u[4],k=u[5],U=u[6],P=u[8],j=u[9],Y=u[10];return _[0]=Math.sqrt(y*y+v*v+G*G),_[1]=Math.sqrt(I*I+k*k+U*U),_[2]=Math.sqrt(P*P+j*j+Y*Y),_}function w(u,A,_,y){const v=y??new t(3),G=[],I=[];return G[0]=u[0]-A[0],G[1]=u[1]-A[1],G[2]=u[2]-A[2],I[0]=G[0],I[1]=G[1]*Math.cos(_)-G[2]*Math.sin(_),I[2]=G[1]*Math.sin(_)+G[2]*Math.cos(_),v[0]=I[0]+A[0],v[1]=I[1]+A[1],v[2]=I[2]+A[2],v}function x(u,A,_,y){const v=y??new t(3),G=[],I=[];return G[0]=u[0]-A[0],G[1]=u[1]-A[1],G[2]=u[2]-A[2],I[0]=G[2]*Math.sin(_)+G[0]*Math.cos(_),I[1]=G[1],I[2]=G[2]*Math.cos(_)-G[0]*Math.sin(_),v[0]=I[0]+A[0],v[1]=I[1]+A[1],v[2]=I[2]+A[2],v}function i(u,A,_,y){const v=y??new t(3),G=[],I=[];return G[0]=u[0]-A[0],G[1]=u[1]-A[1],G[2]=u[2]-A[2],I[0]=G[0]*Math.cos(_)-G[1]*Math.sin(_),I[1]=G[0]*Math.sin(_)+G[1]*Math.cos(_),I[2]=G[2],v[0]=I[0]+A[0],v[1]=I[1]+A[1],v[2]=I[2]+A[2],v}function p(u,A,_){const y=_??new t(3);return xe(u,y),X(y,A,y)}function f(u,A,_){const y=_??new t(3);return ge(u)>A?p(u,A,y):ie(u,y)}function h(u,A,_){const y=_??new t(3);return J(u,A,.5,y)}return{create:e,fromValues:n,set:r,ceil:s,floor:o,round:c,clamp:d,add:m,addScaled:E,angle:M,subtract:D,sub:R,equalsApproximately:L,equals:H,lerp:J,lerpV:K,max:z,min:$,mulScalar:X,scale:re,divScalar:ce,inverse:Re,invert:ke,cross:Oe,dot:Le,length:ge,len:ze,lengthSq:Ee,lenSq:Ye,distance:me,dist:q,distanceSq:ee,distSq:Z,normalize:xe,negate:$e,copy:ie,clone:We,multiply:Fe,mul:Ze,divide:Ge,div:Ke,random:je,zero:T,transformMat4:O,transformMat4Upper3x3:b,transformMat3:a,transformQuat:g,getTranslation:l,getAxis:B,getScaling:C,rotateX:w,rotateY:x,rotateZ:i,setLength:p,truncate:f,midpoint:h}}const Rs=new Map;function vn(t){let e=Rs.get(t);return e||(e=xh(t),Rs.set(t,e)),e}function Mh(t){const e=jo(t),n=vn(t);function r(a,g,l,B,C,w,x,i,p){const f=new t(12);return f[3]=0,f[7]=0,f[11]=0,a!==void 0&&(f[0]=a,g!==void 0&&(f[1]=g,l!==void 0&&(f[2]=l,B!==void 0&&(f[4]=B,C!==void 0&&(f[5]=C,w!==void 0&&(f[6]=w,x!==void 0&&(f[8]=x,i!==void 0&&(f[9]=i,p!==void 0&&(f[10]=p))))))))),f}function s(a,g,l,B,C,w,x,i,p,f){const h=f??new t(12);return h[0]=a,h[1]=g,h[2]=l,h[3]=0,h[4]=B,h[5]=C,h[6]=w,h[7]=0,h[8]=x,h[9]=i,h[10]=p,h[11]=0,h}function o(a,g){const l=g??new t(12);return l[0]=a[0],l[1]=a[1],l[2]=a[2],l[3]=0,l[4]=a[4],l[5]=a[5],l[6]=a[6],l[7]=0,l[8]=a[8],l[9]=a[9],l[10]=a[10],l[11]=0,l}function c(a,g){const l=g??new t(12),B=a[0],C=a[1],w=a[2],x=a[3],i=B+B,p=C+C,f=w+w,h=B*i,u=C*i,A=C*p,_=w*i,y=w*p,v=w*f,G=x*i,I=x*p,k=x*f;return l[0]=1-A-v,l[1]=u+k,l[2]=_-I,l[3]=0,l[4]=u-k,l[5]=1-h-v,l[6]=y+G,l[7]=0,l[8]=_+I,l[9]=y-G,l[10]=1-h-A,l[11]=0,l}function d(a,g){const l=g??new t(12);return l[0]=-a[0],l[1]=-a[1],l[2]=-a[2],l[4]=-a[4],l[5]=-a[5],l[6]=-a[6],l[8]=-a[8],l[9]=-a[9],l[10]=-a[10],l}function m(a,g,l){const B=l??new t(12);return B[0]=a[0]*g,B[1]=a[1]*g,B[2]=a[2]*g,B[4]=a[4]*g,B[5]=a[5]*g,B[6]=a[6]*g,B[8]=a[8]*g,B[9]=a[9]*g,B[10]=a[10]*g,B}const E=m;function M(a,g,l){const B=l??new t(12);return B[0]=a[0]+g[0],B[1]=a[1]+g[1],B[2]=a[2]+g[2],B[4]=a[4]+g[4],B[5]=a[5]+g[5],B[6]=a[6]+g[6],B[8]=a[8]+g[8],B[9]=a[9]+g[9],B[10]=a[10]+g[10],B}function D(a,g){const l=g??new t(12);return l[0]=a[0],l[1]=a[1],l[2]=a[2],l[4]=a[4],l[5]=a[5],l[6]=a[6],l[8]=a[8],l[9]=a[9],l[10]=a[10],l}const R=D;function L(a,g){return Math.abs(a[0]-g[0])<W&&Math.abs(a[1]-g[1])<W&&Math.abs(a[2]-g[2])<W&&Math.abs(a[4]-g[4])<W&&Math.abs(a[5]-g[5])<W&&Math.abs(a[6]-g[6])<W&&Math.abs(a[8]-g[8])<W&&Math.abs(a[9]-g[9])<W&&Math.abs(a[10]-g[10])<W}function H(a,g){return a[0]===g[0]&&a[1]===g[1]&&a[2]===g[2]&&a[4]===g[4]&&a[5]===g[5]&&a[6]===g[6]&&a[8]===g[8]&&a[9]===g[9]&&a[10]===g[10]}function J(a){const g=a??new t(12);return g[0]=1,g[1]=0,g[2]=0,g[4]=0,g[5]=1,g[6]=0,g[8]=0,g[9]=0,g[10]=1,g}function K(a,g){const l=g??new t(12);if(l===a){let A;return A=a[1],a[1]=a[4],a[4]=A,A=a[2],a[2]=a[8],a[8]=A,A=a[6],a[6]=a[9],a[9]=A,l}const B=a[0],C=a[1],w=a[2],x=a[4],i=a[5],p=a[6],f=a[8],h=a[9],u=a[10];return l[0]=B,l[1]=x,l[2]=f,l[4]=C,l[5]=i,l[6]=h,l[8]=w,l[9]=p,l[10]=u,l}function z(a,g){const l=g??new t(12),B=a[0],C=a[1],w=a[2],x=a[4],i=a[5],p=a[6],f=a[8],h=a[9],u=a[10],A=u*i-p*h,_=-u*x+p*f,y=h*x-i*f,v=1/(B*A+C*_+w*y);return l[0]=A*v,l[1]=(-u*C+w*h)*v,l[2]=(p*C-w*i)*v,l[4]=_*v,l[5]=(u*B-w*f)*v,l[6]=(-p*B+w*x)*v,l[8]=y*v,l[9]=(-h*B+C*f)*v,l[10]=(i*B-C*x)*v,l}function $(a){const g=a[0],l=a[1],B=a[2],C=a[4],w=a[5],x=a[6],i=a[8],p=a[9],f=a[10];return g*(w*f-p*x)-C*(l*f-p*B)+i*(l*x-w*B)}const X=z;function re(a,g,l){const B=l??new t(12),C=a[0],w=a[1],x=a[2],i=a[4],p=a[5],f=a[6],h=a[8],u=a[9],A=a[10],_=g[0],y=g[1],v=g[2],G=g[4],I=g[5],k=g[6],U=g[8],P=g[9],j=g[10];return B[0]=C*_+i*y+h*v,B[1]=w*_+p*y+u*v,B[2]=x*_+f*y+A*v,B[4]=C*G+i*I+h*k,B[5]=w*G+p*I+u*k,B[6]=x*G+f*I+A*k,B[8]=C*U+i*P+h*j,B[9]=w*U+p*P+u*j,B[10]=x*U+f*P+A*j,B}const ce=re;function Re(a,g,l){const B=l??J();return a!==B&&(B[0]=a[0],B[1]=a[1],B[2]=a[2],B[4]=a[4],B[5]=a[5],B[6]=a[6]),B[8]=g[0],B[9]=g[1],B[10]=1,B}function ke(a,g){const l=g??e.create();return l[0]=a[8],l[1]=a[9],l}function Oe(a,g,l){const B=l??e.create(),C=g*4;return B[0]=a[C+0],B[1]=a[C+1],B}function Le(a,g,l,B){const C=B===a?a:D(a,B),w=l*4;return C[w+0]=g[0],C[w+1]=g[1],C}function ge(a,g){const l=g??e.create(),B=a[0],C=a[1],w=a[4],x=a[5];return l[0]=Math.sqrt(B*B+C*C),l[1]=Math.sqrt(w*w+x*x),l}function ze(a,g){const l=g??n.create(),B=a[0],C=a[1],w=a[2],x=a[4],i=a[5],p=a[6],f=a[8],h=a[9],u=a[10];return l[0]=Math.sqrt(B*B+C*C+w*w),l[1]=Math.sqrt(x*x+i*i+p*p),l[2]=Math.sqrt(f*f+h*h+u*u),l}function Ee(a,g){const l=g??new t(12);return l[0]=1,l[1]=0,l[2]=0,l[4]=0,l[5]=1,l[6]=0,l[8]=a[0],l[9]=a[1],l[10]=1,l}function Ye(a,g,l){const B=l??new t(12),C=g[0],w=g[1],x=a[0],i=a[1],p=a[2],f=a[4],h=a[5],u=a[6],A=a[8],_=a[9],y=a[10];return a!==B&&(B[0]=x,B[1]=i,B[2]=p,B[4]=f,B[5]=h,B[6]=u),B[8]=x*C+f*w+A,B[9]=i*C+h*w+_,B[10]=p*C+u*w+y,B}function me(a,g){const l=g??new t(12),B=Math.cos(a),C=Math.sin(a);return l[0]=B,l[1]=C,l[2]=0,l[4]=-C,l[5]=B,l[6]=0,l[8]=0,l[9]=0,l[10]=1,l}function q(a,g,l){const B=l??new t(12),C=a[0],w=a[1],x=a[2],i=a[4],p=a[5],f=a[6],h=Math.cos(g),u=Math.sin(g);return B[0]=h*C+u*i,B[1]=h*w+u*p,B[2]=h*x+u*f,B[4]=h*i-u*C,B[5]=h*p-u*w,B[6]=h*f-u*x,a!==B&&(B[8]=a[8],B[9]=a[9],B[10]=a[10]),B}function ee(a,g){const l=g??new t(12),B=Math.cos(a),C=Math.sin(a);return l[0]=1,l[1]=0,l[2]=0,l[4]=0,l[5]=B,l[6]=C,l[8]=0,l[9]=-C,l[10]=B,l}function Z(a,g,l){const B=l??new t(12),C=a[4],w=a[5],x=a[6],i=a[8],p=a[9],f=a[10],h=Math.cos(g),u=Math.sin(g);return B[4]=h*C+u*i,B[5]=h*w+u*p,B[6]=h*x+u*f,B[8]=h*i-u*C,B[9]=h*p-u*w,B[10]=h*f-u*x,a!==B&&(B[0]=a[0],B[1]=a[1],B[2]=a[2]),B}function xe(a,g){const l=g??new t(12),B=Math.cos(a),C=Math.sin(a);return l[0]=B,l[1]=0,l[2]=-C,l[4]=0,l[5]=1,l[6]=0,l[8]=C,l[9]=0,l[10]=B,l}function $e(a,g,l){const B=l??new t(12),C=a[0],w=a[1],x=a[2],i=a[8],p=a[9],f=a[10],h=Math.cos(g),u=Math.sin(g);return B[0]=h*C-u*i,B[1]=h*w-u*p,B[2]=h*x-u*f,B[8]=h*i+u*C,B[9]=h*p+u*w,B[10]=h*f+u*x,a!==B&&(B[4]=a[4],B[5]=a[5],B[6]=a[6]),B}const ie=me,We=q;function Fe(a,g){const l=g??new t(12);return l[0]=a[0],l[1]=0,l[2]=0,l[4]=0,l[5]=a[1],l[6]=0,l[8]=0,l[9]=0,l[10]=1,l}function Ze(a,g,l){const B=l??new t(12),C=g[0],w=g[1];return B[0]=C*a[0],B[1]=C*a[1],B[2]=C*a[2],B[4]=w*a[4],B[5]=w*a[5],B[6]=w*a[6],a!==B&&(B[8]=a[8],B[9]=a[9],B[10]=a[10]),B}function Ge(a,g){const l=g??new t(12);return l[0]=a[0],l[1]=0,l[2]=0,l[4]=0,l[5]=a[1],l[6]=0,l[8]=0,l[9]=0,l[10]=a[2],l}function Ke(a,g,l){const B=l??new t(12),C=g[0],w=g[1],x=g[2];return B[0]=C*a[0],B[1]=C*a[1],B[2]=C*a[2],B[4]=w*a[4],B[5]=w*a[5],B[6]=w*a[6],B[8]=x*a[8],B[9]=x*a[9],B[10]=x*a[10],B}function je(a,g){const l=g??new t(12);return l[0]=a,l[1]=0,l[2]=0,l[4]=0,l[5]=a,l[6]=0,l[8]=0,l[9]=0,l[10]=1,l}function T(a,g,l){const B=l??new t(12);return B[0]=g*a[0],B[1]=g*a[1],B[2]=g*a[2],B[4]=g*a[4],B[5]=g*a[5],B[6]=g*a[6],a!==B&&(B[8]=a[8],B[9]=a[9],B[10]=a[10]),B}function O(a,g){const l=g??new t(12);return l[0]=a,l[1]=0,l[2]=0,l[4]=0,l[5]=a,l[6]=0,l[8]=0,l[9]=0,l[10]=a,l}function b(a,g,l){const B=l??new t(12);return B[0]=g*a[0],B[1]=g*a[1],B[2]=g*a[2],B[4]=g*a[4],B[5]=g*a[5],B[6]=g*a[6],B[8]=g*a[8],B[9]=g*a[9],B[10]=g*a[10],B}return{add:M,clone:R,copy:D,create:r,determinant:$,equals:H,equalsApproximately:L,fromMat4:o,fromQuat:c,get3DScaling:ze,getAxis:Oe,getScaling:ge,getTranslation:ke,identity:J,inverse:z,invert:X,mul:ce,mulScalar:E,multiply:re,multiplyScalar:m,negate:d,rotate:q,rotateX:Z,rotateY:$e,rotateZ:We,rotation:me,rotationX:ee,rotationY:xe,rotationZ:ie,scale:Ze,scale3D:Ke,scaling:Fe,scaling3D:Ge,set:s,setAxis:Le,setTranslation:Re,translate:Ye,translation:Ee,transpose:K,uniformScale:T,uniformScale3D:b,uniformScaling:je,uniformScaling3D:O}}const Os=new Map;function Th(t){let e=Os.get(t);return e||(e=Mh(t),Os.set(t,e)),e}function vh(t){const e=vn(t);function n(i,p,f,h,u,A,_,y,v,G,I,k,U,P,j,Y){const V=new t(16);return i!==void 0&&(V[0]=i,p!==void 0&&(V[1]=p,f!==void 0&&(V[2]=f,h!==void 0&&(V[3]=h,u!==void 0&&(V[4]=u,A!==void 0&&(V[5]=A,_!==void 0&&(V[6]=_,y!==void 0&&(V[7]=y,v!==void 0&&(V[8]=v,G!==void 0&&(V[9]=G,I!==void 0&&(V[10]=I,k!==void 0&&(V[11]=k,U!==void 0&&(V[12]=U,P!==void 0&&(V[13]=P,j!==void 0&&(V[14]=j,Y!==void 0&&(V[15]=Y)))))))))))))))),V}function r(i,p,f,h,u,A,_,y,v,G,I,k,U,P,j,Y,V){const Q=V??new t(16);return Q[0]=i,Q[1]=p,Q[2]=f,Q[3]=h,Q[4]=u,Q[5]=A,Q[6]=_,Q[7]=y,Q[8]=v,Q[9]=G,Q[10]=I,Q[11]=k,Q[12]=U,Q[13]=P,Q[14]=j,Q[15]=Y,Q}function s(i,p){const f=p??new t(16);return f[0]=i[0],f[1]=i[1],f[2]=i[2],f[3]=0,f[4]=i[4],f[5]=i[5],f[6]=i[6],f[7]=0,f[8]=i[8],f[9]=i[9],f[10]=i[10],f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function o(i,p){const f=p??new t(16),h=i[0],u=i[1],A=i[2],_=i[3],y=h+h,v=u+u,G=A+A,I=h*y,k=u*y,U=u*v,P=A*y,j=A*v,Y=A*G,V=_*y,Q=_*v,ne=_*G;return f[0]=1-U-Y,f[1]=k+ne,f[2]=P-Q,f[3]=0,f[4]=k-ne,f[5]=1-I-Y,f[6]=j+V,f[7]=0,f[8]=P+Q,f[9]=j-V,f[10]=1-I-U,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function c(i,p){const f=p??new t(16);return f[0]=-i[0],f[1]=-i[1],f[2]=-i[2],f[3]=-i[3],f[4]=-i[4],f[5]=-i[5],f[6]=-i[6],f[7]=-i[7],f[8]=-i[8],f[9]=-i[9],f[10]=-i[10],f[11]=-i[11],f[12]=-i[12],f[13]=-i[13],f[14]=-i[14],f[15]=-i[15],f}function d(i,p,f){const h=f??new t(16);return h[0]=i[0]+p[0],h[1]=i[1]+p[1],h[2]=i[2]+p[2],h[3]=i[3]+p[3],h[4]=i[4]+p[4],h[5]=i[5]+p[5],h[6]=i[6]+p[6],h[7]=i[7]+p[7],h[8]=i[8]+p[8],h[9]=i[9]+p[9],h[10]=i[10]+p[10],h[11]=i[11]+p[11],h[12]=i[12]+p[12],h[13]=i[13]+p[13],h[14]=i[14]+p[14],h[15]=i[15]+p[15],h}function m(i,p,f){const h=f??new t(16);return h[0]=i[0]*p,h[1]=i[1]*p,h[2]=i[2]*p,h[3]=i[3]*p,h[4]=i[4]*p,h[5]=i[5]*p,h[6]=i[6]*p,h[7]=i[7]*p,h[8]=i[8]*p,h[9]=i[9]*p,h[10]=i[10]*p,h[11]=i[11]*p,h[12]=i[12]*p,h[13]=i[13]*p,h[14]=i[14]*p,h[15]=i[15]*p,h}const E=m;function M(i,p){const f=p??new t(16);return f[0]=i[0],f[1]=i[1],f[2]=i[2],f[3]=i[3],f[4]=i[4],f[5]=i[5],f[6]=i[6],f[7]=i[7],f[8]=i[8],f[9]=i[9],f[10]=i[10],f[11]=i[11],f[12]=i[12],f[13]=i[13],f[14]=i[14],f[15]=i[15],f}const D=M;function R(i,p){return Math.abs(i[0]-p[0])<W&&Math.abs(i[1]-p[1])<W&&Math.abs(i[2]-p[2])<W&&Math.abs(i[3]-p[3])<W&&Math.abs(i[4]-p[4])<W&&Math.abs(i[5]-p[5])<W&&Math.abs(i[6]-p[6])<W&&Math.abs(i[7]-p[7])<W&&Math.abs(i[8]-p[8])<W&&Math.abs(i[9]-p[9])<W&&Math.abs(i[10]-p[10])<W&&Math.abs(i[11]-p[11])<W&&Math.abs(i[12]-p[12])<W&&Math.abs(i[13]-p[13])<W&&Math.abs(i[14]-p[14])<W&&Math.abs(i[15]-p[15])<W}function L(i,p){return i[0]===p[0]&&i[1]===p[1]&&i[2]===p[2]&&i[3]===p[3]&&i[4]===p[4]&&i[5]===p[5]&&i[6]===p[6]&&i[7]===p[7]&&i[8]===p[8]&&i[9]===p[9]&&i[10]===p[10]&&i[11]===p[11]&&i[12]===p[12]&&i[13]===p[13]&&i[14]===p[14]&&i[15]===p[15]}function H(i){const p=i??new t(16);return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}function J(i,p){const f=p??new t(16);if(f===i){let te;return te=i[1],i[1]=i[4],i[4]=te,te=i[2],i[2]=i[8],i[8]=te,te=i[3],i[3]=i[12],i[12]=te,te=i[6],i[6]=i[9],i[9]=te,te=i[7],i[7]=i[13],i[13]=te,te=i[11],i[11]=i[14],i[14]=te,f}const h=i[0],u=i[1],A=i[2],_=i[3],y=i[4],v=i[5],G=i[6],I=i[7],k=i[8],U=i[9],P=i[10],j=i[11],Y=i[12],V=i[13],Q=i[14],ne=i[15];return f[0]=h,f[1]=y,f[2]=k,f[3]=Y,f[4]=u,f[5]=v,f[6]=U,f[7]=V,f[8]=A,f[9]=G,f[10]=P,f[11]=Q,f[12]=_,f[13]=I,f[14]=j,f[15]=ne,f}function K(i,p){const f=p??new t(16),h=i[0],u=i[1],A=i[2],_=i[3],y=i[4],v=i[5],G=i[6],I=i[7],k=i[8],U=i[9],P=i[10],j=i[11],Y=i[12],V=i[13],Q=i[14],ne=i[15],te=P*ne,fe=Q*j,le=G*ne,de=Q*I,pe=G*j,Be=P*I,ye=A*ne,be=Q*_,_e=A*j,Ce=P*_,Me=A*I,Te=G*_,ve=k*V,De=Y*U,Ue=y*V,Pe=Y*v,He=y*U,zt=k*v,Yt=h*V,$t=Y*u,Wt=h*U,Zt=k*u,qt=h*v,en=y*u,Or=te*v+de*U+pe*V-(fe*v+le*U+Be*V),Lr=fe*u+ye*U+Ce*V-(te*u+be*U+_e*V),Ur=le*u+be*v+Me*V-(de*u+ye*v+Te*V),Pr=Be*u+_e*v+Te*U-(pe*u+Ce*v+Me*U),we=1/(h*Or+y*Lr+k*Ur+Y*Pr);return f[0]=we*Or,f[1]=we*Lr,f[2]=we*Ur,f[3]=we*Pr,f[4]=we*(fe*y+le*k+Be*Y-(te*y+de*k+pe*Y)),f[5]=we*(te*h+be*k+_e*Y-(fe*h+ye*k+Ce*Y)),f[6]=we*(de*h+ye*y+Te*Y-(le*h+be*y+Me*Y)),f[7]=we*(pe*h+Ce*y+Me*k-(Be*h+_e*y+Te*k)),f[8]=we*(ve*I+Pe*j+He*ne-(De*I+Ue*j+zt*ne)),f[9]=we*(De*_+Yt*j+Zt*ne-(ve*_+$t*j+Wt*ne)),f[10]=we*(Ue*_+$t*I+qt*ne-(Pe*_+Yt*I+en*ne)),f[11]=we*(zt*_+Wt*I+en*j-(He*_+Zt*I+qt*j)),f[12]=we*(Ue*P+zt*Q+De*G-(He*Q+ve*G+Pe*P)),f[13]=we*(Wt*Q+ve*A+$t*P-(Yt*P+Zt*Q+De*A)),f[14]=we*(Yt*G+en*Q+Pe*A-(qt*Q+Ue*A+$t*G)),f[15]=we*(qt*P+He*A+Zt*G-(Wt*G+en*P+zt*A)),f}function z(i){const p=i[0],f=i[1],h=i[2],u=i[3],A=i[4],_=i[5],y=i[6],v=i[7],G=i[8],I=i[9],k=i[10],U=i[11],P=i[12],j=i[13],Y=i[14],V=i[15],Q=k*V,ne=Y*U,te=y*V,fe=Y*v,le=y*U,de=k*v,pe=h*V,Be=Y*u,ye=h*U,be=k*u,_e=h*v,Ce=y*u,Me=Q*_+fe*I+le*j-(ne*_+te*I+de*j),Te=ne*f+pe*I+be*j-(Q*f+Be*I+ye*j),ve=te*f+Be*_+_e*j-(fe*f+pe*_+Ce*j),De=de*f+ye*_+Ce*I-(le*f+be*_+_e*I);return p*Me+A*Te+G*ve+P*De}const $=K;function X(i,p,f){const h=f??new t(16),u=i[0],A=i[1],_=i[2],y=i[3],v=i[4],G=i[5],I=i[6],k=i[7],U=i[8],P=i[9],j=i[10],Y=i[11],V=i[12],Q=i[13],ne=i[14],te=i[15],fe=p[0],le=p[1],de=p[2],pe=p[3],Be=p[4],ye=p[5],be=p[6],_e=p[7],Ce=p[8],Me=p[9],Te=p[10],ve=p[11],De=p[12],Ue=p[13],Pe=p[14],He=p[15];return h[0]=u*fe+v*le+U*de+V*pe,h[1]=A*fe+G*le+P*de+Q*pe,h[2]=_*fe+I*le+j*de+ne*pe,h[3]=y*fe+k*le+Y*de+te*pe,h[4]=u*Be+v*ye+U*be+V*_e,h[5]=A*Be+G*ye+P*be+Q*_e,h[6]=_*Be+I*ye+j*be+ne*_e,h[7]=y*Be+k*ye+Y*be+te*_e,h[8]=u*Ce+v*Me+U*Te+V*ve,h[9]=A*Ce+G*Me+P*Te+Q*ve,h[10]=_*Ce+I*Me+j*Te+ne*ve,h[11]=y*Ce+k*Me+Y*Te+te*ve,h[12]=u*De+v*Ue+U*Pe+V*He,h[13]=A*De+G*Ue+P*Pe+Q*He,h[14]=_*De+I*Ue+j*Pe+ne*He,h[15]=y*De+k*Ue+Y*Pe+te*He,h}const re=X;function ce(i,p,f){const h=f??H();return i!==h&&(h[0]=i[0],h[1]=i[1],h[2]=i[2],h[3]=i[3],h[4]=i[4],h[5]=i[5],h[6]=i[6],h[7]=i[7],h[8]=i[8],h[9]=i[9],h[10]=i[10],h[11]=i[11]),h[12]=p[0],h[13]=p[1],h[14]=p[2],h[15]=1,h}function Re(i,p){const f=p??e.create();return f[0]=i[12],f[1]=i[13],f[2]=i[14],f}function ke(i,p,f){const h=f??e.create(),u=p*4;return h[0]=i[u+0],h[1]=i[u+1],h[2]=i[u+2],h}function Oe(i,p,f,h){const u=h===i?h:M(i,h),A=f*4;return u[A+0]=p[0],u[A+1]=p[1],u[A+2]=p[2],u}function Le(i,p){const f=p??e.create(),h=i[0],u=i[1],A=i[2],_=i[4],y=i[5],v=i[6],G=i[8],I=i[9],k=i[10];return f[0]=Math.sqrt(h*h+u*u+A*A),f[1]=Math.sqrt(_*_+y*y+v*v),f[2]=Math.sqrt(G*G+I*I+k*k),f}function ge(i,p,f,h,u){const A=u??new t(16),_=Math.tan(Math.PI*.5-.5*i);if(A[0]=_/p,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=_,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[11]=-1,A[12]=0,A[13]=0,A[15]=0,Number.isFinite(h)){const y=1/(f-h);A[10]=h*y,A[14]=h*f*y}else A[10]=-1,A[14]=-f;return A}function ze(i,p,f,h=1/0,u){const A=u??new t(16),_=1/Math.tan(i*.5);if(A[0]=_/p,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=_,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[11]=-1,A[12]=0,A[13]=0,A[15]=0,h===1/0)A[10]=0,A[14]=f;else{const y=1/(h-f);A[10]=f*y,A[14]=h*f*y}return A}function Ee(i,p,f,h,u,A,_){const y=_??new t(16);return y[0]=2/(p-i),y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=2/(h-f),y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=1/(u-A),y[11]=0,y[12]=(p+i)/(i-p),y[13]=(h+f)/(f-h),y[14]=u/(u-A),y[15]=1,y}function Ye(i,p,f,h,u,A,_){const y=_??new t(16),v=p-i,G=h-f,I=u-A;return y[0]=2*u/v,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=2*u/G,y[6]=0,y[7]=0,y[8]=(i+p)/v,y[9]=(h+f)/G,y[10]=A/I,y[11]=-1,y[12]=0,y[13]=0,y[14]=u*A/I,y[15]=0,y}function me(i,p,f,h,u,A=1/0,_){const y=_??new t(16),v=p-i,G=h-f;if(y[0]=2*u/v,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=2*u/G,y[6]=0,y[7]=0,y[8]=(i+p)/v,y[9]=(h+f)/G,y[11]=-1,y[12]=0,y[13]=0,y[15]=0,A===1/0)y[10]=0,y[14]=u;else{const I=1/(A-u);y[10]=u*I,y[14]=A*u*I}return y}const q=e.create(),ee=e.create(),Z=e.create();function xe(i,p,f,h){const u=h??new t(16);return e.normalize(e.subtract(p,i,Z),Z),e.normalize(e.cross(f,Z,q),q),e.normalize(e.cross(Z,q,ee),ee),u[0]=q[0],u[1]=q[1],u[2]=q[2],u[3]=0,u[4]=ee[0],u[5]=ee[1],u[6]=ee[2],u[7]=0,u[8]=Z[0],u[9]=Z[1],u[10]=Z[2],u[11]=0,u[12]=i[0],u[13]=i[1],u[14]=i[2],u[15]=1,u}function $e(i,p,f,h){const u=h??new t(16);return e.normalize(e.subtract(i,p,Z),Z),e.normalize(e.cross(f,Z,q),q),e.normalize(e.cross(Z,q,ee),ee),u[0]=q[0],u[1]=q[1],u[2]=q[2],u[3]=0,u[4]=ee[0],u[5]=ee[1],u[6]=ee[2],u[7]=0,u[8]=Z[0],u[9]=Z[1],u[10]=Z[2],u[11]=0,u[12]=i[0],u[13]=i[1],u[14]=i[2],u[15]=1,u}function ie(i,p,f,h){const u=h??new t(16);return e.normalize(e.subtract(i,p,Z),Z),e.normalize(e.cross(f,Z,q),q),e.normalize(e.cross(Z,q,ee),ee),u[0]=q[0],u[1]=ee[0],u[2]=Z[0],u[3]=0,u[4]=q[1],u[5]=ee[1],u[6]=Z[1],u[7]=0,u[8]=q[2],u[9]=ee[2],u[10]=Z[2],u[11]=0,u[12]=-(q[0]*i[0]+q[1]*i[1]+q[2]*i[2]),u[13]=-(ee[0]*i[0]+ee[1]*i[1]+ee[2]*i[2]),u[14]=-(Z[0]*i[0]+Z[1]*i[1]+Z[2]*i[2]),u[15]=1,u}function We(i,p){const f=p??new t(16);return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=i[0],f[13]=i[1],f[14]=i[2],f[15]=1,f}function Fe(i,p,f){const h=f??new t(16),u=p[0],A=p[1],_=p[2],y=i[0],v=i[1],G=i[2],I=i[3],k=i[4],U=i[5],P=i[6],j=i[7],Y=i[8],V=i[9],Q=i[10],ne=i[11],te=i[12],fe=i[13],le=i[14],de=i[15];return i!==h&&(h[0]=y,h[1]=v,h[2]=G,h[3]=I,h[4]=k,h[5]=U,h[6]=P,h[7]=j,h[8]=Y,h[9]=V,h[10]=Q,h[11]=ne),h[12]=y*u+k*A+Y*_+te,h[13]=v*u+U*A+V*_+fe,h[14]=G*u+P*A+Q*_+le,h[15]=I*u+j*A+ne*_+de,h}function Ze(i,p){const f=p??new t(16),h=Math.cos(i),u=Math.sin(i);return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=h,f[6]=u,f[7]=0,f[8]=0,f[9]=-u,f[10]=h,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function Ge(i,p,f){const h=f??new t(16),u=i[4],A=i[5],_=i[6],y=i[7],v=i[8],G=i[9],I=i[10],k=i[11],U=Math.cos(p),P=Math.sin(p);return h[4]=U*u+P*v,h[5]=U*A+P*G,h[6]=U*_+P*I,h[7]=U*y+P*k,h[8]=U*v-P*u,h[9]=U*G-P*A,h[10]=U*I-P*_,h[11]=U*k-P*y,i!==h&&(h[0]=i[0],h[1]=i[1],h[2]=i[2],h[3]=i[3],h[12]=i[12],h[13]=i[13],h[14]=i[14],h[15]=i[15]),h}function Ke(i,p){const f=p??new t(16),h=Math.cos(i),u=Math.sin(i);return f[0]=h,f[1]=0,f[2]=-u,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=u,f[9]=0,f[10]=h,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function je(i,p,f){const h=f??new t(16),u=i[0],A=i[1],_=i[2],y=i[3],v=i[8],G=i[9],I=i[10],k=i[11],U=Math.cos(p),P=Math.sin(p);return h[0]=U*u-P*v,h[1]=U*A-P*G,h[2]=U*_-P*I,h[3]=U*y-P*k,h[8]=U*v+P*u,h[9]=U*G+P*A,h[10]=U*I+P*_,h[11]=U*k+P*y,i!==h&&(h[4]=i[4],h[5]=i[5],h[6]=i[6],h[7]=i[7],h[12]=i[12],h[13]=i[13],h[14]=i[14],h[15]=i[15]),h}function T(i,p){const f=p??new t(16),h=Math.cos(i),u=Math.sin(i);return f[0]=h,f[1]=u,f[2]=0,f[3]=0,f[4]=-u,f[5]=h,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function O(i,p,f){const h=f??new t(16),u=i[0],A=i[1],_=i[2],y=i[3],v=i[4],G=i[5],I=i[6],k=i[7],U=Math.cos(p),P=Math.sin(p);return h[0]=U*u+P*v,h[1]=U*A+P*G,h[2]=U*_+P*I,h[3]=U*y+P*k,h[4]=U*v-P*u,h[5]=U*G-P*A,h[6]=U*I-P*_,h[7]=U*k-P*y,i!==h&&(h[8]=i[8],h[9]=i[9],h[10]=i[10],h[11]=i[11],h[12]=i[12],h[13]=i[13],h[14]=i[14],h[15]=i[15]),h}function b(i,p,f){const h=f??new t(16);let u=i[0],A=i[1],_=i[2];const y=Math.sqrt(u*u+A*A+_*_);u/=y,A/=y,_/=y;const v=u*u,G=A*A,I=_*_,k=Math.cos(p),U=Math.sin(p),P=1-k;return h[0]=v+(1-v)*k,h[1]=u*A*P+_*U,h[2]=u*_*P-A*U,h[3]=0,h[4]=u*A*P-_*U,h[5]=G+(1-G)*k,h[6]=A*_*P+u*U,h[7]=0,h[8]=u*_*P+A*U,h[9]=A*_*P-u*U,h[10]=I+(1-I)*k,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}const a=b;function g(i,p,f,h){const u=h??new t(16);let A=p[0],_=p[1],y=p[2];const v=Math.sqrt(A*A+_*_+y*y);A/=v,_/=v,y/=v;const G=A*A,I=_*_,k=y*y,U=Math.cos(f),P=Math.sin(f),j=1-U,Y=G+(1-G)*U,V=A*_*j+y*P,Q=A*y*j-_*P,ne=A*_*j-y*P,te=I+(1-I)*U,fe=_*y*j+A*P,le=A*y*j+_*P,de=_*y*j-A*P,pe=k+(1-k)*U,Be=i[0],ye=i[1],be=i[2],_e=i[3],Ce=i[4],Me=i[5],Te=i[6],ve=i[7],De=i[8],Ue=i[9],Pe=i[10],He=i[11];return u[0]=Y*Be+V*Ce+Q*De,u[1]=Y*ye+V*Me+Q*Ue,u[2]=Y*be+V*Te+Q*Pe,u[3]=Y*_e+V*ve+Q*He,u[4]=ne*Be+te*Ce+fe*De,u[5]=ne*ye+te*Me+fe*Ue,u[6]=ne*be+te*Te+fe*Pe,u[7]=ne*_e+te*ve+fe*He,u[8]=le*Be+de*Ce+pe*De,u[9]=le*ye+de*Me+pe*Ue,u[10]=le*be+de*Te+pe*Pe,u[11]=le*_e+de*ve+pe*He,i!==u&&(u[12]=i[12],u[13]=i[13],u[14]=i[14],u[15]=i[15]),u}const l=g;function B(i,p){const f=p??new t(16);return f[0]=i[0],f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=i[1],f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=i[2],f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function C(i,p,f){const h=f??new t(16),u=p[0],A=p[1],_=p[2];return h[0]=u*i[0],h[1]=u*i[1],h[2]=u*i[2],h[3]=u*i[3],h[4]=A*i[4],h[5]=A*i[5],h[6]=A*i[6],h[7]=A*i[7],h[8]=_*i[8],h[9]=_*i[9],h[10]=_*i[10],h[11]=_*i[11],i!==h&&(h[12]=i[12],h[13]=i[13],h[14]=i[14],h[15]=i[15]),h}function w(i,p){const f=p??new t(16);return f[0]=i,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=i,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=i,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function x(i,p,f){const h=f??new t(16);return h[0]=p*i[0],h[1]=p*i[1],h[2]=p*i[2],h[3]=p*i[3],h[4]=p*i[4],h[5]=p*i[5],h[6]=p*i[6],h[7]=p*i[7],h[8]=p*i[8],h[9]=p*i[9],h[10]=p*i[10],h[11]=p*i[11],i!==h&&(h[12]=i[12],h[13]=i[13],h[14]=i[14],h[15]=i[15]),h}return{add:d,aim:xe,axisRotate:g,axisRotation:b,cameraAim:$e,clone:D,copy:M,create:n,determinant:z,equals:L,equalsApproximately:R,fromMat3:s,fromQuat:o,frustum:Ye,frustumReverseZ:me,getAxis:ke,getScaling:Le,getTranslation:Re,identity:H,inverse:K,invert:$,lookAt:ie,mul:re,mulScalar:E,multiply:X,multiplyScalar:m,negate:c,ortho:Ee,perspective:ge,perspectiveReverseZ:ze,rotate:l,rotateX:Ge,rotateY:je,rotateZ:O,rotation:a,rotationX:Ze,rotationY:Ke,rotationZ:T,scale:C,scaling:B,set:r,setAxis:Oe,setTranslation:ce,translate:Fe,translation:We,transpose:J,uniformScale:x,uniformScaling:w}}const Ls=new Map;function Dh(t){let e=Ls.get(t);return e||(e=vh(t),Ls.set(t,e)),e}function Fh(t){const e=vn(t);function n(T,O,b,a){const g=new t(4);return T!==void 0&&(g[0]=T,O!==void 0&&(g[1]=O,b!==void 0&&(g[2]=b,a!==void 0&&(g[3]=a)))),g}const r=n;function s(T,O,b,a,g){const l=g??new t(4);return l[0]=T,l[1]=O,l[2]=b,l[3]=a,l}function o(T,O,b){const a=b??new t(4),g=O*.5,l=Math.sin(g);return a[0]=l*T[0],a[1]=l*T[1],a[2]=l*T[2],a[3]=Math.cos(g),a}function c(T,O){const b=O??e.create(3),a=Math.acos(T[3])*2,g=Math.sin(a*.5);return g>W?(b[0]=T[0]/g,b[1]=T[1]/g,b[2]=T[2]/g):(b[0]=1,b[1]=0,b[2]=0),{angle:a,axis:b}}function d(T,O){const b=ge(T,O);return Math.acos(2*b*b-1)}function m(T,O,b){const a=b??new t(4),g=T[0],l=T[1],B=T[2],C=T[3],w=O[0],x=O[1],i=O[2],p=O[3];return a[0]=g*p+C*w+l*i-B*x,a[1]=l*p+C*x+B*w-g*i,a[2]=B*p+C*i+g*x-l*w,a[3]=C*p-g*w-l*x-B*i,a}const E=m;function M(T,O,b){const a=b??new t(4),g=O*.5,l=T[0],B=T[1],C=T[2],w=T[3],x=Math.sin(g),i=Math.cos(g);return a[0]=l*i+w*x,a[1]=B*i+C*x,a[2]=C*i-B*x,a[3]=w*i-l*x,a}function D(T,O,b){const a=b??new t(4),g=O*.5,l=T[0],B=T[1],C=T[2],w=T[3],x=Math.sin(g),i=Math.cos(g);return a[0]=l*i-C*x,a[1]=B*i+w*x,a[2]=C*i+l*x,a[3]=w*i-B*x,a}function R(T,O,b){const a=b??new t(4),g=O*.5,l=T[0],B=T[1],C=T[2],w=T[3],x=Math.sin(g),i=Math.cos(g);return a[0]=l*i+B*x,a[1]=B*i-l*x,a[2]=C*i+w*x,a[3]=w*i-C*x,a}function L(T,O,b,a){const g=a??new t(4),l=T[0],B=T[1],C=T[2],w=T[3];let x=O[0],i=O[1],p=O[2],f=O[3],h=l*x+B*i+C*p+w*f;h<0&&(h=-h,x=-x,i=-i,p=-p,f=-f);let u,A;if(1-h>W){const _=Math.acos(h),y=Math.sin(_);u=Math.sin((1-b)*_)/y,A=Math.sin(b*_)/y}else u=1-b,A=b;return g[0]=u*l+A*x,g[1]=u*B+A*i,g[2]=u*C+A*p,g[3]=u*w+A*f,g}function H(T,O){const b=O??new t(4),a=T[0],g=T[1],l=T[2],B=T[3],C=a*a+g*g+l*l+B*B,w=C?1/C:0;return b[0]=-a*w,b[1]=-g*w,b[2]=-l*w,b[3]=B*w,b}function J(T,O){const b=O??new t(4);return b[0]=-T[0],b[1]=-T[1],b[2]=-T[2],b[3]=T[3],b}function K(T,O){const b=O??new t(4),a=T[0]+T[5]+T[10];if(a>0){const g=Math.sqrt(a+1);b[3]=.5*g;const l=.5/g;b[0]=(T[6]-T[9])*l,b[1]=(T[8]-T[2])*l,b[2]=(T[1]-T[4])*l}else{let g=0;T[5]>T[0]&&(g=1),T[10]>T[g*4+g]&&(g=2);const l=(g+1)%3,B=(g+2)%3,C=Math.sqrt(T[g*4+g]-T[l*4+l]-T[B*4+B]+1);b[g]=.5*C;const w=.5/C;b[3]=(T[l*4+B]-T[B*4+l])*w,b[l]=(T[l*4+g]+T[g*4+l])*w,b[B]=(T[B*4+g]+T[g*4+B])*w}return b}function z(T,O,b,a,g){const l=g??new t(4),B=T*.5,C=O*.5,w=b*.5,x=Math.sin(B),i=Math.cos(B),p=Math.sin(C),f=Math.cos(C),h=Math.sin(w),u=Math.cos(w);switch(a){case"xyz":l[0]=x*f*u+i*p*h,l[1]=i*p*u-x*f*h,l[2]=i*f*h+x*p*u,l[3]=i*f*u-x*p*h;break;case"xzy":l[0]=x*f*u-i*p*h,l[1]=i*p*u-x*f*h,l[2]=i*f*h+x*p*u,l[3]=i*f*u+x*p*h;break;case"yxz":l[0]=x*f*u+i*p*h,l[1]=i*p*u-x*f*h,l[2]=i*f*h-x*p*u,l[3]=i*f*u+x*p*h;break;case"yzx":l[0]=x*f*u+i*p*h,l[1]=i*p*u+x*f*h,l[2]=i*f*h-x*p*u,l[3]=i*f*u-x*p*h;break;case"zxy":l[0]=x*f*u-i*p*h,l[1]=i*p*u+x*f*h,l[2]=i*f*h+x*p*u,l[3]=i*f*u-x*p*h;break;case"zyx":l[0]=x*f*u-i*p*h,l[1]=i*p*u+x*f*h,l[2]=i*f*h-x*p*u,l[3]=i*f*u+x*p*h;break;default:throw new Error(`Unknown rotation order: ${a}`)}return l}function $(T,O){const b=O??new t(4);return b[0]=T[0],b[1]=T[1],b[2]=T[2],b[3]=T[3],b}const X=$;function re(T,O,b){const a=b??new t(4);return a[0]=T[0]+O[0],a[1]=T[1]+O[1],a[2]=T[2]+O[2],a[3]=T[3]+O[3],a}function ce(T,O,b){const a=b??new t(4);return a[0]=T[0]-O[0],a[1]=T[1]-O[1],a[2]=T[2]-O[2],a[3]=T[3]-O[3],a}const Re=ce;function ke(T,O,b){const a=b??new t(4);return a[0]=T[0]*O,a[1]=T[1]*O,a[2]=T[2]*O,a[3]=T[3]*O,a}const Oe=ke;function Le(T,O,b){const a=b??new t(4);return a[0]=T[0]/O,a[1]=T[1]/O,a[2]=T[2]/O,a[3]=T[3]/O,a}function ge(T,O){return T[0]*O[0]+T[1]*O[1]+T[2]*O[2]+T[3]*O[3]}function ze(T,O,b,a){const g=a??new t(4);return g[0]=T[0]+b*(O[0]-T[0]),g[1]=T[1]+b*(O[1]-T[1]),g[2]=T[2]+b*(O[2]-T[2]),g[3]=T[3]+b*(O[3]-T[3]),g}function Ee(T){const O=T[0],b=T[1],a=T[2],g=T[3];return Math.sqrt(O*O+b*b+a*a+g*g)}const Ye=Ee;function me(T){const O=T[0],b=T[1],a=T[2],g=T[3];return O*O+b*b+a*a+g*g}const q=me;function ee(T,O){const b=O??new t(4),a=T[0],g=T[1],l=T[2],B=T[3],C=Math.sqrt(a*a+g*g+l*l+B*B);return C>1e-5?(b[0]=a/C,b[1]=g/C,b[2]=l/C,b[3]=B/C):(b[0]=0,b[1]=0,b[2]=0,b[3]=1),b}function Z(T,O){return Math.abs(T[0]-O[0])<W&&Math.abs(T[1]-O[1])<W&&Math.abs(T[2]-O[2])<W&&Math.abs(T[3]-O[3])<W}function xe(T,O){return T[0]===O[0]&&T[1]===O[1]&&T[2]===O[2]&&T[3]===O[3]}function $e(T){const O=T??new t(4);return O[0]=0,O[1]=0,O[2]=0,O[3]=1,O}const ie=e.create(),We=e.create(),Fe=e.create();function Ze(T,O,b){const a=b??new t(4),g=e.dot(T,O);return g<-.999999?(e.cross(We,T,ie),e.len(ie)<1e-6&&e.cross(Fe,T,ie),e.normalize(ie,ie),o(ie,Math.PI,a),a):g>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(e.cross(T,O,ie),a[0]=ie[0],a[1]=ie[1],a[2]=ie[2],a[3]=1+g,ee(a,a))}const Ge=new t(4),Ke=new t(4);function je(T,O,b,a,g,l){const B=l??new t(4);return L(T,a,g,Ge),L(O,b,g,Ke),L(Ge,Ke,2*g*(1-g),B),B}return{create:n,fromValues:r,set:s,fromAxisAngle:o,toAxisAngle:c,angle:d,multiply:m,mul:E,rotateX:M,rotateY:D,rotateZ:R,slerp:L,inverse:H,conjugate:J,fromMat:K,fromEuler:z,copy:$,clone:X,add:re,subtract:ce,sub:Re,mulScalar:ke,scale:Oe,divScalar:Le,dot:ge,lerp:ze,length:Ee,len:Ye,lengthSq:me,lenSq:q,normalize:ee,equalsApproximately:Z,equals:xe,identity:$e,rotationTo:Ze,sqlerp:je}}const Us=new Map;function Gh(t){let e=Us.get(t);return e||(e=Fh(t),Us.set(t,e)),e}function Ih(t){function e(b,a,g,l){const B=new t(4);return b!==void 0&&(B[0]=b,a!==void 0&&(B[1]=a,g!==void 0&&(B[2]=g,l!==void 0&&(B[3]=l)))),B}const n=e;function r(b,a,g,l,B){const C=B??new t(4);return C[0]=b,C[1]=a,C[2]=g,C[3]=l,C}function s(b,a){const g=a??new t(4);return g[0]=Math.ceil(b[0]),g[1]=Math.ceil(b[1]),g[2]=Math.ceil(b[2]),g[3]=Math.ceil(b[3]),g}function o(b,a){const g=a??new t(4);return g[0]=Math.floor(b[0]),g[1]=Math.floor(b[1]),g[2]=Math.floor(b[2]),g[3]=Math.floor(b[3]),g}function c(b,a){const g=a??new t(4);return g[0]=Math.round(b[0]),g[1]=Math.round(b[1]),g[2]=Math.round(b[2]),g[3]=Math.round(b[3]),g}function d(b,a=0,g=1,l){const B=l??new t(4);return B[0]=Math.min(g,Math.max(a,b[0])),B[1]=Math.min(g,Math.max(a,b[1])),B[2]=Math.min(g,Math.max(a,b[2])),B[3]=Math.min(g,Math.max(a,b[3])),B}function m(b,a,g){const l=g??new t(4);return l[0]=b[0]+a[0],l[1]=b[1]+a[1],l[2]=b[2]+a[2],l[3]=b[3]+a[3],l}function E(b,a,g,l){const B=l??new t(4);return B[0]=b[0]+a[0]*g,B[1]=b[1]+a[1]*g,B[2]=b[2]+a[2]*g,B[3]=b[3]+a[3]*g,B}function M(b,a,g){const l=g??new t(4);return l[0]=b[0]-a[0],l[1]=b[1]-a[1],l[2]=b[2]-a[2],l[3]=b[3]-a[3],l}const D=M;function R(b,a){return Math.abs(b[0]-a[0])<W&&Math.abs(b[1]-a[1])<W&&Math.abs(b[2]-a[2])<W&&Math.abs(b[3]-a[3])<W}function L(b,a){return b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]&&b[3]===a[3]}function H(b,a,g,l){const B=l??new t(4);return B[0]=b[0]+g*(a[0]-b[0]),B[1]=b[1]+g*(a[1]-b[1]),B[2]=b[2]+g*(a[2]-b[2]),B[3]=b[3]+g*(a[3]-b[3]),B}function J(b,a,g,l){const B=l??new t(4);return B[0]=b[0]+g[0]*(a[0]-b[0]),B[1]=b[1]+g[1]*(a[1]-b[1]),B[2]=b[2]+g[2]*(a[2]-b[2]),B[3]=b[3]+g[3]*(a[3]-b[3]),B}function K(b,a,g){const l=g??new t(4);return l[0]=Math.max(b[0],a[0]),l[1]=Math.max(b[1],a[1]),l[2]=Math.max(b[2],a[2]),l[3]=Math.max(b[3],a[3]),l}function z(b,a,g){const l=g??new t(4);return l[0]=Math.min(b[0],a[0]),l[1]=Math.min(b[1],a[1]),l[2]=Math.min(b[2],a[2]),l[3]=Math.min(b[3],a[3]),l}function $(b,a,g){const l=g??new t(4);return l[0]=b[0]*a,l[1]=b[1]*a,l[2]=b[2]*a,l[3]=b[3]*a,l}const X=$;function re(b,a,g){const l=g??new t(4);return l[0]=b[0]/a,l[1]=b[1]/a,l[2]=b[2]/a,l[3]=b[3]/a,l}function ce(b,a){const g=a??new t(4);return g[0]=1/b[0],g[1]=1/b[1],g[2]=1/b[2],g[3]=1/b[3],g}const Re=ce;function ke(b,a){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]*a[3]}function Oe(b){const a=b[0],g=b[1],l=b[2],B=b[3];return Math.sqrt(a*a+g*g+l*l+B*B)}const Le=Oe;function ge(b){const a=b[0],g=b[1],l=b[2],B=b[3];return a*a+g*g+l*l+B*B}const ze=ge;function Ee(b,a){const g=b[0]-a[0],l=b[1]-a[1],B=b[2]-a[2],C=b[3]-a[3];return Math.sqrt(g*g+l*l+B*B+C*C)}const Ye=Ee;function me(b,a){const g=b[0]-a[0],l=b[1]-a[1],B=b[2]-a[2],C=b[3]-a[3];return g*g+l*l+B*B+C*C}const q=me;function ee(b,a){const g=a??new t(4),l=b[0],B=b[1],C=b[2],w=b[3],x=Math.sqrt(l*l+B*B+C*C+w*w);return x>1e-5?(g[0]=l/x,g[1]=B/x,g[2]=C/x,g[3]=w/x):(g[0]=0,g[1]=0,g[2]=0,g[3]=0),g}function Z(b,a){const g=a??new t(4);return g[0]=-b[0],g[1]=-b[1],g[2]=-b[2],g[3]=-b[3],g}function xe(b,a){const g=a??new t(4);return g[0]=b[0],g[1]=b[1],g[2]=b[2],g[3]=b[3],g}const $e=xe;function ie(b,a,g){const l=g??new t(4);return l[0]=b[0]*a[0],l[1]=b[1]*a[1],l[2]=b[2]*a[2],l[3]=b[3]*a[3],l}const We=ie;function Fe(b,a,g){const l=g??new t(4);return l[0]=b[0]/a[0],l[1]=b[1]/a[1],l[2]=b[2]/a[2],l[3]=b[3]/a[3],l}const Ze=Fe;function Ge(b){const a=b??new t(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a}function Ke(b,a,g){const l=g??new t(4),B=b[0],C=b[1],w=b[2],x=b[3];return l[0]=a[0]*B+a[4]*C+a[8]*w+a[12]*x,l[1]=a[1]*B+a[5]*C+a[9]*w+a[13]*x,l[2]=a[2]*B+a[6]*C+a[10]*w+a[14]*x,l[3]=a[3]*B+a[7]*C+a[11]*w+a[15]*x,l}function je(b,a,g){const l=g??new t(4);return ee(b,l),$(l,a,l)}function T(b,a,g){const l=g??new t(4);return Oe(b)>a?je(b,a,l):xe(b,l)}function O(b,a,g){const l=g??new t(4);return H(b,a,.5,l)}return{create:e,fromValues:n,set:r,ceil:s,floor:o,round:c,clamp:d,add:m,addScaled:E,subtract:M,sub:D,equalsApproximately:R,equals:L,lerp:H,lerpV:J,max:K,min:z,mulScalar:$,scale:X,divScalar:re,inverse:ce,invert:Re,dot:ke,length:Oe,len:Le,lengthSq:ge,lenSq:ze,distance:Ee,dist:Ye,distanceSq:me,distSq:q,normalize:ee,negate:Z,copy:xe,clone:$e,multiply:ie,mul:We,divide:Fe,div:Ze,zero:Ge,transformMat4:Ke,setLength:je,truncate:T,midpoint:O}}const Ps=new Map;function Sh(t){let e=Ps.get(t);return e||(e=Ih(t),Ps.set(t,e)),e}function Ir(t,e,n,r,s,o){return{mat3:Th(t),mat4:Dh(e),quat:Gh(n),vec2:jo(r),vec3:vn(s),vec4:Sh(o)}}const{mat4:Se,vec3:se}=Ir(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);Ir(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);Ir(wh,Array,Array,Array,Array,Array);function Rh(){hc([ur,_o])}function Xn(t,e){const n=t.json,r=n.accessors[e],s=n.bufferViews[r.bufferView],o=t.buffers[s.buffer],c=(r.byteOffset??0)+(s.byteOffset??0)+o.byteOffset;return new Float32Array(o.arrayBuffer,c,s.byteLength/4)}class Oh{image;sampler;constructor(e,n){this.image=e,this.sampler=n}}class Sr{static nextId=0;id;materialBindGroup;constructor(e,n){this.id=Sr.nextId++;const r=n[e.pbrMetallicRoughness.baseColorTexture.index];this.materialBindGroup=N.createBindGroup({label:"material bind group",layout:Kt,entries:[{binding:0,resource:r.image.createView()},{binding:1,resource:r.sampler}]})}}class Lh{vertexBuffer;indexBuffer;numIndices=-1;material;constructor(e,n,r){this.material=r;const s=n.json,o=s.accessors[e.indices],c=s.bufferViews[o.bufferView],d=o.componentType,m=n.buffers[c.buffer],E=(o.byteOffset??0)+(c.byteOffset??0)+m.byteOffset;let M;switch(d){case 5123:M=Uint32Array.from(new Uint16Array(m.arrayBuffer,E,o.count));break;case 5125:M=new Uint32Array(m.arrayBuffer,E,o.count);break;default:throw new Error(`unsupported index buffer element component type: 0x${d.toString(16)}`)}const D=Xn(n,e.attributes.POSITION),R=Xn(n,e.attributes.NORMAL),L=Xn(n,e.attributes.TEXCOORD_0),H=8,J=D.length/3,K=new Float32Array(J*H);for(let z=0;z<J;++z){const $=z*H;K[$]=D[z*3],K[$+1]=D[z*3+1],K[$+2]=D[z*3+2],K[$+3]=R[z*3],K[$+4]=R[z*3+1],K[$+5]=R[z*3+2],K[$+6]=L[z*2],K[$+7]=L[z*2+1]}this.indexBuffer=N.createBuffer({label:"index buffer",size:M.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST}),N.queue.writeBuffer(this.indexBuffer,0,M),this.vertexBuffer=N.createBuffer({label:"vertex buffer",size:K.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),N.queue.writeBuffer(this.vertexBuffer,0,K),this.numIndices=M.length}}class Uh{primitives=[];constructor(e,n,r){e.primitives.forEach(s=>{this.primitives.push(new Lh(s,n,r[s.material]))}),this.primitives.sort((s,o)=>s.material.id-o.material.id)}}class Qn{name="node";parent;children=new Set;transform=Se.identity();modelMatUniformBuffer;modelBindGroup;mesh;setName(e){this.name=e}setParent(e){this.parent!=null&&this.parent.children.delete(this),this.parent=e,e.children.add(this)}propagateTransformations(){this.parent!=null&&(this.transform=Se.mul(this.parent.transform,this.transform)),this.mesh!=null&&(this.modelMatUniformBuffer=N.createBuffer({label:"model mat uniform",size:64,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),N.queue.writeBuffer(this.modelMatUniformBuffer,0,this.transform),this.modelBindGroup=N.createBindGroup({label:"model bind group",layout:kt,entries:[{binding:0,resource:{buffer:this.modelMatUniformBuffer}}]}));for(let e of this.children)e.propagateTransformations()}}function Ph(t){let e=N.createTexture({size:[t.width,t.height],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});return N.queue.copyExternalImageToTexture({source:t},{texture:e},{width:t.width,height:t.height}),e}function Hs(t){switch(t){case 10497:return"repeat";case 33071:return"clamp-to-edge";case 33648:return"mirror-repeat";default:throw new Error(`unsupported wrap mode: 0x${t.toString(16)}`)}}function Hh(t){let e={};switch(t.magFilter){case 9728:e.magFilter="nearest";break;case 9729:e.magFilter="linear";break;default:throw new Error(`unsupported magFilter: 0x${t.magFilter.toString(16)}`)}switch(t.minFilter){case 9728:e.minFilter="nearest";break;case 9729:e.minFilter="linear";break;case 9984:e.minFilter="nearest",e.mipmapFilter="nearest";break;case 9985:e.minFilter="linear",e.mipmapFilter="nearest";break;case 9986:e.minFilter="nearest",e.mipmapFilter="linear";break;case 9987:e.minFilter="linear",e.mipmapFilter="linear";break;default:throw new Error(`unsupported minFilter: 0x${t.minFilter.toString(16)}`)}return e.addressModeU=Hs(t.wrapS),e.addressModeV=Hs(t.wrapT),N.createSampler(e)}class Jh{root=new Qn;constructor(){this.root.setName("root")}async loadGltf(e){const n=await kc(e),r=n.json;let s=[];{let E=[];for(let D of n.images)E.push(Ph(D));let M=[];for(let D of r.samplers)M.push(Hh(D));for(let D of r.textures)s.push(new Oh(E[D.source],M[D.sampler]))}let o=[];for(let E of r.materials)o.push(new Sr(E,s));let c=[];for(let E of r.meshes)c.push(new Uh(E,n,o));let d=new Qn;d.setName("scene root"),d.setParent(this.root);let m=[];for(let E of r.nodes){let M=new Qn;M.setName(E.name),M.setParent(d),E.mesh!=null&&(M.mesh=c[E.mesh]),E.matrix!=null?M.transform=new Float32Array(E.matrix):(E.translation!=null&&(M.transform=Se.mul(M.transform,Se.translation(E.translation))),E.rotation!=null&&(M.transform=Se.mul(M.transform,Se.fromQuat(E.rotation))),E.scale!=null&&(M.transform=Se.mul(M.transform,Se.scaling(E.scale)))),m.push(M)}for(let E in r.nodes){const M=r.nodes[E];if(M.children!=null)for(let D of M.children)m[D].setParent(m[E])}d.propagateTransformations()}iterate(e,n,r){let s=[this.root],o;for(;s.length>0;){let c=s.pop();if(c.mesh!=null){e(c);for(let d of c.mesh.primitives)d.material.id!=o&&(n(d.material),o=d.material.id),r(d)}for(let d of c.children)s.push(d)}}}function Nh(t){let e=(n,r=(n+t*6)%6)=>1-Math.max(Math.min(r,4-r,1),0);return se.lerp(se.create(1,1,1),se.create(e(5),e(3),e(1)),.8)}class it{camera;numLights=1e3;static maxNumLights=5e3;static numFloatsPerLight=8;static lightIntensity=.1;lightsArray=new Float32Array(it.maxNumLights*it.numFloatsPerLight);lightSetStorageBuffer;timeUniformBuffer;moveLightsComputeBindGroupLayout;moveLightsComputeBindGroup;moveLightsComputePipeline;numClusters;sceneUniformsComputeBindGroupLayout;sceneUniformsComputeBindGroup;clusterSetStorageBuffer;clusteredLightsComputeBindGroupLayout;clusterLightsComputeBindGroup;clusteringComputePipeline;constructor(e){this.camera=e,this.lightSetStorageBuffer=N.createBuffer({label:"lights",size:16+this.lightsArray.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.populateLightsBuffer(),this.updateLightSetUniformNumLights(),this.timeUniformBuffer=N.createBuffer({label:"time uniform",size:4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.moveLightsComputeBindGroupLayout=N.createBindGroupLayout({label:"move lights compute bind group layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]}),this.moveLightsComputeBindGroup=N.createBindGroup({label:"move lights compute bind group",layout:this.moveLightsComputeBindGroupLayout,entries:[{binding:0,resource:{buffer:this.lightSetStorageBuffer}},{binding:1,resource:{buffer:this.timeUniformBuffer}}]}),this.moveLightsComputePipeline=N.createComputePipeline({label:"move lights compute pipeline",layout:N.createPipelineLayout({label:"move lights compute pipeline layout",bindGroupLayouts:[this.moveLightsComputeBindGroupLayout]}),compute:{module:N.createShaderModule({label:"move lights compute shader",code:Ni}),entryPoint:"main"}}),this.sceneUniformsComputeBindGroupLayout=N.createBindGroupLayout({label:"scene uniforms compute bind group layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]}),this.sceneUniformsComputeBindGroup=N.createBindGroup({label:"scene uniforms compute bind group",layout:this.sceneUniformsComputeBindGroupLayout,entries:[{binding:0,resource:{buffer:this.camera.uniformsBuffer}}]});const n=Math.ceil(ae.width/ue.clusterPixelSize),r=Math.ceil(ae.height/ue.clusterPixelSize);this.numClusters=n*r*ue.numClustersZ,this.clusterSetStorageBuffer=N.createBuffer({label:"clustered lights",size:8+this.numClusters*(1+ue.maxLightsPerCluster)*4,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),N.queue.writeBuffer(this.clusterSetStorageBuffer,0,new Uint32Array([n,r])),this.clusteredLightsComputeBindGroupLayout=N.createBindGroupLayout({label:"clustered lights compute bind group layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]}),this.clusterLightsComputeBindGroup=N.createBindGroup({label:"cluster lights compute bind group",layout:this.clusteredLightsComputeBindGroupLayout,entries:[{binding:0,resource:{buffer:this.lightSetStorageBuffer}},{binding:1,resource:{buffer:this.clusterSetStorageBuffer}}]}),this.clusteringComputePipeline=N.createComputePipeline({label:"clustering compute pipeline",layout:N.createPipelineLayout({label:"clustering compute pipeline layout",bindGroupLayouts:[this.sceneUniformsComputeBindGroupLayout,this.clusteredLightsComputeBindGroupLayout]}),compute:{module:N.createShaderModule({label:"clustering compute shader",code:ki}),entryPoint:"main"}})}populateLightsBuffer(){for(let e=0;e<it.maxNumLights;++e){const n=se.scale(Nh(Math.random()),it.lightIntensity);this.lightsArray.set(n,e*it.numFloatsPerLight+4)}N.queue.writeBuffer(this.lightSetStorageBuffer,16,this.lightsArray)}updateLightSetUniformNumLights(){N.queue.writeBuffer(this.lightSetStorageBuffer,0,new Uint32Array([this.numLights]))}doLightClustering(e){const n=e.beginComputePass();n.setPipeline(this.clusteringComputePipeline),n.setBindGroup(0,this.sceneUniformsComputeBindGroup),n.setBindGroup(1,this.clusterLightsComputeBindGroup);const r=Math.ceil(this.numClusters/ue.clusteringWorkGroupSize);n.dispatchWorkgroups(r),n.end()}onFrame(e){N.queue.writeBuffer(this.timeUniformBuffer,0,new Float32Array([e]));const n=N.createCommandEncoder(),r=n.beginComputePass();r.setPipeline(this.moveLightsComputePipeline),r.setBindGroup(0,this.moveLightsComputeBindGroup);const s=Math.ceil(this.numLights/ue.moveLightsWorkgroupSize);r.dispatchWorkgroups(s),r.end(),N.queue.submit([n.finish()])}}function _t(t){return t*Math.PI/180}class kh{buffer=new ArrayBuffer(192);floatView=new Float32Array(this.buffer);set viewProjMat(e){this.floatView.set(e.subarray(0,16),0)}set invProjMat(e){this.floatView.set(e.subarray(0,16),16)}set viewMat(e){this.floatView.set(e.subarray(0,16),32)}}class _n{uniforms=new kh;uniformsBuffer;projMat=Se.create();cameraPos=se.create(-7,2,0);cameraFront=se.create(0,0,-1);cameraUp=se.create(0,1,0);cameraRight=se.create(1,0,0);yaw=0;pitch=0;moveSpeed=.004;sensitivity=.15;static nearPlane=.1;static farPlane=1e3;keys={};constructor(){this.uniformsBuffer=N.createBuffer({size:this.uniforms.buffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.projMat=Se.perspective(_t(wi),Qs,_n.nearPlane,_n.farPlane),this.rotateCamera(0,0),window.addEventListener("keydown",e=>this.onKeyEvent(e,!0)),window.addEventListener("keyup",e=>this.onKeyEvent(e,!1)),window.onblur=()=>this.keys={},ae.addEventListener("mousedown",()=>ae.requestPointerLock()),ae.addEventListener("mouseup",()=>document.exitPointerLock()),ae.addEventListener("mousemove",e=>this.onMouseMove(e))}onKeyEvent(e,n){this.keys[e.key.toLowerCase()]=n,this.keys.alt&&e.preventDefault()}rotateCamera(e,n){this.yaw+=e,this.pitch-=n,this.pitch>89&&(this.pitch=89),this.pitch<-89&&(this.pitch=-89);const r=Se.create();r[0]=Math.cos(_t(this.yaw))*Math.cos(_t(this.pitch)),r[1]=Math.sin(_t(this.pitch)),r[2]=Math.sin(_t(this.yaw))*Math.cos(_t(this.pitch)),this.cameraFront=se.normalize(r),this.cameraRight=se.normalize(se.cross(this.cameraFront,[0,1,0])),this.cameraUp=se.normalize(se.cross(this.cameraRight,this.cameraFront))}onMouseMove(e){document.pointerLockElement===ae&&this.rotateCamera(e.movementX*this.sensitivity,e.movementY*this.sensitivity)}processInput(e){let n=se.create(0,0,0);this.keys.w&&(n=se.add(n,this.cameraFront)),this.keys.s&&(n=se.sub(n,this.cameraFront)),this.keys.a&&(n=se.sub(n,this.cameraRight)),this.keys.d&&(n=se.add(n,this.cameraRight)),this.keys.q&&(n=se.sub(n,this.cameraUp)),this.keys.e&&(n=se.add(n,this.cameraUp));let r=this.moveSpeed*e;const s=3;if(this.keys.shift&&(r*=s),this.keys.alt&&(r/=s),se.length(n)>0){const o=se.scale(se.normalize(n),r);this.cameraPos=se.add(this.cameraPos,o)}}onFrame(e){this.processInput(e);const n=se.add(this.cameraPos,se.scale(this.cameraFront,1)),r=Se.lookAt(this.cameraPos,n,[0,1,0]),s=Se.mul(this.projMat,r);this.uniforms.viewProjMat=s,this.uniforms.invProjMat=Se.inverse(this.projMat),this.uniforms.viewMat=r,N.queue.writeBuffer(this.uniformsBuffer,0,this.uniforms.buffer)}}class Kh{scene;lights;camera;stats;constructor(e,n,r,s){this.scene=e,this.lights=n,this.camera=r,this.stats=s}}await Ei();Rh();let Vo=new Jh;await Vo.loadGltf("./scenes/sponza/Sponza.gltf");const Xo=new _n,fr=new it(Xo),Rr=new ei;Rr.showPanel(0);document.body.appendChild(Rr.dom);const Qo=new Ci;Qo.add(fr,"numLights").min(1).max(it.maxNumLights).step(1).onChange(()=>{fr.updateLightSetUniformNumLights()});const zn=new Kh(Vo,fr,Xo,Rr);var un;function zo(t){switch(un?.stop(),t){case Ut.naive:un=new Ki(zn);break;case Ut.forwardPlus:un=new ji(zn);break;case Ut.clusteredDeferred:un=new Vi(zn);break}}const Ut={naive:"naive",forwardPlus:"forward+",clusteredDeferred:"clustered deferred"};let Yo=Qo.add({mode:Ut.naive},"mode",Ut);Yo.onChange(zo);zo(Yo.getValue());
